if (window.performance && window.performance.mark) { window.performance.mark('startLoadBundleInner-async'); }
// Copyright (C) Microsoft Corporation. All rights reserved.
var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__assign=this&&this.__assign||Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__rest=this&&this.__rest||function(n,t){var u={},r;for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(u[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&(u[i[r]]=n[i[r]]);return u};define("VersionControl/Scenarios/Shared/FileViewers/BlameList",["require","exports","OfficeFabric/Button","OfficeFabric/FocusZone","OfficeFabric/List","OfficeFabric/Spinner","OfficeFabric/Tooltip","OfficeFabric/Utilities","react","VSS/Utils/Date","VersionControl/Scenarios/Shared/CommitHash","VersionControl/Scripts/Controls/ControlsCommon","VersionControl/Scripts/Generated/TFS.VersionControl.Legacy.Contracts","VersionControl/Scripts/GitIdentityHelper","VersionControl/Scripts/RepositoryContext","VersionControl/Scripts/Resources/TFS.Resources.VersionControl","VersionControl/Scripts/TFS.VersionControl","VersionControl/Scripts/Utils/Number","VersionControl/Scripts/VersionControlUrls","VSS/LoaderPlugins/Css!VersionControl/Shared/FileViewers/BlameList"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){function tt(n,t,i,r){var u=t.versionsMap[n.version];return s.createElement(it,{repositoryContext:t.repositoryContext,path:u?u.serverItem:t.path,changeList:u&&u.changeList,isEdit:w.ChangeType.hasChangeFlag(u&&u.itemChangeType,a.VersionControlChangeType.Edit),hasOlderChange:n.version!==t.firstVersion,blockHeight:n.lineCount*t.lineHeight,isCurrentVersion:n.version===i.selectedVersion,isCurrentBlock:et(i.highlightLineNumber,n),startLine:n.startLine,onClick:r,onCommitClick:t.onCommitClick,onFocus:r,onViewBlamePrior:t.onViewBlamePrior})}function et(n,t){return t.startLine<=n&&n<t.startLine+t.lineCount}function ut(n){var u=n.isEdit?l.VersionControlActionIds.Compare:l.VersionControlActionIds.Contents,t,i,r;return n.repositoryContext.getRepositoryType()===y.RepositoryType.Git?(t=n.changeList.commitId,{commitId:t,href:k.getCommitUrlForFile(n.repositoryContext,t.full,n.path,u)}):(i=n.changeList.changesetId,r=i.toString(),{commitId:{full:r,short:r},href:k.getChangesetUrlForFile(i,n.path,u,n.repositoryContext.getTfsContext())})}var g,nt,it,rt,d,ft;Object.defineProperty(t,"__esModule",{value:!0}),function(n){n.blocksPerPage=10}(g||(g={}));nt=function(n){function t(t){var i=n.call(this,t)||this;return i.onRenderCell=function(n){return tt(n,i.props,i.state,i.setHighlightLineNumber)},i.setHighlightLineNumber=function(n){i.setState({highlightLineNumber:n,selectedVersion:i.props.getVersion(n)},function(){return i.list&&i.list.forceUpdate()})},i.getItemCountForPage=function(){return g.blocksPerPage},i.getPageHeight=function(n){var r=i.props.blocks[n].startLine,t=Math.min(n+g.blocksPerPage,i.props.blocks.length)-1,u=i.props.blocks[t].startLine+i.props.blocks[t].lineCount,f=u-r;return f*i.props.lineHeight},i.state={highlightLineNumber:t.currentLineNumber,selectedVersion:t.getVersion(t.currentLineNumber)},i}return __extends(t,n),t.prototype.componentWillReceiveProps=function(n){this.props.currentLineNumber!==n.currentLineNumber&&this.setHighlightLineNumber(n.currentLineNumber)},t.prototype.render=function(){var n=this;return this.props.blocks?s.createElement(ft,{className:"vc-blame-list",scrollTop:this.props.scrollTop,onScroll:this.props.onScroll},s.createElement("div",{style:{height:this.props.firstLineTop}}),s.createElement(r.FocusZone,{direction:r.FocusZoneDirection.bidirectional},s.createElement(u.List,{ref:function(t){return n.list=t},items:this.props.blocks,onRenderCell:this.onRenderCell,getPageHeight:this.getPageHeight,getItemCountForPage:this.getItemCountForPage}))):s.createElement(f.Spinner,{type:f.SpinnerType.large,label:p.LoadingText})},t}(s.PureComponent);t.BlameList=nt;t.renderBlock=tt;it=function(n){var i=n.blockHeight,t=n.isCurrentBlock,r=n.isCurrentVersion,u=__rest(n,["blockHeight","isCurrentBlock","isCurrentVersion"]);return s.createElement("div",{className:"annotation-block",role:"row","aria-selected":t,style:{height:i}},r&&s.createElement("div",{className:o.css("selected-annotation-block-marker",{"selected-line":t})}),s.createElement(rt,__assign({},u)))};rt=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.onClick=function(){t.commitHash.focus();t.props.onClick(t.props.startLine)},t.onFocus=function(){t.props.onFocus(t.props.startLine)},t.onViewBlamePrior=function(){t.props.onViewBlamePrior(t.props.changeList)},t}return __extends(t,n),t.prototype.render=function(){var n=this;return this.props.changeList?s.createElement("div",{className:"annotation-details",role:"presentation",onClick:this.onClick},s.createElement(d,{className:"change-list",content:this.props.changeList.comment},s.createElement(c.CommitHash,__assign({},ut(this.props),{ref:function(t){return n.commitHash=t},showCopyButton:!1,showTooltip:!1,onLinkClick:this.props.onCommitClick,onFocus:this.onFocus}))),s.createElement(d,{content:p.BlamePriorThisChange,className:"blame-prior-tooltip-host",tabIndex:-1},this.props.hasOlderChange&&s.createElement(i.IconButton,{className:"blame-prior-button",iconProps:{iconName:"Rewind"},ariaLabel:p.BlamePriorThisChange,onClick:this.onViewBlamePrior})),s.createElement(d,{className:"owner",content:this.props.changeList.ownerDisplayName},v.getUserNameWithoutEmail(this.props.changeList.ownerDisplayName)),s.createElement(d,{className:"date",content:h.localeFormat(this.props.changeList.creationDate,"F")},h.friendly(this.props.changeList.creationDate))):null},t}(s.PureComponent);t.getCommitHashProps=ut;d=function(n){return s.createElement("div",{className:n.className,tabIndex:n.tabIndex},s.createElement(e.TooltipHost,{calloutProps:{gapSpace:0},content:n.content,directionalHint:1},n.children))};ft=function(n){function t(){var i=n!==null&&n.apply(this,arguments)||this;return i.captureElement=function(n){if(i.element=n,n&&!t.hideScrollbarStyle){var r=n.offsetWidth-n.clientWidth;t.hideScrollbarStyle={marginRight:-r,paddingBottom:r};i.forceUpdate()}},i.onScroll=function(){if(i.element)i.props.onScroll(i.element.scrollTop)},i}return __extends(t,n),t.prototype.componentDidUpdate=function(){this.element&&this.props.scrollTop!==undefined&&!b.areSimilar(this.element.scrollTop,this.props.scrollTop)&&(this.element.scrollTop=this.props.scrollTop)},t.prototype.render=function(){return s.createElement("div",{className:"scrollable-without-bars-outer "+(this.props.className||"")},s.createElement("div",{className:"scrollable-without-bars-inner",ref:this.captureElement,style:t.hideScrollbarStyle,onScroll:this.onScroll},this.props.children))},t}(s.PureComponent)});
var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}();define("VSS/Controls/Panels",["require","exports","VSS/Ajax","VSS/Controls","VSS/Diag","VSS/Resources/VSS.Resources.Platform","VSS/Controls/StatusIndicator","VSS/Utils/Core","VSS/Utils/UI","VSS/VSS","VSS/LoaderPlugins/Css!VSS.Controls"],function(n,t,i,r,u,f,e,o,s,h){var a,v;Object.defineProperty(t,"__esModule",{value:!0});var c=s.domElem,y=h.getErrorMessage,l=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,$.extend({collapsed:!0,iconCss:"icon",iconCollapseCss:"bowtie-icon bowtie-toggle-tree-collapsed",iconExpandCss:"bowtie-icon bowtie-toggle-tree-expanded"},t))},t.prototype._swapDefaultToggleIconForCustom=function(n){this._$toggleIcon.remove();this._$toggleIcon=n;this._header.addClass(t._defaultToggleIconOverrideClass)},t.prototype._createControl=function(){var t=this,n=this._options;return this._isDisabled=!1,n.hoverCss&&this.getElement().hover(function(){$(this).addClass(n.hoverCss)},function(){$(this).removeClass(n.hoverCss)}),this._header=$(c("div","tfs-collapsible-header")),this._options.headerNotFocusable?this._header.attr("role","presentation"):this._header.attr({tabIndex:"0",role:"button","aria-expanded":String(this.isExpanded())}),n.headerCss&&this._header.addClass(n.headerCss),this._header.bind("click.CollapsiblePanel",function(){return t.toggleExpandedState()}),this._header.bind("keydown",function(n){if(n.target===n.currentTarget&&(n.keyCode===s.KeyCode.ENTER||n.keyCode===s.KeyCode.SPACE)&&!s.KeyUtils.isModifierKey(n))return t.toggleExpandedState()}),this._header.bind("mouseenter focus",function(n){return n.preventDefault(),t._header.addClass("focus"),!1}),this._header.bind("mouseleave blur",function(n){return n.preventDefault(),t._header.removeClass("focus"),!1}),this._$toggleIcon=$(c("span","tfs-collapsible-collapse")).attr("aria-hidden","true").addClass(n.iconCss).addClass(n.collapsed?n.iconCollapseCss:n.iconExpandCss),n.collapseCss&&this._$toggleIcon.addClass(n.collapseCss),this._header.append(this._$toggleIcon),this.getElement().append(this._header),this._content=$(c("div","tfs-collapsible-content")),n.contentCss&&this._content.addClass(n.contentCss),n.collapsed&&this._content.hide(),this.getElement().append(this._content),this.getElement()},t.prototype._createIn=function(t){n.prototype._createIn.call(this,t);this._createControl()},t.prototype._enhance=function(n){if(this._options.collapsed=n.hasClass("collapsed"),this._createElement(),this._createControl(),n.after(this.getElement()),this.appendContent(n),this._options.headerText)this.appendHeaderText(this._options.headerText);else if(this._options.headerContent)this.appendHeader(this._options.headerContent),this._options.customToggleIcon&&this._swapDefaultToggleIconForCustom(this._options.customToggleIcon);else{var t=n.attr("title");t&&(n.hasClass("header")&&(n.removeClass("header"),this._header.addClass("header")),this.appendHeader(t))}},t.prototype.replaceHeaderTextIfPresent=function(n){return $("span.tfs-collapsible-text",this._header).text(n)},t.prototype.appendHeaderText=function(n){this._header.attr("title",n);var t=$("<span/>").text(n).addClass("tfs-collapsible-text");return(this._options.headingLevel===undefined||this._options.headingLevel>0)&&t.attr({role:"heading","aria-level":this._options.headingLevel?String(this._options.headingLevel):"2"}),this.appendHeader(t)},t.prototype.appendHeader=function(n){return this._header.append(n),this},t.prototype.prependHeader=function(n){return this._header.prepend(n),this},t.prototype.appendContent=function(n){var i=this._options,t;return $.isFunction(n)?i.collapsed?(this._dynamicContents||(this._dynamicContents=[]),this._dynamicContents.push(n)):t=n.call(this):t=n,t&&typeof t!="function"&&(this._content.append(t),this.getElement().removeClass("collapsed")),this},t.prototype.isExpanded=function(){return this._options.collapsed?!1:!0},t.prototype.expand=function(){this.isExpanded()||this.toggleExpandedState()},t.prototype.collapse=function(){this.isExpanded()&&this.toggleExpandedState()},t.prototype.toggleExpandedState=function(){var n=this._options,r=this._content,o=this._dynamicContents,u,i,f,e;if(this._isDisabled)return!1;if(n.collapsed=!n.collapsed,u=this._$toggleIcon,u.removeClass(n.iconCollapseCss+" "+n.iconExpandCss),u.addClass(n.collapsed?n.iconCollapseCss:n.iconExpandCss),this._options.headerNotFocusable||this._header.attr("aria-expanded",String(!n.collapsed)),n.collapsed)r.hide(),n.expandCss&&this.getElement().removeClass(n.expandCss),this._fire(t.EVENT_CONTENT_COLLAPSED);else{if(o){for(i=0,f=o;i<f.length;i++)e=f[i],typeof e=="function"&&r.append(e.apply(undefined));this._dynamicContents=null}r.show();n.expandCss&&this.getElement().addClass(n.expandCss);this._fire(t.EVENT_CONTENT_EXPANDED)}if(this._options.onToggleCallback&&$.isFunction(this._options.onToggleCallback))this._options.onToggleCallback(this.isExpanded());return!1},t.prototype.setDisabled=function(n){this._isDisabled!==n&&(n?(this._header.addClass("disabled"),this._$toggleIcon.hide(),this._header.removeAttr("tabindex")):(this._header.removeClass("disabled"),this._$toggleIcon.show(),this._header.attr("tabindex","0")),this._isDisabled=n)},t.prototype.isCollapsiblePanelDisabled=function(){return this._isDisabled},t.EVENT_CONTENT_EXPANDED="collapsible-panel-expanded",t.EVENT_CONTENT_COLLAPSED="collapsible-panel-collapsed",t.enhancementTypeName="tfs.collapsiblepanel",t._defaultToggleIconOverrideClass="custom-toggle-icon",t}(r.Control);t.CollapsiblePanel=l;r.Enhancement.registerJQueryWidget(l,"collapsible");r.Enhancement.registerEnhancement(l,".tfs-collapsible");a=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,$.extend({cssClass:"ajax-panel",replaceContent:!0,cache:!0},t))},t.prototype.initialize=function(){var t=this._options.url;n.prototype.initialize.call(this);t&&this.beginLoad(t,this._options.urlParams,this._options.success,this._options.error)},t.prototype._dispose=function(){this._cancelPendingLoad();n.prototype._dispose.call(this)},t.prototype.beginLoad=function(n,t,s,h){var l=this,c,a;u.logTracePoint("AjaxPanel.beginLoad.start");this._cancelPendingLoad();c=new o.Cancelable(this);this._cancelable=c;this.getElement().empty();this._options.showStatusIndicator!==!1&&(a=r.BaseControl.createIn(e.StatusIndicator,this.getElement(),{center:!0,imageClass:"big-status-progress",message:f.Loading}),a.start());this._element.attr("aria-busy","true");i.issueRequest(n,{type:"GET",data:t,dataType:"html",traditional:!0,cache:this._options.cache}).then(c.wrap(function(n){l.onLoadCompleted(n);$.isFunction(s)&&s.call(self,n)}),c.wrap(function(n){var t;$.isFunction(h)&&(t=h.call(self,n)===!0);l.onLoadError(n,t)}))},t.prototype.onLoadCompleted=function(n){this.getElement()&&this._options.replaceContent&&(this.getElement().empty(),this.getElement().html(n),r.Enhancement.ensureEnhancements(this.getElement()));this._element.removeAttr("aria-busy");u.logTracePoint("AjaxPanel.beginLoad.complete")},t.prototype.onLoadError=function(n,t){t||this.showError(n);this._element.removeAttr("aria-busy");u.logTracePoint("AjaxPanel.beginLoad.complete")},t.prototype.showError=function(n){this.getElement().empty();$(c("div","error")).appendTo(this.getElement()).text(y(n))},t.prototype._cancelPendingLoad=function(){this._cancelable&&(this._cancelable.cancel(),this._cancelable=null)},t.enhancementTypeName="tfs.ajaxPanel",t}(r.Control);t.AjaxPanelO=a;v=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(a);t.AjaxPanel=v});
/*!
 * jQuery UI Button 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/button/
 */
(function (n) { typeof define == "function" && define.amd ? define("jQueryUI/button",["jquery", "./core", "./widget"], n) : n(jQuery) })(function (n) { var t, i = "ui-button ui-widget ui-state-default ui-corner-all", r = "ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only", f = function () { var t = n(this); setTimeout(function () { t.find(":ui-button").button("refresh") }, 1) }, u = function (t) { var i = t.name, r = t.form, u = n([]); return i && (i = i.replace(/'/g, "\\'"), u = r ? n(r).find("[name='" + i + "'][type=radio]") : n("[name='" + i + "'][type=radio]", t.ownerDocument).filter(function () { return !this.form })), u }; return n.widget("ui.button", { version: "1.11.4", defaultElement: "<button>", options: { disabled: null, text: !0, label: null, icons: { primary: null, secondary: null } }, _create: function () { this.element.closest("form").unbind("reset" + this.eventNamespace).bind("reset" + this.eventNamespace, f); typeof this.options.disabled != "boolean" ? this.options.disabled = !!this.element.prop("disabled") : this.element.prop("disabled", this.options.disabled); this._determineButtonType(); this.hasTitle = !!this.buttonElement.attr("title"); var e = this, r = this.options, o = this.type === "checkbox" || this.type === "radio", s = o ? "" : "ui-state-active"; r.label === null && (r.label = this.type === "input" ? this.buttonElement.val() : this.buttonElement.html()); this._hoverable(this.buttonElement); this.buttonElement.addClass(i).attr("role", "button").bind("mouseenter" + this.eventNamespace, function () { r.disabled || this === t && n(this).addClass("ui-state-active") }).bind("mouseleave" + this.eventNamespace, function () { r.disabled || n(this).removeClass(s) }).bind("click" + this.eventNamespace, function (n) { r.disabled && (n.preventDefault(), n.stopImmediatePropagation()) }); this._on({ focus: function () { this.buttonElement.addClass("ui-state-focus") }, blur: function () { this.buttonElement.removeClass("ui-state-focus") } }); o && this.element.bind("change" + this.eventNamespace, function () { e.refresh() }); this.type === "checkbox" ? this.buttonElement.bind("click" + this.eventNamespace, function () { if (r.disabled) return !1 }) : this.type === "radio" ? this.buttonElement.bind("click" + this.eventNamespace, function () { if (r.disabled) return !1; n(this).addClass("ui-state-active"); e.buttonElement.attr("aria-pressed", "true"); var t = e.element[0]; u(t).not(t).map(function () { return n(this).button("widget")[0] }).removeClass("ui-state-active").attr("aria-pressed", "false") }) : (this.buttonElement.bind("mousedown" + this.eventNamespace, function () { if (r.disabled) return !1; n(this).addClass("ui-state-active"); t = this; e.document.one("mouseup", function () { t = null }) }).bind("mouseup" + this.eventNamespace, function () { if (r.disabled) return !1; n(this).removeClass("ui-state-active") }).bind("keydown" + this.eventNamespace, function (t) { if (r.disabled) return !1; (t.keyCode === n.ui.keyCode.SPACE || t.keyCode === n.ui.keyCode.ENTER) && n(this).addClass("ui-state-active") }).bind("keyup" + this.eventNamespace + " blur" + this.eventNamespace, function () { n(this).removeClass("ui-state-active") }), this.buttonElement.is("a") && this.buttonElement.keyup(function (t) { t.keyCode === n.ui.keyCode.SPACE && n(this).click() })); this._setOption("disabled", r.disabled); this._resetButton() }, _determineButtonType: function () { var n, t, i; this.type = this.element.is("[type=checkbox]") ? "checkbox" : this.element.is("[type=radio]") ? "radio" : this.element.is("input") ? "input" : "button"; this.type === "checkbox" || this.type === "radio" ? (n = this.element.parents().last(), t = "label[for='" + this.element.attr("id") + "']", this.buttonElement = n.find(t), this.buttonElement.length || (n = n.length ? n.siblings() : this.element.siblings(), this.buttonElement = n.filter(t), this.buttonElement.length || (this.buttonElement = n.find(t))), this.element.addClass("ui-helper-hidden-accessible"), i = this.element.is(":checked"), i && this.buttonElement.addClass("ui-state-active"), this.buttonElement.prop("aria-pressed", i)) : this.buttonElement = this.element }, widget: function () { return this.buttonElement }, _destroy: function () { this.element.removeClass("ui-helper-hidden-accessible"); this.buttonElement.removeClass(i + " ui-state-active " + r).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()); this.hasTitle || this.buttonElement.removeAttr("title") }, _setOption: function (n, t) { if (this._super(n, t), n === "disabled") { this.widget().toggleClass("ui-state-disabled", !!t); this.element.prop("disabled", !!t); t && (this.type === "checkbox" || this.type === "radio" ? this.buttonElement.removeClass("ui-state-focus") : this.buttonElement.removeClass("ui-state-focus ui-state-active")); return } this._resetButton() }, refresh: function () { var t = this.element.is("input, button") ? this.element.is(":disabled") : this.element.hasClass("ui-button-disabled"); t !== this.options.disabled && this._setOption("disabled", t); this.type === "radio" ? u(this.element[0]).each(function () { n(this).is(":checked") ? n(this).button("widget").addClass("ui-state-active").attr("aria-pressed", "true") : n(this).button("widget").removeClass("ui-state-active").attr("aria-pressed", "false") }) : this.type === "checkbox" && (this.element.is(":checked") ? this.buttonElement.addClass("ui-state-active").attr("aria-pressed", "true") : this.buttonElement.removeClass("ui-state-active").attr("aria-pressed", "false")) }, _resetButton: function () { if (this.type === "input") { this.options.label && this.element.val(this.options.label); return } var i = this.buttonElement.removeClass(r), e = n("<span><\/span>", this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(i.empty()).text(), t = this.options.icons, f = t.primary && t.secondary, u = []; t.primary || t.secondary ? (this.options.text && u.push("ui-button-text-icon" + (f ? "s" : t.primary ? "-primary" : "-secondary")), t.primary && i.prepend("<span class='ui-button-icon-primary ui-icon " + t.primary + "'><\/span>"), t.secondary && i.append("<span class='ui-button-icon-secondary ui-icon " + t.secondary + "'><\/span>"), this.options.text || (u.push(f ? "ui-button-icons-only" : "ui-button-icon-only"), this.hasTitle || i.attr("title", n.trim(e)))) : u.push("ui-button-text-only"); i.addClass(u.join(" ")) } }), n.widget("ui.buttonset", { version: "1.11.4", options: { items: "button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)" }, _create: function () { this.element.addClass("ui-buttonset") }, _init: function () { this.refresh() }, _setOption: function (n, t) { n === "disabled" && this.buttons.button("option", n, t); this._super(n, t) }, refresh: function () { var i = this.element.css("direction") === "rtl", t = this.element.find(this.options.items), r = t.filter(":ui-button"); t.not(":ui-button").button(); r.button("refresh"); this.buttons = t.map(function () { return n(this).button("widget")[0] }).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(i ? "ui-corner-right" : "ui-corner-left").end().filter(":last").addClass(i ? "ui-corner-left" : "ui-corner-right").end().end() }, _destroy: function () { this.element.removeClass("ui-buttonset"); this.buttons.map(function () { return n(this).button("widget")[0] }).removeClass("ui-corner-left ui-corner-right").end().button("destroy") } }), n.ui.button });
/*!
 * jQuery UI Draggable 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/draggable/
 */
(function (n) { typeof define == "function" && define.amd ? define("jQueryUI/draggable",["jquery", "./core", "./mouse", "./widget"], n) : n(jQuery) })(function (n) { return n.widget("ui.draggable", n.ui.mouse, { version: "1.11.4", widgetEventPrefix: "drag", options: { addClasses: !0, appendTo: "parent", axis: !1, connectToSortable: !1, containment: !1, cursor: "auto", cursorAt: !1, grid: !1, handle: !1, helper: "original", iframeFix: !1, opacity: !1, refreshPositions: !1, revert: !1, revertDuration: 500, scope: "default", scroll: !0, scrollSensitivity: 20, scrollSpeed: 20, snap: !1, snapMode: "both", snapTolerance: 20, stack: !1, zIndex: !1, drag: null, start: null, stop: null }, _create: function () { this.options.helper === "original" && this._setPositionRelative(); this.options.addClasses && this.element.addClass("ui-draggable"); this.options.disabled && this.element.addClass("ui-draggable-disabled"); this._setHandleClassName(); this._mouseInit() }, _setOption: function (n, t) { this._super(n, t); n === "handle" && (this._removeHandleClassName(), this._setHandleClassName()) }, _destroy: function () { if ((this.helper || this.element).is(".ui-draggable-dragging")) { this.destroyOnClear = !0; return } this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"); this._removeHandleClassName(); this._mouseDestroy() }, _mouseCapture: function (t) { var i = this.options; return (this._blurActiveElement(t), this.helper || i.disabled || n(t.target).closest(".ui-resizable-handle").length > 0) ? !1 : (this.handle = this._getHandle(t), !this.handle) ? !1 : (this._blockFrames(i.iframeFix === !0 ? "iframe" : i.iframeFix), !0) }, _blockFrames: function (t) { this.iframeBlocks = this.document.find(t).map(function () { var t = n(this); return n("<div>").css("position", "absolute").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0] }) }, _unblockFrames: function () { this.iframeBlocks && (this.iframeBlocks.remove(), delete this.iframeBlocks) }, _blurActiveElement: function (t) { var i = this.document[0]; if (this.handleElement.is(t.target)) try { i.activeElement && i.activeElement.nodeName.toLowerCase() !== "body" && n(i.activeElement).blur() } catch (r) { } }, _mouseStart: function (t) { var i = this.options; return (this.helper = this._createHelper(t), this.helper.addClass("ui-draggable-dragging"), this._cacheHelperProportions(), n.ui.ddmanager && (n.ui.ddmanager.current = this), this._cacheMargins(), this.cssPosition = this.helper.css("position"), this.scrollParent = this.helper.scrollParent(!0), this.offsetParent = this.helper.offsetParent(), this.hasFixedAncestor = this.helper.parents().filter(function () { return n(this).css("position") === "fixed" }).length > 0, this.positionAbs = this.element.offset(), this._refreshOffsets(t), this.originalPosition = this.position = this._generatePosition(t, !1), this.originalPageX = t.pageX, this.originalPageY = t.pageY, i.cursorAt && this._adjustOffsetFromHelper(i.cursorAt), this._setContainment(), this._trigger("start", t) === !1) ? (this._clear(), !1) : (this._cacheHelperProportions(), n.ui.ddmanager && !i.dropBehaviour && n.ui.ddmanager.prepareOffsets(this, t), this._normalizeRightBottom(), this._mouseDrag(t, !0), n.ui.ddmanager && n.ui.ddmanager.dragStart(this, t), !0) }, _refreshOffsets: function (n) { this.offset = { top: this.positionAbs.top - this.margins.top, left: this.positionAbs.left - this.margins.left, scroll: !1, parent: this._getParentOffset(), relative: this._getRelativeOffset() }; this.offset.click = { left: n.pageX - this.offset.left, top: n.pageY - this.offset.top } }, _mouseDrag: function (t, i) { if (this.hasFixedAncestor && (this.offset.parent = this._getParentOffset()), this.position = this._generatePosition(t, !0), this.positionAbs = this._convertPositionTo("absolute"), !i) { var r = this._uiHash(); if (this._trigger("drag", t, r) === !1) return this._mouseUp({}), !1; this.position = r.position } return this.helper[0].style.left = this.position.left + "px", this.helper[0].style.top = this.position.top + "px", n.ui.ddmanager && n.ui.ddmanager.drag(this, t), !1 }, _mouseStop: function (t) { var r = this, i = !1; return n.ui.ddmanager && !this.options.dropBehaviour && (i = n.ui.ddmanager.drop(this, t)), this.dropped && (i = this.dropped, this.dropped = !1), this.options.revert === "invalid" && !i || this.options.revert === "valid" && i || this.options.revert === !0 || n.isFunction(this.options.revert) && this.options.revert.call(this.element, i) ? n(this.helper).animate(this.originalPosition, parseInt(this.options.revertDuration, 10), function () { r._trigger("stop", t) !== !1 && r._clear() }) : this._trigger("stop", t) !== !1 && this._clear(), !1 }, _mouseUp: function (t) { return this._unblockFrames(), n.ui.ddmanager && n.ui.ddmanager.dragStop(this, t), this.handleElement.is(t.target) && this.element.focus(), n.ui.mouse.prototype._mouseUp.call(this, t) }, cancel: function () { return this.helper.is(".ui-draggable-dragging") ? this._mouseUp({}) : this._clear(), this }, _getHandle: function (t) { return this.options.handle ? !!n(t.target).closest(this.element.find(this.options.handle)).length : !0 }, _setHandleClassName: function () { this.handleElement = this.options.handle ? this.element.find(this.options.handle) : this.element; this.handleElement.addClass("ui-draggable-handle") }, _removeHandleClassName: function () { this.handleElement.removeClass("ui-draggable-handle") }, _createHelper: function (t) { var r = this.options, u = n.isFunction(r.helper), i = u ? n(r.helper.apply(this.element[0], [t])) : r.helper === "clone" ? this.element.clone().removeAttr("id") : this.element; return i.parents("body").length || i.appendTo(r.appendTo === "parent" ? this.element[0].parentNode : r.appendTo), u && i[0] === this.element[0] && this._setPositionRelative(), i[0] === this.element[0] || /(fixed|absolute)/.test(i.css("position")) || i.css("position", "absolute"), i }, _setPositionRelative: function () { /^(?:r|a|f)/.test(this.element.css("position")) || (this.element[0].style.position = "relative") }, _adjustOffsetFromHelper: function (t) { typeof t == "string" && (t = t.split(" ")); n.isArray(t) && (t = { left: +t[0], top: +t[1] || 0 }); "left" in t && (this.offset.click.left = t.left + this.margins.left); "right" in t && (this.offset.click.left = this.helperProportions.width - t.right + this.margins.left); "top" in t && (this.offset.click.top = t.top + this.margins.top); "bottom" in t && (this.offset.click.top = this.helperProportions.height - t.bottom + this.margins.top) }, _isRootNode: function (n) { return /(html|body)/i.test(n.tagName) || n === this.document[0] }, _getParentOffset: function () { var t = this.offsetParent.offset(), i = this.document[0]; return this.cssPosition === "absolute" && this.scrollParent[0] !== i && n.contains(this.scrollParent[0], this.offsetParent[0]) && (t.left += this.scrollParent.scrollLeft(), t.top += this.scrollParent.scrollTop()), this._isRootNode(this.offsetParent[0]) && (t = { top: 0, left: 0 }), { top: t.top + (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0), left: t.left + (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0) } }, _getRelativeOffset: function () { if (this.cssPosition !== "relative") return { top: 0, left: 0 }; var n = this.element.position(), t = this._isRootNode(this.scrollParent[0]); return { top: n.top - (parseInt(this.helper.css("top"), 10) || 0) + (t ? 0 : this.scrollParent.scrollTop()), left: n.left - (parseInt(this.helper.css("left"), 10) || 0) + (t ? 0 : this.scrollParent.scrollLeft()) } }, _cacheMargins: function () { this.margins = { left: parseInt(this.element.css("marginLeft"), 10) || 0, top: parseInt(this.element.css("marginTop"), 10) || 0, right: parseInt(this.element.css("marginRight"), 10) || 0, bottom: parseInt(this.element.css("marginBottom"), 10) || 0 } }, _cacheHelperProportions: function () { this.helperProportions = { width: this.helper.outerWidth(), height: this.helper.outerHeight() } }, _setContainment: function () { var f, t, i, r = this.options, u = this.document[0]; if (this.relativeContainer = null, !r.containment) { this.containment = null; return } if (r.containment === "window") { this.containment = [n(window).scrollLeft() - this.offset.relative.left - this.offset.parent.left, n(window).scrollTop() - this.offset.relative.top - this.offset.parent.top, n(window).scrollLeft() + n(window).width() - this.helperProportions.width - this.margins.left, n(window).scrollTop() + (n(window).height() || u.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top]; return } if (r.containment === "document") { this.containment = [0, 0, n(u).width() - this.helperProportions.width - this.margins.left, (n(u).height() || u.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top]; return } if (r.containment.constructor === Array) { this.containment = r.containment; return } (r.containment === "parent" && (r.containment = this.helper[0].parentNode), t = n(r.containment), i = t[0], i) && (f = /(scroll|auto)/.test(t.css("overflow")), this.containment = [(parseInt(t.css("borderLeftWidth"), 10) || 0) + (parseInt(t.css("paddingLeft"), 10) || 0), (parseInt(t.css("borderTopWidth"), 10) || 0) + (parseInt(t.css("paddingTop"), 10) || 0), (f ? Math.max(i.scrollWidth, i.offsetWidth) : i.offsetWidth) - (parseInt(t.css("borderRightWidth"), 10) || 0) - (parseInt(t.css("paddingRight"), 10) || 0) - this.helperProportions.width - this.margins.left - this.margins.right, (f ? Math.max(i.scrollHeight, i.offsetHeight) : i.offsetHeight) - (parseInt(t.css("borderBottomWidth"), 10) || 0) - (parseInt(t.css("paddingBottom"), 10) || 0) - this.helperProportions.height - this.margins.top - this.margins.bottom], this.relativeContainer = t) }, _convertPositionTo: function (n, t) { t || (t = this.position); var i = n === "absolute" ? 1 : -1, r = this._isRootNode(this.scrollParent[0]); return { top: t.top + this.offset.relative.top * i + this.offset.parent.top * i - (this.cssPosition === "fixed" ? -this.offset.scroll.top : r ? 0 : this.offset.scroll.top) * i, left: t.left + this.offset.relative.left * i + this.offset.parent.left * i - (this.cssPosition === "fixed" ? -this.offset.scroll.left : r ? 0 : this.offset.scroll.left) * i } }, _generatePosition: function (n, t) { var i, s, u, f, r = this.options, h = this._isRootNode(this.scrollParent[0]), e = n.pageX, o = n.pageY; return h && this.offset.scroll || (this.offset.scroll = { top: this.scrollParent.scrollTop(), left: this.scrollParent.scrollLeft() }), t && (this.containment && (this.relativeContainer ? (s = this.relativeContainer.offset(), i = [this.containment[0] + s.left, this.containment[1] + s.top, this.containment[2] + s.left, this.containment[3] + s.top]) : i = this.containment, n.pageX - this.offset.click.left < i[0] && (e = i[0] + this.offset.click.left), n.pageY - this.offset.click.top < i[1] && (o = i[1] + this.offset.click.top), n.pageX - this.offset.click.left > i[2] && (e = i[2] + this.offset.click.left), n.pageY - this.offset.click.top > i[3] && (o = i[3] + this.offset.click.top)), r.grid && (u = r.grid[1] ? this.originalPageY + Math.round((o - this.originalPageY) / r.grid[1]) * r.grid[1] : this.originalPageY, o = i ? u - this.offset.click.top >= i[1] || u - this.offset.click.top > i[3] ? u : u - this.offset.click.top >= i[1] ? u - r.grid[1] : u + r.grid[1] : u, f = r.grid[0] ? this.originalPageX + Math.round((e - this.originalPageX) / r.grid[0]) * r.grid[0] : this.originalPageX, e = i ? f - this.offset.click.left >= i[0] || f - this.offset.click.left > i[2] ? f : f - this.offset.click.left >= i[0] ? f - r.grid[0] : f + r.grid[0] : f), r.axis === "y" && (e = this.originalPageX), r.axis === "x" && (o = this.originalPageY)), { top: o - this.offset.click.top - this.offset.relative.top - this.offset.parent.top + (this.cssPosition === "fixed" ? -this.offset.scroll.top : h ? 0 : this.offset.scroll.top), left: e - this.offset.click.left - this.offset.relative.left - this.offset.parent.left + (this.cssPosition === "fixed" ? -this.offset.scroll.left : h ? 0 : this.offset.scroll.left) } }, _clear: function () { this.helper.removeClass("ui-draggable-dragging"); this.helper[0] === this.element[0] || this.cancelHelperRemoval || this.helper.remove(); this.helper = null; this.cancelHelperRemoval = !1; this.destroyOnClear && this.destroy() }, _normalizeRightBottom: function () { this.options.axis !== "y" && this.helper.css("right") !== "auto" && (this.helper.width(this.helper.width()), this.helper.css("right", "auto")); this.options.axis !== "x" && this.helper.css("bottom") !== "auto" && (this.helper.height(this.helper.height()), this.helper.css("bottom", "auto")) }, _trigger: function (t, i, r) { return r = r || this._uiHash(), n.ui.plugin.call(this, t, [i, r, this], !0), /^(drag|start|stop)/.test(t) && (this.positionAbs = this._convertPositionTo("absolute"), r.offset = this.positionAbs), n.Widget.prototype._trigger.call(this, t, i, r) }, plugins: {}, _uiHash: function () { return { helper: this.helper, position: this.position, originalPosition: this.originalPosition, offset: this.positionAbs } } }), n.ui.plugin.add("draggable", "connectToSortable", { start: function (t, i, r) { var u = n.extend({}, i, { item: r.element }); r.sortables = []; n(r.options.connectToSortable).each(function () { var i = n(this).sortable("instance"); i && !i.options.disabled && (r.sortables.push(i), i.refreshPositions(), i._trigger("activate", t, u)) }) }, stop: function (t, i, r) { var u = n.extend({}, i, { item: r.element }); r.cancelHelperRemoval = !1; n.each(r.sortables, function () { var n = this; n.isOver ? (n.isOver = 0, r.cancelHelperRemoval = !0, n.cancelHelperRemoval = !1, n._storedCSS = { position: n.placeholder.css("position"), top: n.placeholder.css("top"), left: n.placeholder.css("left") }, n._mouseStop(t), n.options.helper = n.options._helper) : (n.cancelHelperRemoval = !0, n._trigger("deactivate", t, u)) }) }, drag: function (t, i, r) { n.each(r.sortables, function () { var f = !1, u = this; u.positionAbs = r.positionAbs; u.helperProportions = r.helperProportions; u.offset.click = r.offset.click; u._intersectsWith(u.containerCache) && (f = !0, n.each(r.sortables, function () { return this.positionAbs = r.positionAbs, this.helperProportions = r.helperProportions, this.offset.click = r.offset.click, this !== u && this._intersectsWith(this.containerCache) && n.contains(u.element[0], this.element[0]) && (f = !1), f })); f ? (u.isOver || (u.isOver = 1, r._parent = i.helper.parent(), u.currentItem = i.helper.appendTo(u.element).data("ui-sortable-item", !0), u.options._helper = u.options.helper, u.options.helper = function () { return i.helper[0] }, t.target = u.currentItem[0], u._mouseCapture(t, !0), u._mouseStart(t, !0, !0), u.offset.click.top = r.offset.click.top, u.offset.click.left = r.offset.click.left, u.offset.parent.left -= r.offset.parent.left - u.offset.parent.left, u.offset.parent.top -= r.offset.parent.top - u.offset.parent.top, r._trigger("toSortable", t), r.dropped = u.element, n.each(r.sortables, function () { this.refreshPositions() }), r.currentItem = r.element, u.fromOutside = r), u.currentItem && (u._mouseDrag(t), i.position = u.position)) : u.isOver && (u.isOver = 0, u.cancelHelperRemoval = !0, u.options._revert = u.options.revert, u.options.revert = !1, u._trigger("out", t, u._uiHash(u)), u._mouseStop(t, !0), u.options.revert = u.options._revert, u.options.helper = u.options._helper, u.placeholder && u.placeholder.remove(), i.helper.appendTo(r._parent), r._refreshOffsets(t), i.position = r._generatePosition(t, !0), r._trigger("fromSortable", t), r.dropped = !1, n.each(r.sortables, function () { this.refreshPositions() })) }) } }), n.ui.plugin.add("draggable", "cursor", { start: function (t, i, r) { var u = n("body"), f = r.options; u.css("cursor") && (f._cursor = u.css("cursor")); u.css("cursor", f.cursor) }, stop: function (t, i, r) { var u = r.options; u._cursor && n("body").css("cursor", u._cursor) } }), n.ui.plugin.add("draggable", "opacity", { start: function (t, i, r) { var u = n(i.helper), f = r.options; u.css("opacity") && (f._opacity = u.css("opacity")); u.css("opacity", f.opacity) }, stop: function (t, i, r) { var u = r.options; u._opacity && n(i.helper).css("opacity", u._opacity) } }), n.ui.plugin.add("draggable", "scroll", { start: function (n, t, i) { i.scrollParentNotHidden || (i.scrollParentNotHidden = i.helper.scrollParent(!1)); i.scrollParentNotHidden[0] !== i.document[0] && i.scrollParentNotHidden[0].tagName !== "HTML" && (i.overflowOffset = i.scrollParentNotHidden.offset()) }, drag: function (t, i, r) { var u = r.options, o = !1, e = r.scrollParentNotHidden[0], f = r.document[0]; e !== f && e.tagName !== "HTML" ? (u.axis && u.axis === "x" || (r.overflowOffset.top + e.offsetHeight - t.pageY < u.scrollSensitivity ? e.scrollTop = o = e.scrollTop + u.scrollSpeed : t.pageY - r.overflowOffset.top < u.scrollSensitivity && (e.scrollTop = o = e.scrollTop - u.scrollSpeed)), u.axis && u.axis === "y" || (r.overflowOffset.left + e.offsetWidth - t.pageX < u.scrollSensitivity ? e.scrollLeft = o = e.scrollLeft + u.scrollSpeed : t.pageX - r.overflowOffset.left < u.scrollSensitivity && (e.scrollLeft = o = e.scrollLeft - u.scrollSpeed))) : (u.axis && u.axis === "x" || (t.pageY - n(f).scrollTop() < u.scrollSensitivity ? o = n(f).scrollTop(n(f).scrollTop() - u.scrollSpeed) : n(window).height() - (t.pageY - n(f).scrollTop()) < u.scrollSensitivity && (o = n(f).scrollTop(n(f).scrollTop() + u.scrollSpeed))), u.axis && u.axis === "y" || (t.pageX - n(f).scrollLeft() < u.scrollSensitivity ? o = n(f).scrollLeft(n(f).scrollLeft() - u.scrollSpeed) : n(window).width() - (t.pageX - n(f).scrollLeft()) < u.scrollSensitivity && (o = n(f).scrollLeft(n(f).scrollLeft() + u.scrollSpeed)))); o !== !1 && n.ui.ddmanager && !u.dropBehaviour && n.ui.ddmanager.prepareOffsets(r, t) } }), n.ui.plugin.add("draggable", "snap", { start: function (t, i, r) { var u = r.options; r.snapElements = []; n(u.snap.constructor !== String ? u.snap.items || ":data(ui-draggable)" : u.snap).each(function () { var t = n(this), i = t.offset(); this !== r.element[0] && r.snapElements.push({ item: this, width: t.outerWidth(), height: t.outerHeight(), top: i.top, left: i.left }) }) }, drag: function (t, i, r) { for (var e, o, s, h, c, a, l, v, w, b = r.options, f = b.snapTolerance, y = i.offset.left, k = y + r.helperProportions.width, p = i.offset.top, d = p + r.helperProportions.height, u = r.snapElements.length - 1; u >= 0; u--) { if (c = r.snapElements[u].left - r.margins.left, a = c + r.snapElements[u].width, l = r.snapElements[u].top - r.margins.top, v = l + r.snapElements[u].height, k < c - f || y > a + f || d < l - f || p > v + f || !n.contains(r.snapElements[u].item.ownerDocument, r.snapElements[u].item)) { r.snapElements[u].snapping && r.options.snap.release && r.options.snap.release.call(r.element, t, n.extend(r._uiHash(), { snapItem: r.snapElements[u].item })); r.snapElements[u].snapping = !1; continue } b.snapMode !== "inner" && (e = Math.abs(l - d) <= f, o = Math.abs(v - p) <= f, s = Math.abs(c - k) <= f, h = Math.abs(a - y) <= f, e && (i.position.top = r._convertPositionTo("relative", { top: l - r.helperProportions.height, left: 0 }).top), o && (i.position.top = r._convertPositionTo("relative", { top: v, left: 0 }).top), s && (i.position.left = r._convertPositionTo("relative", { top: 0, left: c - r.helperProportions.width }).left), h && (i.position.left = r._convertPositionTo("relative", { top: 0, left: a }).left)); w = e || o || s || h; b.snapMode !== "outer" && (e = Math.abs(l - p) <= f, o = Math.abs(v - d) <= f, s = Math.abs(c - y) <= f, h = Math.abs(a - k) <= f, e && (i.position.top = r._convertPositionTo("relative", { top: l, left: 0 }).top), o && (i.position.top = r._convertPositionTo("relative", { top: v - r.helperProportions.height, left: 0 }).top), s && (i.position.left = r._convertPositionTo("relative", { top: 0, left: c }).left), h && (i.position.left = r._convertPositionTo("relative", { top: 0, left: a - r.helperProportions.width }).left)); !r.snapElements[u].snapping && (e || o || s || h || w) && r.options.snap.snap && r.options.snap.snap.call(r.element, t, n.extend(r._uiHash(), { snapItem: r.snapElements[u].item })); r.snapElements[u].snapping = e || o || s || h || w } } }), n.ui.plugin.add("draggable", "stack", { start: function (t, i, r) { var f, e = r.options, u = n.makeArray(n(e.stack)).sort(function (t, i) { return (parseInt(n(t).css("zIndex"), 10) || 0) - (parseInt(n(i).css("zIndex"), 10) || 0) }); u.length && (f = parseInt(n(u[0]).css("zIndex"), 10) || 0, n(u).each(function (t) { n(this).css("zIndex", f + t) }), this.css("zIndex", f + u.length)) } }), n.ui.plugin.add("draggable", "zIndex", { start: function (t, i, r) { var u = n(i.helper), f = r.options; u.css("zIndex") && (f._zIndex = u.css("zIndex")); u.css("zIndex", f.zIndex) }, stop: function (t, i, r) { var u = r.options; u._zIndex && n(i.helper).css("zIndex", u._zIndex) } }), n.ui.draggable });
/*!
 * jQuery UI Mouse 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/mouse/
 */
(function (n) { typeof define == "function" && define.amd ? define("jQueryUI/mouse",["jquery", "./widget"], n) : n(jQuery) })(function (n) { var t = !1; return n(document).mouseup(function () { t = !1 }), n.widget("ui.mouse", { version: "1.11.4", options: { cancel: "input,textarea,button,select,option", distance: 1, delay: 0 }, _mouseInit: function () { var t = this; this.element.bind("mousedown." + this.widgetName, function (n) { return t._mouseDown(n) }).bind("click." + this.widgetName, function (i) { if (!0 === n.data(i.target, t.widgetName + ".preventClickEvent")) return n.removeData(i.target, t.widgetName + ".preventClickEvent"), i.stopImmediatePropagation(), !1 }); this.started = !1 }, _mouseDestroy: function () { this.element.unbind("." + this.widgetName); this._mouseMoveDelegate && this.document.unbind("mousemove." + this.widgetName, this._mouseMoveDelegate).unbind("mouseup." + this.widgetName, this._mouseUpDelegate) }, _mouseDown: function (i) { if (!t) { this._mouseMoved = !1; this._mouseStarted && this._mouseUp(i); this._mouseDownEvent = i; var r = this, u = i.which === 1, f = typeof this.options.cancel == "string" && i.target.nodeName ? n(i.target).closest(this.options.cancel).length : !1; return !u || f || !this._mouseCapture(i) ? !0 : (this.mouseDelayMet = !this.options.delay, this.mouseDelayMet || (this._mouseDelayTimer = setTimeout(function () { r.mouseDelayMet = !0 }, this.options.delay)), this._mouseDistanceMet(i) && this._mouseDelayMet(i) && (this._mouseStarted = this._mouseStart(i) !== !1, !this._mouseStarted)) ? (i.preventDefault(), !0) : (!0 === n.data(i.target, this.widgetName + ".preventClickEvent") && n.removeData(i.target, this.widgetName + ".preventClickEvent"), this._mouseMoveDelegate = function (n) { return r._mouseMove(n) }, this._mouseUpDelegate = function (n) { return r._mouseUp(n) }, this.document.bind("mousemove." + this.widgetName, this._mouseMoveDelegate).bind("mouseup." + this.widgetName, this._mouseUpDelegate), i.preventDefault(), t = !0, !0) } }, _mouseMove: function (t) { return this._mouseMoved && (n.ui.ie && (!document.documentMode || document.documentMode < 9) && !t.button || !t.which) ? this._mouseUp(t) : ((t.which || t.button) && (this._mouseMoved = !0), this._mouseStarted) ? (this._mouseDrag(t), t.preventDefault()) : (this._mouseDistanceMet(t) && this._mouseDelayMet(t) && (this._mouseStarted = this._mouseStart(this._mouseDownEvent, t) !== !1, this._mouseStarted ? this._mouseDrag(t) : this._mouseUp(t)), !this._mouseStarted) }, _mouseUp: function (i) { return this.document.unbind("mousemove." + this.widgetName, this._mouseMoveDelegate).unbind("mouseup." + this.widgetName, this._mouseUpDelegate), this._mouseStarted && (this._mouseStarted = !1, i.target === this._mouseDownEvent.target && n.data(i.target, this.widgetName + ".preventClickEvent", !0), this._mouseStop(i)), t = !1, !1 }, _mouseDistanceMet: function (n) { return Math.max(Math.abs(this._mouseDownEvent.pageX - n.pageX), Math.abs(this._mouseDownEvent.pageY - n.pageY)) >= this.options.distance }, _mouseDelayMet: function () { return this.mouseDelayMet }, _mouseStart: function () { }, _mouseDrag: function () { }, _mouseStop: function () { }, _mouseCapture: function () { return !0 } }) });
/*!
 * jQuery UI Position 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/position/
 */
(function(n){typeof define=="function"&&define.amd?define("jQueryUI/position",["jquery"],n):n(jQuery)})(function(n){return function(){function a(n,t,i){return[parseFloat(n[0])*(l.test(n[0])?t/100:1),parseFloat(n[1])*(l.test(n[1])?i/100:1)]}function r(t,i){return parseInt(n.css(t,i),10)||0}function y(t){var i=t[0];return i.nodeType===9?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:n.isWindow(i)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}n.ui=n.ui||{};var u,f,i=Math.max,t=Math.abs,e=Math.round,o=/left|center|right/,s=/top|center|bottom/,h=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,l=/%$/,v=n.fn.position;n.position={scrollbarWidth:function(){if(u!==undefined)return u;var r,i,t=n("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'><\/div><\/div>"),f=t.children()[0];return n("body").append(t),r=f.offsetWidth,t.css("overflow","scroll"),i=f.offsetWidth,r===i&&(i=t[0].clientWidth),t.remove(),u=r-i},getScrollInfo:function(t){var i=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),r=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),u=i==="scroll"||i==="auto"&&t.width<t.element[0].scrollWidth,f=r==="scroll"||r==="auto"&&t.height<t.element[0].scrollHeight;return{width:f?n.position.scrollbarWidth():0,height:u?n.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=n(t||window),r=n.isWindow(i[0]),u=!!i[0]&&i[0].nodeType===9;return{element:i,isWindow:r,isDocument:u,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:r||u?i.width():i.outerWidth(),height:r||u?i.height():i.outerHeight()}}};n.fn.position=function(u){if(!u||!u.of)return v.apply(this,arguments);u=n.extend({},u);var k,l,p,b,w,g,nt=n(u.of),it=n.position.getWithinInfo(u.within),rt=n.position.getScrollInfo(it),d=(u.collision||"flip").split(" "),tt={};return g=y(nt),nt[0].preventDefault&&(u.at="left top"),l=g.width,p=g.height,b=g.offset,w=n.extend({},b),n.each(["my","at"],function(){var n=(u[this]||"").split(" "),t,i;n.length===1&&(n=o.test(n[0])?n.concat(["center"]):s.test(n[0])?["center"].concat(n):["center","center"]);n[0]=o.test(n[0])?n[0]:"center";n[1]=s.test(n[1])?n[1]:"center";t=h.exec(n[0]);i=h.exec(n[1]);tt[this]=[t?t[0]:0,i?i[0]:0];u[this]=[c.exec(n[0])[0],c.exec(n[1])[0]]}),d.length===1&&(d[1]=d[0]),u.at[0]==="right"?w.left+=l:u.at[0]==="center"&&(w.left+=l/2),u.at[1]==="bottom"?w.top+=p:u.at[1]==="center"&&(w.top+=p/2),k=a(tt.at,l,p),w.left+=k[0],w.top+=k[1],this.each(function(){var y,g,s=n(this),h=s.outerWidth(),c=s.outerHeight(),ut=r(this,"marginLeft"),ft=r(this,"marginTop"),et=h+ut+r(this,"marginRight")+rt.width,ot=c+ft+r(this,"marginBottom")+rt.height,o=n.extend({},w),v=a(tt.my,s.outerWidth(),s.outerHeight());u.my[0]==="right"?o.left-=h:u.my[0]==="center"&&(o.left-=h/2);u.my[1]==="bottom"?o.top-=c:u.my[1]==="center"&&(o.top-=c/2);o.left+=v[0];o.top+=v[1];f||(o.left=e(o.left),o.top=e(o.top));y={marginLeft:ut,marginTop:ft};n.each(["left","top"],function(t,i){n.ui.position[d[t]]&&n.ui.position[d[t]][i](o,{targetWidth:l,targetHeight:p,elemWidth:h,elemHeight:c,collisionPosition:y,collisionWidth:et,collisionHeight:ot,offset:[k[0]+v[0],k[1]+v[1]],my:u.my,at:u.at,within:it,elem:s})});u.using&&(g=function(n){var r=b.left-o.left,a=r+l-h,f=b.top-o.top,v=f+p-c,e={target:{element:nt,left:b.left,top:b.top,width:l,height:p},element:{element:s,left:o.left,top:o.top,width:h,height:c},horizontal:a<0?"left":r>0?"right":"center",vertical:v<0?"top":f>0?"bottom":"middle"};l<h&&t(r+a)<l&&(e.horizontal="center");p<c&&t(f+v)<p&&(e.vertical="middle");e.important=i(t(r),t(a))>i(t(f),t(v))?"horizontal":"vertical";u.using.call(this,n,e)});s.offset(n.extend(o,{using:g}))})};n.ui.position={fit:{left:function(n,t){var e=t.within,u=e.isWindow?e.scrollLeft:e.offset.left,o=e.width,s=n.left-t.collisionPosition.marginLeft,r=u-s,f=s+t.collisionWidth-o-u,h;t.collisionWidth>o?r>0&&f<=0?(h=n.left+r+t.collisionWidth-o-u,n.left+=r-h):n.left=f>0&&r<=0?u:r>f?u+o-t.collisionWidth:u:r>0?n.left+=r:f>0?n.left-=f:n.left=i(n.left-s,n.left)},top:function(n,t){var o=t.within,u=o.isWindow?o.scrollTop:o.offset.top,e=t.within.height,s=n.top-t.collisionPosition.marginTop,r=u-s,f=s+t.collisionHeight-e-u,h;t.collisionHeight>e?r>0&&f<=0?(h=n.top+r+t.collisionHeight-e-u,n.top+=r-h):n.top=f>0&&r<=0?u:r>f?u+e-t.collisionHeight:u:r>0?n.top+=r:f>0?n.top-=f:n.top=i(n.top-s,n.top)}},flip:{left:function(n,i){var r=i.within,y=r.offset.left+r.scrollLeft,c=r.width,o=r.isWindow?r.scrollLeft:r.offset.left,l=n.left-i.collisionPosition.marginLeft,a=l-o,v=l+i.collisionWidth-c-o,u=i.my[0]==="left"?-i.elemWidth:i.my[0]==="right"?i.elemWidth:0,f=i.at[0]==="left"?i.targetWidth:i.at[0]==="right"?-i.targetWidth:0,e=-2*i.offset[0],s,h;a<0?(s=n.left+u+f+e+i.collisionWidth-c-y,(s<0||s<t(a))&&(n.left+=u+f+e)):v>0&&(h=n.left-i.collisionPosition.marginLeft+u+f+e-o,(h>0||t(h)<v)&&(n.left+=u+f+e))},top:function(n,i){var r=i.within,y=r.offset.top+r.scrollTop,c=r.height,o=r.isWindow?r.scrollTop:r.offset.top,l=n.top-i.collisionPosition.marginTop,a=l-o,v=l+i.collisionHeight-c-o,p=i.my[1]==="top",u=p?-i.elemHeight:i.my[1]==="bottom"?i.elemHeight:0,f=i.at[1]==="top"?i.targetHeight:i.at[1]==="bottom"?-i.targetHeight:0,e=-2*i.offset[1],s,h;a<0?(h=n.top+u+f+e+i.collisionHeight-c-y,(h<0||h<t(a))&&(n.top+=u+f+e)):v>0&&(s=n.top-i.collisionPosition.marginTop+u+f+e-o,(s>0||t(s)<v)&&(n.top+=u+f+e))}},flipfit:{left:function(){n.ui.position.flip.left.apply(this,arguments);n.ui.position.fit.left.apply(this,arguments)},top:function(){n.ui.position.flip.top.apply(this,arguments);n.ui.position.fit.top.apply(this,arguments)}}},function(){var t,i,r,u,e,o=document.getElementsByTagName("body")[0],s=document.createElement("div");t=document.createElement(o?"div":"body");r={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};o&&n.extend(r,{position:"absolute",left:"-1000px",top:"-1000px"});for(e in r)t.style[e]=r[e];t.appendChild(s);i=o||document.documentElement;i.insertBefore(t,i.firstChild);s.style.cssText="position: absolute; left: 10.7432222px;";u=n(s).offset().left;f=u>10&&u<11;t.innerHTML="";i.removeChild(t)}()}(),n.ui.position});
/*!
 * jQuery UI Resizable 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/resizable/
 */
(function (n) { typeof define == "function" && define.amd ? define("jQueryUI/resizable",["jquery", "./core", "./mouse", "./widget"], n) : n(jQuery) })(function (n) { return n.widget("ui.resizable", n.ui.mouse, { version: "1.11.4", widgetEventPrefix: "resize", options: { alsoResize: !1, animate: !1, animateDuration: "slow", animateEasing: "swing", aspectRatio: !1, autoHide: !1, containment: !1, ghost: !1, grid: !1, handles: "e,s,se", helper: !1, maxHeight: null, maxWidth: null, minHeight: 10, minWidth: 10, zIndex: 90, resize: null, start: null, stop: null }, _num: function (n) { return parseInt(n, 10) || 0 }, _isNumber: function (n) { return !isNaN(parseInt(n, 10)) }, _hasScroll: function (t, i) { if (n(t).css("overflow") === "hidden") return !1; var r = i && i === "left" ? "scrollLeft" : "scrollTop", u = !1; return t[r] > 0 ? !0 : (t[r] = 1, u = t[r] > 0, t[r] = 0, u) }, _create: function () { var e, f, u, i, o, r = this, t = this.options; if (this.element.addClass("ui-resizable"), n.extend(this, { _aspectRatio: !!t.aspectRatio, aspectRatio: t.aspectRatio, originalElement: this.element, _proportionallyResizeElements: [], _helper: t.helper || t.ghost || t.animate ? t.helper || "ui-resizable-helper" : null }), this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i) && (this.element.wrap(n("<div class='ui-wrapper' style='overflow: hidden;'><\/div>").css({ position: this.element.css("position"), width: this.element.outerWidth(), height: this.element.outerHeight(), top: this.element.css("top"), left: this.element.css("left") })), this.element = this.element.parent().data("ui-resizable", this.element.resizable("instance")), this.elementIsWrapper = !0, this.element.css({ marginLeft: this.originalElement.css("marginLeft"), marginTop: this.originalElement.css("marginTop"), marginRight: this.originalElement.css("marginRight"), marginBottom: this.originalElement.css("marginBottom") }), this.originalElement.css({ marginLeft: 0, marginTop: 0, marginRight: 0, marginBottom: 0 }), this.originalResizeStyle = this.originalElement.css("resize"), this.originalElement.css("resize", "none"), this._proportionallyResizeElements.push(this.originalElement.css({ position: "static", zoom: 1, display: "block" })), this.originalElement.css({ margin: this.originalElement.css("margin") }), this._proportionallyResize()), this.handles = t.handles || (n(".ui-resizable-handle", this.element).length ? { n: ".ui-resizable-n", e: ".ui-resizable-e", s: ".ui-resizable-s", w: ".ui-resizable-w", se: ".ui-resizable-se", sw: ".ui-resizable-sw", ne: ".ui-resizable-ne", nw: ".ui-resizable-nw" } : "e,s,se"), this._handles = n(), this.handles.constructor === String) for (this.handles === "all" && (this.handles = "n,e,s,w,se,sw,ne,nw"), e = this.handles.split(","), this.handles = {}, f = 0; f < e.length; f++) u = n.trim(e[f]), o = "ui-resizable-" + u, i = n("<div class='ui-resizable-handle " + o + "'><\/div>"), i.css({ zIndex: t.zIndex }), "se" === u && i.addClass("ui-icon ui-icon-gripsmall-diagonal-se"), this.handles[u] = ".ui-resizable-" + u, this.element.append(i); this._renderAxis = function (t) { var i, u, f, e; t = t || this.element; for (i in this.handles) this.handles[i].constructor === String ? this.handles[i] = this.element.children(this.handles[i]).first().show() : (this.handles[i].jquery || this.handles[i].nodeType) && (this.handles[i] = n(this.handles[i]), this._on(this.handles[i], { mousedown: r._mouseDown })), this.elementIsWrapper && this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i) && (u = n(this.handles[i], this.element), e = /sw|ne|nw|se|n|s/.test(i) ? u.outerHeight() : u.outerWidth(), f = ["padding", /ne|nw|n/.test(i) ? "Top" : /se|sw|s/.test(i) ? "Bottom" : /^e$/.test(i) ? "Right" : "Left"].join(""), t.css(f, e), this._proportionallyResize()), this._handles = this._handles.add(this.handles[i]) }; this._renderAxis(this.element); this._handles = this._handles.add(this.element.find(".ui-resizable-handle")); this._handles.disableSelection(); this._handles.mouseover(function () { r.resizing || (this.className && (i = this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)), r.axis = i && i[1] ? i[1] : "se") }); t.autoHide && (this._handles.hide(), n(this.element).addClass("ui-resizable-autohide").mouseenter(function () { t.disabled || (n(this).removeClass("ui-resizable-autohide"), r._handles.show()) }).mouseleave(function () { t.disabled || r.resizing || (n(this).addClass("ui-resizable-autohide"), r._handles.hide()) })); this._mouseInit() }, _destroy: function () { this._mouseDestroy(); var t, i = function (t) { n(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove() }; return this.elementIsWrapper && (i(this.element), t = this.element, this.originalElement.css({ position: t.css("position"), width: t.outerWidth(), height: t.outerHeight(), top: t.css("top"), left: t.css("left") }).insertAfter(t), t.remove()), this.originalElement.css("resize", this.originalResizeStyle), i(this.originalElement), this }, _mouseCapture: function (t) { var r, i, u = !1; for (r in this.handles) i = n(this.handles[r])[0], (i === t.target || n.contains(i, t.target)) && (u = !0); return !this.options.disabled && u }, _mouseStart: function (t) { var u, f, e, r = this.options, i = this.element; return this.resizing = !0, this._renderProxy(), u = this._num(this.helper.css("left")), f = this._num(this.helper.css("top")), r.containment && (u += n(r.containment).scrollLeft() || 0, f += n(r.containment).scrollTop() || 0), this.offset = this.helper.offset(), this.position = { left: u, top: f }, this.size = this._helper ? { width: this.helper.width(), height: this.helper.height() } : { width: i.width(), height: i.height() }, this.originalSize = this._helper ? { width: i.outerWidth(), height: i.outerHeight() } : { width: i.width(), height: i.height() }, this.sizeDiff = { width: i.outerWidth() - i.width(), height: i.outerHeight() - i.height() }, this.originalPosition = { left: u, top: f }, this.originalMousePosition = { left: t.pageX, top: t.pageY }, this.aspectRatio = typeof r.aspectRatio == "number" ? r.aspectRatio : this.originalSize.width / this.originalSize.height || 1, e = n(".ui-resizable-" + this.axis).css("cursor"), n("body").css("cursor", e === "auto" ? this.axis + "-resize" : e), i.addClass("ui-resizable-resizing"), this._propagate("start", t), !0 }, _mouseDrag: function (t) { var i, r, u = this.originalMousePosition, e = this.axis, o = t.pageX - u.left || 0, s = t.pageY - u.top || 0, f = this._change[e]; return (this._updatePrevProperties(), !f) ? !1 : (i = f.apply(this, [t, o, s]), this._updateVirtualBoundaries(t.shiftKey), (this._aspectRatio || t.shiftKey) && (i = this._updateRatio(i, t)), i = this._respectSize(i, t), this._updateCache(i), this._propagate("resize", t), r = this._applyChanges(), !this._helper && this._proportionallyResizeElements.length && this._proportionallyResize(), n.isEmptyObject(r) || (this._updatePrevProperties(), this._trigger("resize", t, this.ui()), this._applyChanges()), !1) }, _mouseStop: function (t) { this.resizing = !1; var r, u, f, e, o, s, h, c = this.options, i = this; return this._helper && (r = this._proportionallyResizeElements, u = r.length && /textarea/i.test(r[0].nodeName), f = u && this._hasScroll(r[0], "left") ? 0 : i.sizeDiff.height, e = u ? 0 : i.sizeDiff.width, o = { width: i.helper.width() - e, height: i.helper.height() - f }, s = parseInt(i.element.css("left"), 10) + (i.position.left - i.originalPosition.left) || null, h = parseInt(i.element.css("top"), 10) + (i.position.top - i.originalPosition.top) || null, c.animate || this.element.css(n.extend(o, { top: h, left: s })), i.helper.height(i.size.height), i.helper.width(i.size.width), this._helper && !c.animate && this._proportionallyResize()), n("body").css("cursor", "auto"), this.element.removeClass("ui-resizable-resizing"), this._propagate("stop", t), this._helper && this.helper.remove(), !1 }, _updatePrevProperties: function () { this.prevPosition = { top: this.position.top, left: this.position.left }; this.prevSize = { width: this.size.width, height: this.size.height } }, _applyChanges: function () { var n = {}; return this.position.top !== this.prevPosition.top && (n.top = this.position.top + "px"), this.position.left !== this.prevPosition.left && (n.left = this.position.left + "px"), this.size.width !== this.prevSize.width && (n.width = this.size.width + "px"), this.size.height !== this.prevSize.height && (n.height = this.size.height + "px"), this.helper.css(n), n }, _updateVirtualBoundaries: function (n) { var r, u, f, e, t, i = this.options; t = { minWidth: this._isNumber(i.minWidth) ? i.minWidth : 0, maxWidth: this._isNumber(i.maxWidth) ? i.maxWidth : Infinity, minHeight: this._isNumber(i.minHeight) ? i.minHeight : 0, maxHeight: this._isNumber(i.maxHeight) ? i.maxHeight : Infinity }; (this._aspectRatio || n) && (r = t.minHeight * this.aspectRatio, f = t.minWidth / this.aspectRatio, u = t.maxHeight * this.aspectRatio, e = t.maxWidth / this.aspectRatio, r > t.minWidth && (t.minWidth = r), f > t.minHeight && (t.minHeight = f), u < t.maxWidth && (t.maxWidth = u), e < t.maxHeight && (t.maxHeight = e)); this._vBoundaries = t }, _updateCache: function (n) { this.offset = this.helper.offset(); this._isNumber(n.left) && (this.position.left = n.left); this._isNumber(n.top) && (this.position.top = n.top); this._isNumber(n.height) && (this.size.height = n.height); this._isNumber(n.width) && (this.size.width = n.width) }, _updateRatio: function (n) { var t = this.position, i = this.size, r = this.axis; return this._isNumber(n.height) ? n.width = n.height * this.aspectRatio : this._isNumber(n.width) && (n.height = n.width / this.aspectRatio), r === "sw" && (n.left = t.left + (i.width - n.width), n.top = null), r === "nw" && (n.top = t.top + (i.height - n.height), n.left = t.left + (i.width - n.width)), n }, _respectSize: function (n) { var t = this._vBoundaries, i = this.axis, r = this._isNumber(n.width) && t.maxWidth && t.maxWidth < n.width, u = this._isNumber(n.height) && t.maxHeight && t.maxHeight < n.height, f = this._isNumber(n.width) && t.minWidth && t.minWidth > n.width, e = this._isNumber(n.height) && t.minHeight && t.minHeight > n.height, o = this.originalPosition.left + this.originalSize.width, s = this.position.top + this.size.height, h = /sw|nw|w/.test(i), c = /nw|ne|n/.test(i); return f && (n.width = t.minWidth), e && (n.height = t.minHeight), r && (n.width = t.maxWidth), u && (n.height = t.maxHeight), f && h && (n.left = o - t.minWidth), r && h && (n.left = o - t.maxWidth), e && c && (n.top = s - t.minHeight), u && c && (n.top = s - t.maxHeight), n.width || n.height || n.left || !n.top ? n.width || n.height || n.top || !n.left || (n.left = null) : n.top = null, n }, _getPaddingPlusBorderDimensions: function (n) { for (var t = 0, i = [], r = [n.css("borderTopWidth"), n.css("borderRightWidth"), n.css("borderBottomWidth"), n.css("borderLeftWidth")], u = [n.css("paddingTop"), n.css("paddingRight"), n.css("paddingBottom"), n.css("paddingLeft")]; t < 4; t++) i[t] = parseInt(r[t], 10) || 0, i[t] += parseInt(u[t], 10) || 0; return { height: i[0] + i[2], width: i[1] + i[3] } }, _proportionallyResize: function () { if (this._proportionallyResizeElements.length) for (var n, t = 0, i = this.helper || this.element; t < this._proportionallyResizeElements.length; t++) n = this._proportionallyResizeElements[t], this.outerDimensions || (this.outerDimensions = this._getPaddingPlusBorderDimensions(n)), n.css({ height: i.height() - this.outerDimensions.height || 0, width: i.width() - this.outerDimensions.width || 0 }) }, _renderProxy: function () { var t = this.element, i = this.options; this.elementOffset = t.offset(); this._helper ? (this.helper = this.helper || n("<div style='overflow:hidden;'><\/div>"), this.helper.addClass(this._helper).css({ width: this.element.outerWidth() - 1, height: this.element.outerHeight() - 1, position: "absolute", left: this.elementOffset.left + "px", top: this.elementOffset.top + "px", zIndex: ++i.zIndex }), this.helper.appendTo("body").disableSelection()) : this.helper = this.element }, _change: { e: function (n, t) { return { width: this.originalSize.width + t } }, w: function (n, t) { var i = this.originalSize, r = this.originalPosition; return { left: r.left + t, width: i.width - t } }, n: function (n, t, i) { var r = this.originalSize, u = this.originalPosition; return { top: u.top + i, height: r.height - i } }, s: function (n, t, i) { return { height: this.originalSize.height + i } }, se: function (t, i, r) { return n.extend(this._change.s.apply(this, arguments), this._change.e.apply(this, [t, i, r])) }, sw: function (t, i, r) { return n.extend(this._change.s.apply(this, arguments), this._change.w.apply(this, [t, i, r])) }, ne: function (t, i, r) { return n.extend(this._change.n.apply(this, arguments), this._change.e.apply(this, [t, i, r])) }, nw: function (t, i, r) { return n.extend(this._change.n.apply(this, arguments), this._change.w.apply(this, [t, i, r])) } }, _propagate: function (t, i) { n.ui.plugin.call(this, t, [i, this.ui()]); t !== "resize" && this._trigger(t, i, this.ui()) }, plugins: {}, ui: function () { return { originalElement: this.originalElement, element: this.element, helper: this.helper, position: this.position, size: this.size, originalSize: this.originalSize, originalPosition: this.originalPosition } } }), n.ui.plugin.add("resizable", "animate", { stop: function (t) { var i = n(this).resizable("instance"), u = i.options, r = i._proportionallyResizeElements, f = r.length && /textarea/i.test(r[0].nodeName), s = f && i._hasScroll(r[0], "left") ? 0 : i.sizeDiff.height, h = f ? 0 : i.sizeDiff.width, c = { width: i.size.width - h, height: i.size.height - s }, e = parseInt(i.element.css("left"), 10) + (i.position.left - i.originalPosition.left) || null, o = parseInt(i.element.css("top"), 10) + (i.position.top - i.originalPosition.top) || null; i.element.animate(n.extend(c, o && e ? { top: o, left: e } : {}), { duration: u.animateDuration, easing: u.animateEasing, step: function () { var u = { width: parseInt(i.element.css("width"), 10), height: parseInt(i.element.css("height"), 10), top: parseInt(i.element.css("top"), 10), left: parseInt(i.element.css("left"), 10) }; r && r.length && n(r[0]).css({ width: u.width, height: u.height }); i._updateCache(u); i._propagate("resize", t) } }) } }), n.ui.plugin.add("resizable", "containment", { start: function () { var r, f, e, o, s, h, c, t = n(this).resizable("instance"), l = t.options, a = t.element, u = l.containment, i = u instanceof n ? u.get(0) : /parent/.test(u) ? a.parent().get(0) : u; i && (t.containerElement = n(i), /document/.test(u) || u === document ? (t.containerOffset = { left: 0, top: 0 }, t.containerPosition = { left: 0, top: 0 }, t.parentData = { element: n(document), left: 0, top: 0, width: n(document).width(), height: n(document).height() || document.body.parentNode.scrollHeight }) : (r = n(i), f = [], n(["Top", "Right", "Left", "Bottom"]).each(function (n, i) { f[n] = t._num(r.css("padding" + i)) }), t.containerOffset = r.offset(), t.containerPosition = r.position(), t.containerSize = { height: r.innerHeight() - f[3], width: r.innerWidth() - f[1] }, e = t.containerOffset, o = t.containerSize.height, s = t.containerSize.width, h = t._hasScroll(i, "left") ? i.scrollWidth : s, c = t._hasScroll(i) ? i.scrollHeight : o, t.parentData = { element: i, left: e.left, top: e.top, width: h, height: c })) }, resize: function (t) { var o, s, h, c, i = n(this).resizable("instance"), v = i.options, r = i.containerOffset, l = i.position, f = i._aspectRatio || t.shiftKey, e = { top: 0, left: 0 }, a = i.containerElement, u = !0; a[0] !== document && /static/.test(a.css("position")) && (e = r); l.left < (i._helper ? r.left : 0) && (i.size.width = i.size.width + (i._helper ? i.position.left - r.left : i.position.left - e.left), f && (i.size.height = i.size.width / i.aspectRatio, u = !1), i.position.left = v.helper ? r.left : 0); l.top < (i._helper ? r.top : 0) && (i.size.height = i.size.height + (i._helper ? i.position.top - r.top : i.position.top), f && (i.size.width = i.size.height * i.aspectRatio, u = !1), i.position.top = i._helper ? r.top : 0); h = i.containerElement.get(0) === i.element.parent().get(0); c = /relative|absolute/.test(i.containerElement.css("position")); h && c ? (i.offset.left = i.parentData.left + i.position.left, i.offset.top = i.parentData.top + i.position.top) : (i.offset.left = i.element.offset().left, i.offset.top = i.element.offset().top); o = Math.abs(i.sizeDiff.width + (i._helper ? i.offset.left - e.left : i.offset.left - r.left)); s = Math.abs(i.sizeDiff.height + (i._helper ? i.offset.top - e.top : i.offset.top - r.top)); o + i.size.width >= i.parentData.width && (i.size.width = i.parentData.width - o, f && (i.size.height = i.size.width / i.aspectRatio, u = !1)); s + i.size.height >= i.parentData.height && (i.size.height = i.parentData.height - s, f && (i.size.width = i.size.height * i.aspectRatio, u = !1)); u || (i.position.left = i.prevPosition.left, i.position.top = i.prevPosition.top, i.size.width = i.prevSize.width, i.size.height = i.prevSize.height) }, stop: function () { var t = n(this).resizable("instance"), r = t.options, u = t.containerOffset, f = t.containerPosition, e = t.containerElement, i = n(t.helper), o = i.offset(), s = i.outerWidth() - t.sizeDiff.width, h = i.outerHeight() - t.sizeDiff.height; t._helper && !r.animate && /relative/.test(e.css("position")) && n(this).css({ left: o.left - f.left - u.left, width: s, height: h }); t._helper && !r.animate && /static/.test(e.css("position")) && n(this).css({ left: o.left - f.left - u.left, width: s, height: h }) } }), n.ui.plugin.add("resizable", "alsoResize", { start: function () { var t = n(this).resizable("instance"), i = t.options; n(i.alsoResize).each(function () { var t = n(this); t.data("ui-resizable-alsoresize", { width: parseInt(t.width(), 10), height: parseInt(t.height(), 10), left: parseInt(t.css("left"), 10), top: parseInt(t.css("top"), 10) }) }) }, resize: function (t, i) { var r = n(this).resizable("instance"), e = r.options, u = r.originalSize, f = r.originalPosition, o = { height: r.size.height - u.height || 0, width: r.size.width - u.width || 0, top: r.position.top - f.top || 0, left: r.position.left - f.left || 0 }; n(e.alsoResize).each(function () { var t = n(this), u = n(this).data("ui-resizable-alsoresize"), r = {}, f = t.parents(i.originalElement[0]).length ? ["width", "height"] : ["width", "height", "top", "left"]; n.each(f, function (n, t) { var i = (u[t] || 0) + (o[t] || 0); i && i >= 0 && (r[t] = i || null) }); t.css(r) }) }, stop: function () { n(this).removeData("resizable-alsoresize") } }), n.ui.plugin.add("resizable", "ghost", { start: function () { var t = n(this).resizable("instance"), i = t.options, r = t.size; t.ghost = t.originalElement.clone(); t.ghost.css({ opacity: .25, display: "block", position: "relative", height: r.height, width: r.width, margin: 0, left: 0, top: 0 }).addClass("ui-resizable-ghost").addClass(typeof i.ghost == "string" ? i.ghost : ""); t.ghost.appendTo(t.helper) }, resize: function () { var t = n(this).resizable("instance"); t.ghost && t.ghost.css({ position: "relative", height: t.size.height, width: t.size.width }) }, stop: function () { var t = n(this).resizable("instance"); t.ghost && t.helper && t.helper.get(0).removeChild(t.ghost.get(0)) } }), n.ui.plugin.add("resizable", "grid", { resize: function () { var h, t = n(this).resizable("instance"), i = t.options, y = t.size, o = t.originalSize, s = t.originalPosition, c = t.axis, l = typeof i.grid == "number" ? [i.grid, i.grid] : i.grid, f = l[0] || 1, e = l[1] || 1, a = Math.round((y.width - o.width) / f) * f, v = Math.round((y.height - o.height) / e) * e, r = o.width + a, u = o.height + v, p = i.maxWidth && i.maxWidth < r, w = i.maxHeight && i.maxHeight < u, b = i.minWidth && i.minWidth > r, k = i.minHeight && i.minHeight > u; i.grid = l; b && (r += f); k && (u += e); p && (r -= f); w && (u -= e); /^(se|s|e)$/.test(c) ? (t.size.width = r, t.size.height = u) : /^(ne)$/.test(c) ? (t.size.width = r, t.size.height = u, t.position.top = s.top - v) : /^(sw)$/.test(c) ? (t.size.width = r, t.size.height = u, t.position.left = s.left - a) : ((u - e <= 0 || r - f <= 0) && (h = t._getPaddingPlusBorderDimensions(this)), u - e > 0 ? (t.size.height = u, t.position.top = s.top - v) : (u = e - h.height, t.size.height = u, t.position.top = s.top + o.height - u), r - f > 0 ? (t.size.width = r, t.position.left = s.left - a) : (r = f - h.width, t.size.width = r, t.position.left = s.left + o.width - r)) } }), n.ui.resizable });
/*!
 * jQuery UI Dialog 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/dialog/
 */
(function (n) { typeof define == "function" && define.amd ? define("jQueryUI/dialog",["jquery", "./core", "./widget", "./button", "./draggable", "./mouse", "./position", "./resizable"], n) : n(jQuery) })(function (n) { return n.widget("ui.dialog", { version: "1.11.4", options: { appendTo: "body", autoOpen: !0, buttons: [], closeOnEscape: !0, closeText: "Close", dialogClass: "", draggable: !0, hide: null, height: "auto", maxHeight: null, maxWidth: null, minHeight: 150, minWidth: 150, modal: !1, position: { my: "center", at: "center", of: window, collision: "fit", using: function (t) { var i = n(this).css(t).offset().top; i < 0 && n(this).css("top", t.top - i) } }, resizable: !0, show: null, title: null, width: 300, beforeClose: null, close: null, drag: null, dragStart: null, dragStop: null, focus: null, open: null, resize: null, resizeStart: null, resizeStop: null }, sizeRelatedOptions: { buttons: !0, height: !0, maxHeight: !0, maxWidth: !0, minHeight: !0, minWidth: !0, width: !0 }, resizableRelatedOptions: { maxHeight: !0, maxWidth: !0, minHeight: !0, minWidth: !0 }, _create: function () { this.originalCss = { display: this.element[0].style.display, width: this.element[0].style.width, minHeight: this.element[0].style.minHeight, maxHeight: this.element[0].style.maxHeight, height: this.element[0].style.height }; this.originalPosition = { parent: this.element.parent(), index: this.element.parent().children().index(this.element) }; this.originalTitle = this.element.attr("title"); this.options.title = this.options.title || this.originalTitle; this._createWrapper(); this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog); this._createTitlebar(); this._createButtonPane(); this.options.draggable && n.fn.draggable && this._makeDraggable(); this.options.resizable && n.fn.resizable && this._makeResizable(); this._isOpen = !1; this._trackFocus() }, _init: function () { this.options.autoOpen && this.open() }, _appendTo: function () { var t = this.options.appendTo; return t && (t.jquery || t.nodeType) ? n(t) : this.document.find(t || "body").eq(0) }, _destroy: function () { var n, t = this.originalPosition; this._untrackInstance(); this._destroyOverlay(); this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(); this.uiDialog.stop(!0, !0).remove(); this.originalTitle && this.element.attr("title", this.originalTitle); n = t.parent.children().eq(t.index); n.length && n[0] !== this.element[0] ? n.before(this.element) : t.parent.append(this.element) }, widget: function () { return this.uiDialog }, disable: n.noop, enable: n.noop, close: function (t) { var i, r = this; if (this._isOpen && this._trigger("beforeClose", t) !== !1) { if (this._isOpen = !1, this._focusedElement = null, this._destroyOverlay(), this._untrackInstance(), !this.opener.filter(":focusable").focus().length) try { i = this.document[0].activeElement; i && i.nodeName.toLowerCase() !== "body" && n(i).blur() } catch (u) { } this._hide(this.uiDialog, this.options.hide, function () { r._trigger("close", t) }) } }, isOpen: function () { return this._isOpen }, moveToTop: function () { this._moveToTop() }, _moveToTop: function (t, i) { var r = !1, f = this.uiDialog.siblings(".ui-front:visible").map(function () { return +n(this).css("z-index") }).get(), u = Math.max.apply(null, f); return u >= +this.uiDialog.css("z-index") && (this.uiDialog.css("z-index", u + 1), r = !0), r && !i && this._trigger("focus", t), r }, open: function () { var t = this; if (this._isOpen) { this._moveToTop() && this._focusTabbable(); return } this._isOpen = !0; this.opener = n(this.document[0].activeElement); this._size(); this._position(); this._createOverlay(); this._moveToTop(null, !0); this.overlay && this.overlay.css("z-index", this.uiDialog.css("z-index") - 1); this._show(this.uiDialog, this.options.show, function () { t._focusTabbable(); t._trigger("focus") }); this._makeFocusTarget(); this._trigger("open") }, _focusTabbable: function () { var n = this._focusedElement; n || (n = this.element.find("[autofocus]")); n.length || (n = this.element.find(":tabbable")); n.length || (n = this.uiDialogButtonPane.find(":tabbable")); n.length || (n = this.uiDialogTitlebarClose.filter(":tabbable")); n.length || (n = this.uiDialog); n.eq(0).focus() }, _keepFocus: function (t) { function i() { var t = this.document[0].activeElement, i = this.uiDialog[0] === t || n.contains(this.uiDialog[0], t); i || this._focusTabbable() } t.preventDefault(); i.call(this); this._delay(i) }, _createWrapper: function () { this.uiDialog = n("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front " + this.options.dialogClass).hide().attr({ tabIndex: -1, role: "dialog" }).appendTo(this._appendTo()); this._on(this.uiDialog, { keydown: function (t) { if (this.options.closeOnEscape && !t.isDefaultPrevented() && t.keyCode && t.keyCode === n.ui.keyCode.ESCAPE) { t.preventDefault(); this.close(t); return } if (t.keyCode === n.ui.keyCode.TAB && !t.isDefaultPrevented()) { var i = this.uiDialog.find(":tabbable"), r = i.filter(":first"), u = i.filter(":last"); t.target !== u[0] && t.target !== this.uiDialog[0] || t.shiftKey ? (t.target === r[0] || t.target === this.uiDialog[0]) && t.shiftKey && (this._delay(function () { u.focus() }), t.preventDefault()) : (this._delay(function () { r.focus() }), t.preventDefault()) } }, mousedown: function (n) { this._moveToTop(n) && this._focusTabbable() } }); this.element.find("[aria-describedby]").length || this.uiDialog.attr({ "aria-describedby": this.element.uniqueId().attr("id") }) }, _createTitlebar: function () { var t; this.uiDialogTitlebar = n("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog); this._on(this.uiDialogTitlebar, { mousedown: function (t) { n(t.target).closest(".ui-dialog-titlebar-close") || this.uiDialog.focus() } }); this.uiDialogTitlebarClose = n("<button type='button'><\/button>").button({ label: this.options.closeText, icons: { primary: "ui-icon-closethick" }, text: !1 }).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar); this._on(this.uiDialogTitlebarClose, { click: function (n) { n.preventDefault(); this.close(n) } }); t = n("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar); this._title(t); this.uiDialog.attr({ "aria-labelledby": t.attr("id") }) }, _title: function (n) { this.options.title || n.html("&#160;"); n.text(this.options.title) }, _createButtonPane: function () { this.uiDialogButtonPane = n("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"); this.uiButtonSet = n("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane); this._createButtons() }, _createButtons: function () { var i = this, t = this.options.buttons; if (this.uiDialogButtonPane.remove(), this.uiButtonSet.empty(), n.isEmptyObject(t) || n.isArray(t) && !t.length) { this.uiDialog.removeClass("ui-dialog-buttons"); return } n.each(t, function (t, r) { var u, f; r = n.isFunction(r) ? { click: r, text: t } : r; r = n.extend({ type: "button" }, r); u = r.click; r.click = function () { u.apply(i.element[0], arguments) }; f = { icons: r.icons, text: r.showText }; delete r.icons; delete r.showText; n("<button><\/button>", r).button(f).appendTo(i.uiButtonSet) }); this.uiDialog.addClass("ui-dialog-buttons"); this.uiDialogButtonPane.appendTo(this.uiDialog) }, _makeDraggable: function () { function i(n) { return { position: n.position, offset: n.offset } } var t = this, r = this.options; this.uiDialog.draggable({ cancel: ".ui-dialog-content, .ui-dialog-titlebar-close", handle: ".ui-dialog-titlebar", containment: "document", start: function (r, u) { n(this).addClass("ui-dialog-dragging"); t._blockFrames(); t._trigger("dragStart", r, i(u)) }, drag: function (n, r) { t._trigger("drag", n, i(r)) }, stop: function (u, f) { var e = f.offset.left - t.document.scrollLeft(), o = f.offset.top - t.document.scrollTop(); r.position = { my: "left top", at: "left" + (e >= 0 ? "+" : "") + e + " top" + (o >= 0 ? "+" : "") + o, of: t.window }; n(this).removeClass("ui-dialog-dragging"); t._unblockFrames(); t._trigger("dragStop", u, i(f)) } }) }, _makeResizable: function () { function r(n) { return { originalPosition: n.originalPosition, originalSize: n.originalSize, position: n.position, size: n.size } } var t = this, i = this.options, u = i.resizable, f = this.uiDialog.css("position"), e = typeof u == "string" ? u : "n,e,s,w,se,sw,ne,nw"; this.uiDialog.resizable({ cancel: ".ui-dialog-content", containment: "document", alsoResize: this.element, maxWidth: i.maxWidth, maxHeight: i.maxHeight, minWidth: i.minWidth, minHeight: this._minHeight(), handles: e, start: function (i, u) { n(this).addClass("ui-dialog-resizing"); t._blockFrames(); t._trigger("resizeStart", i, r(u)) }, resize: function (n, i) { t._trigger("resize", n, r(i)) }, stop: function (u, f) { var e = t.uiDialog.offset(), o = e.left - t.document.scrollLeft(), s = e.top - t.document.scrollTop(); i.height = t.uiDialog.height(); i.width = t.uiDialog.width(); i.position = { my: "left top", at: "left" + (o >= 0 ? "+" : "") + o + " top" + (s >= 0 ? "+" : "") + s, of: t.window }; n(this).removeClass("ui-dialog-resizing"); t._unblockFrames(); t._trigger("resizeStop", u, r(f)) } }).css("position", f) }, _trackFocus: function () { this._on(this.widget(), { focusin: function (t) { this._makeFocusTarget(); this._focusedElement = n(t.target) } }) }, _makeFocusTarget: function () { this._untrackInstance(); this._trackingInstances().unshift(this) }, _untrackInstance: function () { var t = this._trackingInstances(), i = n.inArray(this, t); i !== -1 && t.splice(i, 1) }, _trackingInstances: function () { var n = this.document.data("ui-dialog-instances"); return n || (n = [], this.document.data("ui-dialog-instances", n)), n }, _minHeight: function () { var n = this.options; return n.height === "auto" ? n.minHeight : Math.min(n.minHeight, n.height) }, _position: function () { var n = this.uiDialog.is(":visible"); n || this.uiDialog.show(); this.uiDialog.position(this.options.position); n || this.uiDialog.hide() }, _setOptions: function (t) { var i = this, r = !1, u = {}; n.each(t, function (n, t) { i._setOption(n, t); n in i.sizeRelatedOptions && (r = !0); n in i.resizableRelatedOptions && (u[n] = t) }); r && (this._size(), this._position()); this.uiDialog.is(":data(ui-resizable)") && this.uiDialog.resizable("option", u) }, _setOption: function (n, t) { var u, r, i = this.uiDialog; (n === "dialogClass" && i.removeClass(this.options.dialogClass).addClass(t), n !== "disabled") && (this._super(n, t), n === "appendTo" && this.uiDialog.appendTo(this._appendTo()), n === "buttons" && this._createButtons(), n === "closeText" && this.uiDialogTitlebarClose.button({ label: "" + t }), n === "draggable" && (u = i.is(":data(ui-draggable)"), u && !t && i.draggable("destroy"), !u && t && this._makeDraggable()), n === "position" && this._position(), n === "resizable" && (r = i.is(":data(ui-resizable)"), r && !t && i.resizable("destroy"), r && typeof t == "string" && i.resizable("option", "handles", t), r || t === !1 || this._makeResizable()), n === "title" && this._title(this.uiDialogTitlebar.find(".ui-dialog-title"))) }, _size: function () { var t, i, r, n = this.options; this.element.show().css({ width: "auto", minHeight: 0, maxHeight: "none", height: 0 }); n.minWidth > n.width && (n.width = n.minWidth); t = this.uiDialog.css({ height: "auto", width: n.width }).outerHeight(); i = Math.max(0, n.minHeight - t); r = typeof n.maxHeight == "number" ? Math.max(0, n.maxHeight - t) : "none"; n.height === "auto" ? this.element.css({ minHeight: i, maxHeight: r, height: "auto" }) : this.element.height(Math.max(0, n.height - t)); this.uiDialog.is(":data(ui-resizable)") && this.uiDialog.resizable("option", "minHeight", this._minHeight()) }, _blockFrames: function () { this.iframeBlocks = this.document.find("iframe").map(function () { var t = n(this); return n("<div>").css({ position: "absolute", width: t.outerWidth(), height: t.outerHeight() }).appendTo(t.parent()).offset(t.offset())[0] }) }, _unblockFrames: function () { this.iframeBlocks && (this.iframeBlocks.remove(), delete this.iframeBlocks) }, _allowInteraction: function (t) { return n(t.target).closest(".ui-dialog").length ? !0 : !!n(t.target).closest(".ui-datepicker").length }, _createOverlay: function () { if (this.options.modal) { var t = !0; this._delay(function () { t = !1 }); this.document.data("ui-dialog-overlays") || this._on(this.document, { focusin: function (n) { t || this._allowInteraction(n) || (n.preventDefault(), this._trackingInstances()[0]._focusTabbable()) } }); this.overlay = n("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()); this._on(this.overlay, { mousedown: "_keepFocus" }); this.document.data("ui-dialog-overlays", (this.document.data("ui-dialog-overlays") || 0) + 1) } }, _destroyOverlay: function () { if (this.options.modal && this.overlay) { var n = this.document.data("ui-dialog-overlays") - 1; n ? this.document.data("ui-dialog-overlays", n) : this.document.unbind("focusin").removeData("ui-dialog-overlays"); this.overlay.remove(); this.overlay = null } } }) });
// Copyright (C) Microsoft Corporation. All rights reserved.
var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__assign=this&&this.__assign||Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n};define("VSS/Controls/Dialogs",["require","exports","VSS/Controls","VSS/Diag","VSS/Events/Services","VSS/Navigation/HubsService","VSS/Controls/Panels","VSS/Controls/PopupContent","VSS/Resources/VSS.Resources.Platform","VSS/Utils/Accessibility","VSS/Utils/Core","VSS/Utils/String","VSS/Utils/UI","VSS/VSS","q","jQueryUI/core","jQueryUI/button","jQueryUI/dialog","VSS/LoaderPlugins/Css!VSS.Controls"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){function rt(n,t){t&&a.BrowserCheckUtils.isEdge()&&$.each(t,function(t,i){var r=i.click;r&&(i.click=function(t){t&&!$(t.currentTarget).is(":disabled")&&r.apply(n[0],arguments)})})}function ut(n,t){var r=t||"",i;return i=typeof n=="string"?n.split(" "):n,r.split(" ").concat(i).filter(function(n,t,i){return i.indexOf(n)===t}).join(" ")}function st(n,t){return w.show(n,t)}function ht(n,t){return b.showMessageDialog(n,t)}var p,it,k,w,d,g,nt,ft,et,tt,b,ot;Object.defineProperty(t,"__esModule",{value:!0});p=c.delegate;it=a.domElem,function(){var n=[".ms-Layer"];$.widget("ui.dialog",$.ui.dialog,{_allowInteraction:function(t){var i,r,u;if(this._super(t)||a.BrowserCheckUtils.isFirefox()&&t.type==="focusin"&&t.target==document)return!0;for(i=0,r=n;i<r.length;i++)if(u=r[i],$(t.target).closest(u).length)return!0}})}();t.preventClickingDisabledButtons=rt;k=function(n){function t(t){var i=n.call(this,t)||this;return i._closedByNavigation=!1,i._onWindowResizeDelegate=p(i,i._onWindowResize),i}return __extends(t,n),t.beginExecuteDialogAction=function(n){w._dialogActionInProgress||(w._dialogActionInProgress=!0,n(function(){w._dialogActionInProgress=!1}))},t.create=function(n,t){var o=t&&t.content||$("<div />"),r,u,f,e;return t&&t.contentText&&o.text(t.contentText),r=i.Enhancement.enhance(n,o,t),u=this._getNextDialogZIndex(),r._element.parent().css("z-index",u),r._options.modal&&(f=r._element.parent().next("div.ui-widget-overlay").css("z-index",u-1),(a.BrowserCheckUtils.isIE()||a.BrowserCheckUtils.isEdge())&&(e=f.clone().insertAfter(f),f.css("width","50%"),e.css({"z-index":u-1,width:"50%",left:"50%"}),r._secondOverlay=e)),r._element.parent().children("div.ui-icon-gripsmall-diagonal-se").addClass("ui-icon-grip-diagonal-se"),r},t._getNextDialogZIndex=function(){var t,n,i=0;return $("div.ui-dialog").each(function(){t=Number($(this).css("z-index"));!isNaN(t)&&t>i&&(i=t)}),i<10001?n=10002:(n=i+2,n%2!=0&&n++),n},t.show=function(n,t){return this.create(n,$.extend({autoOpen:!0},t))},t.prototype.initializeOptions=function(t){var i,r,u,f;this._options=this._options||{};n.prototype.initializeOptions.call(this,$.extend({coreCssClass:"dialog",widthPct:.8,heightPct:.8,modal:!0,draggable:!0,resizable:!0,autoOpen:!1,dynamicSize:!0,disposeOnClose:!0,closeText:s.CloseButtonLabelText},t));i=this._options;r=$(window);i.height==="auto"&&(i.height=null);i.minWidth=Math.max(240,parseInt(i.minWidth,10)||0);i.minHeight=Math.max(192,parseInt(i.minHeight,10)||0);this._specifiedMaxWidth=parseInt(i.maxWidth,10);this._specifiedMaxHeight=parseInt(i.maxHeight,10);this._setMaxSize();this._ensureCtaButton();i.dynamicSize?(i.width=r.width()*i.widthPct,i.height=r.height()*i.heightPct):!i.useLegacyStyle&&i.height&&(u=66,i.subtitle&&(u+=22),f=typeof i.height=="number"?i.height:parseInt(i.height,10),f+=u,i.height=f);i.height&&!isNaN(i.height)&&(i.height=Math.min(i.height,r.height()));i.width&&!isNaN(i.width)&&(i.width=Math.min(i.width,r.width()));i.hideCloseButton&&(i.dialogClass=ut("no-close",i.dialogClass));this._options.useLegacyStyle&&(i.dialogClass=ut("ui-dialog-legacy",i.dialogClass))},t.prototype.initialize=function(){var t=this,s,l,c,h;n.prototype.initialize.call(this);var i=this,v=$(window),e=$.extend({},this._options);e.title=this.getTitle();e.close=function(n){t._options.close&&t._options.close(__assign({},n,{closedByNavigation:t._closedByNavigation}));t._removeSecondOverlay();t.onClose(n)};e.open=function(n){i._options.open&&i._options.open.call(this,n);i.onOpen(n)};this._bind("dialogdragstart dialogdragstop",function(){u.getService().fire("dialog-move",t);t._onDialogMove()});this._options.attachResize&&this._bind("dialogresizestop",this.onDialogResize.bind(this));this._options.resizable&&(this._bind("dialogresize",this._onDialogResizing.bind(this)),this._bind("dialogresizestart",this._onDialogResizeStart.bind(this)));e.dynamicSize&&(u.getService().attachEvent("window-resize",this._onWindowResizeDelegate),this._bind("dialogclose",function(){var n=u.getService();n.fire("dialog-close",i);n.detachEvent("window-resize",i._onWindowResizeDelegate)}));e.url||r.logTracePoint("Dialog.initialize.complete");rt(this.getElement(),e.buttons);this._options.contentMargin===!1&&this.getElement().addClass("no-margin");this.getElement().dialog(e);this._options.useLegacyStyle||(s=this.getElement().parent(),l=s.find(".ui-dialog-titlebar"),l.addClass("bowtie").append($("<div />").addClass("ui-dialog-subtitle")),c=$("span.ui-dialog-title",l),c.attr({role:"heading","aria-level":1}),a.tooltipIfOverflow(c[0],{titleTarget:c[0],titleText:this.getTitle()}),s.find(".ui-dialog-buttonpane").addClass("bowtie"),h=s.find("button.ui-dialog-titlebar-close"),this._closeTooltip=o.RichContentTooltip.add(this._options.closeText,h),h.removeAttr("title"),h.attr("aria-label",this._options.closeText),h.find(".ui-button-icon-primary").addClass("bowtie-icon bowtie-navigate-close"),(this._options.useBowtieStyle||this._options.bowtieVersion>0)&&s.addClass("bowtie-style"));this.setSubtitle(this.getSubtitle());this.getElement().keydown(function(n){var r,u,t;if(n.keyCode===$.ui.keyCode.ENTER){if(t=$(n.target),(!n.shiftKey&&t.is("input[type='text']")||t.is("textarea")&&n.ctrlKey)&&i._options.defaultButton&&i._options.buttons)return r=i._options.buttons[i._options.defaultButton],r&&(u=$("#"+r.id).button("option"),u.disabled||r.click.apply(this,[n])),!1;if(!t.is("textarea")&&!t.is("a")&&!t.is("button")&&!t.hasClass("propagate-keydown-event"))return!1}});this._options.resizable&&this._addResizeKeydownHandler();setTimeout(function(){t._autoSizeAndPosition();t.onInitialize()},0);w._dialogActionInProgress=!1;this._onHubNavigateDelegate=function(){t._closedByNavigation=!0;t.close()};u.getService().attachEvent(f.HubEventNames.PreXHRNavigate,this._onHubNavigateDelegate)},t.prototype._addResizeKeydownHandler=function(){var t=this,n=this.getElement(),i=n.siblings(".ui-icon-gripsmall-diagonal-se");if(i.length>0){i.attr({tabindex:0,role:"button","aria-label":s.DialogResizeLabel});var r=n.dialog("option","minWidth")||150,u=n.dialog("option","minHeight")||150,f=n.dialog("option","maxWidth")||Number.MAX_VALUE,e=n.dialog("option","maxHeight")||Number.MAX_VALUE;i.keydown(function(n){switch(n.keyCode){case a.KeyCode.LEFT:t._resize("width",!1,r,Math.max);h.announce(s.DialogSizeDecreased);break;case a.KeyCode.RIGHT:t._resize("width",!0,f,Math.min);h.announce(s.DialogSizeIncreased);break;case a.KeyCode.UP:t._resize("height",!1,u,Math.max);h.announce(s.DialogSizeDecreased);break;case a.KeyCode.DOWN:t._resize("height",!0,e,Math.min);h.announce(s.DialogSizeIncreased)}})}},t.prototype._resize=function(n,i,r,u){var f=this.getElement(),e=f.dialog("option",n),o;e==="auto"&&(e=f.parent().height());o=u(e+t.RESIZE_STEP*(i?1:-1),r);f.dialog("option",n,o);f.trigger("dialogresizestop",{size:{width:f.dialog("option","width"),height:f.dialog("option","height")}})},t.prototype._autoSizeAndPosition=function(){var n=this.getElement(),t=this._options;n&&n.length>0&&$.contains(document.body,n[0])&&(t.preventAutoResize||(t.position&&n.dialog("option","position",t.position),t.height?n.dialog("option","height",t.height):n.dialog("option","height","auto"),this._setMaxHeight()),n.show())},t.prototype._ensureCtaButton=function(){var n=this._options,r,u,t,i;n.noAutoCta!==!0&&(r=/(^cta$)|(^cta\ )|(\ cta\ )|( cta$)/,u=/(^warning$)|(^warning\ )|(\ warning\ )|( warning$)/,$.isArray(n.buttons)&&n.buttons.length>0&&!n.buttons.some(function(n){return r.test(n.class)})&&!n.buttons.some(function(n){return u.test(n.class)})?(i=n.buttons[0].class||"",n.buttons[0].class=i+" cta"):n.buttons&&typeof n.buttons=="object"&&(t=Object.keys(n.buttons),t.length>0&&(t.some(function(t){return r.test(n.buttons[t].class)})||t.some(function(t){return u.test(n.buttons[t].class)})||(i=n.buttons[t[0]].class||"",n.buttons[t[0]].class=i+" cta"))))},t.prototype.onLoadCompleted=function(t){n.prototype.onLoadCompleted.call(this,t);this.setInitialFocus();r.logTracePoint("Dialog.initialize.complete")},t.prototype.setInitialFocus=function(){var n=this._options.initialFocusSelector||":visible:tabbable";this.getElement().find(n).first().focus()},t.prototype.setFormFocusDelayed=function(n){c.delay(this,300,function(){n.eq(0).focus().select()})},t.prototype.setTitle=function(n){this._title=n;this._updateTitle()},t.prototype.getTitle=function(){return this._title||this._options.title||this.getElement().attr("title")||""},t.prototype.setSubtitle=function(n){this._subtitle=n;this._updateSubtitle()},t.prototype.getSubtitle=function(){var n=this._subtitle;return(n===null||n===undefined)&&(n=this._options.subtitle),n||""},t.prototype.centerDialog=function(){this.getElement().dialog("option","position",{my:"center",at:"center",of:window});this._setMaxHeight()},t.prototype.getDialogResult=function(){return this._dialogResult},t.prototype.setDialogResult=function(n){this._dialogResult=n},t.prototype.show=function(){this.getElement().dialog("open")},t.prototype.onOpen=function(){if(!this._options||this._options.hasProgressElement!==!1){var n=$("<div />").addClass("ui-dialog-titlebar-progress-container").appendTo(this.getElement().parent().find(".ui-dialog-titlebar"));this._progressElement=$("<div />").addClass("ui-dialog-titlebar-progress-element").appendTo(n);v.globalProgressIndicator.registerProgressElement(this._progressElement)}u.getService().fire("dialog-open",this)},t.prototype.onClose=function(){u.getService().fire("dialog-close",this);this._progressElement&&v.globalProgressIndicator.unRegisterProgressElement(this._progressElement);this._removeSecondOverlay();this._options.disposeOnClose&&this.dispose();var n=$(".ui-dialog").slice(-1);n.length&&!this._options.noFocusOnClose&&n.focus()},t.prototype.onInitialize=function(){typeof this._options.initialize=="function"&&this._options.initialize.call(this)},t.prototype.close=function(){this.getElement()&&this.getElement().dialog("close")},t.prototype.dispose=function(){this._removeSecondOverlay();u.getService().detachEvent(f.HubEventNames.PreXHRNavigate,this._onHubNavigateDelegate);this._closeTooltip&&(this._closeTooltip.dispose(),this._closeTooltip=null);n.prototype.dispose.call(this)},t.prototype._removeSecondOverlay=function(){this._secondOverlay&&(this._secondOverlay.remove(),this._secondOverlay=null)},t.prototype._updateSubtitle=function(){if(this._initialized&&this.getElement()){var n=this.getElement().parent().find(".ui-dialog-subtitle"),t=this.getSubtitle()||"";n.text(t);a.tooltipIfOverflow(n[0],{titleTarget:n[0],titleText:t});n.toggle(t.length>0)}},t.prototype.onDialogResize=function(){},t.prototype._updateTitle=function(){if(this._initialized&&this.getElement()){var t=this.getElement().dialog("option","title",this.getTitle()),n=$("span.ui-dialog-title",t.parent());a.tooltipIfOverflow(n[0],{titleTarget:n[0],titleText:this.getTitle()})}},t.prototype._onWindowResize=function(){var t=$(window),n=this._options;this._setMaxSize();this.getElement().dialog("option",{width:t.width()*n.widthPct,height:t.height()*n.heightPct,maxHeight:parseInt(this._options.maxHeight,10),maxWidth:parseInt(this._options.maxWidth,10)});this.getElement().dialog("option",{position:n.position})},t.prototype._onDialogResizing=function(n,t){var u=$(window),i,r;t&&t.position&&t.size&&(i=Math.min(t.size.height,u.height()-t.position.top),r=Math.min(t.size.width,u.width()-t.position.left),(i!==t.size.height||r!==t.size.width)&&this.getElement().dialog("option",{width:r,height:i}))},t.prototype._onDialogMove=function(){this._options.preventAutoResize||(this._setMaxHeight(),this._ensureDialogContentHeight());this._hideCloseButtonTooltip()},t.prototype._onDialogResizeStart=function(){this._hideCloseButtonTooltip()},t.prototype._ensureDialogContentHeight=function(){var n=this.getElement().parent().css("height");n!=="auto"?this.getElement().css("height",this.getElement().outerHeight()):this.getElement().css("height","auto")},t.prototype._setMaxHeight=function(){var n=this.getElement().prev().outerHeight(!0)+this.getElement().next().outerHeight(!0);this.getElement().css("maxHeight",window.innerHeight-this.getElement().parent().position().top-n)},t.prototype._setMaxSize=function(){this._options.maxWidth=Math.min(window.innerWidth,this._specifiedMaxWidth||Infinity);this._options.maxHeight=Math.min(window.innerHeight,this._specifiedMaxHeight||Infinity)},t.prototype._hideCloseButtonTooltip=function(){this._closeTooltip&&this._closeTooltip.hide()},t.enhancementTypeName="tfs.dialog",t._dialogActionInProgress=!1,t.RESIZE_STEP=25,t}(e.AjaxPanelO);t.DialogO=k;w=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(k);t.Dialog=w;d=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,$.extend({coreCssClass:"dialog modal-dialog",modal:!0,dynamicSize:!1,width:500,height:"auto",defaultButton:"ok",buttons:{ok:{id:"ok",text:t&&t.okText||s.ModalDialogOkButton,click:p(this,this.onOkClick),"class":"cta",disabled:"disabled"},cancel:{id:"cancel",text:t&&t.cancelText||s.ModalDialogCancelButton,click:p(this,this.onCancelClick)}}},t))},t.prototype.initialize=function(){this._bind(g.EVENT_BUTTON_STATUS_CHANGE,p(this,this.onButtonStatusChange));this._bind("resultReady",p(this,this.onResultReady));n.prototype.initialize.call(this)},t.prototype.updateOkButton=function(n){this.getElement()&&this.getElement().trigger(g.EVENT_BUTTON_STATUS_CHANGE,{enabled:n===!0})},t.prototype.processResult=function(n){var t=this._options.okCallback;n&&($.isFunction(t)&&(t.call(this,n),r.logTracePoint(this.getTypeName()+".callback-complete")),this.close())},t.prototype.onOkClick=function(){r.logTracePoint(this.getTypeName()+".OkClicked");this.processResult(this.getDialogResult())},t.prototype.onResultReady=function(n,t){this.processResult(t)},t.prototype.onCancelClick=function(){$.isFunction(this._options.cancelCallback)&&this._options.cancelCallback();this.close()},t.prototype.onButtonStatusChange=function(n,t){var i=this.getElement().siblings(".ui-dialog-buttonpane").find("#"+(t.button||"ok"));i.button("option","disabled",t.enabled?"":"disabled");this.setAttribute("aria-disabled",t.enabled?"false":"true",i)},t.enhancementTypeName="tfs.modaldialog",t.EVENT_BUTTON_STATUS_CHANGE="buttonStatusChange",t}(k);t.ModalDialogO=d;g=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(d);t.ModalDialog=g;nt=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,$.extend({width:400,height:200,resizable:!1,cssClass:"confirmation-dialog"},t))},t.prototype.initialize=function(){n.prototype.initialize.call(this);this.$errorContainer=$(it("div")).addClass("confirmation-dialog-error").prependTo(this.getElement()).hide();this.updateOkButton(!0)},t.prototype._onSuccess=function(){this._fire("resultReady",!0);var n=this._options.successCallback;$.isFunction(n)&&(n.apply(this,arguments),r.logTracePoint(this.getTypeName()+".callback-complete"))},t.prototype._onError=function(n){this.$errorContainer.text(n.message).show()},t.prototype.onOkClick=function(t){this.updateOkButton(!1);n.prototype.onOkClick.call(this,t)},t}(d);t.ConfirmationDialogO=nt;ft=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(nt);t.ConfirmationDialog=ft;et=function(){function n(n){this.button=n}return n.prototype.toString=function(){return"MessageDialogResult: Button: "+(this.button?this.button.id:"?")+" ("+v.ErrorHandler.ignoreRejectedPromiseTag+")"},n}();tt=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.initializeOptions=function(t){var u=this,i=$.extend({width:500,height:"auto",hideCloseButton:!0,coreCssClass:"dialog modal-dialog message-dialog",modal:!0,dynamicSize:!1},t),r;i.buttons instanceof Array&&i.buttons.length>0&&(r={},i.buttons.forEach(function(n){r[n.id]=u.getButtonOptions(n)}),t.noDefaultButton||(i.defaultButton=i.buttons[0].id),this.setDialogResult(i.buttons[i.buttons.length-1]),i.buttons=r);t.escapeButton&&this.setDialogResult(t.escapeButton);n.prototype.initializeOptions.call(this,i)},t.prototype.initialize=function(){var i,t;n.prototype.initialize.call(this);this._options.requiredTypedConfirmation&&this.initializeTypedConfirmation();for(i in this._options.buttons)t=this._options.buttons[i],t.style&&$("#"+t.id).addClass(t.style)},t.prototype.initializeTypedConfirmation=function(){var u=this,f=this.getElement(),n=$("<input type='text' class='textbox message-dialog-confirm-textbox no-match' />"),t=$(),i,r;for(i in this._options.buttons)this._options.buttons[i].reject||(t=t.add($("#"+this._options.buttons[i].id)));r=function(){l.ignoreCaseComparer(n.val(),u._options.requiredTypedConfirmation)==0?(n.removeClass("no-match").addClass("match"),t.button("option","disabled","")):(n.addClass("no-match").removeClass("match"),t.button("option","disabled","disabled"))};n.bind("input keyup",r);f.append($("<div class='message-dialog-confirm'><\/div>").append(n));r(null);c.delay(this,100,function(){n.focus();n.select()})},t.prototype.getPromise=function(){return this._deferred||(this._deferred=y.defer()),this._deferred.promise},t.showMessageDialog=function(n,t){var i,r;return t=t||{},i=$.extend({buttons:[b.buttons.ok,b.buttons.cancel],useBowtieStyle:!0,minWidth:t.width,minHeight:t.height,title:s.Confirm},t),i.content=typeof n=="string"?$("<div />").text(n):n,r=st(b,i),r.getPromise()},t.prototype.onClose=function(t){if(this._deferred){var i=new et(this.getDialogResult());this._options.beforeClose&&this._options.beforeClose(i.button);i.button.reject?this._deferred.reject(i):this._deferred.resolve(i)}return n.prototype.onClose.call(this,t)},t.prototype.getButtonOptions=function(n){var t=this;return $.extend({click:function(){t.setDialogResult(n);t.close()}},n)},t.buttons={ok:{id:"ok",text:s.ModalDialogOkButton,reject:!1},cancel:{id:"cancel",text:s.ModalDialogCancelButton,reject:!0},yes:{id:"yes",text:s.ModalDialogYesButton,reject:!1},no:{id:"no",text:s.ModalDialogNoButton,reject:!0},close:{id:"close",text:s.CloseButtonLabelText,reject:!0}},t}(k);t.MessageDialogO=tt;b=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(tt);t.MessageDialog=b;ot=function(n){function t(t){return n.call(this,t)||this}return __extends(t,n),t.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,$.extend({width:t.width||600,minWidth:400,height:t.height||450,minHeight:200,attachResize:!0,defaultButton:"close",buttons:[{id:"close",text:s.CloseButtonLabelText,click:p(this,this.close)}]},t))},t.prototype.initialize=function(){n.prototype.initialize.call(this);this.setTitle(s.CopyContentDialogTitle);this._decorate()},t.prototype._decorate=function(){var r=this.getElement(),n,i=$("<div>").text(this._options.dialogLabel||this._getDefaultLabelText()),t;this._options.dialogLabelExtend&&i.append(this._options.dialogLabelExtend);t=$("<div class='copy-dialog-container'>").append(i).append($("<p>"));this._options.excludeTextPanel||(n=$("<div>"),t.append(n),this._options.copyAsHtml?this._initializeRichEditor(n):(this._initializeTextPanel(n),c.delay(this,100,function(){this._$textArea.focus();this._$textArea.select()})),this._bind("dialogresize",function(){n.css("height",t.height()-i.height()-40+"px")}));r.append(t);this._options.excludeTextPanel||n.css("height",t.height()-i.height()-40+"px")},t.prototype._getDefaultLabelText=function(){return a.BrowserCheckUtils.isMacintosh()?s.CopyContentMacintoshHelpText:s.CopyContentPcHelpText},t.prototype._initializeRichEditor=function(n){var t=this;v.using(["VSS/Controls/RichEditor"],function(r){var u=i.BaseControl.createIn(r.RichEditor,n,{noToolbar:!0,height:"100%",pageHtml:t._options.pageHtml,internal:!0});u.ready(function(){u.setValue(t._options.data);u.bindOnCopy(p(t,function(){c.delay(this,0,function(){this.close()})}));c.delay(t,100,function(){u.selectText();u.setEnabled(!1)})})})},t.prototype._initializeTextPanel=function(n){var t="copy-content-textarea";this._options.textAreaCopyClass&&(t=this._options.textAreaCopyClass);this._$textArea=$("<textarea/>").addClass(t).text(this._options.data);this._options.disableEdit&&this._$textArea.attr("disabled","disabled");this._$textArea[0].oncopy=p(this,function(){c.delay(this,0,function(){this.close()})});n.append(this._$textArea)},t.enhancementTypeName="CopyContentDialog",t}(d);t.CopyContentDialog=ot;t.show=st;t.showMessageDialog=ht});
var __assign=this&&this.__assign||Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n};define("Presentation/Scripts/TFS/TFS.Discussion.Common",["require","exports","VSS/VSS"],function(n,t,i){var r,u,f,e,o,s,h;Object.defineProperty(t,"__esModule",{value:!0}),function(n){n.LeftBuffer="LeftBuffer";n.RightBuffer="RightBuffer";n.InLineBuffer="InLineBuffer"}(r=t.PositionContext||(t.PositionContext={}));u=function(){function n(){}return n}();t.DiscussionPosition=u;f=function(){function n(){}return n}();t.DiscussionPositionContext=f;e=function(){function n(){}return n}();t.DiscussionComment=e;o=function(){function n(){}return n.hasNewContent=function(n){return n&&n.isDirty&&!!n.newContent&&$.trim(n.newContent).length!==0},n}();t.DiscussionCommentUtils=o;s=function(){function n(){}return n}();t.DiscussionThread=s;h=function(){function n(){}return n.getBaseIterationForNav=function(n){return n.firstComparingIteration&&n.firstComparingIteration!==n.secondComparingIteration?n.firstComparingIteration:null},n.getThreadUpdateNumber=function(n){if(!n||!n.secondComparingIteration||!n.firstComparingIteration||n.isDeleted)return-1;if(!n.position)return n.secondComparingIteration;var t=n.position.positionContext===r.InLineBuffer||n.position.positionContext===r.RightBuffer;return t?n.secondComparingIteration:n.firstComparingIteration},n.updateThreadPositionInContext=function(t,i,r){var o=!t||i<0||r<0,s=!t.itemPath||!t.position,f,u;if(!o&&!s){var e=n.getCacheKeyWithIterationContext(i,r),h=n.getCacheKeyWithIterationContext(t.secondComparingIteration,t.firstComparingIteration),c=Boolean(t.contextCache)&&Boolean(t.contextCache[e]);c&&(f=t.contextCache[h],u=t.contextCache[e],u||f)&&(t.position=u&&u.position||f&&f.position,t.itemPath=u&&u.filePath||f&&f.filePath,t.trackingCriteria=u&&u.trackingCriteria||null)}},n.populateTrackingCaches=function(t,i){if(t.position&&t.secondComparingIteration&&t.firstComparingIteration){t.contextCache=i&&i.contextCache||t.contextCache||{};var u=t.originalPosition||!t.trackingCriteria&&t.position||null,s=t.trackingCriteria&&t.trackingCriteria.origFilePath||t.itemPath,f=t.trackingCriteria&&t.position||null,h=t.itemPath;if(u){var e=t.secondComparingIteration,o=t.firstComparingIteration,r=n.getCacheKeyWithIterationContext(e,o);t.contextCache[r]=t.contextCache[r]||{position:u,filePath:s,trackingCriteria:null}}if(f){var e=t.trackingCriteria.secondComparingIteration,o=t.trackingCriteria.firstComparingIteration,r=n.getCacheKeyWithIterationContext(e,o);t.contextCache[r]=t.contextCache[r]||{position:f,filePath:h,trackingCriteria:t.trackingCriteria}}}},n.isThreadGroupLeader=function(n,t){return n?!t||!t.length?!0:!t.some(function(t){return(t.publishedDate||t.createdDate)>(n.publishedDate||n.createdDate)}):!1},n.getThreadGroupKey=function(n){if(!n||!n.itemPath||!n.position||!n.position.endLine)return null;var t=n.position.positionContext===r.InLineBuffer||n.position.positionContext===r.RightBuffer?r.RightBuffer:r.LeftBuffer;return t+("|"+n.itemPath+"|"+n.position.endLine)},n.getThreadPositionsAreEqual=function(n,t){return(!n||!n.position)&&(!t||!t.position)?!0:n.position.positionContext===t.position.positionContext&&n.position.startLine===t.position.startLine&&n.position.startColumn===t.position.startColumn&&n.position.endLine===t.position.endLine&&n.position.endColumn===t.position.endColumn},n.getCacheKeyWithIterationContext=function(n,t){return t=n===t?0:t,n+"|"+t},n.sortThreadsByDate=function(n,t){return(t.publishedDate||t.createdDate).getTime()-(n.publishedDate||n.createdDate).getTime()},n.sortThreadsById=function(n,t){return n.id-t.id},n.copyWithEUIIRedacted=function(n){return __assign({},n,{comments:n.comments.map(function(n){return __assign({},n,{author:undefined})})})},n}();t.DiscussionThreadUtils=h;i.tfsModuleLoaded("TFS.Discussion.Common",t)});
define("Presentation/Scripts/TFS/TFS.Discussion.Common.UI",["require","exports","jQueryUI/core"],function(n,t){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function n(){this._discussionThreadControlsById={}}return n.prototype.registerThreadControl=function(n){this._discussionThreadControlsById[n.getThread().id]=n},n.prototype.getThreadControl=function(n){return this._discussionThreadControlsById[n]},n.prototype.unregisterThreadControl=function(n){var t=n.getThread().id;delete this._discussionThreadControlsById[t]},n.prototype.clearDiscussionThreads=function(){$.each(this._discussionThreadControlsById,function(n,t){t.dispose()});this._discussionThreadControlsById={}},n}();t.DiscussionThreadControlManagerBase=i});
define("Presentation/Scripts/TFS/TFS.Discussion.OM",["require","exports","Presentation/Scripts/TFS/TFS.Discussion.Common.UI","Presentation/Scripts/TFS/Generated/TFS.Discussion.Constants","VSS/Controls/Menus","VSS/VSS","VSS/Events/Services","VSS/Events/Document","Presentation/Scripts/TFS/TFS.Core.Utils"],function(n,t,i,r,u,f,e,o,s){var l,h,c;Object.defineProperty(t,"__esModule",{value:!0});l=f.queueRequest;t.DISCUSSION_MANAGER_AREA="DiscussionManager";h=function(){function n(n,t,i,r,f){this._tfsContext=n;this._artifactUri=i;this._viewOptions=r||{};this._saveActive=!1;this._discussionAdapter=t;this.init(f);u.menuManager.attachExecuteCommand(this._executeCommand);this._documentsEntryForDirtyCheck=o.getRunningDocumentsTable().add("DiscussionManager",this)}return n.prototype._executeCommand=function(n,t){var i,r;switch(t.get_commandName()){case"add-file-discussion":return i=t.get_commandArgument(),r=i.discussionManager,r.createNewDiscussionThread(i.itemPath),!1}},n.prototype.dispose=function(){u.menuManager.detachExecuteCommand(this._executeCommand);this._discussionAdapter&&(this._discussionAdapter.dispose(),this._discussionAdapter=null);this._documentsEntryForDirtyCheck&&(o.getRunningDocumentsTable().remove(this._documentsEntryForDirtyCheck),this._documentsEntryForDirtyCheck=null)},n.prototype.init=function(){},n.prototype.getTfsContext=function(){return this._tfsContext},n.prototype.isDirty=function(){return this._discussionAdapter&&this._discussionAdapter.isDirty()},n.prototype.getArtifactUri=function(){return this._artifactUri},n.prototype._setArtifactUri=function(n){this._artifactUri=n},n.prototype.beginLoadDiscussionThreads=function(n){$.isFunction(n)&&n.call(this,this.getCurrentThreads())},n.prototype.getAllThreads=function(){return this._discussionAdapter?this._discussionAdapter.getDiscussionThreads():[]},n.prototype.getCurrentThreads=function(){return this._viewOptions.hideComments?[]:this._viewOptions.hideNonActiveComments?this.getAllThreads().filter(function(n){return n.status===r.DiscussionStatus.Active||n.status===r.DiscussionStatus.Pending}):this.getAllThreads()},n.prototype.getViewOptions=function(){return $.extend({},this._viewOptions)},n.prototype.getExtraProperties=function(){return null},n.prototype.populateExtraMembers=function(){},n.prototype.setViewOptions=function(n){var i=!1,r=!1,t,u;if(n||(n={}),(this._viewOptions.hideComments===!0!=(n.hideComments===!0)||this._viewOptions.hideNonActiveComments===!0!=(n.hideNonActiveComments===!0))&&(i=!0,r=!0,(n.hideComments===!0||n.hideNonActiveComments===!0)&&this._threads&&this._threads.length>0))for(t=[],$.each(this._threads,function(n,i){if(i.comments&&i.comments.length>0){var r=i.comments[i.comments.length-1];r.id<1&&!r.newContent&&(i.comments.splice(i.comments.length-1,1),i.comments.length===0&&t.push(n))}});t.length>0;)u=t.pop(),this._threads.splice(u,1);this._viewOptions=n;i&&this.fireDiscussionThreadsUpdatedEvent({currentThreads:this.getCurrentThreads()});r&&this.fireOptionsUpdatedEvent(n)},n.prototype.toggleHideComments=function(){var n=this.getViewOptions();n.hideComments=!n.hideComments;this.setViewOptions(n)},n.prototype.getCurrentThreadsForItemPath=function(n){return this._filterDiscussionThreads(this.getCurrentThreads(),n)},n.prototype.filterEventData=function(n,t){var i;return i={currentThreads:this._filterDiscussionThreads(n.currentThreads,t),newThreads:this._filterDiscussionThreads(n.newThreads,t),deletedThreads:this._filterDiscussionThreads(n.deletedThreads,t),savedThreads:this._filterDiscussionThreads(n.savedThreads,t),state:n.state},n.newComments&&(i.newComments=n.newComments),n.deletedComments&&(i.deletedComments=n.deletedComments),n.updatedComments&&(i.updatedComments=n.updatedComments),n.savedComments&&(i.savedComments=n.savedComments),i.createdByUser=n.createdByUser,n.threadSelected&&((!t||n.threadSelected.itemPath!==t)&&(t||n.threadSelected.itemPath)||(i.threadSelected=n.threadSelected,n.navigateToSelectedThread&&(i.navigateToSelectedThread=!0))),i},n.prototype._filterDiscussionThreads=function(n,t){return n?t?$.grep(n,function(n){return n.itemPath===t}):$.grep(n,function(n){return!n.itemPath}):null},n.prototype.createNewDiscussionThread=function(n,t,i){var h=this,c=this.getAllThreads(),f=$.grep(c,function(i){return i.id<1&&i.artifactUri===h._artifactUri&&i.itemPath===n&&(!i.position&&!t||i.position&&t&&i.position.startLine===t.startLine&&i.position.endLine===t.endLine&&i.position.startColumn===t.startColumn&&i.position.endColumn===t.endColumn&&i.position.positionContext===t.positionContext)})[0],u,e,o;f?this.fireDiscussionThreadsUpdatedEvent({threadSelected:f}):(o=this._discussionAdapter.newThreadId(),u={id:o,artifactUri:this._artifactUri,status:r.DiscussionStatus.Active,itemPath:n,position:t,comments:[],supportsMarkdown:!0,uniqueId:s.GUIDUtils.newGuid()},u.originalId=u.id,e=this._createNewComment(u,0),$.isFunction(i)&&i.call(this,u),this.populateExtraMembers(u),this._discussionAdapter.createThread(u),this.fireDiscussionThreadsUpdatedEvent({newThreads:[u],newComments:[e],createdByUser:!0}))},n.prototype._createNewComment=function(n,t){var u=this._discussionAdapter.newCommentId(),i={id:u,parentId:t,threadId:n.id,author:{id:this._tfsContext.currentIdentity.id,displayName:this._tfsContext.currentIdentity.displayName},commentType:r.CommentType.Text,isDirty:!0,isEditable:!0};return i.originalId=i.id,i.originalThreadId=n.id,n.comments||(n.comments=[]),n.comments.push(i),i},n.prototype.findThread=function(n){var t=this.getAllThreads();return $.grep(t,function(t){return t.id===n})[0]||null},n.prototype.findCommentById=function(n,t){var i=this.findThread(n),r=null;return i&&(r=$.grep(i.comments||[],function(n){return n.id===t})[0]),r},n.prototype.findComment=function(n){var t=this.findThread(n.threadId);return t?$.grep(t.comments||[],function(t){return t.id===n.id})[0]:null},n.prototype.saveComment=function(n){var t=$.extend({},n),i=this.findThread(n.threadId);this._discussionAdapter.saveComment(i,t);return},n.prototype.deleteComment=function(n,t){this._discussionAdapter.deleteComment(n,t)},n.prototype._setThreadsFromServer=function(n){this._threads=n},n.prototype.refresh=function(n){this["_initialized"+this.getArtifactUri()]=null;this.beginLoadDiscussionThreads(n)},n.prototype.addDiscussionThreadsUpdatedListener=function(t){e.getService().attachEvent(n.EVENT_NAME_THREADS_UPDATED,t)},n.prototype.removeDiscussionThreadsUpdatedListener=function(t){e.getService().detachEvent(n.EVENT_NAME_THREADS_UPDATED,t)},n.prototype.fireDiscussionThreadsUpdatedEvent=function(t){e.getService().fire(n.EVENT_NAME_THREADS_UPDATED,this,t)},n.prototype.addDiscussionThreadStatusUpdatedListener=function(t){e.getService().attachEvent(n.EVENT_NAME_THREAD_STATUS_UPDATED,t)},n.prototype.removeDiscussionThreadStatusUpdatedListener=function(t){e.getService().detachEvent(n.EVENT_NAME_THREAD_STATUS_UPDATED,t)},n.prototype.fireDiscussionThreadStatusUpdatedEvent=function(t){e.getService().fire(n.EVENT_NAME_THREAD_STATUS_UPDATED,this,t)},n.prototype.addOptionsUpdatedListener=function(t){e.getService().attachEvent(n.EVENT_NAME_OPTIONS_UPDATED,t)},n.prototype.removeOptionsUpdatedListener=function(t){e.getService().detachEvent(n.EVENT_NAME_OPTIONS_UPDATED,t)},n.prototype.fireOptionsUpdatedEvent=function(t){e.getService().fire(n.EVENT_NAME_OPTIONS_UPDATED,this,t)},n.prototype.supportsWorkItemIntegration=function(){return!1},n.EVENT_NAME_THREADS_UPDATED="threads-updated",n.EVENT_NAME_THREAD_STATUS_UPDATED="thread-status-updated",n.EVENT_NAME_OPTIONS_UPDATED="discussion-options-updated",n._newDiscussionThreadId=-1,n._newCommentId=-1,n}();t.DiscussionManager=h;c=function(n){function t(t){var i=n.call(this)||this;return i._supportCommentStatus=!1,i._tfsContext=t,i}return __extends(t,n),t.prototype.dispose=function(){this._discussionManager&&(this._discussionManager.removeDiscussionThreadsUpdatedListener(this._discussionEventHandler),this._discussionManager=null)},t.prototype.setDiscussionManager=function(n){n!==this._discussionManager&&(this._discussionManager&&this._discussionManager.removeDiscussionThreadsUpdatedListener(this._discussionEventHandler),this._discussionManager=n,n&&n.addDiscussionThreadsUpdatedListener(this._discussionEventHandler))},t}(i.DiscussionThreadControlManagerBase);t.DiscussionThreadControlManager=c;f.tfsModuleLoaded("TFS.Discussion.OM",t)});
define("Presentation/Scripts/TFS/TFS.Extensions",["require","exports","VSS/VSS","VSS/Context","Presentation/Scripts/TFS/TFS.Host.TfsContext","VSS/Utils/Core","VSS/Diag","VSS/Utils/Html","VSS/Resources/VSS.Resources.Platform","VSS/Controls","VSS/Controls/Notifications","VSS/Controls/StatusIndicator","VSS/SDK/XDM"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){var y,p,v,w,b;Object.defineProperty(t,"__esModule",{value:!0}),function(n){n[n.Unknown=0]="Unknown";n[n.Post=1]="Post";n[n.Navigate=2]="Navigate"}(y=t.WebAccessExtensionFrameLoadBehavior||(t.WebAccessExtensionFrameLoadBehavior={})),function(n){n[n.None=0]="None";n[n.Smart=1]="Smart"}(p=t.WebAccessExtensionFrameHandshakeBehavior||(t.WebAccessExtensionFrameHandshakeBehavior={}));v=function(n){function t(t){var i=n.call(this,t)||this;return i._queuedMessages=[],i._messageListeners=[],i}return __extends(t,n),t.prototype.getIFrame=function(){return this._$iframe},t.prototype.getWindow=function(){return this._$iframe[0].contentWindow},t.prototype.getIntegrationUrl=function(){return this._integration.url},t.prototype.getXdmChannel=function(){return this.ensureXdmChannelIntialized(),this._xdmChannel},t.prototype.ensureXdmChannelIntialized=function(){this._xdmChannel||(this._xdmChannel=a.channelManager.addChannel(this.getWindow(),this._integration.url))},t.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,$.extend({integration:null,postData:null,messageListener:null,coreCssClass:"extension-host-control"},t,{errorOptions:$.extend({showSlowLoadWarningMessage:!0,slowLoadWarningDuration:2e4,showLoadFailedMessage:!0,formatErrorMessage:null},t&&t.errorOptions)}))},t.prototype.initialize=function(){var n=this,i,u,o;this._integration=this._options.integration;this._$container=$("<div />").addClass("extension-host-container").appendTo(this._element);this._iframeId="extensionHost"+h.getId();this._integration.loadBehavior===y.Post&&(u=r._getDefaultRawPageContext(),o=u?u.webContext:null,i=$("<form />").attr("method","post").attr("target",this._iframeId).attr("action",this._integration.url).appendTo(this._$container),$("<input />").attr("type","hidden").attr("name","requestJson").attr("value",JSON.stringify($.extend({},this._options.postData,o))).appendTo(i));this._$iframe=$("<iframe frameborder='0' />").addClass("extension-iframe").attr("id",this._iframeId).attr("name",this._iframeId).appendTo(this._$container);this._integration.handshake===p.Smart&&(this._$iframe.addClass("loading"),this._$statusContainer=$("<div />").addClass("status-container").appendTo(this._$container),this._statusControl=h.BaseControl.createIn(l.StatusIndicator,this._$statusContainer,{center:!0,imageClass:"big-status-progress",message:s.ExternalControlLoading}),this._statusControl.start(),$(window).bind("message."+this._iframeId,f.delegate(this,this._handleMessageReceived)),$.isFunction(this._options.messageListener)&&this.addMessageListener(this._options.messageListener),this._$iframe.load(function(){n.cancelDelayedFunction("slowLoadTimeout");n._receivedLoadedEvent||n._loadFailed||n.delayExecute("waitForLoadedEvent",t.MAX_WAIT_FOR_LOADED_EVENT,!0,function(){n._receivedLoadedEvent||n._disposed||n._loadFailed||n._handleLoadError(null)})}),this.delayExecute("slowLoadTimeout",this._options.errorOptions.slowLoadWarningDuration,!0,function(){n._disposed||n._loadFailed||(n._options.errorOptions.showSlowLoadWarningMessage&&n._showExtensionMessage(c.MessageAreaType.Warning,s.ExtensionSlowLoadWarningHeader,s.ExtensionSlowLoadWarningBody,!1,!1),n._fire(t.Events.SLOW_LOAD_WARNING,[n]))}));this._integration.loadBehavior===y.Post?i[0].submit():this._$iframe.attr("src",this._integration.url);this._options.initializeXdmChannel&&this.getXdmChannel()},t.prototype.setConfiguration=function(n){this._configuration=n;this._receivedReadyEvent&&this.postMessage(t.Actions.SET_CONFIGURATION,n)},t.prototype.postMessage=function(n,t,i){var r={actionId:n||"",actionData:t||{},requestId:i};this._receivedReadyEvent?this._sendMessage(r):this._queuedMessages.push(r)},t.prototype.postXdmMessage=function(n,t,i,r){var u,e,f=n.lastIndexOf(".");f>0&&(u=n.substr(0,f),u&&(e=n.substr(f+1)));this.getXdmChannel().invokeRemoteMethod(e,u,t).then(i,r)},t.prototype.addMessageListener=function(n){this._messageListeners.push(n)},t.prototype._dispose=function(){$(window).unbind("message."+this._iframeId);n.prototype._dispose.call(this)},t.prototype._showExtensionMessage=function(n,i,r,u,f){var e=this,l,v,a,y;this._options.errorOptions.showLoadFailedMessage!==!1&&(y=o.HtmlNormalizer.normalize(r||""),l=$("<div />"),v=$("<div />").html(y).appendTo(l),u||(v.find("a").text(this._integration.url).attr("href",this._integration.url).attr("target","blank"),$("<br />").appendTo(l),$("<div />").html(s.ExtensionErrorAdditionalSteps).appendTo(l)),this._options.errorOptions&&$.isFunction(this._options.errorOptions.formatErrorMessage)&&this._options.errorOptions.formatErrorMessage.call(this,l,u));a={type:n,header:i,content:l};this._messageArea?(this._messageArea.setMessage(a),f&&this._messageArea.setErrorDetailsVisibility(!0)):(this._messageArea=h.Enhancement.enhance(c.MessageAreaControl,$("<div />").prependTo(this._element),{closeable:!0,expanded:f,message:a}),this._$container.css("padding-top",this._messageArea._element.height()+20+"px"),this._messageArea._bind(c.MessageAreaControl.EVENT_DISPLAY_COMPLETE,function(){e._$container.css("padding-top",e._messageArea._element.height()+20+"px");e._fire(t.Events.EXTENSION_MESSAGE_RESIZED,[e])}),this._messageArea._bind(c.MessageAreaControl.EVENT_DISPLAY_CLEARED,function(){e._$container.css("padding-top","0");e._messageArea=null;e._fire(t.Events.EXTENSION_MESSAGE_RESIZED,[e])}),this._fire(t.Events.EXTENSION_MESSAGE_RESIZED,[e]))},t.prototype._hideLoadingIndicator=function(){this._$iframe.removeClass("loading");this._statusControl&&(this._statusControl.dispose(),this._$statusContainer.remove(),this._statusControl=null,this._$statusContainer=null)},t.prototype._sendMessage=function(n){this._disposed||this._$iframe[0].contentWindow.postMessage(JSON.stringify(n),"*")},t.prototype._notifyLoadComplete=function(){this._receivedLoadedEvent=!0;this._hideLoadingIndicator()},t.prototype._handleMessageReceived=function(n){var u=this,r=n&&n.originalEvent,e=r&&r.origin,i;!this._disposed&&r&&r.source===this._$iframe[0].contentWindow&&e&&(u._integration.url.toLowerCase().indexOf(e.toLowerCase())===0||e.toLowerCase().indexOf((window.location.protocol+"//"+window.location.host).toLowerCase())===0)&&(i=f.parseMSJSON(r.data,!1)||{},this._receivedLoadedEvent||i.actionId!==t.Actions.EXTENSION_LOADED?this._receivedReadyEvent||i.actionId!==t.Actions.EXTENSION_READY?i.actionId===t.Actions.EXTENSION_LOAD_ERROR&&this._handleLoadError(i.actionData&&i.actionData.errorMessage):(this._receivedReadyEvent=!0,this._configuration&&this.postMessage(t.Actions.SET_CONFIGURATION,this._configuration),$.each(this._queuedMessages,function(n,t){u._sendMessage(t)})):this._notifyLoadComplete(),$.each(this._messageListeners,function(n,t){t.call(u,i)}))},t.prototype._handleLoadError=function(n){var i=!1,r;this._loadFailed=!0;this._hideLoadingIndicator();$.isFunction(this._options.errorOptions.getFallbackControl)&&(r=this._options.errorOptions.getFallbackControl.call(this),i=r!==null&&r.length,i&&(r.appendTo($("<div />").addClass("fallback-control").appendTo(this._$container)),this._$iframe.hide()));this._options.errorOptions.showLoadFailedMessage!==!1&&this._showExtensionMessage(i?c.MessageAreaType.Warning:c.MessageAreaType.Error,s.ExtensionErrorHeader,n||s.ExtensionErrorBody,n?!0:!1,!i);this._fire(t.Events.EXTENSION_LOAD_FAILED,[this])},t.Actions={SET_CONFIGURATION:"set-configuration",EXTENSION_LOADED:"extension-loaded",EXTENSION_READY:"extension-ready",EXTENSION_LOAD_ERROR:"extension-load-error"},t.Events={EXTENSION_LOAD_FAILED:"extension-host-load-failed",SLOW_LOAD_WARNING:"extension-host-slow-load-warning",EXTENSION_MESSAGE_RESIZED:"extension-message-resized"},t.MAX_WAIT_FOR_LOADED_EVENT=3e3,t}(h.BaseControl);t.ExtensionHost=v;i.classExtend(v,u.TfsContext.ControlExtensions);w=function(n){function t(t){return n.call(this,t)||this}return __extends(t,n),t.prototype.getInstanceKey=function(){var n;return this.instanceKey||(n=this.getIntegrationUrl()||"",n.charAt(n.length-1)==="/"&&(n=n.substr(0,n.length-1)),this.instanceKey=n),this.instanceKey},t.prototype.initialize=function(){n.prototype.initialize.call(this);this.loadedDeferred=$.Deferred();this._options.integration.handshake===p.Smart&&(this.ensureXdmChannelIntialized(),a.globalObjectRegistry.register("VSS.Part["+this.getInstanceKey()+"]",this))},t.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,$.extend({cssClass:"external-part"},t))},t.prototype.resize=function(n,t){this.getIFrame().width(n).height(t)},t.prototype.initialHandshake=function(n,t){n&&this.notifyLoaded();t&&t.call(this,r._getDefaultRawPageContext())},t.prototype.notifyLoaded=function(){this._notifyLoadComplete();this.loadedDeferred.resolve()},t.prototype.notifyLoadFailed=function(n){this._handleLoadError(n?n.message||n:null);this.loadedDeferred.fail(n)},t.prototype.loadingPromise=function(){return this.loadedDeferred.promise()},t}(v);t.ExternalPart=w;b=function(n){function t(t){var i=n.call(this,t)||this;return i._loaded=!1,i._part=t.part,i}return __extends(t,n),t.prototype.getIFrame=function(){return this._part.getIFrame()},t.prototype.getUrl=function(){return this._part.getIntegrationUrl()},t.prototype.initialize=function(){this.setupProgress();this.setupLoadEvent()},t.prototype.setupProgress=function(){var n=this;this.delayExecute("waitForProgress",t.PROGRESS_DURATION,!0,function(){n.getIFrame().addClass("loading");n._$statusElement=$("<div />").addClass("status-container").appendTo(n._element);n._statusIndicator=h.BaseControl.createIn(l.StatusIndicator,n._$statusElement,{center:!0,imageClass:"big-status-progress",message:s.ExternalControlLoading});n._statusIndicator.start()})},t.prototype.hideProgress=function(){this.getIFrame().removeClass("loading");this._statusIndicator&&(this._statusIndicator.dispose(),this._$statusElement.remove(),this._statusIndicator=null,this._$statusElement=null)},t.prototype.setupLoadEvent=function(){var n=this;this._part._bind(this.getIFrame(),"load",function(){n._loaded||n.delayExecute("waitForLoadedEvent",v.MAX_WAIT_FOR_LOADED_EVENT,!0,function(){n._loaded||(n._loaded=!0,n.hideProgress(),n.showErrorMessage())})})},t.prototype.showErrorMessage=function(){var t=this,n,i,r,u=this.getUrl();n=$("<div />");i=$("<div />").html(s.ExtensionErrorBody).appendTo(n);i.find("a").text(u).attr("href",u).attr("target","blank");$("<br />").appendTo(n);$("<div />").html(s.ExtensionErrorAdditionalSteps).appendTo(n);r={type:c.MessageAreaType.Error,header:s.ExtensionErrorHeader,content:n};this._messageAreaControl=h.Enhancement.enhance(c.MessageAreaControl,$("<div />").prependTo(this._element),{closeable:!0,expanded:!0,message:r});this._element.css("padding-top",this._messageAreaControl._element.height()+20+"px");this._messageAreaControl._bind(c.MessageAreaControl.EVENT_DISPLAY_COMPLETE,function(){t._element.css("padding-top",t._messageAreaControl._element.height()+20+"px")});this._messageAreaControl._bind(c.MessageAreaControl.EVENT_DISPLAY_CLEARED,function(){t._element.css("padding-top","0");t._messageAreaControl=null})},t.prototype.hideErrorMessage=function(){this._messageAreaControl&&(this._messageAreaControl.clear(),this._messageAreaControl.dispose())},t.prototype.loaded=function(){this._loaded=!0;this.cancelDelayedFunction("waitForProgress");this.cancelDelayedFunction("waitForLoadedEvent");this.hideProgress();this.hideErrorMessage()},t.PROGRESS_DURATION=1e3,t}(h.BaseControl);i.tfsModuleLoaded("TFS.Extensions",t)});
define("VersionControl/Scripts/TFS.VersionControl.Telemetry",["require","exports","VSS/VSS","VSS/Telemetry/Services"],function(n,t,i,r){Object.defineProperty(t,"__esModule",{value:!0});var u;(function(n){function t(n){window.location.href=n}function i(t,i,u){return function(){if(u.targetUrl=$(this).attr("href"),u.originalHref=$(this).attr("data-original-href"),u.sourceUrl=window.location.href,r.publishEvent(new r.TelemetryEventData(t,i,u)),$(this).attr("target"))return!0;var f=$(this).attr("href");return setTimeout(function(){n.setWindowHref(f)},300),!1}}n.setWindowHref=t;n.create=i})(u=t.linkClickHandlerFactory||(t.linkClickHandlerFactory={}));i.tfsModuleLoaded("TFS.VersionControl.Telemetry",t)});
define("OfficeFabric/components/Checkbox/Checkbox.classNames",["require","exports","../../Utilities","../../Styling"],function(n,t,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.getClassNames=i.memoizeFunction(function(n,t,i,u,f){return{root:r.mergeStyles("ms-Checkbox",f&&"reversed",u&&"is-checked",!i&&"is-enabled",i&&"is-disabled",t,n.root,!i&&[!u&&{selectors:{":hover .ms-Checkbox-checkbox":n.checkboxHovered,":focus .ms-Checkbox-checkbox":n.checkboxFocused}},u&&{selectors:{":hover .ms-Checkbox-checkbox":n.checkboxCheckedHovered,":focus .ms-Checkbox-checkbox":n.checkboxCheckedFocused}},{selectors:{":hover .ms-Checkbox-text":n.textHovered,":focus .ms-Checkbox-text":n.textFocused}}]),label:r.mergeStyles("ms-Checkbox-label",n.label,f&&n.labelReversed,i&&n.labelDisabled),checkbox:r.mergeStyles("ms-Checkbox-checkbox",n.checkbox,!i&&u&&n.checkboxChecked,i&&!u&&n.checkboxDisabled,i&&u&&n.checkboxCheckedDisabled),checkmark:r.mergeStyles(n.checkmark,!i&&u&&n.checkmarkChecked,i&&!u&&n.checkmarkDisabled,i&&u&&n.checkmarkCheckedDisabled),text:r.mergeStyles("ms-Checkbox-text",n.text,i&&n.textDisabled)}})});
define("OfficeFabric/components/Checkbox/Checkbox.styles",["require","exports","../../Styling","../../Utilities"],function(n,t,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u="20px",f="200ms",e="cubic-bezier(.4, 0, .23, 1)";t.getStyles=r.memoizeFunction(function(n,t){var r=n.semanticColors,o=n.palette,v=r.inputForegroundChecked,y=r.disabledBackground,p=r.inputBorderHovered,w=r.inputBackgroundChecked,s=r.disabledText,h=r.inputBorderHovered,b=r.inputBackgroundChecked,c=r.inputBackgroundCheckedHovered,l=r.inputBackgroundCheckedHovered,a=r.disabledText,k=r.bodyText,d=r.disabledText,g={root:[i.getFocusStyle(n,-2),{padding:"0",border:"none",background:"none",margin:"0",outline:"none",display:"block",cursor:"pointer"}],label:{display:"inline-flex",margin:"0 -4px",alignItems:"center",cursor:"pointer",position:"relative",userSelect:"none",textAlign:"left"},labelReversed:{flexDirection:"row-reverse",justifyContent:"flex-end"},labelDisabled:{cursor:"default"},checkbox:{display:"flex",flexShrink:0,alignItems:"center",justifyContent:"center",height:u,width:u,borderWidth:"1px",borderStyle:"solid",borderColor:p,margin:"0 4px",boxSizing:"border-box",transitionProperty:"background, border, border-color",transitionDuration:f,transitionTimingFunction:e,overflow:"hidden"},checkboxHovered:{borderColor:h},checkboxFocused:{borderColor:h},checkboxChecked:{background:b,borderColor:w},checkboxCheckedHovered:{background:c,borderColor:l},checkboxCheckedFocused:{background:c,borderColor:l},checkboxDisabled:{background:a,borderColor:s},checkboxCheckedDisabled:{background:a,borderColor:s},checkmark:{opacity:"0",color:v},checkmarkChecked:{opacity:"1"},checkmarkDisabled:{},checkmarkCheckedDisabled:{opacity:"1",color:y},text:{color:k,margin:"0 4px",fontSize:i.FontSizes.medium},textHovered:{color:o.black},textFocused:{color:o.black},textDisabled:{color:d}};return i.concatStyleSets(g,t)})});
define("OfficeFabric/components/Checkbox/Checkbox",["require","exports","tslib","react","../../Utilities","../../Icon","../../Utilities","./Checkbox.classNames","./Checkbox.styles"],function(n,t,i,r,u,f,e,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=function(n){function t(t,i){var r=n.call(this,t,i)||this;return r._warnMutuallyExclusive({checked:"defaultChecked"}),r._id=u.getId("checkbox-"),r.state={isChecked:!!(t.checked!==undefined?t.checked:t.defaultChecked)},r}return i.__extends(t,n),t.prototype.componentWillReceiveProps=function(n){n.checked!==undefined&&this.setState({isChecked:!!n.checked})},t.prototype.render=function(){var n=this.props,t=n.checked,l=n.className,e=n.defaultChecked,u=n.disabled,a=n.inputProps,v=n.name,y=n.boxSide,p=n.theme,w=n.ariaLabel,b=n.ariaLabelledBy,k=n.ariaDescribedBy,d=n.styles,h=n.onRenderLabel,g=h===void 0?this._onRenderLabel:h,nt=n.checkmarkIconProps,c=t===undefined?this.state.isChecked:t,tt=y!=="start"?!0:!1;return this._classNames=o.getClassNames(s.getStyles(p,d),l,u,c,tt),r.createElement("button",i.__assign({},a,t!==undefined&&{checked:t},e!==undefined&&{defaultChecked:e},{disabled:u,ref:this._resolveRef("_checkBox"),name:v,id:this._id,role:"checkbox",type:"button",className:this._classNames.root,onClick:this._onClick,onFocus:this._onFocus,onBlur:this._onBlur,"aria-checked":c,"aria-disabled":u,"aria-label":w,"aria-labelledby":b,"aria-describedby":k}),r.createElement("label",{className:this._classNames.label,htmlFor:this._id},r.createElement("div",{className:this._classNames.checkbox},r.createElement(f.Icon,i.__assign({iconName:"CheckMark"},nt,{className:this._classNames.checkmark}))),g(this.props,this._onRenderLabel)))},Object.defineProperty(t.prototype,"checked",{get:function(){return this.state.isChecked},enumerable:!0,configurable:!0}),t.prototype.focus=function(){this._checkBox&&this._checkBox.focus()},t.prototype._onFocus=function(n){var t=this.props.inputProps;if(t&&t.onFocus)t.onFocus(n)},t.prototype._onBlur=function(n){var t=this.props.inputProps;if(t&&t.onBlur)t.onBlur(n)},t.prototype._onClick=function(n){var t=this.props,u=t.disabled,i=t.onChange,r=this.state.isChecked;n.preventDefault();n.stopPropagation();u||(i&&i(n,!r),this.props.checked===undefined&&this.setState({isChecked:!r}))},t.prototype._onRenderLabel=function(n){var t=n.label;return t?r.createElement("span",{className:this._classNames.text},t):null},t.defaultProps={boxSide:"start"},i.__decorate([u.autobind],t.prototype,"_onFocus",null),i.__decorate([u.autobind],t.prototype,"_onBlur",null),i.__decorate([u.autobind],t.prototype,"_onClick",null),i.__decorate([u.autobind],t.prototype,"_onRenderLabel",null),i.__decorate([e.customizable("Checkbox",["theme"])],t)}(u.BaseComponent);t.Checkbox=h});
define("OfficeFabric/components/Checkbox/index",["require","exports","tslib","./Checkbox"],function(n,t,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});i.__exportStar(r,t)});
define("OfficeFabric/Checkbox",["require","exports","tslib","./components/Checkbox/index"],function(n,t,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});i.__exportStar(r,t)});
// Copyright (C) Microsoft Corporation. All rights reserved.
var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__assign=this&&this.__assign||Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__decorate=this&&this.__decorate||function(n,t,i,r){var f=arguments.length,u=f<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r,e,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(n,t,i,r);else for(o=n.length-1;o>=0;o--)(e=n[o])&&(u=(f<3?e(u):f>3?e(t,i,u):e(t,i))||u);return f>3&&u&&Object.defineProperty(t,i,u),u};define("VersionControl/Scenarios/EditorPreferences/EditorPreferencesDialog",["require","exports","react","react-dom","OfficeFabric/Button","OfficeFabric/Checkbox","OfficeFabric/Dialog","OfficeFabric/Utilities","VersionControl/Scripts/Resources/TFS.Resources.VersionControl"],function(n,t,i,r,u,f,e,o,s){var h,c;Object.defineProperty(t,"__esModule",{value:!0}),function(n){function u(n){t=document.createElement("div");document.body.appendChild(t);r.render(i.createElement(c,__assign({},n)),t)}function f(){t&&(r.unmountComponentAtNode(t),t.parentElement.removeChild(t),t=null)}var t=null;n.show=u;n.close=f}(h=t.EditorPreferencesDialog||(t.EditorPreferencesDialog={}));c=function(n){function t(t){var i=n.call(this,t)||this;return i.state=__assign({},t.editorUserPreferences),i}return __extends(t,n),t.prototype.render=function(){var n=!o.shallowCompare(this.props.editorUserPreferences,this.state);return i.createElement(e.Dialog,{hidden:!1,dialogContentProps:{type:e.DialogType.close},onDismiss:h.close,closeButtonAriaLabel:s.DialogClose,title:s.EditorPreferencesDialogTitle,modalProps:{containerClassName:"vc-editor-preferences-dialog",isBlocking:!0}},i.createElement(f.Checkbox,{label:s.EditorPreferencesDialogWhiteSpace,onChange:this.onWhiteSpaceChanged,checked:this.state.whiteSpaceEnabled}),i.createElement(f.Checkbox,{label:s.EditorPreferencesDialogWordWrap,onChange:this.onWordWrapChanged,checked:this.state.wordWrapEnabled}),i.createElement(f.Checkbox,{label:s.EditorPreferencesDialogFolding,onChange:this.onFoldingChanged,checked:this.state.foldingEnabled}),i.createElement(f.Checkbox,{label:s.EditorPreferencesDialogMinimap,onChange:this.onMinimapChanged,checked:this.state.minimapEnabled}),i.createElement(e.DialogFooter,null,i.createElement(u.PrimaryButton,{ariaLabel:s.ModalDialogSaveButton,disabled:!n,onClick:this.onSaveClicked},s.ModalDialogSaveButton),i.createElement(u.DefaultButton,{ariaLabel:s.ModalDialogCancelButton,onClick:this.onCancelClick},s.ModalDialogCancelButton)))},t.prototype.onWhiteSpaceChanged=function(n,t){this.setState({whiteSpaceEnabled:t})},t.prototype.onWordWrapChanged=function(n,t){this.setState({wordWrapEnabled:t})},t.prototype.onFoldingChanged=function(n,t){this.setState({foldingEnabled:t})},t.prototype.onMinimapChanged=function(n,t){this.setState({minimapEnabled:t})},t.prototype.onSaveClicked=function(){this.props.onSavePreferences(this.state,this.props.uiSource);h.close()},t.prototype.onCancelClick=function(){this.props.onCancelled&&this.props.onCancelled();h.close()},__decorate([o.autobind],t.prototype,"onWhiteSpaceChanged",null),__decorate([o.autobind],t.prototype,"onWordWrapChanged",null),__decorate([o.autobind],t.prototype,"onFoldingChanged",null),__decorate([o.autobind],t.prototype,"onMinimapChanged",null),__decorate([o.autobind],t.prototype,"onSaveClicked",null),__decorate([o.autobind],t.prototype,"onCancelClick",null),t}(i.Component)});
define("VersionControl/Scenarios/EditorPreferences/EditorPreferences",["require","exports","VSS/Telemetry/Services","VersionControl/Scenarios/EditorPreferences/EditorPreferencesDialog","VersionControl/Scripts/CustomerIntelligenceConstants","VersionControl/Scripts/Resources/TFS.Resources.VersionControl"],function(n,t,i,r,u,f){Object.defineProperty(t,"__esModule",{value:!0});t.EditorPreferencesMenuId="tfs-user-preferences";var e=function(){function n(n){var t=this;this.savePreferences=function(n,i){t.updatePreferences(n,i+"-preferences-dialog");t._onSavedCallback&&(t._onSavedCallback(),t._onSavedCallback=null)};this._repositoryContext=n;this._editorUserPreferences={}}return n.prototype.getPreferences=function(){var n=this;return this._repositoryContext&&this._repositoryContext.getClient().beginGetUserPreferences(function(t){n._editorUserPreferences=t.editorPreferences}),this._editorUserPreferences},n.prototype.updatePreferences=function(n,t){var r=this;t===void 0&&(t="unspecified");this._editorUserPreferences=__assign({},this._editorUserPreferences,n);this._repositoryContext&&this._repositoryContext.getClient().beginGetUserPreferences(function(f){f.editorPreferences=__assign({},f.editorPreferences,n);r._editorUserPreferences=f.editorPreferences;r._repositoryContext.getClient().beginUpdateUserPreferences(f);i.publishEvent(new i.TelemetryEventData(u.VERSION_CONTROL_AREA,u.EDITOR_PREFERENCES_UPDATED,__assign({uiSource:t},r._editorUserPreferences)))})},n.prototype.showDialog=function(n,t){var i=this;t===void 0&&(t="unspecified");this._repositoryContext&&(this._onSavedCallback=n,r.EditorPreferencesDialog.show({editorUserPreferences:this._editorUserPreferences,onSavePreferences:this.savePreferences,onCancelled:function(){i._onSavedCallback=null},uiSource:t}))},n.prototype.setRepository=function(n){this._repositoryContext=n},n.prototype.getContextMenuItem=function(){return{contextMenuGroupId:"99_preferences",enablement:null,id:t.EditorPreferencesMenuId,keybindings:null,label:f.EditorPreferencesMonacoMenuLabel}},n}();t.EditorPreferences=e});
define("VersionControl/Scripts/TFS.VersionControl.EditorExtensions",["require","exports","VSS/FeatureAvailability/Services","VSS/Navigation/Services","Presentation/Scripts/TFS/Generated/TFS.Server.WebAccess.Constants","VSS/Telemetry/Services","Presentation/Scripts/TFS/TFS.Host.TfsContext","VSS/Contributions/Services","VSS/Service","VersionControl/Scripts/Resources/TFS.Resources.VersionControl","q"],function(n,t,i,r,u,f,e,o,s,h,c){var a,l;Object.defineProperty(t,"__esModule",{value:!0});a=function(){function n(){}return n.bindContextMenuItems=function(t){t._unbind(n.EVENT_CONTEXT_MENU_ITEM_CLICKED)._bind(n.EVENT_CONTEXT_MENU_ITEM_CLICKED,function(n,t){l.isSearchContextMenuItemClicked(t)&&l.searchContextMenuItemClickAction(t)})},n.addContextMenuItems=function(t,i){t._bind(n.EDITOR_CREATED,function(t,r){l.getSearchContextMenuItems(i).done(function(t){r.extensionHost.postMessage(n.EDITOR_ADD_CONTEXT_MENU_ITEM,{contextMenuItems:t})})})},n.EVENT_CONTEXT_MENU_ITEM_CLICKED="context-menu-item-clicked",n.EDITOR_ADD_CONTEXT_MENU_ITEM="vc-editor-add-context-menu-item",n.EDITOR_CREATED="vc-extensionhost-created",n}();t.ContextMenuItemExtension=a;l=function(){function n(){}return n.getSearchContextMenuItems=function(t){var e=t.navigation.currentController,r=[],f=c.defer();return s.getService(o.ExtensionService).getContributions([n.SEARCH_CODE_ENTITY_CONTRIBUTION],!0,!1).then(function(t){(i.FeatureAvailabilityService.isFeatureEnabled(u.FeatureAvailabilityFlags.WebAccessSearchShell)||t.length>0)&&(r.push(n._getActionDescriptor(n.CODESEARCH_CONTEXT_MENU_ITEM_ID,h.ContextMenuCodeSearchToTextLabel,"1_codesearch/1_termsearch",null)),r.push(n._getActionDescriptor(n.CODESEARCH_SEARCH_FOR_DEFINITION_CONTEXT_MENU_ITEM_ID,h.ContextMenuCodeSearchToDefinitionLabel,"1_codesearch/2_definitionsearch",["identifier"])),r.push(n._getActionDescriptor(n.CODESEARCH_SEARCH_FOR_REFERENCES_CONTEXT_MENU_ITEM_ID,h.ContextMenuCodeSearchToReferenceLabel,"1_codesearch/3_referencesearch",["identifier"])));f.resolve(r)},function(n){f.reject(n)}),f.promise},n.searchContextMenuItemClickAction=function(t){var f=t.dataForAction.textUnderCursorOrSelection||"",o,i,l,a;if(f=$.trim(f),f!==""){var s=void 0,u=e.TfsContext.getDefault(),v=u.navigation.serviceHost.hostType===e.NavigationContextLevels.Application,h=null,y=u.navigation.currentController,c="?type="+n.CODE_ENTITY_TYPE_NAME;v||!u.navigation.project||u.navigation.project===""?s="/_"+n.CONTROLLER_NAME+c:(o=u.navigation.project,o!==undefined&&o!==null&&(h=n.PROJECT_FILTERS+n.FILTER_VALUE_START+o+n.FILTER_VALUE_END),s=u.getActionUrl("",n.CONTROLLER_NAME)+c);i={};i[n.PROVIDER_ID_PARAMETER_NAME]=n.CODE_ENTITY_TYPE_NAME;i[n.SEARCH_TEXT_PARAMETER_NAME]=n._getSearchText(f,t.contextMenuItemId);i[n.SEARCH_FILTERS_PARAMETER_NAME]=h;i[n.SEARCH_TRIGGERED_FROM_CODEHUB_RIGHTCLICK]=!0;l=r.getHistoryService().getFragmentActionLink(n.ACTION_NAME,i);n._logTelemetryInformation(i[n.SEARCH_TEXT_PARAMETER_NAME],t.contextMenuItemId,y);a=s+l;window.location.href=a}},n.isSearchContextMenuItemClicked=function(t){return t.contextMenuItemId===n.CODESEARCH_CONTEXT_MENU_ITEM_ID||t.contextMenuItemId===n.CODESEARCH_SEARCH_FOR_DEFINITION_CONTEXT_MENU_ITEM_ID||t.contextMenuItemId===n.CODESEARCH_SEARCH_FOR_REFERENCES_CONTEXT_MENU_ITEM_ID},n._getSearchText=function(t,i){var r="";switch(i){case n.CODESEARCH_CONTEXT_MENU_ITEM_ID:r=t;break;case n.CODESEARCH_SEARCH_FOR_DEFINITION_CONTEXT_MENU_ITEM_ID:r="def:".concat(t);break;case n.CODESEARCH_SEARCH_FOR_REFERENCES_CONTEXT_MENU_ITEM_ID:r="ref:".concat(t)}return r},n._logTelemetryInformation=function(t,i,r){var u="";switch(i){case n.CODESEARCH_CONTEXT_MENU_ITEM_ID:u="TermSearchContextMenuItemAction";break;case n.CODESEARCH_SEARCH_FOR_DEFINITION_CONTEXT_MENU_ITEM_ID:u="DefinitionSearchContextMenuItemAction";break;case n.CODESEARCH_SEARCH_FOR_REFERENCES_CONTEXT_MENU_ITEM_ID:u="ReferencesSearchContextMenuItemAction"}f.publishEvent(new f.TelemetryEventData("webaccess.search","CodeSearchPortal",{rightClickSearchText:t,actionName:u,controller:r}))},n._getActionDescriptor=function(n,t,i,r){var u={textFocus:!0,wordAtPosition:!0,tokensAtPosition:r};return{id:n,label:t,contextMenuGroupId:i,enablement:u}},n.CONTROLLER_NAME="search",n.ACTION_NAME="search",n.PROVIDER_ID_PARAMETER_NAME="type",n.SEARCH_TEXT_PARAMETER_NAME="text",n.CODE_ENTITY_TYPE_NAME="Code",n.PROJECT_FILTERS="ProjectFilters",n.FILTER_VALUE_START="{",n.FILTER_VALUE_END="}",n.SEARCH_FILTERS_PARAMETER_NAME="filters",n.SEARCH_TRIGGERED_FROM_CODEHUB_RIGHTCLICK="trigger",n.CODESEARCH_CONTEXT_MENU_ITEM_ID="72802cd9-9396-4276-9059-8c5e227cd8be",n.CODESEARCH_SEARCH_FOR_DEFINITION_CONTEXT_MENU_ITEM_ID="ada3e19f-82ea-47a9-9585-e4ac3088b9e1",n.CODESEARCH_SEARCH_FOR_REFERENCES_CONTEXT_MENU_ITEM_ID="08350060-51be-4155-9297-58633a8200e1",n.SEARCH_CODE_ENTITY_CONTRIBUTION="ms.vss-code-search.code-entity-type",n}()});
define("VersionControl/Scripts/Controls/SourceEditingEvents",["require","exports"],function(n,t){Object.defineProperty(t,"__esModule",{value:!0});var i;(function(n){function h(n){u.push(n)}function c(n,t,i,r){for(var f=0,e=u.length;f<e;f++)u[f](n,t,i,r)}function l(n){t.push(n)}function a(n,i,r,u,f,e){for(var o=0,s=t.length;o<s;o++)t[o](n,i,r,u,f,e)}function v(n){t=t.filter(function(t){return t!==n})}function y(n){f.push(n)}function p(n,t,i,r){for(var u=0,e=f.length;u<e;u++)f[u](n,t,i,r)}function w(n){e.push(n)}function b(n,t,i,r,u){for(var f=0,o=e.length;f<o;f++)e[f](n,t,i,r,u)}function k(n){i.push(n)}function d(n,t,r){for(var u=0,f=i.length;u<f;u++)i[u](n,t,r)}function g(n){i=i.filter(function(t){return t!==n})}function nt(n){r.push(n)}function tt(n,t){for(var i=0,u=r.length;i<u;i++)r[i](n,t)}function it(n){r=r.filter(function(t){return t!==n})}function rt(n){o.push(n)}function ut(n,t,i){for(var r=0,u=o.length;r<u;r++)o[r](n,t,i)}function ft(n){s.push(n)}function et(n,t){for(var i=0,r=s.length;i<r;i++)s[i](n,t)}var u=[],t=[],f=[],e=[],i=[],r=[],o=[],s=[];n.subscribeItemDeletedEvent=h;n._triggerItemDeletedEvent=c;n.subscribeItemEditedEvent=l;n._triggerItemEditedEvent=a;n.unsubscribeItemEditedEvent=v;n.subscribeItemsUploadedEvent=y;n._triggerItemsUploadedEvent=p;n.subscribeItemRenamedEvent=w;n._triggerItemRenamedEvent=b;n.subscribeItemDirtyStateChangedEvent=k;n._triggerItemDirtyStateChangedEvent=d;n.unsubscribeItemDirtyStateChangedEvent=g;n.subscribeRevertEditedItemEvent=nt;n._triggerRevertEditedItemEvent=tt;n.unsubscribeRevertEditedItemEvent=it;n.subscribeEditModeChangedEvent=rt;n._triggerEditModeChangedEvent=ut;n.subscribeRefreshItemEvent=ft;n._triggerRefreshItemEvent=et})(i=t.Events||(t.Events={}))});
define("VersionControl/Scripts/Controls/VersionControlModalDialog",["require","exports","VSS/Controls/Dialogs","VSS/VSS","Presentation/Scripts/TFS/TFS.Host.TfsContext","VersionControl/Scripts/Resources/TFS.Resources.VersionControl"],function(n,t,i,r,u,f){Object.defineProperty(t,"__esModule",{value:!0});var o=u.TfsContext,e=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,$.extend({coreCssClass:"vc-modal-dialog",okText:t&&t.okText||f.ModalDialogCreateButton,resizable:t&&t.resizable||!1,draggable:t&&t.draggable||!1,useBowtieStyle:!0,bowtieVersion:2},t))},t}(i.ModalDialogO);t.VersionControlModalDialog=e;r.classExtend(e,o.ControlExtensions)});
define("VersionControl/Scripts/Controls/SourceEditingDialogs",["require","exports","VSS/Controls","VSS/Controls/Dialogs","VSS/Controls/FileInput","VSS/Telemetry/Services","VSS/Utils/File","VSS/Utils/UI","VSS/Utils/String","TFS/VersionControl/Contracts","VersionControl/Scripts/Generated/TFS.VersionControl.Legacy.Contracts","VersionControl/Scripts/RepositoryContext","VersionControl/Scripts/CustomerIntelligenceConstants","VersionControl/Scripts/GitRefUtility","VersionControl/Scripts/CommitIdHelper","VersionControl/Scripts/VersionControlPath","VersionControl/Scripts/TFS.VersionControl.VersionSpecs","VersionControl/Scripts/Controls/SourceEditing","VersionControl/Scripts/Controls/SourceEditingEvents","VersionControl/Scripts/Controls/VersionControlModalDialog","VersionControl/Scripts/Resources/TFS.Resources.VersionControl","VSS/LoaderPlugins/Css!VersionControlControls"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g){var it;Object.defineProperty(t,"__esModule",{value:!0});var nt=o.domElem,rt=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t._invalidCharacters=["/","\\",":","<",">","*"],t}return __extends(t,n),t.prototype.initialize=function(){n.prototype.initialize.call(this);this._repositoryContext=this._options.repositoryContext;this._itemPath=this._options.itemPath;this._itemVersion=this._options.itemVersion;this._isGitRepository=this._repositoryContext.getRepositoryType()===l.RepositoryType.Git},t.prototype._addCommentBox=function(n,t,r){var u=this,f="comment"+i.getId(),e=$(nt("div","form-section")).appendTo(r);return $(nt("label")).attr("for",f).text(this._isGitRepository?g.CommitComment:g.CheckinComment).appendTo(e),this._$commentInputBox=$(nt("textarea","comment-input")).attr("id",f).val(n||"").appendTo(e).bind("input keyup",function(){u.updateOkButton(u._hasCompleteInputs())}),t&&(this._$commentInputBox.select(),this._$commentInputBox.focus()),this._$commentInputBox},t.prototype._getCommentText=function(){return this._$commentInputBox?$.trim(this._$commentInputBox.val()):""},t.prototype._setCommentText=function(n){this._$commentInputBox&&this._$commentInputBox.val(n)},t.prototype._hasCompleteInputs=function(){return this._$commentInputBox?!!this._getCommentText():!0},t.prototype._handleError=function(n){var t=this._isGitRepository?g.CommitFailedMessageFormat:g.CheckinFailedMessageFormat;alert(s.format(t,n.message));this.updateOkButton(this._hasCompleteInputs())},t.prototype.addFileNameInput=function(n,t){var i=this;return this._$fileNameInput=$(nt("input","file-name-input")).attr("type","text").attr("id",t).appendTo(n).bind("blur",function(){i._$errorMessage.hide()}).bind("focus",function(){i._$fileNameInput.hasClass("invalid")&&i._$errorMessage.show()}),this._$errorMessage=$(nt("div","input-error-tip")).hide().text("").appendTo(n),this._$fileNameInput},t.prototype.getFileNameInputText=function(){return this._$fileNameInput?this._$fileNameInput.val():""},t.prototype.showFileNameInputError=function(n){var t=this._$fileNameInput.val().trim();t&&n?(this._$fileNameInput.addClass("invalid"),this._$errorMessage.text(s.format(g.InvalidFileName,this._$fileNameInput.val().trim())),this._$errorMessage.show()):(this._$fileNameInput.removeClass("invalid"),this._$errorMessage.hide())},t.prototype.isValidFileNameInput=function(){var t=this._$fileNameInput.val().trim(),n;return t?(n=!0,this._invalidCharacters.forEach(function(i){if(t.indexOf(i)>=0){n=!1;return}}),n):!1},t}(d.VersionControlModalDialog),ut=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,$.extend({coreCssClass:"vc-new-item-dialog vc-editing-dialog"},t))},t.prototype.initialize=function(){var t=this,v,y,w,h;n.prototype.initialize.call(this);var r=u.FileInputControl.isSupported()&&!this._options.hideUpload,o=!r||!this._options.hideNewFile,s=r&&Boolean(this._options.initialDrop),k=!1;if(o&&r&&this._element.addClass("multi-mode-enabled"),this._repositoryContext.getClient().beginGetItem(this._repositoryContext,this._itemPath,this._itemVersion,{recursionLevel:c.VersionControlRecursionType.OneLevel},function(n){t._existingFileNameVersions={};$.each(n.childItems||[],function(n,i){t._existingFileNameVersions[p.getFileName(i.serverItem).toLowerCase()]=i.changeset||1});t._userEditedComment||t._setCommentText(t.getDefaultComment());t._decorateInputFiles();t.updateOkButton(t._hasCompleteInputs())},function(n){t.showError(n)}),o){if(r){var it=$(nt("div","form-section")).appendTo(this._element),d=$(nt("div","radio-pair")).appendTo(it),e="newFile"+i.getId();this._$newFileRadioButton=$(nt("input")).attr("type","radio").attr("id",e).attr("name",e).prop("checked",!s).appendTo(d);$(nt("label")).attr("for",e).text(g.AddFileDialogNewItemLabel).appendTo(d)}this._$newFilePane=$(nt("div","new-file-pane selected-pane form-section")).appendTo(this._element);r&&this._$newFilePane.bind("click",function(){t._$newFileRadioButton&&t._handlePaneToggled(!1)});v="fileName"+i.getId();$(nt("label")).attr("for",v).text(g.AddFileDialogFilenameLabel).appendTo($(nt("div","file-name-label")).appendTo(this._$newFilePane));y=this.addFileNameInput(this._$newFilePane,v);y.bind("input keyup",function(){t.showFileNameInputError(!t.isValidFileNameInput());t.updateOkButton(t._hasCompleteInputs())});s||y.focus();this._$newFileRadioButton&&this._$newFileRadioButton.change(function(){var n=t._$newFileRadioButton.prop("checked")?!0:!1;t._handlePaneToggled(!n)})}if(r){if(o){var rt=$(nt("div","form-section")).appendTo(this._element),tt=$(nt("div","radio-pair")).appendTo(rt),e="uploadFiles"+i.getId();this._$uploadFilesRadioButton=$(nt("input")).attr("type","radio").attr("id",e).attr("name",e).prop("checked",!!s).appendTo(tt);$(nt("label")).attr("for",e).text(g.AddFileDialogUploadFilesLabel).appendTo(tt)}this._$uploadFilesPane=$(nt("div","upload-files-pane form-section")).appendTo(this._element);o&&this._$uploadFilesPane.bind("click",function(){t._$uploadFilesRadioButton&&t._handlePaneToggled(!0)});w=this._repositoryContext.getRepositoryType()===l.RepositoryType.Tfvc;h=this._repositoryContext.getRepositoryType()===l.RepositoryType.Git;this._fileInputControl=u.FileInputControl.createControl($(nt("div","form-section")).appendTo(this._$uploadFilesPane),{initialDrop:this._options.initialDrop,maximumTotalFileSize:b.Constants.MAX_EDIT_FROM_WEB_CONTENT_SIZE,detectEncoding:w,fileNamesCaseSensitive:h,updateHandler:function(){k&&(t._userEditedComment||t._setCommentText(t.getDefaultComment()),t._$uploadFilesRadioButton&&t._handlePaneToggled(!0),t._decorateInputFiles(),t.updateOkButton(t._hasCompleteInputs()))},limitMessageFormatter:function(n,t){return f.publishEvent(new f.TelemetryEventData(a.VERSION_CONTROL_AREA,a.SOURCEEDITING_UPLOAD_LIMIT,$.extend({},t,{isGit:h,isTfvc:w}))),n+(h?g.WebEditLimitWorkaroundGit:g.WebEditLimitWorkaroundTfvc)}});this._addCommentBox(this.getDefaultComment(),!o||s,this._$uploadFilesPane).bind("input keyup",function(){t._userEditedComment=t._getCommentText()!==t.getDefaultComment()});this._$uploadFilesRadioButton&&this._$uploadFilesRadioButton.change(function(){var n=t._$uploadFilesRadioButton.prop("checked")?!0:!1;t._handlePaneToggled(n)})}k=!0;this.updateOkButton(this._hasCompleteInputs())},t.prototype._hasCompleteInputs=function(){if(!n.prototype._hasCompleteInputs.call(this)||!this._existingFileNameVersions)return!1;if(this.isUploadFilesMode()){if(this._fileInputControl.isLoadInProgress()||this._fileInputControl.getFiles().length===0)return!1}else if(!this.isValidFileNameInput())return!1;return!0},t.prototype.onOkClick=function(t){var i=this,r,e,o,h,u;if(this.isUploadFilesMode())this.updateOkButton(!1),r=this._fileInputControl.getFiles(),e=this._getCommentText(),it.updateFilesInFolder(this._repositoryContext,this._itemPath,r,this._existingFileNameVersions,w.VersionSpec.parse(this._itemVersion),e).done(function(u){var o={newFilePaths:r.map(function(n){return p.combinePaths(i._itemPath,n.name)}),newVersion:u,comment:e};i.setDialogResult(o);n.prototype.onOkClick.call(i,t);f.publishEvent(new f.TelemetryEventData(a.VERSION_CONTROL_AREA,a.FILEVIEWER_FILE_UPLOAD_COMMIT_FEATURE,{FileCount:r.length}))}).fail(function(n){i._handleError(n)});else{if(o=this.getFileNameInputText().trim(),h=p.validateFilename(o,this._itemPath,this._repositoryContext.getRepositoryType()),h){this._handleError(new Error(h));return}u=p.combinePaths(this._itemPath,o);this.updateOkButton(!1);this._repositoryContext.getClient().beginGetItem(this._repositoryContext,u,this._itemVersion,null,function(){i._handleError(new Error(s.format(g.AddFileDialogAlreadyExistsErrorFormat,u)))},function(){var r={newFilePaths:[u]};i.setDialogResult(r);n.prototype.onOkClick.call(i,t)})}},t.prototype._handlePaneToggled=function(n){this._$newFilePane.toggleClass("selected-pane",!n);this._$uploadFilesPane.toggleClass("selected-pane",n);this._$newFileRadioButton.prop("checked",!n);this._$uploadFilesRadioButton.prop("checked",n);this.updateOkButton(this._hasCompleteInputs())},t.prototype.isUploadFilesMode=function(){return this._fileInputControl?this._$uploadFilesRadioButton?this._$uploadFilesRadioButton.prop("checked")?!0:!1:!0:!1},t.prototype.getDefaultComment=function(){var n,t,i,u,r;if(this._fileInputControl&&this._fileInputControl.getFiles().length!==0){if(n=this._fileInputControl.getFiles(),t=0,this._existingFileNameVersions)for(i=0,u=n.length;i<u;i++)this._existingFileNameVersions[n[i].name.toLowerCase()]&&t++;return n.length==1?t>0?s.format(g.AddFileDialogDefaultCommentSingleFileWithEdit,n[0].name):s.format(g.AddFileDialogDefaultCommentSingleFile,n[0].name):(r=p.getFileName(this._itemPath)||this._repositoryContext.getRootPath(),t>0&&t<n.length?s.format(g.AddFileDialogDefaultCommentMultipleFilesWithAddsAndEdits,n.length,r):t>0?s.format(g.AddFileDialogDefaultCommentMultipleFilesWithEdits,n.length,r):s.format(g.AddFileDialogDefaultCommentMultipleFiles,n.length,r))}return g.AddFileDialogDefaultComment},t.prototype._decorateInputFiles=function(){var t,i,r,n;if(this._existingFileNameVersions&&this._fileInputControl&&(t=this._fileInputControl.getRows(),t.length>0))for(i=0,r=t.length;i<r;i++)n=t[i],this._existingFileNameVersions[n.result.name.toLowerCase()]?n.$fileNameElement.text(s.format(g.AddFileDialogReplaceFileFormat,n.result.name)):n.$fileNameElement.text(s.format(g.AddFileDialogNewFileFormat,n.result.name))},t}(rt),ft=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,$.extend({coreCssClass:"vc-rename-item-dialog vc-editing-dialog"},t))},t.prototype.initialize=function(){var t=this,u;n.prototype.initialize.call(this);this._itemIsFolder=this._options.itemIsFolder;this._parentFolder=p.getContainingFolder(this._itemPath,this._repositoryContext.getRootPath());var r=p.getFileName(this._itemPath),f=p.getFileExtension(r),e="fileName"+i.getId(),h=$(nt("div","form-section")).appendTo(this._element);$(nt("label")).attr("for",e).text(this._itemIsFolder?g.RenameDialogFoldernameLabel:g.RenameDialogFilenameLabel).appendTo(h);u=this.addFileNameInput(h,e);u.val(r||"").bind("input keyup",function(){t._userEditedComment||(t._defaultComment=s.format(g.DefaultRenameCommentFormatFromTo,r,t.getFileNameInputText().trim()),t._setCommentText(t._defaultComment));t.showFileNameInputError(!t.isValidFileNameInput());t.updateOkButton(t._hasCompleteInputs())});f?o.SelectionUtils.selectInputText(u,0,r.length-f.length-1,!0):o.SelectionUtils.selectInputText(u,0,r.length,!0);this._defaultComment=s.format(g.DefaultRenameCommentFormat,r);this._addCommentBox(this._defaultComment,!1,this._element).bind("input keyup",function(){t._getCommentText()!==t._defaultComment&&(t._userEditedComment=!0)});this.updateOkButton(this._hasCompleteInputs())},t.prototype.showFileNameInputError=function(t){var i=this.getFileNameInputText().trim(),r=p.getFileName(this._itemPath);r===i&&(t=!1);n.prototype.showFileNameInputError.call(this,t)},t.prototype._hasCompleteInputs=function(){return n.prototype._hasCompleteInputs.call(this)?this.isValidFileNameInput()?!0:!1:!1},t.prototype.isValidFileNameInput=function(){var t=this.getFileNameInputText().trim();return!n.prototype.isValidFileNameInput.call(this)||t===p.getFileName(this._itemPath)?!1:!0},t.prototype.onOkClick=function(t){var i=this,u=this.getFileNameInputText().trim(),e=p.validateFilename(u,this._parentFolder,this._repositoryContext.getRepositoryType()),r;if(e){this._handleError(new Error(e));return}this.updateOkButton(!1);r=p.combinePaths(this._parentFolder,u);this._repositoryContext.getClient().beginGetItem(this._repositoryContext,r,this._itemVersion,null,function(){i._handleError(new Error(s.format(g.AddFileDialogAlreadyExistsErrorFormat,r)))},function(){var u=i._getCommentText();it.renameItem(i._repositoryContext,i._itemPath,i._itemVersion,r,u).done(function(e){i.setDialogResult({newVersion:e,comment:u,newItemPath:r});n.prototype.onOkClick.call(i,t);f.publishEvent(new f.TelemetryEventData(a.VERSION_CONTROL_AREA,a.FILEVIEWER_FILE_RENAME_COMMIT_FEATURE,{FileExtension:p.getFileExtension(r)}))}).fail(function(n){i._handleError(n)})})},t}(rt),et=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,$.extend({coreCssClass:"vc-delete-item-dialog vc-editing-dialog"},t))},t.prototype.initialize=function(){n.prototype.initialize.call(this);var t=s.format(g.DefaultDeleteCommentFormat,this._itemPath);this._addCommentBox(t,!0,this._element);this.updateOkButton(!0)},t.prototype.onOkClick=function(t){var i=this,r;this.updateOkButton(!1);r=this._getCommentText();it.deleteItem(this._repositoryContext,this._itemPath,this._itemVersion,r).done(function(u){i.setDialogResult({newVersion:u,comment:r});n.prototype.onOkClick.call(i,t);f.publishEvent(new f.TelemetryEventData(a.VERSION_CONTROL_AREA,a.FILEVIEWER_FILE_DELETE_COMMIT_FEATURE,{FileExtension:p.getFileExtension(i._itemPath)}))}).fail(function(n){i._handleError(n)})},t}(rt),tt;(function(n){function t(n,t,i,u,f,e,o,s){return r.Dialog.show(ut,{title:g.AddFileDialogTitle,width:560,okText:g.AddNewItemsDialogOKText,hideUpload:f,hideNewFile:e,repositoryContext:n,itemPath:t,itemVersion:i,initialDrop:u,okCallback:o,cancelCallback:s})}function i(n,t,i,u,f,e){return r.Dialog.show(ft,{title:g.RenameDialogTitle,width:560,okText:g.RenameItemsDialogOKText,repositoryContext:n,itemPath:t,itemVersion:i,itemIsFolder:u,okCallback:f,cancelCallback:e})}function u(n,t,i,u,f){return r.Dialog.show(et,{title:g.DeleteItemDialogTitle,width:560,okText:g.DeleteItemsDialogOKText,repositoryContext:n,itemPath:t,itemVersion:i,okCallback:u,cancelCallback:f})}n.addNewItems=t;n.renameItem=i;n.deleteItem=u})(tt=t.Dialogs||(t.Dialogs={})),function(n){function f(n,t,i,r,u,f,e,o){tt.addNewItems(n,t,i,r,u,f,e,o)}function o(n,t,i,r,u,f){tt.renameItem(n,t,i,r,u,f)}function c(n,t,i,r,u){var f=$.Deferred();return n.getClient().beginGetItem(n,t,i,null,function(e){var o,s;if(n.getRepositoryType()===l.RepositoryType.Git){var c=n.getClient(),a=n,y=e,p={refUpdates:[{name:v.versionStringToRefName(i),oldObjectId:y.commitId.full}],commits:[{comment:u,changes:[{changeType:h.VersionControlChangeType.Rename,sourceServerItem:t,item:{path:r}}]}]};c.beginPushChanges(a.getRepository(),p,function(n){var e=new w.GitCommitVersionSpec(n.refUpdates[0].newObjectId);k.Events._triggerItemRenamedEvent(e,u,t,i,r);f.resolve(e)},f.reject)}else o=n.getClient(),s={comment:u,changes:[{changeType:h.VersionControlChangeType.Rename,sourceServerItem:t,item:{path:r,version:e.changeset}}]},o.beginCreateChangeset(s,function(n){var e=new w.ChangesetVersionSpec(n.changesetId);k.Events._triggerItemRenamedEvent(e,u,t,i,r);f.resolve(e)},f.reject)},f.reject),f.promise()}function a(n,t,i,r,u){tt.deleteItem(n,t,i,r,u)}function d(n,t,i,r){var u=$.Deferred();return n.getClient().beginGetItem(n,t,i,null,function(f){var e,o;if(n.getRepositoryType()===l.RepositoryType.Git){var s=n.getClient(),c=n,a=f,y={refUpdates:[{name:v.versionStringToRefName(i),oldObjectId:a.commitId.full}],commits:[{comment:r,changes:[{changeType:h.VersionControlChangeType.Delete,item:{path:t}}]}]};s.beginPushChanges(c.getRepository(),y,function(n){var f=new w.GitCommitVersionSpec(n.refUpdates[0].newObjectId);k.Events._triggerItemDeletedEvent(f,r,t,i);u.resolve(f)},u.reject)}else e=n.getClient(),o={comment:r,changes:[{changeType:h.VersionControlChangeType.Delete,item:{path:t,version:f.changeset}}]},e.beginCreateChangeset(o,function(n){var f=new w.ChangesetVersionSpec(n.changesetId);k.Events._triggerItemDeletedEvent(f,r,t,i);u.resolve(f)},u.reject)},u.reject),u.promise()}function nt(n,i,r,u,f,e,o,s){var c=[{changeType:f?h.VersionControlChangeType.Add:h.VersionControlChangeType.Edit,item:{path:i},newContent:{content:e||"",contentType:h.ItemContentType.RawText}}];return t(n,c,r,u,o,s).then(function(t){var r=s?new w.GitBranchVersionSpec(s).toVersionString():undefined;return k.Events._triggerItemEditedEvent(t,o,i,new w.GitBranchVersionSpec(u).toVersionString(),r,n.getRepositoryId()),t})}function it(n,i,f){var s;i===void 0&&(i=!1);var o=$.Deferred(),e=[];return i&&e.push({changeType:h.VersionControlChangeType.Add,item:{path:"/"+u},newContentTemplate:{name:u,type:"readme"}}),f&&e.push({changeType:h.VersionControlChangeType.Add,item:{path:"/"+r},newContentTemplate:{name:f,type:"gitignore"}}),s=rt(e),t(n,e,"","master",s).then(function(n){o.resolve(n)},function(n){o.reject(n)}),o.promise()}function rt(n){for(var i,t="",u=0,f=n;u<f.length;u++)i=f[u],t+=i.newContentTemplate.type==="gitignore"?r+" ("+i.newContentTemplate.name.substr(0,i.newContentTemplate.name.lastIndexOf("."))+")":i.newContentTemplate.name,t+=", ";return t=t.substr(0,t.length-2),s.format(n.length===1?g.InitRepoWithDefaultFileMessage:g.InitRepoWithDefaultFilesMessage,t)}function ut(n,r,u,f,e,o){var b,c,v,s,a,y;if(n.getRepositoryType()===l.RepositoryType.Git){if(!(e instanceof w.GitBranchVersionSpec))throw new Error("Invalid version spec: Can only push to a branch version spec.");for(b=e.branchName,c=[],s=0,a=u.length;s<a;s++)c.push({changeType:f[u[s].name.toLowerCase()]?h.VersionControlChangeType.Edit:h.VersionControlChangeType.Add,item:{path:p.combinePaths(r,u[s].name)},newContent:{content:u[s].content,contentType:h.ItemContentType.Base64Encoded}});return t(n,c,null,b,o).then(function(n){return k.Events._triggerItemsUploadedEvent(n,o,r,c.map(function(n){return n.item.path})),n})}for(v=[],s=0,a=u.length;s<a;s++)y=f[u[s].name.toLowerCase()]||0,v.push({changeType:y?h.VersionControlChangeType.Edit:h.VersionControlChangeType.Add,item:{path:p.combinePaths(r,u[s].name),contentMetadata:{encoding:ot(u[s].encoding)},version:y},newContent:{content:u[s].content,contentType:h.ItemContentType.Base64Encoded}});return i(n,v,o).then(function(n){return k.Events._triggerItemsUploadedEvent(n,o,r,v.map(function(n){return n.item.path})),n})}function t(n,t,i,r,u,f){var e=$.Deferred();return et(n,i,r,f).done(function(i){var r=n.getClient(),f=n,o={refUpdates:[{name:i.name,oldObjectId:i.objectId}],commits:[{comment:u,changes:t}]};r.beginPushChanges(f.getRepository(),o,function(n){var t=new w.GitCommitVersionSpec(n.refUpdates[0].newObjectId);e.resolve(t)},e.reject)}).fail(e.reject),e.promise()}function ft(n,t,r,u,f,e,o){var s=[{changeType:u?h.VersionControlChangeType.Add:h.VersionControlChangeType.Edit,item:{path:t,contentMetadata:{encoding:o?o:b.TfvcEncodingConstants.UTF8},version:r},newContent:{content:f||"",contentType:h.ItemContentType.RawText}}];return i(n,s,e).then(function(n){var i=r?new w.ChangesetVersionSpec(r).toVersionString():(new w.LatestVersionSpec).toVersionString();return k.Events._triggerItemEditedEvent(n,e,t,i),n})}function i(n,t,i){var r=$.Deferred(),u=n.getClient(),f={comment:i,changes:t};return u.beginCreateChangeset(f,function(n){var t=new w.ChangesetVersionSpec(n.changesetId);r.resolve(t)},r.reject),r.promise()}function et(n,t,i,r){var u=$.Deferred(),f,e;return t?u.resolve({name:v.getFullRefNameFromBranch(r||i),objectId:t}):(f=v.getFullRefNameFromBranch(i),e=n,e.getGitClient().beginGetGitRef(e.getRepository(),f,function(n){var t=$.grep(n,function(n){return n.name===f})[0];t?u.resolve({name:r?v.getFullRefNameFromBranch(r):f,objectId:t.objectId}):u.resolve({name:v.getFullRefNameFromBranch(i),objectId:y.EMPTY_OBJECT_ID})})),u.promise()}function ot(n){switch(n){case e.FileEncoding.Binary:return b.TfvcEncodingConstants.Binary;case e.FileEncoding.UTF16_BE:return b.TfvcEncodingConstants.UTF16_BE;case e.FileEncoding.UTF16_LE:return b.TfvcEncodingConstants.UTF16_LE;case e.FileEncoding.UTF32_BE:return b.TfvcEncodingConstants.UTF32_BE;case e.FileEncoding.UTF32_LE:return b.TfvcEncodingConstants.UTF32_LE;default:return b.TfvcEncodingConstants.UTF8}}var r=".gitignore",u="README.md";n.showAddNewItemsUI=f;n.showRenameItemUI=o;n.renameItem=c;n.showDeleteItemUI=a;n.deleteItem=d;n.editFileGit=nt;n.createDefaultFilesPush=it;n.updateFilesInFolder=ut;n.editFileTfvc=ft;n.modifyPathsTfvc=i}(it=t.Actions||(t.Actions={}))});
define("VersionControl/Scripts/TFS.VersionControl.SourceRendering",["require","exports","Presentation/Scripts/TFS/Generated/TFS.Server.WebAccess.Constants","VSS/VSS","VSS/FeatureAvailability/Services"],function(n,t,i,r,u){Object.defineProperty(t,"__esModule",{value:!0});var f;(function(n){function t(){return u.FeatureAvailabilityService.isFeatureEnabled(i.FeatureAvailabilityFlags.WebAccessVersionControlWikiLinkTransformation)}n.isWikiLinkTransformationEnabled=t})(f=t.WikiRelativeLinkEnablement||(t.WikiRelativeLinkEnablement={}));r.tfsModuleLoaded("TFS.VersionControl.SourceRendering",t)});
define("VersionControl/Scripts/VersionControlPathUrl",["require","exports","Presentation/Scripts/URI"],function(n,t,i){function u(n,t){n||(n="");t||(t="");var u=r(n),f=r(t),e=new i(u),o=e.absoluteTo(f);return i.decode(o.href())}function r(n){for(var t=n.split(/[\\\/]/),r=0;r<t.length;r++)t[r]=i.encode(t[r]);return t.join("/")}Object.defineProperty(t,"__esModule",{value:!0});t.resolveRelativePath=u});
define("VersionControl/Scripts/TfvcVersionControlPath",["require","exports"],function(n,t){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function n(t){if(this.isValid=!1,this.rawPath=t,t){var i=t.match(n.pathRegex);i?(this.isValid=!0,this.projectRoot=i[1],this.projectName=i[2],this.relativePath=typeof i[4]=="undefined"?"":i[4]):t===n.rootPath&&(this.isValid=!0)}}return n.prototype.getRawPath=function(){return this.rawPath},n.prototype.getIsValid=function(){return this.isValid},n.prototype.getProjectName=function(){return this.projectName},n.prototype.getProjectRoot=function(){return this.projectRoot},n.prototype.getRelativePath=function(){return this.relativePath},n.pathRegex=/(\$\/([^\/]+))(\/(.*))?/i,n.rootPath="$/",n}();t.TfvcVersionControlPath=i});
define("VersionControl/Scripts/TfvcVersionControlPathUtility",["require","exports","VersionControl/Scripts/VersionControlPathUrl","VersionControl/Scripts/VersionControlPath","VersionControl/Scripts/TfvcVersionControlPath"],function(n,t,i,r,u){Object.defineProperty(t,"__esModule",{value:!0});var f=function(){function n(){}return n.isAbsolutePath=function(n){if(typeof n=="undefined"||n===null)throw new Error("path parameter is required");return n.length>=2&&n.substr(0,2)=="$/"},n.getProjectRelativePathFromAbsolutePath=function(t){var i,r;if(typeof t=="undefined"||t==null)throw new Error("path parameter is required");if(!n.isAbsolutePath(t))throw new Error("path parameter must be an absolute path");if(i=t.split("/"),i.length<2||i[1]==="")throw new Error("path should be of the form '$/[project][/...]'");return r=i.slice(2,i.length),r.length===0||r[0]===""?"":r.join("/")},n.combine=function(n,t){var e,c;if(!n)return t;if(!t)return n;if(e=new u.TfvcVersionControlPath(n),!e.getIsValid())throw new Error(n+" is not a valid TfVC path.");var h=e.getProjectRoot(),s=i.resolveRelativePath(e.getRelativePath(),"/"),f=t,o=new u.TfvcVersionControlPath(t);if(o.getIsValid())if(o.getRelativePath())h=o.getProjectRoot(),s="/",f=o.getRelativePath();else return t;else t.charAt(0)==="/"&&(s="/",f=t.substr(1));return c=r.getDirectory(s),f=i.resolveRelativePath(f,c),h+f},n}();t.TfvcVersionControlPathUtility=f});
define("VersionControl/Scripts/GitVersionControlPathUtility",["require","exports","VersionControl/Scripts/VersionControlPath","VersionControl/Scripts/VersionControlPathUrl"],function(n,t,i,r){Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function n(){}return n.combine=function(n,t){var u,f,e;return n?t?(u=n,f=t,t.charAt(0)==="/"&&(u="/",f=t.substr(1)),e=i.getDirectory(u),r.resolveRelativePath(f,e)):n:t},n}();t.GitVersionControlPathUtility=u});
define("VersionControl/Scripts/TFS.VersionControl.WikiLinkTransformer",["require","exports","VSS/VSS","Presentation/Scripts/URI","VersionControl/Scripts/Controls/ControlsCommon","VersionControl/Scripts/RepositoryContext","VersionControl/Scripts/VersionControlPath","VersionControl/Scripts/VersionControlUrls","VersionControl/Scripts/TfvcVersionControlPathUtility","VersionControl/Scripts/GitVersionControlPathUtility","VersionControl/Scripts/TfvcVersionControlPath"],function(n,t,i,r,u,f,e,o,s,h,c){var l,a;Object.defineProperty(t,"__esModule",{value:!0});l=function(){function n(n,t,i){i===void 0&&(i=!1);this.repositoryContext=n;this.item=t;this.useLinkFragments=i}return n.prototype.getRepositoryContext=function(){return this.repositoryContext},n.prototype.getItem=function(){return this.item},n.prototype.getBrowserUri=function(){throw new Error("This should be overriden in the derived class.");},n.prototype.getGitVersionControlPath=function(n){return h.GitVersionControlPathUtility.combine(this.item.serverItem,n)},n.prototype.getTfsVersionControlPath=function(n){return s.TfvcVersionControlPathUtility.combine(this.item.serverItem,n)},n.prototype.transformRelativeLink=function(n){var t,o,i,u,e;if(n&&n.charAt(0)==="#"&&(n=this.item.serverItem+n),t=new r(n),o=r.decode(t.fragment()),t.fragment(""),i=r.decode(t.href()),u=this.repositoryContext.getRepositoryType(),u==f.RepositoryType.Git)e=this.getGitVersionControlPath(i);else if(u==f.RepositoryType.Tfvc)e=this.getTfsVersionControlPath(i);else return i;return this.getBrowserUri(e,o)},n.prototype.transformLink=function(n){if(!n)return n;var t=new r(n);return t.is("absolute")?n:this.transformRelativeLink(n)},n.prototype.getCodeExplorerUrl=function(n,t){var l=this.repositoryContext.getRepositoryType(),i,a=null,h,r,s,v;if(l===f.RepositoryType.Git)i={path:n,version:this.item.version};else if(l===f.RepositoryType.Tfvc)i={path:n},h=new c.TfvcVersionControlPath(this.getItem().serverItem).getProjectName(),r=new c.TfvcVersionControlPath(n).getProjectName(),r&&h&&r!==h&&(a={project:r});else throw new Error("Repository type must be one of {Git, TFS}");return s=u.VersionControlActionIds.Contents,v=e.getFileExtension(n.toLowerCase()),v==="md"&&(i.createIfNew=!0,s=u.VersionControlActionIds.Preview),t&&(i.anchor=t),this.useLinkFragments?u.getFragmentAction(s,n,i.version,i):o.getExplorerUrl(this.repositoryContext,n,s,i,a)},n}();t.WikiLinkTransformer=l;a=function(n){function t(t,i,r){return r===void 0&&(r=!1),n.call(this,t,i,r)||this}return __extends(t,n),t.prototype.getBrowserUri=function(n,t){return this.getCodeExplorerUrl(n,t)},t}(l);t.CodeExplorerWikiLinkTransformer=a;i.tfsModuleLoaded("TFS.VersionControl.WikiLinkTransformer",t)});
define("VersionControl/Scripts/TFS.VersionControl.WikiImageTransformer",["require","exports","VSS/VSS","VersionControl/Scripts/RepositoryContext","VersionControl/Scripts/VersionControlUrls","Presentation/Scripts/URI","VersionControl/Scripts/TfvcVersionControlPathUtility","VersionControl/Scripts/GitVersionControlPathUtility","VersionControl/Scripts/TfvcVersionControlPath"],function(n,t,i,r,u,f,e,o,s){Object.defineProperty(t,"__esModule",{value:!0});var h=function(){function n(n,t){this.repositoryContext=n;this.item=t}return n.prototype.getRepositoryContext=function(){return this.repositoryContext},n.prototype.getItem=function(){return this.item},n.prototype.getGitVersionControlUri=function(n){return o.GitVersionControlPathUtility.combine(this.item.serverItem,n)},n.prototype.getTfsVersionControlUri=function(n){return e.TfvcVersionControlPathUtility.combine(this.item.serverItem,n)},n.prototype.getFileContentApiUri=function(n){var f=this.repositoryContext.getRepositoryType(),e=null,o=null,i,t;if(f===r.RepositoryType.Tfvc)i=new s.TfvcVersionControlPath(this.item.serverItem),t=new s.TfvcVersionControlPath(n),t.getProjectName()&&i.getProjectName()&&t.getProjectName()!==i.getProjectName()&&(e={project:t.getProjectName()});else if(f===r.RepositoryType.Git)o=this.item.version;else throw new Error("Repository type must be one of {Git, TFS}");return u.getFileContentUrl(this.repositoryContext,n,o,!0,e)},n.prototype.getFileContentUri=function(n){var i=this.repositoryContext.getRepositoryType(),t;if(i===r.RepositoryType.Git)t=this.getGitVersionControlUri(n);else if(i===r.RepositoryType.Tfvc)t=this.getTfsVersionControlUri(n);else return n;return this.getFileContentApiUri(t)},n.prototype.transformImage=function(n){var t,i;return n?(t=new f(n),t.is("absolute"))?n:(i=f.decode(n),this.getFileContentUri(i)):n},n}();t.WikiImageTransformer=h;i.tfsModuleLoaded("TFS.VersionControl.WikiImageTransformer",t)});
define("VersionControl/Scripts/Controls/FileViewerEditConfirmationDialog",["require","exports","VSS/Controls/Dialogs"],function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(n){function t(t){return n.call(this,t)||this}return __extends(t,n),t.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,$.extend({width:500,height:"auto",initialFocusSelector:"#ok"},t))},t.prototype.initialize=function(){this._element.html(this._options.editWarningHtml);n.prototype.initialize.call(this)},t.prototype.getDialogResult=function(){return!0},t}(i.ConfirmationDialogO);t.FileEditConfirmationDialog=r});
define("Presentation/Scripts/TFS/TFS.IdentityImage",["require","exports","Presentation/Scripts/TFS/TFS.Host.TfsContext","Presentation/Scripts/TFS/TFS.OM.Identities","VSS/Utils/UI"],function(n,t,i,r,u){function o(n,t,r,u,e,o){n||(n=i.TfsContext.getDefault());var s=f(u,e,o);return s.attr("src",n.getIdentityImageUrl(t,r)),t&&s.addClass("identity-"+t),s}function s(n,t,i,u,e){var o=f(t,i,u),s=e?r.IdentityImageMode.ShowGenericImage:r.IdentityImageMode.None;return o.attr("src",r.IdentityHelper.getIdentityImageUrl(n,s)),o}function f(n,t,i){var r;return r=$(e("img","identity-picture")),t&&r.attr("title",t),n&&r.addClass(n),i?r.attr("alt",i):r.attr("alt",""),r}Object.defineProperty(t,"__esModule",{value:!0});var e=u.domElem;t.identityImageElement=o;t.identityImageElementByIdentifier=s});
define("VersionControl/Scripts/Controls/FileViewerEditPanel",["require","exports","VSS/Controls","Presentation/Scripts/TFS/TFS.IdentityImage","VSS/Controls/Menus","VSS/VSS","VSS/Utils/UI","Presentation/Scripts/TFS/TFS.Host.TfsContext","VSS/Utils/String","VSS/Telemetry/Services","VersionControl/Scripts/VersionControlPath","VersionControl/Scripts/CustomerIntelligenceConstants","VersionControl/Scripts/Resources/TFS.Resources.VersionControl"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){Object.defineProperty(t,"__esModule",{value:!0});var v=e.domElem,p=o.TfsContext,y=function(n){function t(t){return n.call(this,t)||this}return __extends(t,n),t.prototype.initialize=function(){n.prototype.initialize.call(this);this.hideElement();this._isDirty=!1;this._isInputEnabled=!0},t.prototype.update=function(n,t,i){this._item=n;this._isGitRepository=t;this._editSettings=i;this._isDirty=!1;this.commitMessage(this.getDefaultCommitMessage());this._isRendered&&(this.enableInput(),this._toggleExtendedMessage(!1),this._styleForCommitOptions())},t.prototype.isVisible=function(){return this._isVisible},t.prototype.isDirty=function(n){return n!==undefined&&n!==null&&n!==this._isDirty&&(this._isDirty=n,this._updateToolbar()),this._isDirty},t.prototype.commitMessage=function(n){if(n!==undefined)return n=n||"",this._defaultMessage=n,this._$commitMessage&&(this._$commitMessage.val(n),this._$commitMessageDescription.val("")),n;var t=void 0;return this._$commitMessage&&(t=this._$commitMessage.val().trim(),this._$commitMessageDescription.val().trim()&&(t=t?t+s.lineFeed+this._$commitMessageDescription.val().trim():this._$commitMessageDescription.val().trim())),t||(t=this._defaultMessage),t},t.prototype.getDefaultCommitMessage=function(){var t,n;return this._item&&this._item.serverItem&&(n=c.getFileName(this._item.serverItem),t=this._editSettings&&this._editSettings.newFile?s.format(a.FileViewerDefaultCommitMessageForAdd,n):s.format(a.FileViewerDefaultCommitMessage,n)),t||""},t.prototype._render=function(){var n=this,f=$(v("div")),e=this._options.tfsContext||{},s=e&&e.currentIdentity?e.currentIdentity.id:undefined,t,o;r.identityImageElement(e,s,null,null).addClass("identity-image").appendTo(f);t=$(v("div")).addClass("commit-message-area");this._$commitMessage=$(v("input")).addClass("commit-message").val(this._defaultMessage).appendTo(t);this._addMessageFocusBindings(this._$commitMessage);this._bind(this._$commitMessage,"keydown",function(t){var i=t.charCode?t.charCode:t.keyCode?t.keyCode:0;if(i===13)return n._toggleExtendedMessage(!0),n._$commitMessageDescription.focus(),!1});this._$commitMessageDescription=$(v("textarea")).addClass("commit-message-description").attr("placeholder",a.EditFileExtendedCommitMessageWatermark).appendTo(t);this._addMessageFocusBindings(this._$commitMessageDescription);this._$commitMessageDescription.hide();$(v("span")).addClass("icon").addClass("icon-vc-comment-arrow-left-white").addClass("commit-message-bubble").appendTo(t);o=$(v("span")).addClass("icon").addClass("bowtie-icon bowtie-triangle-down").addClass("commit-message-drop").appendTo(t);this._bind(o,"mousedown",function(){n.delayExecute(null,10,!0,function(){n.cancelDelayedFunction("hideExtendedMessage")})});this._bind(o,"mouseup",function(){var t=n._$commitMessageDescription.is(":visible");t?(n._$commitMessage.focus(),n._toggleExtendedMessage()):(n._toggleExtendedMessage(),n._$commitMessageDescription.focus())});t.appendTo(f);this._actionsToolbar=i.BaseControl.createIn(u.MenuBar,f,{cssClass:"edit-file-actions-menu",items:[]});this._updateToolbar();this._styleForCommitOptions();f.appendTo(this._element);this._isRendered=!0},t.prototype._allowCommitOptions=function(){return!!(this._editSettings&&this._editSettings.allowBranchCreation&&this._isGitRepository)},t.prototype._styleForCommitOptions=function(){this._element.toggleClass("commit-options",this._allowCommitOptions())},t.prototype._addMessageFocusBindings=function(n){var t=this;this._bind(n,"blur",function(){t.delayExecute("hideExtendedMessage",100,!0,function(){t._toggleExtendedMessage(!1)})});this._bind(n,"focus",function(){t.delayExecute(null,10,!0,function(){t.cancelDelayedFunction("hideExtendedMessage")});t._$commitMessageDescription.val()&&t._toggleExtendedMessage(!0)})},t.prototype.toggleVisibility=function(n){var t=this._isVisible;return n===undefined&&(n=!this._isVisible),this._isVisible=n,n?(this._isRendered||this._render(),this.showElement(),h.publishEvent(new h.TelemetryEventData(l.VERSION_CONTROL_AREA,l.FILEVIEWER_EDIT_ON_FEATURE,{FileExtension:c.getFileExtension(this._item.serverItem)}))):this.hideElement(),this._isVisible},t.prototype.disableInput=function(){this._isInputEnabled=!1;this._updateToolbar();this._$commitMessage.attr("disabled","disabled");this._$commitMessageDescription.attr("disabled","disabled")},t.prototype.enableInput=function(){this._isInputEnabled=!0;this._updateToolbar();this._$commitMessage.removeAttr("disabled");this._$commitMessageDescription.removeAttr("disabled")},t.prototype._onCommitClick=function(){this._fire(t.EVENT_COMMIT_CLICKED,{message:this.commitMessage()})},t.prototype._onCommitToNewBranchClick=function(){this._fire(t.EVENT_COMMIT_TO_NEW_BRANCH_CLICKED,{message:this.commitMessage()})},t.prototype._onRevertClick=function(){this._fire(t.EVENT_DISCARD_CLICKED)},t.prototype._updateToolbar=function(){var n=this,t=this._editSettings&&this._editSettings.newFile,r=[],u=[],i=this._isGitRepository?a.EditFileCommit:a.EditFileCheckin,f={id:"commit-file-changes",title:i,icon:"bowtie-icon bowtie-save",showText:!1,disabled:!this._isInputEnabled||!(this.isDirty()||t),action:function(){n._onCommitClick()}};r.push(f);this._allowCommitOptions()&&(u.push({id:"commit-file-changes-default",text:i,title:i,icon:"bowtie-icon bowtie-save",showText:!0,disabled:!this._isInputEnabled||!(this.isDirty()||t),action:function(){n._onCommitClick()}}),u.push({id:"commit-file-changes-new-branch",text:this._isGitRepository?a.EditFileCommitToNewBranch:a.EditFileCheckinToShelveset,title:this._isGitRepository?a.EditFileCommitToNewBranchTitle:a.EditFileCheckinToShelvesetTitle,icon:"bowtie-icon bowtie-tfvc-branch",showText:!0,disabled:!this._isInputEnabled||!(this.isDirty()||t),action:function(){n._onCommitToNewBranchClick()}}),$.extend(f,{childItems:u,splitDropOptions:{id:"commit-file-changes-splitdrop",title:s.format(a.EditFileSaveDropTitle,i)}}));r.push({id:"discard-file-changes",title:this.isDirty()?a.EditFileDiscard:a.EditFileCancel,icon:t?"bowtie-icon bowtie-edit-remove":this.isDirty()?"bowtie-icon bowtie-edit-undo ":"bowtie-icon bowtie-math-multiply",showText:!1,disabled:!this._isInputEnabled,action:function(){n._onRevertClick()}});this._actionsToolbar.updateItems(r)},t.prototype._toggleExtendedMessage=function(n){if(this._isRendered){var t=this._$commitMessageDescription.is(":visible");n===undefined&&(n=!t);n!==t&&(this._$commitMessageDescription.toggle(n),n||this._$commitMessageDescription.val()?this._$commitMessage.addClass("extended-message"):this._$commitMessage.removeClass("extended-message"))}},t.EVENT_COMMIT_CLICKED="commit-clicked",t.EVENT_COMMIT_TO_NEW_BRANCH_CLICKED="commit-to-new-branch-clicked",t.EVENT_DISCARD_CLICKED="discard-clicked",t}(i.BaseControl);t.FileViewerEditPanel=y;f.classExtend(y,p.ControlExtensions)});
define("VersionControl/Scripts/Controls/CreateBranchDialogLazy",["require","exports","VersionControl/Scripts/Resources/TFS.Resources.VersionControl","VersionControl/Scripts/Controls/LazyDialog","VersionControl/Scripts/DeferredJobQueue"],function(n,t,i,r,u){function f(n,t,u,f){return r.show("VersionControl/Scripts/Controls/CreateBranchDialog",function(n){return n.CreateBranchFromItemDialog},{title:i.CreateBranchDialogFromCommitTitle,okText:i.EditFileCommit,width:560,draggable:!0,repositoryContext:n,itemPath:t,itemVersion:u,commitItemCallback:f})}Object.defineProperty(t,"__esModule",{value:!0});u.queueModulePreload("VersionControl/Scripts/Controls/CreateBranchDialog");t.createBranchFromItemCommit=f});
define("VersionControl/Scripts/ExtensionActionHandler",["require","exports","VersionControl/Scripts/Controls/ControlsCommon"],function(n,t,i){function r(n,t,r,u,f){var o=f.actionId,e=f.actionData||[],s=f.requestId;switch(o){case i.VersionControlExtensionActionIds.GET_FILE_CONTENT:n.getClient().beginGetItemContentJson(n,e.path,e.version,e.maxContentLength,!1,!0,function(n){t&&!t.isDisposed()&&(t.postMessage(o,$.extend(e,n),s),t._fire(i.VersionControlExtensionActionIds.GET_FILE_CONTENT,e,n))},function(n){t.postMessage(o,$.extend(e,{error:n.message}),s)});break;case i.DiscussionExtensionActionIds.CREATE_THREAD:r.createNewDiscussionThread(u,e.position,function(n){t.postMessage(o,n,s)})}}Object.defineProperty(t,"__esModule",{value:!0});t.versionControlExtensionActionHandler=r});
define("VersionControl/Scripts/BuiltInExtensions",["require","exports","VSS/Context","VSS/Controls","VSS/Diag","VSS/Controls/Notifications","VSS/Utils/Core","VSS/Utils/Html","VSS/Utils/String","VSS/Utils/UI","VSS/Context","VSS/Resources/VSS.Resources.Platform","Presentation/Scripts/TFS/TFS.Extensions","Presentation/Scripts/TFS/TFS.Host.TfsContext","VersionControl/Scripts/Controls/ControlsCommon"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){Object.defineProperty(t,"__esModule",{value:!0});var p=h.domElem,w=function(t){function w(n){var i=t.call(this,n)||this;return i._BUILT_IN_EDITOR_PATH="Extensions/CodeEditor/0.10.1",i._queuedMessages=[],i._messageListeners=[],i}return __extends(w,t),w.prototype.initializeOptions=function(n){t.prototype.initializeOptions.call(this,$.extend({integration:null,postData:null,messageListener:null,coreCssClass:"extension-host-control"},n,{errorOptions:$.extend({showLoadFailedMessage:!0,formatErrorMessage:null},n&&n.errorOptions)}))},w.prototype.initialize=function(){var t=this,e=i.getPageContext(),r;window.require.config({paths:{vs:"../../../../../3rdParty/_content/"+this._BUILT_IN_EDITOR_PATH+"/vs","BuiltInExtensions/Scripts":"../../Extensions"+(e.diagnostics.debugMode?"/debug":"/min")}});var o=v.TfsContext.getDefault(),l=o.configuration.get3rdPartyStaticRootPath(),k=s.caseInsensitiveContains(c.getPageContext().globalization.theme||"","HighContrast")?"hc-black":"vs",a=s.format("{0}_content/{1}/vs/editor/editor.main.css",l,this._BUILT_IN_EDITOR_PATH);h.injectStylesheets([a]);this._$container=$("<div />").addClass("extension-host-container");r=$(p("div","built-in-extension-messages")).hide();this._$messagesIn=$(p("div","built-in-exension-messages-in"));this._$messagesIn.appendTo(r);this._$messagesOut=$(p("div","built-in-exension-messages-out"));this._$messagesOut.appendTo(r);this._$messagesOut.on("message",function(n,i){t._handleMessageReceived(i)});r.appendTo(this._$container);this._$builtInExtensionDiv=$(p("div","built-in-extension-div loading"));this._$builtInExtensionDiv.appendTo(this._$container);var f=i._getDefaultRawPageContext(),w=f?f.webContext:null,b=$.extend({},this._options.postData,w),u="code-editor-hostId-"+this.getId();$(p("script","code-editor-options "+u)).attr("type","application/json").html(JSON.stringify(b)).appendTo(this._$builtInExtensionDiv);$(p("div","errors-host "+u)).hide().appendTo(this._$builtInExtensionDiv);$(p("div","code-editor-host "+u)).appendTo(this._$builtInExtensionDiv);this._$container.appendTo(this._element);n(["BuiltInExtensions/Scripts/TFS.Extension"],function(n){if(t._options.end_point===y.VersionControlExtensionEndPoints.FILE_VIEWER)n.VersionControlExtension.createBuiltInCodeEditor(t._$messagesIn,t._$messagesOut,t.getId());else if(t._options.end_point===y.VersionControlExtensionEndPoints.DIFF_VIEWER)n.VersionControlExtension.createBuiltInDiffEditor(t._$messagesIn,t._$messagesOut,t.getId());else throw new Error("Only the Monaco code editor may be hosted as a legacy built-in extension");});$.isFunction(this._options.messageListener)&&this.addMessageListener(this._options.messageListener)},w.prototype.setConfiguration=function(n){this._configuration=n;this._receivedReadyEvent&&this.postMessage(a.ExtensionHost.Actions.SET_CONFIGURATION,n)},w.prototype.postMessage=function(n,t,i){var r={actionId:n||"",actionData:t||{},requestId:i};this._receivedReadyEvent?this._sendMessage(r):this._queuedMessages.push(r)},w.prototype.addMessageListener=function(n){this._messageListeners.push(n)},w.prototype._dispose=function(){this._$messagesOut.off("message");t.prototype._dispose.call(this)},w.prototype._showExtensionMessage=function(n,t,i,u,e){var s=this,h,v,c,y;this._options.errorOptions.showLoadFailedMessage!==!1&&(y=o.HtmlNormalizer.normalize(i||""),h=$("<div />"),v=$("<div />").html(y).appendTo(h),u||(v.find("a").text(this._integration.url).attr("href",this._integration.url).attr("target","blank"),$("<br />").appendTo(h),$("<div />").html(l.ExtensionErrorAdditionalSteps).appendTo(h)),this._options.errorOptions&&$.isFunction(this._options.errorOptions.formatErrorMessage)&&this._options.errorOptions.formatErrorMessage.call(this,h,u));c={type:n,header:t,content:h};this._messageArea?(this._messageArea.setMessage(c),e&&this._messageArea.setErrorDetailsVisibility(!0)):(this._messageArea=r.Enhancement.enhance(f.MessageAreaControl,$("<div />").prependTo(this._element),{closeable:!0,expanded:e,message:c}),this._$container.css("padding-top",this._messageArea._element.height()+20+"px"),this._messageArea._bind(f.MessageAreaControl.EVENT_DISPLAY_COMPLETE,function(){s._$container.css("padding-top",s._messageArea._element.height()+20+"px");s._fire(a.ExtensionHost.Events.EXTENSION_MESSAGE_RESIZED,[s])}),this._messageArea._bind(f.MessageAreaControl.EVENT_DISPLAY_CLEARED,function(){s._$container.css("padding-top","0");s._messageArea=null;s._fire(a.ExtensionHost.Events.EXTENSION_MESSAGE_RESIZED,[s])}),this._fire(a.ExtensionHost.Events.EXTENSION_MESSAGE_RESIZED,[s]))},w.prototype._hideLoadingIndicator=function(){this._$builtInExtensionDiv.removeClass("loading");this._statusControl&&(this._statusControl.dispose(),this._$statusContainer.remove(),this._statusControl=null,this._$statusContainer=null)},w.prototype._sendMessage=function(n){var i=this,t;this._disposed||(t=JSON.stringify(n),setTimeout(function(){i._$messagesIn.triggerHandler("message",[{data:t}])},0))},w.prototype._notifyLoadComplete=function(){this._receivedLoadedEvent=!0;this._hideLoadingIndicator()},w.prototype._handleMessageReceived=function(n){var i=this,t;this._disposed||(t=e.parseMSJSON(n.data,!1)||{},this._receivedLoadedEvent||t.actionId!==a.ExtensionHost.Actions.EXTENSION_LOADED?this._receivedReadyEvent||t.actionId!==a.ExtensionHost.Actions.EXTENSION_READY?t.actionId===a.ExtensionHost.Actions.EXTENSION_LOAD_ERROR&&this._handleLoadError(t.actionData&&t.actionData.errorMessage):(this._receivedReadyEvent=!0,this._configuration&&this.postMessage(a.ExtensionHost.Actions.SET_CONFIGURATION,this._configuration),$.each(this._queuedMessages,function(n,t){i._sendMessage(t)})):this._notifyLoadComplete(),$.each(this._messageListeners,function(n,r){r.call(i,t)}))},w.prototype._handleLoadError=function(n){var t=!1,i;this._loadFailed=!0;this._hideLoadingIndicator();$.isFunction(this._options.errorOptions.getFallbackControl)&&(i=this._options.errorOptions.getFallbackControl.call(this),t=i!==null&&i.length,t&&(i.appendTo($("<div />").addClass("fallback-control").appendTo(this._$container)),this._$builtInExtensionDiv.hide()));this._options.errorOptions.showLoadFailedMessage!==!1&&this._showExtensionMessage(t?f.MessageAreaType.Warning:f.MessageAreaType.Error,l.ExtensionErrorHeader,n||l.ExtensionErrorBody,n?!0:!1,!t);this._fire(a.ExtensionHost.Events.EXTENSION_LOAD_FAILED,[this])},w}(r.BaseControl);t.BuiltInExtensionHost=w});
define("VersionControl/Scripts/ExtensionViewerSupport",["require","exports","VSS/Controls","Presentation/Scripts/TFS/TFS.Extensions","VersionControl/Scripts/Generated/TFS.VersionControl.WebAccess.Contracts","VersionControl/Scripts/VersionControlPath","VersionControl/Scripts/Controls/ControlsCommon","VersionControl/Scripts/BuiltInExtensions"],function(n,t,i,r,u,f,e,o){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function n(n,t,i,r){r===void 0&&(r=!1);this._tfsContext=n;this._endPointId=t;this._getFallbackControl=i;this._isBuiltInExtension=r;this._isBuiltInExtension&&this._initializeForBuiltInIntegrations()}return n.prototype.getExtensionIntegration=function(n,t,i){var r=this;this._getAllEndPointIntegrations(function(e){var o=[],s=null;e.length>0&&(o=[].concat(e),$.each(n,function(n,i){var s=[],e=i.contentMetadata;e||(e={extension:f.getFileExtension(i.serverItem)});$.each(o,function(n,i){var f=!0;i.url||r._isBuiltInExtension||(f=!1);e.isBinary&&i.properties.supportsBinaryFiles!=="true"?f=!1:e.isImage&&i.properties.supportsImageFiles!=="true"?f=!1:i.properties.supportedFileExtensionsRegEx&&!(""+e.extension).match(new RegExp(i.properties.supportedFileExtensionsRegEx))?f=!1:i.properties.supportedContentTypesRegEx&&!(""+e.extension).match(new RegExp(i.properties.supportedContentTypesRegEx))&&(f=!1);t.orientation&&(t.orientation===u.DiffViewerOrientation.Inline&&i.properties.inlineDiffSupport===!1?f=!1:t.orientation===u.DiffViewerOrientation.SideBySide&&i.properties.sideBySideDiffSupport===!1&&(f=!1));f&&s.push(i)});o=s}),o.length>0&&(s=o[0]));i.call(r,s)})},n.prototype.createExtensionHost=function(n,t){t=t||{};$.extend(t,{end_point:(this._integrations[0]||{}).end_point});var i=this._isBuiltInExtension?o.BuiltInExtensionHost:r.ExtensionHost;return this._createExtensionHostForType(i,n,t)},n.prototype._createExtensionHostForType=function(n,t,r){return i.BaseControl.createIn(n,t,$.extend({tfsContext:this._tfsContext,postData:r.postData,errorOptions:{getFallbackControl:this._getFallbackControl}},r))},n.prototype._getAllEndPointIntegrations=function(n){this._integrations||(this._integrations=[]);n.call(this,this._integrations)},n.prototype._initializeForBuiltInIntegrations=function(){var n=this,t=[{end_point:e.VersionControlExtensionEndPoints.FILE_VIEWER,properties:{name:"Advanced Code Editor"},handshake:r.WebAccessExtensionFrameHandshakeBehavior.Smart,loadBehavior:r.WebAccessExtensionFrameLoadBehavior.Post,url:""},{end_point:e.VersionControlExtensionEndPoints.DIFF_VIEWER,properties:{name:"Advanced Code Editor"},handshake:r.WebAccessExtensionFrameHandshakeBehavior.Smart,loadBehavior:r.WebAccessExtensionFrameLoadBehavior.Post,url:""},];this._integrations=$.grep(t,function(t){return t.end_point===n._endPointId})},n}();t.VersionControlExtensionViewerSupport=s});
define("VersionControl/Scripts/Controls/ViewerConfigurerExtensionSupport",["require","exports","VSS/Controls","Presentation/Scripts/TFS/TFS.Extensions"],function(n,t,i,r){Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function n(n,t){this._tfsContext=n;this._endPointId=t;this._integrations=[]}return n.prototype.getExtensionIntegrations=function(n){this._getAllEndPointIntegrations(function(t){n(t)})},n.prototype.createExtensionHost=function(n,t){return i.BaseControl.createIn(r.ExtensionHost,n,$.extend({tfsContext:this._tfsContext,postData:t.postData},t))},n.prototype._getAllEndPointIntegrations=function(n){n.call(this,this._integrations)},n}();t.ViewerConfigurerExtensionSupport=u});
define("Mention/Scripts/TFS.Mention",["require","exports","q","VSS/VSS","VSS/Diag","VSS/Utils/Array","VSS/FeatureAvailability/Services","Presentation/Scripts/TFS/Generated/TFS.Server.WebAccess.Constants"],function(n,t,i,r,u,f,e,o){function p(n,t,i){var r="version:1.0",u;return i&&(r+=","+i),u=$("<a>").attr("href",n).attr(c.HTML_MENTION_ATTR_NAME,r).text(t),u[0].outerHTML+"&nbsp;"}var c,y,s,l,a,h,v;Object.defineProperty(t,"__esModule",{value:!0}),function(n){n.PATTERN_WORD_START_SEPARATOR="\\s|^|\\?|!|-|\\.|,|:|;|'|\"|\\(";n.PATTERN_WORD_END_SEPARATOR="\\s|$|\\?|!|\\.|,|:|;|-|' | \"|\\)";n.PATTERN_WORD_SEPARATOR="\\s#";n.METADATA_ATTR_SEPARATOR=":";n.HTML_MENTION_ATTR_NAME="data-vss-mention";n.HTML_MENTION_ID_ATTR="id";n.HTML_MENTION_OID_ATTR="oid";n.HTML_MENTION_ID_ATTR_PREFIX=n.HTML_MENTION_ID_ATTR+n.METADATA_ATTR_SEPARATOR;n.HTML_MENTION_OID_ATTR_PREFIX=n.HTML_MENTION_OID_ATTR+n.METADATA_ATTR_SEPARATOR;n.IDENTITY_PICKER_CONSUMER_ID="0ca36598-9c44-4a19-a3b1-74960b631990";n.DISCUSSION_MESSAGE_CLASS="discussion-messages-messagecontent"}(c=t.Constants||(t.Constants={})),function(n){n.AUTOCOMPLETE_ID="mention-autocomp-id";n.AUTOCOMPLETE_TITLE="mention-autocomp-title"}(y=t.CssClasses||(t.CssClasses={}));t.createHtmlMention=p,function(n){n[n.Text=0]="Text";n[n.Mention=1]="Mention"}(s=t.TextPartType||(t.TextPartType={}));l=function(){function n(n){n===void 0&&(n=h.getDefault());this._parserFactories=[];this._mentionsRenderer=n;e.FeatureAvailabilityService.isFeatureEnabled(o.FeatureAvailabilityFlags.WebAccessVersionControlPullRequestsMentions,!1)&&this._parserFactories.push(i.Promise(function(n){r.using(["VersionControl/Scripts/Mentions/PullRequestMentionParser"],function(t){n(function(){return t.createParser()})})}))}return n.getDefault=function(){return n._defaultInstance||(n._defaultInstance=new n),n._defaultInstance},n.prototype.registerParser=function(n){this._parsers?this._parsers.then(function(t){for(var f,r=n(),e=r.getArtifactType(),i=0,u=t;i<u.length;i++)if(f=u[i],f.getArtifactType()===e)throw new Error("Cannot register additional parser of same artifact type after initialization.");return t.push(r),t}):this._parserFactories.push(i.resolve(n))},n.prototype.getMentionsRenderer=function(){return this._mentionsRenderer},n.prototype.parseInput=function(n){return this._parsers||(this._parsers=i.allSettled(this._parserFactories).then(function(n){return n.map(function(n){return n.state=="fulfilled"?n.value():null}).filter(function(n){return n!=null})})),this._parsers.then(function(t){var i=[{Text:n,Type:s.Text}],r,u;for(r in t)u=t[r],i=$.map(i,function(n){var t=n;return t.Type===s.Mention?n:u.parseMentions(t.Text)});return i})},n.prototype.renderParts=function(n,t,i){for(var u,e=this,o=$.Deferred(),r=$(),h=0,f=[],c=0;c<t.length;c++)r=r.add("<span>");return u=function(){h++;h===t.length&&(i.parts=f.join(","),o.resolve(r))},t.forEach(function(n,t){if(n.Type===s.Mention){var i=n;f.push(e._mentionsRenderer.getTelemetryMentionSummary(i));e._mentionsRenderer.renderMention($(r[t]),i).then(function(){u(t)},function(){u(t)})}else f.push("text"),$(r[t]).text(n.Text),u(t)}),r.appendTo(n),o.promise()},n}();t.MentionProcessor=l;a=function(){function n(){}return n.prototype.parseFromText=function(){throw new Error("Not implemented");},n.prototype.getArtifactType=function(){throw new Error("Not implemented");},n.prototype.parseFromUrl=function(){throw new Error("Not implemented");},n.prototype.parseMentions=function(n){for(var t,r=[],f=this.parseFromText(n),i=0,u=0;u<f.length;u++)t=f[u],t.start>i&&r.push({Type:s.Text,Text:n.substring(i,t.start)}),r.push({Type:s.Mention,Text:n.substring(t.start,t.end),ArtifactType:this.getArtifactType(),ArtifactId:t.id}),i=t.end;return n.length>i&&r.push({Type:s.Text,Text:n.substring(i,n.length)}),r},n}();t.ArtifactMentionParser=a;h=function(){function n(){this._rendererFactories=[];this._vcRendererPromise=e.FeatureAvailabilityService.isFeatureEnabled(o.FeatureAvailabilityFlags.WebAccessVersionControlPullRequestsMentions,!1)?i.Promise(function(n){r.using(["VersionControl/Scripts/Mentions/PullRequestMentionRenderer"],function(t){n(t.createRenderer())},function(t){u.logError(t);n(null)})}):i.resolve(null)}return n.getDefault=function(){return n._defaultInstance||(n._defaultInstance=new n),n._defaultInstance},n.prototype.registerProvider=function(n){var i,u,t,r,f;if(this._renderers){for(i=n(),u=i.getArtifactType(),t=0,r=this._renderers;t<r.length;t++)if(f=r[t],f.getArtifactType()===u)throw new Error("Cannot register additional providers of same artifact type after initialization.");this._renderers.push(i)}else this._rendererFactories.push(n)},n.prototype.getRenderer=function(n){var t=this;return this._vcRendererPromise.then(function(i){return t._renderers||(t._renderers=$.map(t._rendererFactories,function(n){return n()}),i&&t._renderers.push(i)),f.first(t._renderers,function(t){return n.ArtifactType===t.getArtifactType()})})},n.prototype.renderMention=function(n,t){return this.getRenderer(t).then(function(i){if(i)return i.renderMention(t,function(t){var i=$(t);return i.appendTo(n),i});throw new Error("No rendering provider found for artifact type");})},n.prototype.getTelemetryMentionSummary=function(n){return this.getRenderer(n).then(function(t){return t?t.getTelemetryMentionSummary(n):null})},n}();t.MentionsRenderer=h;v=function(){function n(n,t,i){this._artifactsLoader=n;this._queueWaitMSec=t;this._maxBatchSize=i;this._cache={};this._queue=[];this._keyPoppedFromQueue={}}return n.prototype.getArtifactPromise=function(n){var t,r;return typeof this._cache[n]!="undefined"?t=this._cache[n]:(r=i.defer(),t=r.promise,this._cache[n]=t,this._queue.push({key:n,deferred:r}),this._keyPoppedFromQueue[n]=!1,this._delayProcessQueue(n)),t},n.prototype._delayProcessQueue=function(n){var t=this;setTimeout(function(){return t._processQueue(n)},this._queueWaitMSec)},n.prototype._processQueue=function(n){var t,i,r;if(!this._keyPoppedFromQueue[n])while(this._queue.length>0){for(i=this._maxBatchSize,this._queue.length<=i?(t=this._queue,this._queue=[]):(t=this._queue.slice(0,i),this._queue=this._queue.slice(i)),r=0;r<t.length;r++)this._keyPoppedFromQueue[t[r].key]=!0;this._processBatch(t)}},n.prototype._processBatch=function(n){var i=n.map(function(n){return n.key}),t=this._artifactsLoader(i);n.forEach(function(n){if(t.hasOwnProperty(n.key)){var i=t[n.key];i.then(function(t){n.deferred.resolve(t)},function(){n.deferred.reject.apply(n.deferred,arguments)})}else n.deferred.reject(new Error("Artifact was missing from results of batch load."))})},n}();t.ArtifactsCache=v});
define("Mention/Scripts/MentionSyntaxProcessor",["require","exports","q","Presentation/Scripts/TFS/TFS.Core.Utils","Mention/Scripts/TFS.Mention"],function(n,t,i,r,u){Object.defineProperty(t,"__esModule",{value:!0});var f=function(){function n(n){n===void 0&&(n=u.MentionProcessor.getDefault());this._mentionProcessor=n}return n.prototype.preProcess=function(n){var t=this;return this._mentionProcessor.parseInput(n).then(function(n){for(var e,h,c,o=[],f=0,s=n;f<s.length;f++)e=s[f],e.Type===u.TextPartType.Mention&&(h=$("<span><\/span>"),c=t._mentionProcessor.getMentionsRenderer().renderMention(h,e),o.push(i(c)));return i.allSettled(o).then(function(i){var o=0,s="",f,h,e,c;for(t._replacementMap={},f=0,h=n;f<h.length;f++)e=h[f],e.Type===u.TextPartType.Mention&&i[o].state==="fulfilled"?(c=r.GUIDUtils.newGuid().replace(new RegExp("-","g"),""),t._replacementMap[c]=i[o].value,s+=c):s+=e.Text,e.Type===u.TextPartType.Mention&&o++;return s})})},n.prototype.postProcess=function(n){var f=this._replacementMap,e,i,o,r,s,u,h,t,c;if(!f)return n;for(e=Object.keys(f),i=0,o=e;i<o.length;i++)t=o[i],r=n.lastIndexOf(t),r>0&&(n=n.substring(0,r)+("<mention id='"+t+"'/>")+n.substring(r+t.length));for(s=$(n),u=0,h=e;u<h.length;u++)t=h[u],c=s.find("mention#"+t),c&&c.replaceWith(f[t]);return $("<div>").append(s).html()},n}();t.MentionSyntaxProcessor=f});
/*!
 * jQuery UI Menu 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/menu/
 */
(function (n) { typeof define == "function" && define.amd ? define("jQueryUI/menu",["jquery", "./core", "./widget", "./position"], n) : n(jQuery) })(function (n) { return n.widget("ui.menu", { version: "1.11.4", defaultElement: "<ul>", delay: 300, options: { icons: { submenu: "ui-icon-carat-1-e" }, items: "> *", menus: "ul", position: { my: "left-1 top", at: "right top" }, role: "menu", blur: null, focus: null, select: null }, _create: function () { this.activeMenu = this.element; this.mouseHandled = !1; this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content").toggleClass("ui-menu-icons", !!this.element.find(".ui-icon").length).attr({ role: this.options.role, tabIndex: 0 }); this.options.disabled && this.element.addClass("ui-state-disabled").attr("aria-disabled", "true"); this._on({ "mousedown .ui-menu-item": function (n) { n.preventDefault() }, "click .ui-menu-item": function (t) { var i = n(t.target); !this.mouseHandled && i.not(".ui-state-disabled").length && (this.select(t), t.isPropagationStopped() || (this.mouseHandled = !0), i.has(".ui-menu").length ? this.expand(t) : !this.element.is(":focus") && n(this.document[0].activeElement).closest(".ui-menu").length && (this.element.trigger("focus", [!0]), this.active && this.active.parents(".ui-menu").length === 1 && clearTimeout(this.timer))) }, "mouseenter .ui-menu-item": function (t) { if (!this.previousFilter) { var i = n(t.currentTarget); i.siblings(".ui-state-active").removeClass("ui-state-active"); this.focus(t, i) } }, mouseleave: "collapseAll", "mouseleave .ui-menu": "collapseAll", focus: function (n, t) { var i = this.active || this.element.find(this.options.items).eq(0); t || this.focus(n, i) }, blur: function (t) { this._delay(function () { n.contains(this.element[0], this.document[0].activeElement) || this.collapseAll(t) }) }, keydown: "_keydown" }); this.refresh(); this._on(this.document, { click: function (n) { this._closeOnDocumentClick(n) && this.collapseAll(n); this.mouseHandled = !1 } }) }, _destroy: function () { this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-menu-icons ui-front").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(); this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").removeUniqueId().removeClass("ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function () { var t = n(this); t.data("ui-menu-submenu-carat") && t.remove() }); this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content") }, _keydown: function (t) { var i, u, r, f, e = !0; switch (t.keyCode) { case n.ui.keyCode.PAGE_UP: this.previousPage(t); break; case n.ui.keyCode.PAGE_DOWN: this.nextPage(t); break; case n.ui.keyCode.HOME: this._move("first", "first", t); break; case n.ui.keyCode.END: this._move("last", "last", t); break; case n.ui.keyCode.UP: this.previous(t); break; case n.ui.keyCode.DOWN: this.next(t); break; case n.ui.keyCode.LEFT: this.collapse(t); break; case n.ui.keyCode.RIGHT: this.active && !this.active.is(".ui-state-disabled") && this.expand(t); break; case n.ui.keyCode.ENTER: case n.ui.keyCode.SPACE: this._activate(t); break; case n.ui.keyCode.ESCAPE: this.collapse(t); break; default: e = !1; u = this.previousFilter || ""; r = String.fromCharCode(t.keyCode); f = !1; clearTimeout(this.filterTimer); r === u ? f = !0 : r = u + r; i = this._filterMenuItems(r); i = f && i.index(this.active.next()) !== -1 ? this.active.nextAll(".ui-menu-item") : i; i.length || (r = String.fromCharCode(t.keyCode), i = this._filterMenuItems(r)); i.length ? (this.focus(t, i), this.previousFilter = r, this.filterTimer = this._delay(function () { delete this.previousFilter }, 1e3)) : delete this.previousFilter } e && t.preventDefault() }, _activate: function (n) { this.active.is(".ui-state-disabled") || (this.active.is("[aria-haspopup='true']") ? this.expand(n) : this.select(n)) }, refresh: function () { var i, t, u = this, f = this.options.icons.submenu, r = this.element.find(this.options.menus); this.element.toggleClass("ui-menu-icons", !!this.element.find(".ui-icon").length); r.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-front").hide().attr({ role: this.options.role, "aria-hidden": "true", "aria-expanded": "false" }).each(function () { var t = n(this), i = t.parent(), r = n("<span>").addClass("ui-menu-icon ui-icon " + f).data("ui-menu-submenu-carat", !0); i.attr("aria-haspopup", "true").prepend(r); t.attr("aria-labelledby", i.attr("id")) }); i = r.add(this.element); t = i.find(this.options.items); t.not(".ui-menu-item").each(function () { var t = n(this); u._isDivider(t) && t.addClass("ui-widget-content ui-menu-divider") }); t.not(".ui-menu-item, .ui-menu-divider").addClass("ui-menu-item").uniqueId().attr({ tabIndex: -1, role: this._itemRole() }); t.filter(".ui-state-disabled").attr("aria-disabled", "true"); this.active && !n.contains(this.element[0], this.active[0]) && this.blur() }, _itemRole: function () { return { menu: "menuitem", listbox: "option" }[this.options.role] }, _setOption: function (n, t) { n === "icons" && this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(t.submenu); n === "disabled" && this.element.toggleClass("ui-state-disabled", !!t).attr("aria-disabled", t); this._super(n, t) }, focus: function (n, t) { var i, r; this.blur(n, n && n.type === "focus"); this._scrollIntoView(t); this.active = t.first(); r = this.active.addClass("ui-state-focus").removeClass("ui-state-active"); this.options.role && this.element.attr("aria-activedescendant", r.attr("id")); this.active.parent().closest(".ui-menu-item").addClass("ui-state-active"); n && n.type === "keydown" ? this._close() : this.timer = this._delay(function () { this._close() }, this.delay); i = t.children(".ui-menu"); i.length && n && /^mouse/.test(n.type) && this._startOpening(i); this.activeMenu = t.parent(); this._trigger("focus", n, { item: t }) }, _scrollIntoView: function (t) { var e, o, i, r, u, f; this._hasScroll() && (e = parseFloat(n.css(this.activeMenu[0], "borderTopWidth")) || 0, o = parseFloat(n.css(this.activeMenu[0], "paddingTop")) || 0, i = t.offset().top - this.activeMenu.offset().top - e - o, r = this.activeMenu.scrollTop(), u = this.activeMenu.height(), f = t.outerHeight(), i < 0 ? this.activeMenu.scrollTop(r + i) : i + f > u && this.activeMenu.scrollTop(r + i - u + f)) }, blur: function (n, t) { (t || clearTimeout(this.timer), this.active) && (this.active.removeClass("ui-state-focus"), this.active = null, this._trigger("blur", n, { item: this.active })) }, _startOpening: function (n) { (clearTimeout(this.timer), n.attr("aria-hidden") === "true") && (this.timer = this._delay(function () { this._close(); this._open(n) }, this.delay)) }, _open: function (t) { var i = n.extend({ of: this.active }, this.options.position); clearTimeout(this.timer); this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden", "true"); t.show().removeAttr("aria-hidden").attr("aria-expanded", "true").position(i) }, collapseAll: function (t, i) { clearTimeout(this.timer); this.timer = this._delay(function () { var r = i ? this.element : n(t && t.target).closest(this.element.find(".ui-menu")); r.length || (r = this.element); this._close(r); this.blur(t); this.activeMenu = r }, this.delay) }, _close: function (n) { n || (n = this.active ? this.active.parent() : this.element); n.find(".ui-menu").hide().attr("aria-hidden", "true").attr("aria-expanded", "false").end().find(".ui-state-active").not(".ui-state-focus").removeClass("ui-state-active") }, _closeOnDocumentClick: function (t) { return !n(t.target).closest(".ui-menu").length }, _isDivider: function (n) { return !/[^\-\u2014\u2013\s]/.test(n.text()) }, collapse: function (n) { var t = this.active && this.active.parent().closest(".ui-menu-item", this.element); t && t.length && (this._close(), this.focus(n, t)) }, expand: function (n) { var t = this.active && this.active.children(".ui-menu ").find(this.options.items).first(); t && t.length && (this._open(t.parent()), this._delay(function () { this.focus(n, t) })) }, next: function (n) { this._move("next", "first", n) }, previous: function (n) { this._move("prev", "last", n) }, isFirstItem: function () { return this.active && !this.active.prevAll(".ui-menu-item").length }, isLastItem: function () { return this.active && !this.active.nextAll(".ui-menu-item").length }, _move: function (n, t, i) { var r; this.active && (r = n === "first" || n === "last" ? this.active[n === "first" ? "prevAll" : "nextAll"](".ui-menu-item").eq(-1) : this.active[n + "All"](".ui-menu-item").eq(0)); r && r.length && this.active || (r = this.activeMenu.find(this.options.items)[t]()); this.focus(i, r) }, nextPage: function (t) { var i, r, u; if (!this.active) { this.next(t); return } this.isLastItem() || (this._hasScroll() ? (r = this.active.offset().top, u = this.element.height(), this.active.nextAll(".ui-menu-item").each(function () { return i = n(this), i.offset().top - r - u < 0 }), this.focus(t, i)) : this.focus(t, this.activeMenu.find(this.options.items)[this.active ? "last" : "first"]())) }, previousPage: function (t) { var i, r, u; if (!this.active) { this.next(t); return } this.isFirstItem() || (this._hasScroll() ? (r = this.active.offset().top, u = this.element.height(), this.active.prevAll(".ui-menu-item").each(function () { return i = n(this), i.offset().top - r + u > 0 }), this.focus(t, i)) : this.focus(t, this.activeMenu.find(this.options.items).first())) }, _hasScroll: function () { return this.element.outerHeight() < this.element.prop("scrollHeight") }, select: function (t) { this.active = this.active || n(t.target).closest(".ui-menu-item"); var i = { item: this.active }; this.active.has(".ui-menu").length || this.collapseAll(t, !0); this._trigger("select", t, i) }, _filterMenuItems: function (t) { var i = t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&"), r = new RegExp("^" + i, "i"); return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function () { return r.test(n.trim(n(this).text())) }) } }) });
/*!
 * jQuery UI Autocomplete 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/autocomplete/
 */
(function (n) { typeof define == "function" && define.amd ? define("jQueryUI/autocomplete",["jquery", "./core", "./widget", "./position", "./menu"], n) : n(jQuery) })(function (n) { return n.widget("ui.autocomplete", { version: "1.11.4", defaultElement: "<input>", options: { appendTo: null, autoFocus: !1, delay: 300, minLength: 1, position: { my: "left top", at: "left bottom", collision: "none" }, source: null, change: null, close: null, focus: null, open: null, response: null, search: null, select: null }, requestIndex: 0, pending: 0, _create: function () { var t, i, r, u = this.element[0].nodeName.toLowerCase(), f = u === "textarea", e = u === "input"; this.isMultiLine = f ? !0 : e ? !1 : this.element.prop("isContentEditable"); this.valueMethod = this.element[f || e ? "val" : "text"]; this.isNewMenu = !0; this.element.addClass("ui-autocomplete-input").attr("autocomplete", "off"); this._on(this.element, { keydown: function (u) { if (this.element.prop("readOnly")) { t = !0; r = !0; i = !0; return } t = !1; r = !1; i = !1; var f = n.ui.keyCode; switch (u.keyCode) { case f.PAGE_UP: t = !0; this._move("previousPage", u); break; case f.PAGE_DOWN: t = !0; this._move("nextPage", u); break; case f.UP: t = !0; this._keyEvent("previous", u); break; case f.DOWN: t = !0; this._keyEvent("next", u); break; case f.ENTER: this.menu.active && (t = !0, u.preventDefault(), this.menu.select(u)); break; case f.TAB: this.menu.active && this.menu.select(u); break; case f.ESCAPE: this.menu.element.is(":visible") && (this.isMultiLine || this._value(this.term), this.close(u), u.preventDefault()); break; default: i = !0; this._searchTimeout(u) } }, keypress: function (r) { if (t) { t = !1; (!this.isMultiLine || this.menu.element.is(":visible")) && r.preventDefault(); return } if (!i) { var u = n.ui.keyCode; switch (r.keyCode) { case u.PAGE_UP: this._move("previousPage", r); break; case u.PAGE_DOWN: this._move("nextPage", r); break; case u.UP: this._keyEvent("previous", r); break; case u.DOWN: this._keyEvent("next", r) } } }, input: function (n) { if (r) { r = !1; n.preventDefault(); return } this._searchTimeout(n) }, focus: function () { this.selectedItem = null; this.previous = this._value() }, blur: function (n) { if (this.cancelBlur) { delete this.cancelBlur; return } clearTimeout(this.searching); this.close(n); this._change(n) } }); this._initSource(); this.menu = n("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({ role: null }).hide().menu("instance"); this._on(this.menu.element, { mousedown: function (t) { t.preventDefault(); this.cancelBlur = !0; this._delay(function () { delete this.cancelBlur }); var i = this.menu.element[0]; n(t.target).closest(".ui-menu-item").length || this._delay(function () { var t = this; this.document.one("mousedown", function (r) { r.target === t.element[0] || r.target === i || n.contains(i, r.target) || t.close() }) }) }, menufocus: function (t, i) { var r, u; if (this.isNewMenu && (this.isNewMenu = !1, t.originalEvent && /^mouse/.test(t.originalEvent.type))) { this.menu.blur(); this.document.one("mousemove", function () { n(t.target).trigger(t.originalEvent) }); return } u = i.item.data("ui-autocomplete-item"); !1 !== this._trigger("focus", t, { item: u }) && t.originalEvent && /^key/.test(t.originalEvent.type) && this._value(u.value); r = i.item.attr("aria-label") || u.value; r && n.trim(r).length && (this.liveRegion.children().hide(), n("<div>").text(r).appendTo(this.liveRegion)) }, menuselect: function (n, t) { var i = t.item.data("ui-autocomplete-item"), r = this.previous; this.element[0] !== this.document[0].activeElement && (this.element.focus(), this.previous = r, this._delay(function () { this.previous = r; this.selectedItem = i })); !1 !== this._trigger("select", n, { item: i }) && this._value(i.value); this.term = this._value(); this.close(n); this.selectedItem = i } }); this.liveRegion = n("<span>", { role: "status", "aria-live": "assertive", "aria-relevant": "additions" }).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body); this._on(this.window, { beforeunload: function () { this.element.removeAttr("autocomplete") } }) }, _destroy: function () { clearTimeout(this.searching); this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"); this.menu.element.remove(); this.liveRegion.remove() }, _setOption: function (n, t) { this._super(n, t); n === "source" && this._initSource(); n === "appendTo" && this.menu.element.appendTo(this._appendTo()); n === "disabled" && t && this.xhr && this.xhr.abort() }, _appendTo: function () { var t = this.options.appendTo; return t && (t = t.jquery || t.nodeType ? n(t) : this.document.find(t).eq(0)), t && t[0] || (t = this.element.closest(".ui-front")), t.length || (t = this.document[0].body), t }, _initSource: function () { var i, r, t = this; n.isArray(this.options.source) ? (i = this.options.source, this.source = function (t, r) { r(n.ui.autocomplete.filter(i, t.term)) }) : typeof this.options.source == "string" ? (r = this.options.source, this.source = function (i, u) { t.xhr && t.xhr.abort(); t.xhr = n.ajax({ url: r, data: i, dataType: "json", success: function (n) { u(n) }, error: function () { u([]) } }) }) : this.source = this.options.source }, _searchTimeout: function (n) { clearTimeout(this.searching); this.searching = this._delay(function () { var t = this.term === this._value(), i = this.menu.element.is(":visible"), r = n.altKey || n.ctrlKey || n.metaKey || n.shiftKey; t && (!t || i || r) || (this.selectedItem = null, this.search(null, n)) }, this.options.delay) }, search: function (n, t) { return (n = n != null ? n : this._value(), this.term = this._value(), n.length < this.options.minLength) ? this.close(t) : this._trigger("search", t) === !1 ? void 0 : this._search(n) }, _search: function (n) { this.pending++; this.element.addClass("ui-autocomplete-loading"); this.cancelSearch = !1; this.source({ term: n }, this._response()) }, _response: function () { var t = ++this.requestIndex; return n.proxy(function (n) { t === this.requestIndex && this.__response(n); this.pending--; this.pending || this.element.removeClass("ui-autocomplete-loading") }, this) }, __response: function (n) { n && (n = this._normalize(n)); this._trigger("response", null, { content: n }); !this.options.disabled && n && n.length && !this.cancelSearch ? (this._suggest(n), this._trigger("open")) : this._close() }, close: function (n) { this.cancelSearch = !0; this._close(n) }, _close: function (n) { this.menu.element.is(":visible") && (this.menu.element.hide(), this.menu.blur(), this.isNewMenu = !0, this._trigger("close", n)) }, _change: function (n) { this.previous !== this._value() && this._trigger("change", n, { item: this.selectedItem }) }, _normalize: function (t) { return t.length && t[0].label && t[0].value ? t : n.map(t, function (t) { return typeof t == "string" ? { label: t, value: t } : n.extend({}, t, { label: t.label || t.value, value: t.value || t.label }) }) }, _suggest: function (t) { var i = this.menu.element.empty(); this._renderMenu(i, t); this.isNewMenu = !0; this.menu.refresh(); i.show(); this._resizeMenu(); i.position(n.extend({ of: this.element }, this.options.position)); this.options.autoFocus && this.menu.next() }, _resizeMenu: function () { var n = this.menu.element; n.outerWidth(Math.max(n.width("").outerWidth() + 1, this.element.outerWidth())) }, _renderMenu: function (t, i) { var r = this; n.each(i, function (n, i) { r._renderItemData(t, i) }) }, _renderItemData: function (n, t) { return this._renderItem(n, t).data("ui-autocomplete-item", t) }, _renderItem: function (t, i) { return n("<li>").text(i.label).appendTo(t) }, _move: function (n, t) { if (!this.menu.element.is(":visible")) { this.search(null, t); return } if (this.menu.isFirstItem() && /^previous/.test(n) || this.menu.isLastItem() && /^next/.test(n)) { this.isMultiLine || this._value(this.term); this.menu.blur(); return } this.menu[n](t) }, widget: function () { return this.menu.element }, _value: function () { return this.valueMethod.apply(this.element, arguments) }, _keyEvent: function (n, t) { (!this.isMultiLine || this.menu.element.is(":visible")) && (this._move(n, t), t.preventDefault()) } }), n.extend(n.ui.autocomplete, { escapeRegex: function (n) { return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&") }, filter: function (t, i) { var r = new RegExp(n.ui.autocomplete.escapeRegex(i), "i"); return n.grep(t, function (n) { return r.test(n.label || n.value || n) }) } }), n.widget("ui.autocomplete", n.ui.autocomplete, { options: { messages: { noResults: "No search results.", results: function (n) { return n + (n > 1 ? " results are" : " result is") + " available, use up and down arrow keys to navigate." } } }, __response: function (t) { var i; (this._superApply(arguments), this.options.disabled || this.cancelSearch) || (i = t && t.length ? this.options.messages.results(t.length) : this.options.messages.noResults, this.liveRegion.children().hide(), n("<div>").text(i).appendTo(this.liveRegion)) } }), n.ui.autocomplete });
// Copyright (C) Microsoft Corporation. All rights reserved.
define("Mention/Scripts/TFS.Mention.Helpers",["require","exports","VSS/Utils/Core","Presentation/Scripts/TFS/TFS.Host.TfsContext","jQueryUI/autocomplete"],function(n,t,i,r){function h(n,t,i,r){var h;if(typeof n=="undefined"||n===null||t===null||!t.length)return{found:{},highlightedSource:n};t=t.slice(0,e);var c=n.toUpperCase(),l=t.map(function(n){return $.ui.autocomplete.escapeRegex(n)}),o,f={},s=!1;return i===u.Prefix?(t.forEach(function(n){c.indexOf(n.toUpperCase())===0?(s=!0,f[n]=!0):f[n]=!1}),o=new RegExp("^("+l.join("|")+")","ig")):i===u.Contains&&(t.forEach(function(n){c.indexOf(n.toUpperCase())>=0?(s=!0,f[n]=!0):f[n]=!1}),o=new RegExp(l.join("|"),"ig")),h="",h=s&&r?n.replace(o,r):n,{found:f,highlightedSource:h}}function o(){return window.parent!==window}function s(){try{if(o()&&window.parent.TfsMentionHelpers)return window.parent.TfsMentionHelpers.getDefaultTfsContext()}catch(n){}return f.getDefaultTfsContext()}function c(){var n;try{n=s()}catch(t){n=null}return!!n}function l(n,t){return i.delegate(n,t)}function a(n,t,r){var u,f=i.throttledDelegate(n,t,function(){var t=u;u=null;r.apply(n,t)});return function(){return u=arguments,f()}}function v(){return window.location}function y(n){return $("<div>").html(n).text()}function p(n){if(!n)return null;var t=n.ownerDocument;return t?t.defaultView||t.parentWindow:null}function w(n){return n.charCode?!0:!1}var e,u,f;Object.defineProperty(t,"__esModule",{value:!0});e=10,function(n){n[n.Contains=0]="Contains";n[n.Prefix=1]="Prefix"}(u=t.SearchBehavior||(t.SearchBehavior={}));t.searchString=h;t.hasParentWindow=o;t.getMainTfsContext=s;t.environmentIsSupported=c;t.delegate=l;t.throttledDelegate=a;t.getWindowLocation=v;t.convertHtmlToText=y;t.getWindow=p,function(n){function t(){return r.TfsContext.getDefault()}n.getDefaultTfsContext=t}(f=t.TfsMentionHelpers||(t.TfsMentionHelpers={}));t.eventHasPrintableCharacter=w;window.TfsMentionHelpers=f});
define("Mention/Scripts/Resources/TFS.Resources.Mention",["require","exports"],function(require,exports){var e=exports;e.PullRequestText="Pull Request {0}";e.WorkItemMentionOptionSelected="{0}. Selected";e.AutocompleteServerError="Error loading suggestions";e.DiscussionMentionWorkItemTip="workitems (#)";e.AutocompleteSuggestionsPlural="Showing {0} suggestions";e.AutocompleteSuggestionsSingular="Showing {0} suggestion";e.AutocompleteNoSuggestions="No suggestions found";e.DiscussionShowMoreRetrievalError="Unable to show more comments";e.GitPullRequestMentionWorkItemDiscussionMessageFormat="Mentioned in {0}";e.AutocompleteLoading="Loading suggestions";e.DiscussionStateTextFormat="({0} of {1})";e.DiscussionMentionPersonTip="people (@)";e.DiscussionUserCommentedTextFormat="commented {0}";e.DiscussionShowMoreLinkText="Show more";});

// Copyright (C) Microsoft Corporation. All rights reserved.
define("Mention/Scripts/TFS.Mention.Autocomplete.JQueryAutocomplete",["require","exports","VSS/Utils/Accessibility","VSS/Diag","VSS/Utils/UI","VSS/Utils/String","Mention/Scripts/TFS.Mention.Helpers","Mention/Scripts/Resources/TFS.Resources.Mention","VSS/Utils/Core","jQueryUI/autocomplete"],function(n,t,i,r,u,f,e,o,s){var l,c,h,a;Object.defineProperty(t,"__esModule",{value:!0}),function(n){function t(n,i){var r=null,u;return n&&(u=/^key(down|up|press)$/i.test(n.type),u?r=n:n.originalEvent&&i&&i>0&&(r=t(n.originalEvent,i-1))),r}function i(n){return n.textBeforeSelection+n.textInSelection+n.textAfterSelection}n.tryGetKeyboardEvent=t;n.getStringFromInputText=i}(l||(l={})),function(n){n.AUTOCOMPLETE_CONTAINER="mention-autocomplete-container";n.AUTOCOMPLETE_FOOTER="mention-autocomplete-footer";n.AUTOCOMPLETE_FOOTER_CONTENTS="mention-autocomplete-footer-contents";n.HIGHLIGHT="mention-autocomplete-highlight";n.AUTOCOMPLETE_NO_ITEMS_FOUND="mention-autocomplete-no-items";n.AUTOCOMPLETE_FOOTER_LOADING="mention-autocomplete-loading"}(c=t.CssClasses||(t.CssClasses={})),function(n){n[n.Suggestion=0]="Suggestion";n[n.Error=1]="Error";n[n.Empty=2]="Empty";n[n.Loading=3]="Loading"}(h||(h={}));a=function(){function n(n){this._isOpen=!1;this._options=n}return n.prototype.initialize=function(){var t=this,n;this._$inputElement=$("<input>").autocomplete({appendTo:this._getMenuContainer(),autoFocus:!0,source:e.delegate(this,this._autocompleteOnSource),select:e.delegate(this,this._autocompleteOnSelect),focus:e.delegate(this,this._autocompleteOnFocus),open:e.delegate(this,this._autocompleteOnOpen),close:e.delegate(this,this._autocompleteOnClose),messages:{noResults:"",results:function(){return""}}});this._$inputElement.on("keydown keypress",function(n){e.eventHasPrintableCharacter(n)||(n.keyCode===u.KeyCode.UP||n.keyCode===u.KeyCode.DOWN||n.keyCode===u.KeyCode.PAGE_UP||n.keyCode===u.KeyCode.PAGE_DOWN)&&t._handleAutocompleteReset(n)});this._$menuContainer.on("mousewheel",function(n){n.stopPropagation()});n=this._getAutocompleteInstance();n._resizeMenu=e.delegate(this,this._autocompleteResizeMenu);n._renderMenu=e.delegate(this,this._autocompleteRenderMenu);n._renderItem=e.delegate(this,this._autocompleteRenderItem)},n.prototype.__test=function(){return{_$footer:this._$footer}},n.prototype.prefetch=function(){},n.prototype.getPluginName=function(){throw new Error("Not implemented");},n.prototype.canOpen=function(){throw new Error("Not implemented");},n.prototype.getSuggestions=function(){throw new Error("Not Implemented");},n.prototype.renderSuggestion=function(){throw new Error("Not Implemented");},n.prototype.getReplacementText=function(){throw new Error("Not Implemented");},n.prototype.getReplacementHtml=function(){throw new Error("Not Implemented");},n.prototype.afterRender=function(){},n.prototype.onClose=function(){},n.prototype.dispose=function(){this._$inputElement&&(this._$inputElement.autocomplete("destroy"),this._$inputElement.remove(),this._$inputElement=null);this._$menuContainer&&(this._$menuContainer.remove(),this._$menuContainer=null);this._options=null},n.prototype.getOptions=function(){return this._options},n.prototype.open=function(n,t){this._inputText=t;this._isOpen=!0},n.prototype.suggest=function(n,t){var i=$.Deferred();return this._inputText=t,this._$inputElement.val(l.getStringFromInputText(t)),this._$inputElement.autocomplete("search",i,n),i},n.prototype.close=function(n,t){this._inputText=t;this._$inputElement.autocomplete("close",n);this._isOpen=!1},n.prototype.handle=function(n){this._$inputElement.trigger(n)},n.prototype.isOpen=function(){return this._isOpen},n.prototype._getMenuContainer=function(){if(!this._$menuContainer){var n=this._options.menuContainer().length?this._options.menuContainer():$(document.body);this._$menuContainer=$("<div>").addClass(c.AUTOCOMPLETE_CONTAINER).appendTo(n)}return this._$menuContainer},n.prototype._getMenuMaxHeight=function(){return this._options.menuMaxHeight||n.DEFAULT_MENU_MAX_HEIGHT},n.prototype._getAutocompleteInstance=function(){return this._$inputElement.data("ui-autocomplete")},n.prototype._applySuggestionToTextBox=function(n,t,i){var f=this,e={selectionIndex:""+t.index},r=this.getReplacementText(this._inputText,t.suggestion,i),u;this._$inputElement.val(l.getStringFromInputText(r));u={getPlainText:function(){return r},getHtml:function(){return f.getReplacementHtml(t.suggestion)}};i?this._options.focus&&this._options.focus(n,u):(this._inputText=r,this._options.select&&this._options.select(n,u,e))},n.prototype._handleAutocompleteReset=function(n){var r=l.getStringFromInputText(this._inputText),u=this._$inputElement.val(),t,i;u===r&&this._options.focus&&(t=this._inputText,i={getPlainText:function(){return t},getHtml:function(){return""}},this._options.focus(n,i))},n.prototype._getMentionTextArea=function(){return this._options.textElement?this._options.textElement():null},n.prototype._autocompleteResizeMenu=function(){var r=this,t=$(this._getAutocompleteInstance().menu.element),i=this._options.positioningElement?typeof this._options.positioningElement=="function"?this._options.positioningElement():this._options.positioningElement:this._getMenuContainer(),p=this._options.isMenuWidthOverridable&&this._options.menuWidth?this._options.menuWidth:i.innerWidth(),u,f,s;t.width(p);u=$(">:first:visible",t);f=Math.max(i.zIndex()*1+1,n.MIN_MENU_ZINDEX);t.css("z-index",f);var h=i.offset(),c=h.top-$(window).scrollTop(),w=$(window).height()-c-i.outerHeight(!1)-n.MENU_FOOTER_HEIGHT,e=c>this._getMenuMaxHeight()&&this._getMenuMaxHeight()>w,o=0;if(this._options.allowHorizontalShift){var b=h.left-$(window).scrollLeft(),l=$(window).width()-b,a=t.outerWidth();o=a<l?0:a-l}if(s=function(o){$(this).css(o);r._$footer.css("z-index",f);r._$footer.width(t.width());r._$footer.height(n.MENU_FOOTER_HEIGHT);r._$footer.show();u.length>0?r._$footer.position({my:"left top-1",at:"left bottom",collision:"none",of:t}):r._$footer.position({my:"left "+(e?"bottom":"top"),at:"left "+(e?"top":"bottom"),collision:"none",of:i})},e?this._$inputElement.autocomplete({position:{my:"left bottom",at:"left-"+o+" top-"+n.MENU_FOOTER_HEIGHT,collision:"none",of:i,using:s}}):this._$inputElement.autocomplete({position:{my:"left top",at:"left-"+o+" bottom",collision:"none",of:i,using:s}}),u.length>0){var k=u.position().top,v=$(">:last:visible",t),d=v.position().top+v.outerHeight(),y=d-k,g=y<=this._getMenuMaxHeight()?y:this._getMenuMaxHeight();t.height(g);this.afterRender(t);t.css("max-height","").css("overflow","")}else t.css("max-height",0).css("overflow","hidden")},n.prototype._renderFooter=function(n,t){return this._$footer||(this._$footer=$("<div>").addClass(c.AUTOCOMPLETE_FOOTER),t&&this._$footer.addClass(t),this._$footer.appendTo(this._$menuContainer).hide()),this._$footer.attr("class",c.AUTOCOMPLETE_FOOTER),t&&this._$footer.addClass(t),i.announce(n,!0),this._$footer.text(n)},n.prototype._autocompleteRenderMenu=function(n,t){var i=this._getAutocompleteInstance();n.addClass("mention-autocomplete-menu").attr("role","listbox");t[0].type===h.Suggestion?(t.forEach(function(t){i._renderItemData(n,t)}),this._renderFooter(this._getFooterItemsCountString(t.length),c.AUTOCOMPLETE_FOOTER_CONTENTS)):(this._addFakeAnchor(n,t[0]),t[0].type===h.Loading?this._renderFooter(o.AutocompleteLoading,c.AUTOCOMPLETE_FOOTER_LOADING):t[0].type===h.Empty?this._renderFooter(o.AutocompleteNoSuggestions,c.AUTOCOMPLETE_NO_ITEMS_FOUND):t[0].type===h.Error&&this._renderFooter(o.AutocompleteServerError))},n.prototype._getFooterItemsCountString=function(n){if(n===0)return o.AutocompleteNoSuggestions;var t=n===1?o.AutocompleteSuggestionsSingular:o.AutocompleteSuggestionsPlural;return f.format(t,n)},n.prototype._addFakeAnchor=function(n,t){var i=$("<li>").hide().appendTo(n).data("ui-autocomplete-item",t);$("<a>").appendTo(i)},n.prototype._autocompleteRenderItem=function(n,t){return this.renderSuggestion(n,t.suggestion).addClass("mention-autocomplete-item").attr("role","option").attr("aria-selected","false")},n.prototype._autocompleteOnSource=function(t,i){var r=t.term,u;if(r&&r.resolve||(r=null),!this._isOpen){this._getAutocompleteInstance().close();i(null);return}u=!1;this.getSuggestions(this._inputText).done(function(n){var f,t;u=!0;n?(f=n.result&&n.result.length?n.result.map(function(n,t){return{type:h.Suggestion,index:t,suggestion:n,error:null}}):[{type:h.Empty,index:null,suggestion:null,error:null}],r&&r.resolve(n),i(f)):(t=new Error("Suggestions is Null"),r&&r.reject(t),i([{type:h.Error,index:null,suggestion:null,error:t}]))}).fail(function(n){u=!0;r&&r.reject(n);i([{type:h.Error,index:null,suggestion:null,error:n}])});setTimeout(function(){u||i([{type:h.Loading,index:null,suggestion:null,error:null}])},n.LOADING_DELAY_TIME)},n.prototype._autocompleteOnFocus=function(n,t){var f=this,i,r,u;return t.item.type===h.Suggestion&&(this._applySuggestionToTextBox(n,t.item,!0),t.item.value=this._$inputElement.val(),$(".ui-helper-hidden-accessible").hide().attr("aria-live","off")),i=this._$menuContainer.find("ul"),i&&i.length&&(r=this._getMentionTextArea(),u=i.find(".mention-autocomplete-item"),u.each(function(n,t){var i=$(t);i.hasClass("ui-state-focus")?(i.attr("aria-selected","true"),r&&s.delay(f,0,function(){r.attr("aria-activedescendant",i.attr("id"))})):i.attr("aria-selected","false")})),!1},n.prototype._autocompleteOnSelect=function(n,t){return t.item.type===h.Suggestion&&this._applySuggestionToTextBox(n,t.item,!1),!1},n.prototype._autocompleteOnOpen=function(){var t=this._getMentionTextArea(),n=$(this._getAutocompleteInstance().menu.element);t&&n&&n.length&&t.attr({"aria-owns":n[0].id,"aria-expanded":"true","aria-autocomplete":"list"})},n.prototype._autocompleteOnClose=function(n){var r=$(this._getAutocompleteInstance().menu.element),t,i;if(r)this.onClose(r);this._$footer.hide();t=l.tryGetKeyboardEvent(n,5);t&&t.keyCode===u.KeyCode.ESCAPE&&this._handleAutocompleteReset(n);this._options.close&&this._options.close(n,this._inputText);i=this._getMentionTextArea();i&&i.attr({"aria-owns":null,"aria-autocomplete":null,"aria-activedescendant":null,"aria-expanded":"false"})},n.MENU_FOOTER_HEIGHT=20,n.DEFAULT_MENU_MAX_HEIGHT=200,n.LOADING_DELAY_TIME=100,n.MIN_MENU_ZINDEX=100,n}();t.JQueryAutocompletePlugin=a});
define("Mention/Scripts/TFS.Social.Telemetry",["require","exports","Mention/Scripts/TFS.Mention.Helpers","VSS/Telemetry/Services","VSS/VSS"],function(n,t,i,r,u){Object.defineProperty(t,"__esModule",{value:!0});var f=function(){function n(){}return n.MENTION_AREA="Mention",n.WORKITEMS_INITIALIZE_EVENT="WorkitemsInitialize",n.WORKITEMS_CLICK_EVENT="WorkitemsClick",n.PEOPLE_CLICK_EVENT="PeopleClick",n.AUTOCOMPLETE_OPEN_EVENT="AutocompleteOpen",n.AUTOCOMPLETE_SUGGEST_EVENT="AutocompleteSuggest",n.AUTOCOMPLETE_SELECT_EVENT="AutocompleteSelect",n.AUTOCOMPLETE_CANCEL_EVENT="AutocompleteCancel",n.MENTIONABLE_PREVIEW_EVENT="MentionablePreview",n.MENTIONABLE_EDIT_EVENT="MentionableEdit",n.SOCIAL_AREA="Social",n.DISCUSSION_RENDER_EVENT="DiscussionRender",n.DISCUSSION_SHOWMORE_EVENT="DiscussionShowMore",n}(),e=function(){function n(){}return n.publishAutocompleteOpenEvent=function(t){n.delayedPublish(f.AUTOCOMPLETE_OPEN_EVENT,t)},n.publishAutocompleteSuggestEvent=function(t){n.delayedPublish(f.AUTOCOMPLETE_SUGGEST_EVENT,t)},n.publishAutocompleteSelectEvent=function(t){n.delayedPublish(f.AUTOCOMPLETE_SELECT_EVENT,t)},n.publishAutocompleteCancelEvent=function(t){n.delayedPublish(f.AUTOCOMPLETE_CANCEL_EVENT,t)},n.publishWorkItemsInitializeEvent=function(t){n.delayedPublish(f.WORKITEMS_INITIALIZE_EVENT,t)},n.publishWorkItemsClickEvent=function(t){n.delayedPublish(f.WORKITEMS_CLICK_EVENT,t)},n.publishPeopleClickEvent=function(t){n.delayedPublish(f.PEOPLE_CLICK_EVENT,t)},n.publishMentionableEditEvent=function(t){n.delayedPublish(f.MENTIONABLE_EDIT_EVENT,t)},n.publishMentionablePreviewEvent=function(t){n.delayedPublish(f.MENTIONABLE_PREVIEW_EVENT,t)},n.publishDiscussionRenderEvent=function(t){n.delayedPublish(f.DISCUSSION_RENDER_EVENT,t,f.SOCIAL_AREA)},n.publishDiscussionShowMoreClickEvent=function(t){n.delayedPublish(f.DISCUSSION_SHOWMORE_EVENT,t,f.SOCIAL_AREA)},n._getTfsContext=function(){return n.tfsContext||(n.tfsContext=i.getMainTfsContext()),n.tfsContext},n._extendProperties=function(t){var i=n._getTfsContext().navigation.projectId;t=t||{};t.projectId=""+i},n.delayedPublish=function(t,i,u){u===void 0&&(u=f.MENTION_AREA);n._extendProperties(i);r.publishEvent(new r.TelemetryEventData(u,t,i))},n.publish=function(t,i){n._extendProperties(i);r.publishEvent(new r.TelemetryEventData(f.MENTION_AREA,t,i))},n}();t.EventLogging=e;u.tfsModuleLoaded("TFS.Social.Telemetry",t)});
define("Mention/Scripts/TFS.Mention.WorkItems",["require","exports","q","VSS/Diag","Mention/Scripts/TFS.Mention","Mention/Scripts/TFS.Mention.Autocomplete.JQueryAutocomplete","Mention/Scripts/TFS.Mention.Helpers","VSS/Service","Mention/Scripts/TFS.Social.Telemetry","Presentation/Scripts/URI","VSS/Utils/Array","VSS/Utils/String","VSS/VSS","Presentation/Scripts/TFS/Generated/TFS.WorkItemTracking.Constants","TFS/WorkItemTracking/RestClient","Presentation/Scripts/TFS/FeatureRef/WorkItemTypeColorAndIconsProvider","Presentation/Scripts/TFS/Components/WorkItemTypeIcon","VSS/Error"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){function ft(n){var r=e.getMainTfsContext(),s=r.getPermalinkUrl("edit","workitems",{parameters:n.id,collectionId:r.navigation.collection.instanceId}),t=new h(s),i,f,o;return t.host()||(i=e.getWindowLocation(),t.host(i.host),t.protocol(i.protocol)),f=k.getWorkItemTypeWithIdString(n),o=k.getWorkItemSummary(f,n.title),u.createHtmlMention(t.href(),o)}var rt,et,nt,ot,g,st,k,d,tt,it,ht,ut;Object.defineProperty(t,"__esModule",{value:!0}),function(n){n.ACTION_WORKITEM_OPEN="open-work-item";n.ACTION_WORKITEM_OPEN_IN_NEW_TAB="open-work-item-in-new-tab";n.EDITOR_CAPTION="{0} {1}";n.EDITOR_WINDOW_TITLE="{0}: {1}"}(rt=t.WorkItemConstants||(t.WorkItemConstants={})),function(n){n.MENTION_WIDGET_WORKITEM="mention-widget-workitem"}(et=t.CssClasses||(t.CssClasses={}));nt=function(){function n(){}return n.searchHighlightedWorkItem=function(t,i,r){r===void 0&&(r=n.DEFAULT_HIGHLIGHT_SUBSTITUTION_PATTERN);var f=i,u=t.split(/\s+/).filter(function(n){return!!n}).map(function(n){return l.htmlEncode(n)}),o=e.searchString(i.id.toString(),u,e.SearchBehavior.Prefix,r),s=e.searchString(l.htmlEncode(i.title),u,e.SearchBehavior.Contains,r),h=e.searchString(i.workItemType,u,e.SearchBehavior.Contains,r),c=!0;return u.forEach(function(n){var t=o.found[n]||s.found[n]||h.found[n];t||(c=!1)}),c&&(f={id:o.highlightedSource,title:s.highlightedSource,workItemType:h.highlightedSource}),f},n.DEFAULT_HIGHLIGHT_SUBSTITUTION_PATTERN='<span class="'+f.CssClasses.HIGHLIGHT+'">$&<\/span>',n}();t.Helpers=nt;ot=function(n){function t(i){var r=this,i=i||{};return i.isMenuWidthOverridable&&$.extend(i,{menuWidth:t.MENU_WIDTH}),r=n.call(this,i)||this,r._iconContainers=[],r}return __extends(t,n),t.prototype.getWorkItemProvider=function(){return this._workItemProvider||(this._workItemProvider=new d({wiql:this._options.wiql})),this._workItemProvider},t.prototype.prefetch=function(){this.getWorkItemProvider()},t.prototype.getPluginName=function(){return"WorkItemAutocompleteProvider"},t.prototype.canOpen=function(n){var t=this.mentionPattern().exec(n.textBeforeSelection),i;return t?(i=t.index,t[1]&&(i+=t[1].length),{start:i,end:n.textBeforeSelection.length}):null},t.prototype.getSuggestions=function(n){var f=$.Deferred(),i={},e=t._numberMentionPattern.exec(n.textBeforeSelection),r,u;return e?(i.searchTerm=e[2],r=this.getWorkItemProvider().searchById(e[2])):(u=this.mentionPattern().exec(n.textBeforeSelection),u?(i.searchTerm=u[2],r=this.getWorkItemProvider().search(u[2])):(i.searchTerm="",r=this.getWorkItemProvider().search(""))),r.done(function(n){i.suggestionsCount=""+n.length;f.resolve({result:n,telemetry:i})}).fail(function(n){f.reject(n)}),f},t.prototype.renderSuggestion=function(n,t){var i=$("<li>").appendTo(n),r=$("<a>").appendTo(i),f=$("<div>"),e=f[0];this._iconContainers.push(e);w.renderWorkItemTypeIcon(e,t.highlighted.workItemType,t.original.colorAndIcon,w.IconlessMode.ColorBar,{ariaAttributes:{}});r.append(f[0].innerHTML);var s=k.getWorkItemTypeWithIdString(t.highlighted),h=$("<span>").addClass(u.CssClasses.AUTOCOMPLETE_ID).html(s)[0].outerHTML,c=$("<span>").addClass(u.CssClasses.AUTOCOMPLETE_TITLE).html(t.highlighted.title)[0].outerHTML,o=$(k.getWorkItemSummary(h,c));return o.appendTo(r),i.attr("aria-label",o.text()),i},t.prototype.afterRender=function(n){$("a",n).each(function(n,t){t.clientWidth>=t.scrollWidth&&$(t).removeAttr("title")})},t.prototype.onClose=function(n){this._cleanup(n)},t.prototype._cleanup=function(){this._iconContainers.forEach(function(n){w.unmountWorkItemTypeIcon(n)});this._iconContainers=[]},t.prototype.getReplacementText=function(n,i,r){var u=this.mentionPattern().exec(n.textBeforeSelection),e=u.index+u[1].length+1,o=n.textBeforeSelection.substr(0,e),f=i.original.id.toString();return t._afterMentionPattern.exec(n.textAfterSelection)||(f+=" "),r?{textBeforeSelection:n.textBeforeSelection,textInSelection:"",textAfterSelection:n.textAfterSelection}:{textBeforeSelection:o+f,textInSelection:"",textAfterSelection:n.textAfterSelection}},t.prototype.getReplacementHtml=function(n){return ft(n.original)},t.prototype.getProviderName=function(){return"WorkItemAutocompleteProvider"},t.prototype.mentionPattern=function(){return this.isOpen()?t._multipleTermsMentionPattern:t._singleTermMentionPattern},t._numberMentionPattern=new RegExp("("+u.Constants.PATTERN_WORD_START_SEPARATOR+")#([0-9]*)$","i"),t._singleTermMentionPattern=new RegExp("("+u.Constants.PATTERN_WORD_START_SEPARATOR+")#(([^"+u.Constants.PATTERN_WORD_SEPARATOR+"]*)$)","i"),t._multipleTermsMentionPattern=new RegExp("("+u.Constants.PATTERN_WORD_START_SEPARATOR+")#(([^"+u.Constants.PATTERN_WORD_SEPARATOR+"]+\\s?){0,5}$)","i"),t._afterMentionPattern=new RegExp("^("+u.Constants.PATTERN_WORD_END_SEPARATOR+")","i"),t.MENU_WIDTH=450,t}(f.JQueryAutocompletePlugin);t.WorkItemAutocompleteProvider=ot;g=function(){function n(){}return n.getDefault=function(){return n._instance||(n._instance=new n),n._instance},n.prototype.getArtifactType=function(){return"WorkItem"},n.prototype._renderWorkItem=function(n,t){var i=$("<a>");w.renderWorkItemTypeIcon(i[0],n.workItemType,n.colorAndIcon,w.IconlessMode.ColorBar,{suppressTooltip:!0});var r=$("<span>").addClass("mention-widget-workitem-typeid").text(k.getWorkItemTypeWithIdString(n))[0].outerHTML,u=$("<span>").addClass("mention-widget-workitem-title").text(n.title)[0].outerHTML,f=k.getWorkItemSummary(r,u);return i.addClass(et.MENTION_WIDGET_WORKITEM).addClass("mention-link").attr("href",t).append(f)},n.prototype.renderMention=function(n,t,u){var f=this;return d.getInstance().getById(n.ArtifactId).then(function(r){var o;if(r===null)return o=$("<span>").text(n.Text)[0].outerHTML,t(o),i.reject(o);var h=e.getMainTfsContext(),c=h.getPermalinkUrl("edit","workitems",{parameters:n.ArtifactId,collectionId:h.navigation.collection.instanceId}),a=f._renderWorkItem(r,c),l=t(a);return l.click(function(){s.EventLogging.publishWorkItemsClickEvent({workItem:JSON.stringify(r)});var n=function(){ut.showWorkItem(r.id)};if(u&&u.onWorkItemClick)u.onWorkItemClick(r,c,n);else n();return!1}),l})},n.prototype.getTelemetryMentionSummary=function(n){return this.getArtifactType()+":"+n.ArtifactId},n}();t.WorkItemMentionsRenderingProvider=g;st=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.renderMention=function(n,t){return d.getInstance().getById(n.ArtifactId).then(function(r){var u,f,e,o;return r===null?(u=$("<span>").text(n.Text)[0].outerHTML,f=t(u),i.reject(f)):(e=ft(r),o=t(e),o)})},t}(g);t.WorkItemHtmlMentionsRenderingProvider=st;k=function(){function n(){}return n.getWorkItemTypeWithIdString=function(n){return l.format(rt.EDITOR_CAPTION,n.workItemType,n.id)},n.getWorkItemSummary=function(n,t){return l.format(rt.EDITOR_WINDOW_TITLE,n,t)},n}();d=function(){function n(t){var u=(new Date).getTime(),i,r;this._client=o.getClient(y.WorkItemTrackingHttpClient,e.getMainTfsContext().contextData);i=$.Deferred();r=$.Deferred();$.when(i,r).done(function(n,t){s.EventLogging.publishWorkItemsInitializeEvent({getMyAssignedWorkItemsDurationInMsec:(n-u).toString(),getWorkItemColorsProviderDurationInMsec:(t-u).toString()})});this._wiql=t!=null&&t.wiql!=null?t.wiql:n.DEFAULT_WIQL;this._myWorkItems=this.getMyWorkItems();this._myWorkItems.then(function(){i.resolve((new Date).getTime())});tt.getInstance()._witColorAndIconsProviderPromise.then(function(){r.resolve((new Date).getTime())})}return n.getInstance=function(){return n._instance||(n._instance=new n),n._instance},n.prototype.getArtifactType=function(){return"WorkItem"},n.prototype.getById=function(n){var i=parseInt(n),t=this.getWorkItemPromises([i]);if(t.length===1)return t[0];throw new Error("Expected GetWorkItemsByIds to return 1 promise.");},n.prototype.searchById=function(n){var t=$.Deferred(),r=parseInt(n),u=[],f=[],e=function(n,t){c.contains(f,n.id)||(f.push(n.id),u.push({original:n,highlighted:t}))},o=function(t){var i;t!==null&&(isNaN(r)?(i={id:t.id,colorAndIcon:t.colorAndIcon,workItemType:t.workItemType,title:l.htmlEncode(t.title)},e(t,i)):(i=nt.searchHighlightedWorkItem(n,t),i!==t&&e(t,i)))},s=this.getWorkItems([r]);return i.all([s,this._myWorkItems]).then(function(n){n.forEach(function(n){n.forEach(function(n){o(n)})});t.resolve(u)},function(){t.reject.apply(t,arguments)}),t.promise()},n.prototype.search=function(n){var t=$.Deferred();return this._myWorkItems.then(function(i){var r=[];i.forEach(function(t){var i=nt.searchHighlightedWorkItem(n,t);i!==t&&r.push({original:t,highlighted:i})});t.resolve(r)},function(){t.reject.apply(t,arguments)}),t.promise()},n.isValidWorkItemId=function(n){return n>=1&&n<=2147483647},n.prototype.getMyWorkItems=function(){return this._getWiqlResults(this._wiql,50)},n.prototype.getWorkItems=function(n){if(n.length===0)throw new Error("ids must contain elements.");return i.all(this.getWorkItemPromises(n))},n.prototype.getWorkItemPromises=function(t){return t.map(function(t){return n.isValidWorkItemId(t)?tt.getInstance().cache.getArtifactPromise(t):i(null)})},n.prototype._getWiqlResults=function(n,t){var u=this,r=i.defer(),f="SELECT ["+v.CoreFieldRefNames.Id+"] FROM WorkItems WHERE "+n;return this._client.queryByWiql({query:f},undefined,undefined,undefined,t).then(function(n){var t=$.map(n.workItems,function(n){return n.id});t.length===0?r.resolve([]):u.getWorkItems(t).then(function(n){r.resolve(n)},function(){r.reject.apply(r,arguments)})},function(n){r.reject(n)}),r.promise},n.QUEUE_WAIT_MSEC=10,n.MAX_BATCH_SIZE=50,n.DEFAULT_WIQL="(["+v.CoreFieldRefNames.AuthorizedAs+"] = @me\n                        AND ["+v.CoreFieldRefNames.AuthorizedDate+"] >= @today - 30)\n                    OR (["+v.CoreFieldRefNames.CreatedBy+"] = @me\n                        AND ["+v.CoreFieldRefNames.CreatedDate+"] >= @today - 30)\n                    OR (["+v.CoreFieldRefNames.AssignedTo+"] = @me\n                        AND ["+v.CoreFieldRefNames.AuthorizedDate+"] >= @today - 30)\n                    ORDER BY ["+v.CoreFieldRefNames.AuthorizedDate+"] DESC",n}();t.WorkItemProvider=d;tt=function(){function n(){var t=this,n;this.cache=new u.ArtifactsCache(function(n){return t._loadWorkItems(n)},d.QUEUE_WAIT_MSEC,d.MAX_BATCH_SIZE);this._client=o.getClient(y.WorkItemTrackingHttpClient,e.getMainTfsContext().contextData);n=this._getProjectName();this._witColorAndIconsProviderPromise=n?p.WorkItemTypeColorAndIconsProvider.getInstance().queueEnsureColorAndIconsArePopulated(n):i(null)}return n.getInstance=function(){return n._instance||(n._instance=new n),n._instance},n.prototype._loadWorkItems=function(n){var f=[v.CoreFieldRefNames.Id,v.CoreFieldRefNames.WorkItemType,v.CoreFieldRefNames.Title,v.CoreFieldRefNames.TeamProject],t={},u={};return n.forEach(function(n){t[n]=i.defer();u[n]=t[n].promise}),this._client.getWorkItems(n,f).then(function(u){var f=[],e=u.map(function(n){var r=n.fields,u=r[v.CoreFieldRefNames.WorkItemType],e=r[v.CoreFieldRefNames.TeamProject],i={id:r[v.CoreFieldRefNames.Id],workItemType:u,title:r[v.CoreFieldRefNames.Title],colorAndIcon:p.WorkItemTypeColorAndIcons.getDefault()};return f.push(i.id),p.WorkItemTypeColorAndIconsProvider.getInstance().getColorAndIconAsync(e,u).then(function(n){i.colorAndIcon=n;t[i.id].resolve(i)},function(n){t[i.id].resolve(i);b.publishErrorToTelemetry(n)})});return i.allSettled(e).then(function(){n.forEach(function(n){if(f.indexOf(n)===-1){var i="WorkItem #"+n+" not returned from server.";r.logWarning(i);t[n].resolve(null)}})})},function(i){a.handleError(i);n.forEach(function(n){t[n].reject(i)})}),u},n.prototype._getProjectName=function(){return e.getMainTfsContext().navigation.project||l.empty},n}();t.WorkItemProviderCache=tt;it=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.getDefault=function(){return t._instance||(t._instance=new t),t._instance},t.prototype.parseFromText=function(n){for(var r=[],f=new RegExp("("+u.Constants.PATTERN_WORD_START_SEPARATOR+")#([0-9]{1,10})(?=("+u.Constants.PATTERN_WORD_END_SEPARATOR+"))","ig"),t;t=f.exec(n);){var e=t.index,o=f.lastIndex,i=t[1];i&&i.length&&(e+=i.length);r.push({start:e,end:o,id:t[2]})}return r},t.prototype.parseFromUrl=function(n){for(var u=new h(n),t=u.segment(),r,i;t.shift()!=="_permalink";)if(!t.length)return;return r=t.shift(),i=+t.pop(),r==="_workitems"&&i>0?{workItemId:i}:void 0},t.prototype.parseFromHtml=function(n,t){var i=this,r=n.find('a[href*="/_permalink/_workitems/edit/"]['+u.Constants.HTML_MENTION_ATTR_NAME+'^="version"]');r.each(function(n,r){var u=$(r),f=i.parseFromUrl(u.attr("href"));f&&t(u,f)})},t.prototype.getArtifactType=function(){return"WorkItem"},t}(u.ArtifactMentionParser);t.WorkItemsMentionParser=it;ht=function(){function n(){}return n.processHtml=function(n,t){it.getDefault().parseFromHtml(n,function(n,i){var r={ArtifactId:i.workItemId.toString(),ArtifactType:"",Text:"",Type:u.TextPartType.Mention};g.getDefault().renderMention(r,function(n){return $("<span>").append(n)},t).then(function(t){n.replaceWith(t)})})},n}();t.WorkItemMentionProcessor=ht;u.MentionsRenderer.getDefault().registerProvider(g.getDefault);u.MentionProcessor.getDefault().registerParser(it.getDefault),function(n){function t(n){try{if(e.hasParentWindow()&&window.parent.TfsMentionWorkItemHelpers){var t=window.parent.TfsMentionWorkItemHelpers;t.showWorkItem(n);return}}catch(i){}a.requireModules(["WorkItemTracking/SharedScripts/WorkItemDialogShim"]).spread(function(t){t.showWorkItemById(n)})}n.showWorkItem=t}(ut=t.TfsMentionWorkItemHelpers||(t.TfsMentionWorkItemHelpers={}));t.createWorkItemHtmlMention=ft;window.TfsMentionWorkItemHelpers=ut});
define("VersionControl/Scripts/Controls/FileViewer",["require","exports","react-dom","Presentation/Scripts/TFS/TFS.ContentRendering","VSS/Controls","VSS/Controls/Dialogs","Presentation/Scripts/TFS/TFS.Discussion.Common","Presentation/Scripts/TFS/TFS.Discussion.OM","Presentation/Scripts/TFS/TFS.Extensions","VSS/Controls/Menus","VSS/Controls/Notifications","VSS/Events/Document","VSS/Controls/StatusIndicator","VSS/VSS","VSS/Utils/UI","Presentation/Scripts/TFS/TFS.Core.Utils","Presentation/Scripts/TFS/TFS.Host.TfsContext","VSS/Utils/Core","VSS/Utils/String","Presentation/Scripts/TFS/TFS.Core.Utils.VisualStudio","VSS/Context","VSS/Telemetry/Services","VersionControl/Scripts/TFS.VersionControl.Telemetry","VersionControl/Scenarios/EditorPreferences/EditorPreferences","VersionControl/Scripts/TFS.VersionControl.EditorExtensions","VersionControl/Scripts/RepositoryContext","VersionControl/Scripts/VersionControlPath","VersionControl/Scripts/CustomerIntelligenceConstants","VersionControl/Scripts/VersionControlUrls","VersionControl/Scripts/Controls/ControlsCommon","VersionControl/Scripts/Controls/SourceEditing","VersionControl/Scripts/Controls/SourceEditingDialogs","VersionControl/Scripts/Controls/SourceEditingEvents","VersionControl/Scripts/Resources/TFS.Resources.VersionControl","VersionControl/Scripts/TFS.VersionControl.VersionSpecs","VersionControl/Scripts/TFS.VersionControl.SourceRendering","VersionControl/Scripts/TFS.VersionControl.WikiLinkTransformer","VersionControl/Scripts/TFS.VersionControl.WikiImageTransformer","VersionControl/Scripts/Controls/FileViewerEditConfirmationDialog","VersionControl/Scripts/Controls/FileViewerEditPanel","VersionControl/Scripts/Controls/CreateBranchDialogLazy","VersionControl/Scripts/ExtensionActionHandler","VersionControl/Scripts/ExtensionViewerSupport","VersionControl/Scripts/Controls/ViewerConfigurerExtensionSupport","Dashboards/Scripts/Pinning.PushToDashboard","Dashboards/Scripts/Pinning.PushToDashboardConstants","Dashboards/Scripts/Pinning.WidgetDataForPinning","Mention/Scripts/MentionSyntaxProcessor","VSS/FeatureAvailability/Services","VSS/Common/Constants/Platform","ContentRendering/Markdown","q","VSS/LoaderPlugins/Css!VersionControlControls","Mention/Scripts/TFS.Mention.WorkItems","VSS/LoaderPlugins/Css!FileViewerMarkdownStyles"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt,pt,wt,bt,kt,dt,gt,ni,ti,ii,ri,ui,fi,ei,oi,si,hi){var vi;Object.defineProperty(t,"__esModule",{value:!0});var li=b.delegate,ci=y.domElem,ai=w.TfsContext,yi=function(n){function t(t){var i=n.call(this,t)||this;return i._discussionUpdatedListener=li(i,i.onDiscussionCommentsUpdated),i._discussionThreadControlManager=new o.DiscussionThreadControlManager(i._options.tfsContext),i._activeState=!0,i._isEditable=!1,i._isShowingDiff=!1,i._editorConfigOptions={},i._previewContentUserModesByExt={},i}return __extends(t,n),t.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,$.extend(t,{coreCssClass:"version-control-file-viewer vc-code-editor-viewer"}))},t.prototype.dispose=function(){this._discussionManager&&(this._discussionManager.removeDiscussionThreadsUpdatedListener(this._discussionUpdatedListener),this._discussionManager=null);this._discussionThreadControlManager&&(this._discussionThreadControlManager.dispose(),this._discussionThreadControlManager=null);n.prototype.dispose.call(this)},t.prototype.initialize=function(){var t,i;n.prototype.initialize.call(this);this._requestIndex=0;t=this._options.separateToolbarSelector;t?this._createMenus($(t)):this._createMenus($(ci("div","file-contents-menu toolbar")).appendTo(this._element));this._$fileContentsContainer=$(ci("div","file-contents-container")).appendTo(this._element);this._updateViewsToolbarDelegate=li(this,this._updateViewsToolbar);this._viewerTopOffset=0;this._scrollPositionListeners=[];this._selectionListeners=[];this._scrollPositionCallbacks=[];this._selectionCallbacks={};this._editorContentCallbacks={};this._showOpenInVS=!0;this._previewContentMode=!1;this._documentsEntryForDirtyCheck=l.getRunningDocumentsTable().add("FileViewer",this);this._editorPreferences=new it.EditorPreferences;i=this._options.contextMenuItems||[];i.push(this._editorPreferences.getContextMenuItem());this._options.contextMenuItems=i},t.prototype.isDirty=function(){return!!(this._editPanel&&this._editPanel.isDirty())},t.prototype.getDirtyDocumentTitles=function(){return this._item?[ft.getFileName(this._item.serverItem)]:[]},t.prototype.getPreviewContentMode=function(){return this._previewContentMode},t.prototype.setPreviewContentMode=function(n,i){i===void 0&&(i=!0);this._contentRenderer&&this._previewContentMode!==n&&(this._previewContentMode=n,this._item&&i&&(this._previewContentUserModesByExt[ft.getFileExtension(this._item.serverItem)]=n,this._updateViewer()),this._fire(t.EVENT_PREVIEW_MODE_CHANGED,{previewMode:n}))},t.prototype._dispose=function(){if(this._$previewContentContainer&&this._$previewContentContainer.length>0){var t=this._$previewContentContainer.get()[0];i.unmountComponentAtNode(t)}this.setChangeListNavigator(null);this._extensionHost&&(this._extensionHost.dispose(),this._extensionHost=null);this._documentsEntryForDirtyCheck&&(l.getRunningDocumentsTable().remove(this._documentsEntryForDirtyCheck),this._documentsEntryForDirtyCheck=null);n.prototype._dispose.call(this)},t.prototype.isEditable=function(){return this._isEditable},t.prototype.setActiveState=function(n,t){n!==this._activeState&&(this._activeState=n,n&&(this._viewerRefreshNeeded=!0),t||!this._extensionHost||this._usingFallbackEditor||this._setExternalEditorConfig())},t.prototype.setChangeListNavigator=function(n){this._changeListNavigator!==n&&(this._changeListNavigator&&(this._changeListNavigator.detachSourceChangedEvent(this._updateViewsToolbarDelegate),this._changeListNavigator=null),n&&(this._changeListNavigator=n,this._changeListNavigator.attachSourceChangedEvent(this._updateViewsToolbarDelegate)),this._updateViewsToolbar())},t.prototype.setExternalEditorCss=function(n,t){this._options.externalViewerCss!==n&&(this._options.externalViewerCss=n,t&&this._extensionHost&&this._setExternalEditorConfig())},t.prototype.suppressExternalEditorLayoutRefreshes=function(n){this._options.externalViewerSuppressLayout!==n&&(this._options.externalViewerSuppressLayout=n,this._extensionHost&&(this._setExternalEditorConfig(),n||this._extensionHost.postMessage(st.VersionControlExtensionActionIds.REFRESH_LAYOUT)))},t.prototype.setDiscussionManager=function(n,t,i){this._isDiscussionForLeftSide=i?!0:!1;this._discussionManager!==n&&(n||this._discussionManager)&&(this._viewerRefreshNeeded=!0,this._discussionManager&&this._discussionManager.removeDiscussionThreadsUpdatedListener(this._discussionUpdatedListener),this._discussionManager=n,n&&this._discussionManager.addDiscussionThreadsUpdatedListener(this._discussionUpdatedListener),this._discussionThreadControlManager.setDiscussionManager(this._discussionManager),t&&(this._extensionHost&&!this._usingFallbackEditor?this._setExternalEditorConfig():this._$builtInTextViewer&&this._$builtInTextViewer.length&&this._drawFileDiscussionThreads(),this._viewerRefreshNeeded=!1))},t.prototype._addFileLevelThread=function(n){var t=this;this._$fileLevelDiscussionsContainer&&v.using(["VersionControl/Scripts/Controls/DiffBuiltInDiffViewerDiscussionThreadControlReact"],function(i){var r=new i.BuiltInDiffViewerDiscussionThreadControlReact(null,n,t._discussionThreadControlManager,t._$fileLevelDiscussionsContainer)})},t.prototype.onDiscussionCommentsUpdated=function(n,t){var r=this,i;this._activeState&&(i=n.filterEventData(t,this._item.serverItem),this._extensionHost&&!this._usingFallbackEditor?this._extensionHost.postMessage(st.VersionControlExtensionActionIds.DISCUSSION_THREAD_UPDATED,i):i.currentThreads?this._drawFileDiscussionThreads():i.newThreads&&this._$fileLevelDiscussionsContainer&&$.each(i.newThreads,function(n,t){t.position||r._$fileLevelDiscussionsContainer&&(r._$fileLevelDiscussionsContainer.show(),r._addFileLevelThread(t,n===0))}))},t.prototype.clearContent=function(){this._setEditable(!1);var n=__assign({},this._editSettings,{editMode:!1});this.viewItem(this._repositoryContext,null,n,this._viewSettings,this._offlineSettings)},t.prototype.viewItem=function(n,t,i,u,f){var e=this,s=hi.resolve(null),o,h,c;return(this._initializeViewItemPreviewTimer(),o=i?!!i.editMode:!1,this._editSettings=i,this._viewSettings=u||{},this._offlineSettings=f||{},u&&(this._pendingScrollContentTo=ei.FeatureAvailabilityService.isFeatureEnabled(oi.WebPlatformFeatureFlags.MarkdownRendering)?si.UserContentAnchorHelper.convertAnchorName(u.scrollContentTo):u.scrollContentTo),h=n===this._repositoryContext&&t===this._item,h&&!o&&this.isEditable()&&this.isDirty())?(this._discardChanges(),s):(!h&&this._isShowingDiff&&(this._isShowingDiff=!1),h&&!this._viewerRefreshNeeded)?(this._showFileEdit&&this._isEditable!==o?this._setEditable(o):this._updateViewsToolbar(),this._executePendingScrollContentTo(),s):(this._repositoryContext=n,this._item=t,this._viewerRefreshNeeded=!1,this._contentTooBigToEdit=!1,this._requiresItemRefresh=!1,this._$previewContentContainer=undefined,this._editorPreferences.setRepository(n),this._showFileEdit=!!(this._options.allowEditing&&i&&i.allowEditing&&this._areAdditionalFeaturesEnabled()),t&&(c=ft.getFileExtension(t.serverItem),s=r.ContentRendererFactory.getRendererForExtension(c).then(function(n){e._contentRenderer=n?n:null})),s.then(function(){t===e._item&&(t&&(e._previewContentMode=e._getPreviewMode(t,o)),e._updateViewer(),e._editPanel.update(e._item,e._isGitRepository(),e._editSettings),e._setEditable(o))}))},t.prototype.isContentTooBigToEdit=function(){return this._contentTooBigToEdit},t.prototype.isPreviewModeAvailable=function(){return!!this._contentRenderer},t.prototype.isPreviewMode=function(){return this._previewContentMode},t.prototype.setContentChangedCallback=function(n){if(this._contentChangedCallback)throw new Error("_contentChangedCallback can only be set once. No multiple listeners supported.");this._contentChangedCallback=n},t.prototype.setEditorEscapeEditCallback=function(n){if(this._editorEscapeEditCallback)throw new Error("_editorEscapeEditCallback can only be set once. No multiple listeners supported.");this._editorEscapeEditCallback=n},t.prototype.scroll=function(n){this._extensionHost&&this._extensionHost.postMessage(st.VersionControlExtensionActionIds.SET_SCROLL_POSITION,{scrollTop:n})},t.prototype.scrollContentTo=function(n){this._pendingScrollContentTo=n;this._executePendingScrollContentTo()},t.prototype._executePendingScrollContentTo=function(){var n,t;this._pendingScrollContentTo&&(n=this._$previewContentContainer,this._previewContentMode&&n&&(t=p.AnchorLinkUtils.findAnchorInContainer(this._pendingScrollContentTo,n),t&&this._executeScrollContentTo(n,t,n.scrollTop(),new Date),this._pendingScrollContentTo=null))},t.prototype._executeScrollContentTo=function(n,t,i,r){var s=this,f,e,o,u;n&&t&&r&&(f=n.scrollTop(),f==i)&&((e=(new Date).getTime()-r.getTime(),e>6e4)||(o=t.position().top-n.position().top,u=f+o,n.scrollTop(u),u=n.scrollTop(),window.setTimeout(function(){s._executeScrollContentTo(n,t,u,r)},200)))},t.prototype._initializeViewItemPreviewTimer=function(){this._viewItemStartTime=(new Date).getTime()},t.prototype._publishViewItemPreviewTimer=function(n){if(this._viewItemStartTime&&n.metadata&&n.content&&n.content.length){var t={TimeInMSec:((new Date).getTime()-this._viewItemStartTime).toString(),ItemSizeInBytes:n.content.length.toString(),ItemExtension:n.metadata.extension};nt.publishEvent(new nt.TelemetryEventData(et.VERSION_CONTROL_AREA,et.FILEVIEWER_PREVIEW_FILE_FEATURE,t));this._viewItemStartTime=undefined}},t.prototype._updateViewer=function(){var n=this,u=++this._requestIndex,i,r;this._updateActionsToolbar();this._updateViewsToolbar();this._viewerConfigurerExtensionHosts||(this._viewerConfigurerExtensionHosts=[],i=new ti.ViewerConfigurerExtensionSupport(this._options.tfsContext,st.VersionControlExtensionEndPoints.VIEWER_CONFIGURER),i.getExtensionIntegrations(function(t){if(t){var r=$("<div />").addClass("vc-viewer-configurer-hosts").hide().appendTo(n._$fileContentsContainer.parent());$.each(t,function(t,u){var f=i.createExtensionHost(r,{cssClass:"vc-viewer-configurer-host",integration:u,messageListener:function(t){t.actionId===st.ConfigurerExtensionActionIds.UPDATE_EDITOR_CONFIG&&n.extendEditorConfig(t.actionData.config)}});n._editorConfig&&f.setConfiguration(n._prepareConfigForExtension());n._viewerConfigurerExtensionHosts.push(f)})}}));this._extensionViewerSupport||(this._extensionViewerSupport=new ni.VersionControlExtensionViewerSupport(this._options.tfsContext,st.VersionControlExtensionEndPoints.FILE_VIEWER,li(this,this._getFallbackControl),!this._options.hostInIframe));r=this._item?[this._item]:[];this._extensionViewerSupport.getExtensionIntegration(r,{},function(i){var r={},e=n._previewContentMode&&n._contentRenderer,f;u===n._requestIndex&&(i!==n._currentIntegration&&(n._extensionHost&&(n._extensionHost.dispose(),n._extensionHost=null),n._$builtInViewerContainer&&(n._$builtInViewerContainer.remove(),n._$builtInViewerContainer=null),n._$fileContentsContainer.empty(),n._usingFallbackEditor=!1),n._currentIntegration=i,n._scrollPosition=null,n._selection=null,!i||n._usingFallbackEditor||e?(n._extensionHost&&n._extensionHost.hideElement(),n._$builtInViewerContainer?n._$builtInViewerContainer.empty():n._$builtInViewerContainer=$(ci("div","version-control-builtin-viewer")).appendTo(n._$fileContentsContainer),n._beginShowItemBuiltInEditor(n._$builtInViewerContainer,n._item)):(n._$builtInViewerContainer&&(n._$builtInViewerContainer.remove(),n._$builtInViewerContainer=null),n._extensionHost?n._extensionHost.showElement():(n._options.monitorScroll&&(r.monitorScroll=!0),n._options.monitorSelection&&(r.monitorSelection=!0),n._options.bindKeys&&(r.bindKeys=n._options.bindKeys),n._options.contextMenuItems&&(r.contextMenuItems=n._options.contextMenuItems),n._options.externalViewerCss&&(r.editorCss=n._options.externalViewerCss),n._options.selectedDiscussionId&&(r.selectedDiscussionId=n._options.selectedDiscussionId||0),r.supportsDiscussionWorkItemCreation=n._areAdditionalFeaturesEnabled()&&st.hasProjectContext(n._discussionManager?n._discussionManager.getTfsContext():null)&&!n._options.disableDiscussionWorkItemCreation,r.supportCommentStatus=n._areAdditionalFeaturesEnabled()&&(n._options.supportCommentStatus?!0:!1),r.editorTheme=k.caseInsensitiveContains(g.getPageContext().globalization.theme||"","HighContrast")?"hc-black":"vs",n._extensionHost=n._extensionViewerSupport.createExtensionHost(n._$fileContentsContainer,{cssClass:"vc-external-fileviewer-host",integration:i,postData:r,messageListener:li(n,function(i){var o,f,u,e,r,s;i.actionId===st.VersionControlExtensionActionIds.SCROLL_POSITION_CHANGED?(n._scrollPosition=i.actionData||{},n._scrollPosition.topOffset=(n._scrollPosition.topOffset||0)+n._viewerTopOffset,n._triggerScrollPositionChangedEvent()):i.actionId===st.VersionControlExtensionActionIds.GET_SCROLL_POSITION?(n._scrollPosition=i.actionData||{},n._scrollPosition.topOffset=(n._scrollPosition.topOffset||0)+n._viewerTopOffset,$.each(n._scrollPositionCallbacks,function(t,i){i.call(n,n._scrollPosition)}),n._scrollPositionCallbacks=[]):i.actionId===st.VersionControlExtensionActionIds.SELECTION_CHANGED?(n._selection=i.actionData||{},n._triggerSelectionChangedEvent()):i.actionId===st.VersionControlExtensionActionIds.GET_SELECTION?(n._selection=i.actionData||{},n._selectionCallbacks[i.requestId]&&n._selectionCallbacks[i.requestId].call(n,n._selection)):i.actionId===st.VersionControlExtensionActionIds.GET_EDITOR_CONTENT?(r=(i.actionData||{}).content,n._editorContentCallbacks[i.requestId]&&n._editorContentCallbacks[i.requestId].call(n,r)):i.actionId===st.VersionControlExtensionActionIds.EDITOR_DIRTY_STATE_CHANGED?(o=(i.actionData||{}).isDirty,n._onEditorDirtyStateChanged(o)):i.actionId===st.VersionControlExtensionActionIds.EDITOR_CONTENT_CHANGED?n._contentChangedCallback&&n._contentChangedCallback(i.actionData.content):i.actionId===st.VersionControlExtensionActionIds.EDITOR_ESCAPE_EDIT?n.isEditable()&&n._editorEscapeEditCallback&&n._editorEscapeEditCallback():i.actionId===st.VersionControlExtensionActionIds.GET_FILE_CONTENT?n._offlineSettings.isOffline?(u=i.actionData||[],f=n._offlineSettings.offlineFileContent||{content:""},n._extensionHost.postMessage(i.actionId,$.extend(u,f),i.requestId),n._offlineSettings.hitAdornments&&(n._editorConfig.forceRefresh&&(n._editorConfig.forceRefresh=!1),n.extendEditorConfig({adornmentsEnabled:!0,adornments:n._offlineSettings.hitAdornments.highlightingAdornments})),$.extend(f,{hitAdornments:n._offlineSettings.hitAdornments}),n._extensionHost._fire(st.VersionControlExtensionActionIds.GET_FILE_CONTENT,f)):n._editSettings&&n._editSettings.newFile?(u=i.actionData||[],e={content:n._editSettings.initialContent||""},n._extensionHost.postMessage(i.actionId,$.extend(u,e),i.requestId),n._extensionHost._fire(st.VersionControlExtensionActionIds.GET_FILE_CONTENT,u,e)):n._repositoryContext.getClient().beginGetItemContentJson(n._repositoryContext,i.actionData.path,i.actionData.version,i.actionData.maxContentLength,!1,!0,function(t){n._extensionHost&&!n._extensionHost.isDisposed()&&(n._extensionHost.postMessage(i.actionId,$.extend(i.actionData,t),i.requestId),n._extensionHost._fire(st.VersionControlExtensionActionIds.GET_FILE_CONTENT,i.actionData,t),n._item&&n._item.serverItem===i.actionData.path&&n._item.version===i.actionData.version&&(t&&t.metadata&&n._item.contentMetadata&&(n._item.contentMetadata.encoding=t.metadata.encoding||0),(t.exceededMaxContentLength||t.content&&t.content.length>ht.Constants.MAX_EDIT_FROM_WEB_CONTENT_SIZE)&&(n._contentTooBigToEdit=!0,n._setEditable(!1),n._updateActionsToolbar())))},function(t){n._extensionHost.postMessage(i.actionId,$.extend(i.actionData,{error:t.message}),i.requestId)}):i.actionId===st.VersionControlExtensionActionIds.EDITOR_KEY_PRESSED?(r=i.actionData||{},n._fire(t.EVENT_KEY_PRESSED,r)):i.actionId===st.VersionControlExtensionActionIds.EDITOR_CONTEXT_MENU_ITEM_CLICKED?(r=i.actionData||{},r.contextMenuItemId===it.EditorPreferencesMenuId?n._showEditorPreferencesDialog("monaco-menu-item"):n._fire(rt.ContextMenuItemExtension.EVENT_CONTEXT_MENU_ITEM_CLICKED,{contextMenuItemId:r.contextMenuItemId,dataForAction:r.dataForAction})):i.actionId===st.VersionControlExtensionActionIds.EDITOR_CREATED?n._fire(rt.ContextMenuItemExtension.EDITOR_CREATED,{extensionHost:n._extensionHost}):i.actionId===st.VersionControlExtensionActionIds.EDITOR_PREFERENCES_CHANGED?(s=(i.actionData||{}).preferences,n._editorPreferences.updatePreferences(s,"monaco-toggle")):gt.versionControlExtensionActionHandler(n._repositoryContext,n._extensionHost,n._discussionManager,(n._item||{}).serverItem,i)})}),n._extensionHost._bind(s.ExtensionHost.Events.EXTENSION_MESSAGE_RESIZED,function(){n._updateTopOffset();n._options.monitorScroll&&(n._scrollPosition=null,n.beginGetScrollPosition(function(){n._triggerScrollPositionChangedEvent()}))})),f=n._offlineSettings.forceRefresh||!1,n._setExternalEditorConfig(undefined,f)))})},t.prototype._getPreviewMode=function(n,t){var i=!1,u;return n&&this._contentRenderer&&!t&&(u=ft.getFileExtension(n.serverItem),i=this._previewContentUserModesByExt[u],typeof i=="undefined"&&(i=this._contentRenderer.defaultBehavior===r.ContentRenderingDefaultBehavior.ShowRenderedContent,this._previewContentUserModesByExt[u]=i)),i},t.prototype.setLineLinkingWidgetUrl=function(n,t){t===void 0&&(t=!1);this.extendEditorConfig({lineLinkingWidgetUrl:n},t&&!this._isEditable)},t.prototype.extendEditorConfig=function(n,t){t===void 0&&(t=!0);$.extend(this._editorConfigOptions,n);t&&this._doSetExternalEditorConfig()},t.prototype._doSetExternalEditorConfig=function(){if(this._extensionHost&&this._editorConfig){var n=$.extend({},this._editorConfig,this._editorConfigOptions);this._extensionHost.setConfiguration(n)}},t.prototype._prepareConfigForExtension=function(){var n=null;return this._isGitRepository()&&(n=this._repositoryContext.getRepository()),{tfsContext:this._options.tfsContext,repositoryContext:n,editorConfig:this._editorConfig}},t.prototype._setExternalEditorConfig=function(n,t){var i=this;t===void 0&&(t=!1);this._editorConfig={content:n,path:this._item&&this._item.serverItem,version:this._item&&this._item.version,repositoryId:this._repositoryContext?this._repositoryContext.getRepositoryId():null,fileInfo:this._item&&this._item.contentMetadata,editorCss:this._options.externalViewerCss,skipLayoutOnResize:this._options.externalViewerSuppressLayout,discussionThreads:this._getDiscussionThreadsForThisItem(),commentsEnabled:this._discussionManager?!0:!1,commentsDefaultPositionContext:this._isDiscussionForLeftSide?e.PositionContext.LeftBuffer:e.PositionContext.RightBuffer,selectedDiscussionId:this._options.selectedDiscussionId||0,activeState:this._activeState,editable:this._isEditable,forceRefresh:t,showDiff:this._isEditable&&this._isShowingDiff,inline:this._showDiffInline,userPreferences:this._editorPreferences.getPreferences()};this._viewerConfigurerExtensionHosts&&$.each(this._viewerConfigurerExtensionHosts,function(n,t){t.setConfiguration(i._prepareConfigForExtension())});this._doSetExternalEditorConfig()},t.prototype._getDiscussionThreadsForThisItem=function(){var t=this,n=[];return this._discussionManager&&this._item&&(n=$.grep(this._discussionManager.getCurrentThreadsForItemPath(this._item.serverItem),function(n){return!n.position||n.position.positionContext===(t._isDiscussionForLeftSide?e.PositionContext.LeftBuffer:e.PositionContext.RightBuffer)})),n},t.prototype._getContentRendererOptionsOrDefaults=function(){var n={},t;return this._viewSettings&&this._viewSettings.contentRendererOptions&&(n=this._viewSettings.contentRendererOptions),this._item&&yt.WikiRelativeLinkEnablement.isWikiLinkTransformationEnabled()&&typeof n.linkTransformer=="undefined"&&(n.linkTransformer=new pt.CodeExplorerWikiLinkTransformer(this._repositoryContext,this._item)),this._item&&typeof n.imageTransformer=="undefined"&&(n.imageTransformer=new wt.WikiImageTransformer(this._repositoryContext,this._item)),n.async=!0,n.customSyntaxProcessor=new fi.MentionSyntaxProcessor,n.html=!0,this._item&&typeof n.linkClickHandler=="undefined"&&(t={sourceUrl:this._item.url,repositoryId:this._repositoryContext.getRepositoryId(),project:this._repositoryContext.getTfsContext().navigation.project,item:this._item.serverItem},n.linkClickHandler=tt.linkClickHandlerFactory.create("VersionControl","VersionControlMarkdownLinkOnClick",t)),n},t.prototype._beginShowItemBuiltInEditor=function(n,t){var i=this,s=++this._requestIndex,e,r;e=$(ci("div","status-container")).appendTo(this._element);r=u.BaseControl.createIn(a.StatusIndicator,e,{center:!0,imageClass:"big-status-progress",message:at.LoadingText});this.delayExecute("showWaitIndicator",200,!0,function(){r&&r.start()});var o=this._previewContentMode&&this._contentRenderer,h=!o,f=function(f){var h,l,v,a;e.remove();r=null;i._disposed||s!==i._requestIndex||(o?(i._$previewContentContainer=$(ci("div","vc-preview-content-container")).appendTo(n),i._contentRenderer.renderContent(f.content,i._$previewContentContainer,i._getContentRendererOptionsOrDefaults())):f.metadata.isImage?(l=$(ci("div","vc-builtin-file-viewer-image")).appendTo(n),i._$fileLevelDiscussionsContainer=$(ci("div","file-level-discussion-container")).appendTo(l),i._$fileLevelDiscussionsContainer.hide(),a=i._areAdditionalFeaturesEnabled()?ot.getFileContentUrl(i._repositoryContext,t.serverItem,t.version,!0):i._offlineSettings.offlineFileContentUrl,v=$(ci("a")).attr({href:a,target:"_blank"}).appendTo(l),$(ci("img","vc-builtin-file-viewer-image-img")).attr({src:a,title:k.format(at.ImageTitle,t.serverItem,t.versionDescription)}).appendTo(v)):f.metadata.isBinary?(h=$(ci("div")),$(ci("div")).text(k.format(at.FileViewerUnableToShowContent,f.metadata.extension)).appendTo(h),$(ci("br")).appendTo(h),$(ci("a")).text(at.FileViewerClickToDownloadContent).attr("href",i._areAdditionalFeaturesEnabled()?ot.getFileContentUrl(i._repositoryContext,t.serverItem,t.version):i._offlineSettings.offlineFileDownloadUrl).appendTo($(ci("div")).appendTo(h)),u.BaseControl.createIn(c.MessageAreaControl,$(ci("div","vc-builtin-file-viewer-message-area")).appendTo(n),{closeable:!1,message:{header:h,type:c.MessageAreaType.Warning}}),i._$fileLevelDiscussionsContainer=$(ci("div","file-level-discussion-container")).appendTo(n),i._$fileLevelDiscussionsContainer.hide()):f.contentLines.length===0?($(ci("div","vc-builtin-file-viewer-message")).text(at.FileIsEmpty).appendTo(n),i._$fileLevelDiscussionsContainer=$(ci("div","file-level-discussion-container")).appendTo(n),i._$fileLevelDiscussionsContainer.hide()):i._drawFileContent(n,f),i._executePendingScrollContentTo(),i._discussionManager&&i._drawFileDiscussionThreads(),i._updateTopOffset(),i._options.monitorScroll&&(i._scrollPosition=i._getBuiltInViewerScrollPosition(),i._triggerScrollPositionChangedEvent()),i._fire(st.VersionControlExtensionActionIds.GET_FILE_CONTENT,{content:f,hitAdornments:i._offlineSettings.hitAdornments}),i._publishViewItemPreviewTimer(f))},l=function(t){e.remove();r=null;s===i._requestIndex&&u.BaseControl.createIn(c.MessageAreaControl,$(ci("div","vc-builtin-file-viewer-message-area")).appendTo(n),{closeable:!1,message:v.getErrorMessage(t)})};this._isOfflineContentMetadataPresent(this._offlineSettings)?(this._offlineSettings.offlineFileContent.metadata.isBinary||this._offlineSettings.offlineFileContent.metadata.isImage||!h||(this._offlineSettings.offlineFileContent.contentLines=this._offlineSettings.offlineFileContent.content.split("\n")),f(this._offlineSettings.offlineFileContent)):o&&this._editPanel.isVisible()?this.beginGetEditorContent(function(n){f({content:n})}):this._editSettings&&this._editSettings.newFile?f({content:this._editSettings.initialContent||"",metadata:{extension:ft.getFileExtension(t.serverItem)}}):t?this._repositoryContext.getClient().beginGetItemContentJson(this._repositoryContext,t.serverItem,t.version,0,h,!1,f,l):o&&f({content:""})},t.prototype._drawFileContent=function(n,t){var i=this,r;this._$builtInTextViewer=$(ci("div","vc-builtin-file-viewer"));this._$fileLevelDiscussionsContainer=$(ci("div","file-level-discussion-container")).appendTo(this._$builtInTextViewer);this._$fileLevelDiscussionsContainer.hide();r=$(ci("table")).appendTo(this._$builtInTextViewer);t.exceededMaxContentLength&&(this._$builtInTextViewer.addClass("truncated"),$(ci("div","vc-builtin-file-viewer-message")).text(at.FileViewerContentIsTrimmed).appendTo(n));$.each(t.contentLines,function(n,t){var i=$(ci("tr","line-row")).appendTo(r);$(ci("td","ln")).text(""+(n+1)).appendTo(i);$(ci("td","content")).text(t).appendTo(i)});this._options.monitorScroll&&this._$builtInTextViewer.bind("scroll",function(){i._scrollPosition=i._getBuiltInViewerScrollPosition();i._triggerScrollPositionChangedEvent()});this._$builtInTextViewer.appendTo(n)},t.prototype._drawFileDiscussionThreads=function(){var i=this,t=[],n=[];this._element.find(".discussion-thread").remove();t=this._getDiscussionThreadsForThisItem();n=$.grep(t,function(n){return n.position?!1:!0});n.length>0?(this._$fileLevelDiscussionsContainer&&this._$fileLevelDiscussionsContainer.show(),$.each(n,function(n,t){i._addFileLevelThread(t)}),this._element.addClass("has-file-level-discussion-threads")):(this._$fileLevelDiscussionsContainer&&this._$fileLevelDiscussionsContainer.hide(),this._element.removeClass("has-file-level-discussion-threads"))},t.prototype.beginGetScrollPosition=function(n){this._scrollPosition?n.call(this,this._scrollPosition):this._extensionHost&&!this._usingFallbackEditor?(this._scrollPositionCallbacks.push(n),this._extensionHost.postMessage(st.VersionControlExtensionActionIds.GET_SCROLL_POSITION,{})):(this._scrollPosition=this._getBuiltInViewerScrollPosition(),n.call(this,this._scrollPosition))},t.prototype.beginGetEditorContent=function(n){var i,t;this._extensionHost&&!this._usingFallbackEditor?(this._editorContentCallbacks[i]=n,t=null,this._editSettings&&this._editSettings.newFile&&this._isGitRepository()&&(t={lineEnding:vi.LINE_ENDING_LF}),this._extensionHost.postMessage(st.VersionControlExtensionActionIds.GET_EDITOR_CONTENT,{codeEditorOptions:t})):n.call(this,null)},t.prototype.beginResetEditorDiffContent=function(){this._extensionHost&&!this._usingFallbackEditor&&this._extensionHost.postMessage(st.VersionControlExtensionActionIds.RESET_EDITOR_DIFF_CONTENT,{})},t.prototype.addScrollPositionListener=function(n){this._scrollPositionListeners.push(n)},t.prototype._isOfflineContentMetadataPresent=function(n){return!!(n&&n.isOffline&&n.offlineFileContent&&n.offlineFileContent.metadata)},t.prototype._triggerScrollPositionChangedEvent=function(){var n=this;$.each(this._scrollPositionListeners,function(t,i){i.call(n,n._scrollPosition)})},t.prototype._getBuiltInViewerScrollPosition=function(){return this._$builtInTextViewer&&this._$builtInTextViewer.length?{scrollTop:this._$builtInTextViewer[0].scrollTop,scrollLeft:this._$builtInTextViewer[0].scrollTop,lineHeight:16,topOffset:this._viewerTopOffset}:{scrollTop:0,scrollLeft:0,lineHeight:16,topOffset:this._viewerTopOffset}},t.prototype.beginGetSelection=function(n){var t;this._selection?n.call(this,this._selection):this._extensionHost?(this._selectionCallbacks[t]=n,this._extensionHost.postMessage(st.VersionControlExtensionActionIds.GET_SELECTION,{})):(this._selection={startColumn:1,startLineNumber:1,endColumn:1,endLineNumber:1,positionColumn:1,positionLineNumber:1},n.call(this,this._selection))},t.prototype.addSelectionListener=function(n){this._selectionListeners.push(n)},t.prototype._triggerSelectionChangedEvent=function(){var n=this;$.each(this._selectionListeners,function(t,i){i.call(n,n._selection)})},t.prototype._getFallbackControl=function(){return this._usingFallbackEditor=!0,this._$builtInViewerContainer=$("<div />"),this._beginShowItemBuiltInEditor(this._$builtInViewerContainer,this._item),this._$builtInViewerContainer},t.prototype._createMenus=function(n){var i=this._options.hideActionsToolbar,t;i||(this._actionsToolbar=u.BaseControl.createIn(h.MenuBar,n,{cssClass:"file-actions-menu",items:[]}));this._createEditPanel($(ci("div","vc-file-viewer-edit-panel-container")).appendTo(n));i&&this._editPanel.hideElement();t=$(ci("div","file-views-menu-container"));this._viewsToolbar=u.BaseControl.createIn(h.MenuBar,t,{cssClass:"file-views-menu",items:[]});t.appendTo(n)},t.prototype._updateActionsToolbar=function(){var n=this,t,i;this._actionsToolbar&&(t=[],!this._item||this._item.isSymLink||this._isEditable||(this._showOpenInVS&&this._areAdditionalFeaturesEnabled()&&p.UserAgentUtils.isWindowsClient()&&this._item.contentMetadata&&this._item.contentMetadata.vsLink&&k.localeIgnoreCaseComparer(this._item.contentMetadata.extension,"sln")===0&&(t.push({id:"open-file-in-vs",title:at.OpenInVisualStudioTooltip,icon:"bowtie-icon bowtie-logo-visual-studio",showText:!1,action:function(){d.VSLauncher.openVSWebLink(n._item.contentMetadata.vsLink)}}),t.push({separator:!0})),this._discussionManager&&!this._discussionManager.getViewOptions().hideComments&&t.push({id:"add-file-discussion",text:at.AddCommentAction,title:at.AddCommentAction,icon:"bowtie-icon bowtie-comment-add",action:function(){n.beginGetSelection(function(t){var i;n._item&&n._discussionManager&&(n._extensionHost&&t&&(t.endLineNumber>1||t.endColumn>1)&&(t.startLineNumber>t.endLineNumber||t.endColumn>t.startColumn)&&(i={startLine:t.startLineNumber,endLine:t.endLineNumber,startColumn:t.startColumn,endColumn:t.endColumn,positionContext:n._isDiscussionForLeftSide?e.PositionContext.LeftBuffer:e.PositionContext.RightBuffer}),n._discussionManager.createNewDiscussionThread(n._item.serverItem,i))})}}),!this._showFileEdit||this._item.contentMetadata&&this._item.contentMetadata.isBinary||t.push({id:"edit-file",text:at.FileViewerEditFileMenuText,title:this._contentTooBigToEdit?this._isGitRepository()?at.MaxFileSizeExceededGit:at.MaxFileSizeExceededTfvc:at.FileViewerEditFileMenuToolTip,icon:"bowtie-icon bowtie-edit",disabled:this._contentTooBigToEdit,action:function(){n._onToggleEditClick()}}),this._editSettings&&this._editSettings.newFile||(i=this._areAdditionalFeaturesEnabled()?ot.getFileContentUrl(this._repositoryContext,this._item.serverItem,this._item.version):this._offlineSettings.offlineFileDownloadUrl,t.push({id:"download-file",text:at.DownloadFileMenuText,title:this._offlineSettings.isOffline&&!this._offlineSettings.canDownloadOffline?at.FileViewerClickToDownloadContentDisbled:at.FileViewerClickToDownloadContent,icon:"bowtie-icon bowtie-transfer-download",disabled:this._offlineSettings.isOffline&&!this._offlineSettings.canDownloadOffline,action:function(){nt.publishEvent(new nt.TelemetryEventData(et.VERSION_CONTROL_AREA,et.FILEVIEWER_DOWNLOAD_CLICK,{}));window.open(i,"_blank")}}),i&&this._item.serverItem.toLocaleLowerCase().split(".").pop()=="md"&&this._buildDashboardMenuEntry(t,JSON.stringify({path:this._item.serverItem,version:this._item.version,repositoryId:this._repositoryContext.getRepositoryId()})))),this._actionsToolbar.updateItems(t))},t.prototype._buildDashboardMenuEntry=function(n,t){var i=new ui.WidgetDataForPinning("Pinned Markdown",ri.Markdown_WidgetTypeID,t),r=ii.PushToDashboard.createMenu(ai.getDefault().contextData,i,function(n){ii.PushToDashboard.pinToDashboard(ai.getDefault().contextData,n.commandArgs)});n.push(r)},t.prototype._createEditPanel=function(n){var t=this;this._editPanel=u.BaseControl.createIn(kt.FileViewerEditPanel,n,{cssClass:"vc-file-viewer-edit-panel",tfsContext:this._options.tfsContext});this._editPanel._bind(kt.FileViewerEditPanel.EVENT_COMMIT_CLICKED,function(n,i){t._onCommitClicked(i.message)});this._editPanel._bind(kt.FileViewerEditPanel.EVENT_COMMIT_TO_NEW_BRANCH_CLICKED,function(n,i){t._onCommitToNewBranchClicked(i.message)});this._editPanel._bind(kt.FileViewerEditPanel.EVENT_DISCARD_CLICKED,function(){t._onDiscardClicked()})},t.prototype._onToggleEditClick=function(){this._isEditable?this._onDiscardClicked():(this._isShowingDiff=!1,this._prepareForEdit());this._updateViewsToolbar()},t.prototype._onDiffClick=function(n){var t=!this._isShowingDiff;n!==undefined&&(this._showDiffInline=n,t=!0);this._isShowingDiff=this._isEditable&&t?!0:!1;this._setExternalEditorConfig();this._updateViewsToolbar()},t.prototype._setEditable=function(n){var i=this,t;n=n&&!this._contentTooBigToEdit&&this._areAdditionalFeaturesEnabled();this._isEditable!==n&&(this._isEditable=n,t=function(n){i._editorEscapeEditCallback||n.keyCode!==y.KeyCode.ESCAPE||$('li[command="commit-file-changes"]').focus()},n?(this._previewContentMode=!1,this._$fileContentsContainer.bind("keydown",t)):(this._previewContentMode=this._getPreviewMode(this._item,!1),this._$fileContentsContainer.unbind("keydown",t)),this._setDirtyState(!1),this._editPanel.toggleVisibility(n),this._item&&lt.Events._triggerEditModeChangedEvent(this._item.serverItem,this._item.version,n),this._updateViewer())},t.prototype._onCommitClicked=function(n,t){var r=this,i;return this._disableEditInput(),this._isShowingDiff?(this._isShowingDiff=!1,this._setExternalEditorConfig(),this._updateViewsToolbar(),i=$.Deferred(),window.setTimeout(function(){r._commitChanges(n,t).done(function(n){return i.resolve(n)}).fail(function(n){return i.reject(n)})},200),i.promise()):this._commitChanges(n,t)},t.prototype._onCommitToNewBranchClicked=function(n){var t=this;dt.createBranchFromItemCommit(this._repositoryContext,this._item.serverItem,this._item.version,function(i){var r=t._getBranchName();return t._onCommitClicked(n,i.branchName).done(function(){if(i.createPullRequest){var n=ot.getCreatePullRequestUrl(t._repositoryContext,i.branchName,r);window.location.href=n}})})},t.prototype._commitChanges=function(n,t){var i=this,e=n||this._editPanel.getDefaultCommitMessage(),r=this._editSettings&&this._editSettings.newFile,h=e!==this._editPanel.getDefaultCommitMessage(),u=$.Deferred(),f=$.Deferred(),o,s;return r?f.resolve(null):t?f.resolve(this._item):(o=this._isGitRepository(),s=o?this._item.version:(new vt.LatestVersionSpec).toVersionString(),this._beginGetItem(s,function(n){i._matchesFileVersion(n)?f.resolve(n):f.reject({message:at.EditFileUpdatedAfterEditAlert,name:at.EditFileRefreshTitle})})),f.done(function(n){i.beginGetEditorContent(function(f){var o,s,c,l,a,v,y;if(f.length>ht.Constants.MAX_EDIT_FROM_WEB_CONTENT_SIZE){o=new Error(i._isGitRepository()?at.MaxFileSizeExceededGit:at.MaxFileSizeExceededTfvc);i._handleCommitFailError(o);u.reject(o);return}c=i._item.version;i._isGitRepository()?(l=i._getBranchName(),a=r?"":n.commitId.full,s=ct.Actions.editFileGit(i._repositoryContext,i._item.serverItem,a,l,r,f,e,t)):(v=r?0:i._item.changeset,y=i._item.contentMetadata?i._item.contentMetadata.encoding||ht.TfvcEncodingConstants.UTF8:ht.TfvcEncodingConstants.UTF8,s=ct.Actions.editFileTfvc(i._repositoryContext,i._item.serverItem,v,r,f,e,y));s.done(function(n){var f,e;i._resetUserPreviewModePreference();i._enableEditInput();i.beginResetEditorDiffContent();i._editSettings&&i._editSettings.newFile&&(i._editSettings.newFile=!1);f=i._isGitRepository()?t?new vt.GitBranchVersionSpec(t).toVersionString():c:n.toVersionString();i._beginGetItem(f,function(t){i._item=t;i._setEditable(!1);i._setExternalEditorConfig(null,!0);u.resolve(n)},function(n){return u.reject(n)});e=r?et.FILEVIEWER_FILE_ADD_COMMIT_FEATURE:et.FILEVIEWER_EDIT_COMMIT_FEATURE;nt.publishEvent(new nt.TelemetryEventData(et.VERSION_CONTROL_AREA,e,{FileExtension:ft.getFileExtension(i._item.serverItem),CommitMessageChanged:h}))}).fail(function(n){i._handleCommitFailError(n);u.reject(n)})})}).fail(function(n){i._handleCommitFailError(n);i._requiresItemRefresh=!0;u.reject(n)}),u.promise()},t.prototype._disableEditInput=function(){this._editPanel.disableInput()},t.prototype._enableEditInput=function(){this._editPanel.enableInput()},t.prototype._getBranchName=function(){var n=vt.VersionSpec.parse(this._item.version);if(!(n instanceof vt.GitBranchVersionSpec))throw new Error("Cannot edit using a git version spec other than branch.");return n.branchName},t.prototype._isGitRepository=function(){return this._repositoryContext?this._repositoryContext.getRepositoryType()===ut.RepositoryType.Git:!1},t.prototype._handleCommitFailError=function(n){var i=this._isGitRepository(),t,r,u;i&&(""+n.message).toUpperCase().indexOf("TF402455")===0?(r=this._getBranchName(),t=k.format(at.CommitFailedUsePullRequest,r)):(u=i?at.CommitFailedMessageFormat:at.CheckinFailedMessageFormat,t=k.format(u,n.message));alert(t);this._enableEditInput()},t.prototype._onDiscardClicked=function(){var n=this;this.isDirty()?f.show(bt.FileEditConfirmationDialog,{okCallback:function(){n._discardChanges();nt.publishEvent(new nt.TelemetryEventData(et.VERSION_CONTROL_AREA,et.FILEVIEWER_EDIT_DISCARD_FEATURE,{FileExtension:ft.getFileExtension(n._item.serverItem)}))},editWarningHtml:k.format(at.EditFileDiscardChangesConfirmation,ft.getFileName(this._item.serverItem)),title:at.EditFileDiscardChangesTitle}):(this._discardChanges(),nt.publishEvent(new nt.TelemetryEventData(et.VERSION_CONTROL_AREA,et.FILEVIEWER_EDIT_CANCEL_FEATURE,{FileExtension:ft.getFileExtension(this._item.serverItem)})))},t.prototype._discardChanges=function(){this._resetUserPreviewModePreference();this.beginResetEditorDiffContent();this._setEditable(!1);this._setExternalEditorConfig(null,!0);this._isShowingDiff=!1;this._updateViewsToolbar();lt.Events._triggerRevertEditedItemEvent(this._item.serverItem,this._item.version);this._requiresItemRefresh&&(this._requiresItemRefresh=!1,lt.Events._triggerRefreshItemEvent(this._item.serverItem,this._item.version),this._setExternalEditorConfig(null,!0))},t.prototype._prepareForEdit=function(){var n=this,t,i;if(this._editSettings&&this._editSettings.newFile){this._setEditable(!0);return}t=this._isGitRepository();i=t?this._item.version:(new vt.LatestVersionSpec).toVersionString();this._beginGetItem(i,function(t){n._matchesFileVersion(t)?n._setEditable(!0):f.show(bt.FileEditConfirmationDialog,{okCallback:function(){lt.Events._triggerRefreshItemEvent(t.serverItem,t.version);n._setExternalEditorConfig(null,!0);window.setTimeout(function(){n._setEditable(!0)},500)},editWarningHtml:at.EditFileRefreshConfirmation,title:at.EditFileRefreshTitle})})},t.prototype._beginGetItem=function(n,t,i){var r=this;this._repositoryContext.getClient().beginGetItem(this._repositoryContext,this._item.serverItem,n,{includeContentMetadata:!0,includeVersionDescription:!0},function(n){t(n)},function(n){v.errorHandler.show(n);r._enableEditInput();i&&i(n)})},t.prototype._matchesFileVersion=function(n){return this._isGitRepository()?n.objectId&&n.objectId.full===this._item.objectId.full:n.changeset===this._item.changeset},t.prototype._updateViewsToolbar=function(){var n=this,t=this._isEditable?[{separator:!0}]:[],r,i;$.isFunction(this._options.getContributedViewMenuItems)&&!this._isEditable&&(r=this._options.getContributedViewMenuItems.call(this)||[],t=t.concat(r));this._contentRenderer&&!this._options.hidePreviewButton&&(this._previewContentMode?t.push({id:"preview-mode-off",title:at.PreviewOffTooltip,icon:"bowtie-icon bowtie-tfvc-raw-source",text:at.PreviewOffLabel,showText:!this._isEditable,action:function(){n.setPreviewContentMode(!1);nt.publishEvent(new nt.TelemetryEventData(et.VERSION_CONTROL_AREA,et.FILEVIEWER_PREVIEW_OFF_FEATURE,{IsEditMode:n._isEditable,FileExtension:ft.getFileExtension(n._item.serverItem)}))}}):t.push({id:"preview-mode-on",title:at.PreviewOnTooltip,icon:"bowtie-icon bowtie-file-preview",text:at.PreviewOnLabel,showText:!this._isEditable,action:function(){n.setPreviewContentMode(!0);nt.publishEvent(new nt.TelemetryEventData(et.VERSION_CONTROL_AREA,et.FILEVIEWER_PREVIEW_ON_FEATURE,{IsEditMode:n._isEditable,FileExtension:ft.getFileExtension(n._item.serverItem)}))}}));this._showFileEdit&&this._isEditable&&(!this._item.contentMetadata||!this._item.contentMetadata.isBinary)&&(i=[],i.push({id:"edit-file-diff-side-by-side",title:at.EditFileDiffSideBySide,showText:!1,toggled:!this._showDiffInline,disabled:this._previewContentMode||!this.isDirty()&&!this._isShowingDiff,icon:"bowtie-icon bowtie-diff-side-by-side",action:function(){n._onDiffClick(!1);nt.publishEvent(new nt.TelemetryEventData(et.VERSION_CONTROL_AREA,et.FILEVIEWER_EDIT_DIFF_FEATURE,{FileExtension:ft.getFileExtension(n._item.serverItem)}))}}),i.push({id:"edit-file-diff-inline",title:at.EditFileDiffInline,showText:!1,toggled:this._showDiffInline,disabled:this._previewContentMode||!this.isDirty()&&!this._isShowingDiff,icon:"bowtie-icon bowtie-diff-inline",action:function(){n._onDiffClick(!0);nt.publishEvent(new nt.TelemetryEventData(et.VERSION_CONTROL_AREA,et.FILEVIEWER_EDIT_DIFF_FEATURE,{FileExtension:ft.getFileExtension(n._item.serverItem)}))}}),t.push({id:"edit-file-diff",title:this._isShowingDiff?at.EditModeRevertToEditMode:at.EditModeShowDiff,showText:!1,toggled:this._isShowingDiff&&!this._previewContentMode,disabled:this._previewContentMode||!this.isDirty()&&!this._isShowingDiff,icon:this._showDiffInline?"bowtie-icon bowtie-diff-inline":"bowtie-icon bowtie-diff-side-by-side",childItems:i,splitDropOptions:{id:"edit-file-diff-splitdrop",title:at.EditFileSelectDiffMode},action:function(){n._onDiffClick();nt.publishEvent(new nt.TelemetryEventData(et.VERSION_CONTROL_AREA,et.FILEVIEWER_EDIT_DIFF_FEATURE,{FileExtension:ft.getFileExtension(n._item.serverItem)}))}}));this._previewContentMode||t.push({id:"editor-preferences",title:at.EditorPreferencesDialogTooltip,icon:"bowtie-icon bowtie-settings-gear-outline",showText:!1,action:function(){n._showEditorPreferencesDialog("file-viewer-toolbar")}});this._changeListNavigator&&(this._discussionManager&&this._changeListNavigator.addDiscussionViewMenuEntries(t,this._discussionManager,!1,!0),this._changeListNavigator.addFileNavMenuEntries(t,this._item&&this._item.serverItem,!1,!1));this._viewsToolbar.updateItems(t);this._updateTopOffset()},t.prototype._updateTopOffset=function(){this._viewerTopOffset=this._$builtInTextViewer&&this._$builtInTextViewer.length?this._$builtInTextViewer.offset().top-this._element.offset().top:this._extensionHost?this._extensionHost._element.offset().top-this._element.offset().top:this._$fileContentsContainer.offset().top-this._element.offset().top},t.prototype._onEditorDirtyStateChanged=function(n){this._isEditable&&this._setDirtyState(n)},t.prototype._setDirtyState=function(n){this._editPanel.isDirty()!==n&&(this._editPanel.isDirty(n),lt.Events._triggerItemDirtyStateChangedEvent(n,this._item.serverItem,this._item.version),this._updateViewsToolbar(),this._setExternalEditorConfig())},t.prototype._resetUserPreviewModePreference=function(){this._item&&(this._previewContentUserModesByExt[ft.getFileExtension(this._item.serverItem)]=undefined,this._previewContentMode=this._getPreviewMode(this._item,!1))},t.prototype._showEditorPreferencesDialog=function(n){var t=this;this._editorPreferences.showDialog(function(){t._setExternalEditorConfig()},n)},t.prototype._areAdditionalFeaturesEnabled=function(){return!this._offlineSettings.isOffline||this._offlineSettings.enableAddOns},t.EVENT_PREVIEW_MODE_CHANGED="file-viewer-preview-mode-changed",t.EVENT_KEY_PRESSED="key-pressed",t}(u.BaseControl);t.FileViewer=yi,function(n){n.LINE_ENDING_LF="\n";n.LINE_ENDING_CRLF="\r\n"}(vi||(vi={}));v.classExtend(yi,ai.ControlExtensions)});
define("Presentation/Scripts/TFS/TFS.Adornment.Common",["require","exports"],function(n,t){var i,r;Object.defineProperty(t,"__esModule",{value:!0}),function(n){n[n.Left=1]="Left";n[n.Center=2]="Center";n[n.Right=4]="Right";n[n.Full=7]="Full"}(i=t.OverviewRulerLane||(t.OverviewRulerLane={})),function(n){n[n.UNKNOWN=0]="UNKNOWN";n[n.COMMENTSTYLE=1]="COMMENTSTYLE";n[n.DECORATION=2]="DECORATION"}(r=t.AdornmentType||(t.AdornmentType={}))});
define("VersionControl/Scripts/FileViewerLineAdornment",["require","exports","Presentation/Scripts/TFS/TFS.Adornment.Common"],function(n,t,i){var r,u,f;Object.defineProperty(t,"__esModule",{value:!0});r=function(){function n(n){this.options=n;this.adornmentType=i.AdornmentType.DECORATION;this.usingGlyphMargin=!1;this.isOriginalSide=!0;this.startLine=1;this.endLine=1;this.startColumn=1;this.endColumn=1;this.scrollToAdornment=!0;this.lineNumber=n.startLineNumber;this.startLine=n.startLineNumber;this.endLine=n.endLineNumber||n.startLineNumber;n.scrollTo&&(this.scrollToAdornment=n.scrollTo);this.style=(this.options.style||"").toLocaleLowerCase()}return n.create=function(n){var t=[];return typeof n.startColumn!="undefined"&&typeof n.endColumn!="undefined"?t.push(new u({startLineNumber:n.startLineNumber,endLineNumber:n.endLineNumber,style:n.style,startColumn:n.startColumn,endColumn:n.endColumn})):t.push(new f({startLineNumber:n.startLineNumber,endLineNumber:n.endLineNumber,style:n.style,glyphMarginText:n.glyphMarginText})),t},n.heatMapPosition=1,n}();t.FileViewerLineAdornment=r;u=function(n){function t(t){var i=n.call(this,t)||this;t.startColumn&&(i.startColumn=t.startColumn);t.endColumn&&(i.endColumn=t.endColumn);i.isWholeLine=!1;i.className="vc-line-inline-adornment";switch(i.style){case"error":i.className+=".vc-adornment-style-error";break;case"plain":default:i.className+=".vc-adornment-style-plain"}return i}return __extends(t,n),t}(r);t.FileViewerInlineLineAdornment=u;f=function(n){function t(t){var i=n.call(this,t)||this;i.isWholeLine=!0;i.actualClassName="vc-line-adornment";i.linesDecorationsClassName="vc-line-lineNumber-adornment";i.overviewRuler={color:"",position:r.heatMapPosition};switch(i.style){case"error":i.usingGlyphMargin=!0;i.glyphMarginClassName="vc-line-glyph-adornment bowtie-icon bowtie-status-failure";i.glyphMarginText=t.glyphMarginText;i.actualClassName+=".vc-adornment-style-error";i.linesDecorationsClassName+=".vc-adornment-style-error";i.overviewRuler.color="red";break;case"plain":default:i.actualClassName+=".vc-adornment-style-plain";i.linesDecorationsClassName+=".vc-adornment-style-plain";i.overviewRuler.color="rgb(248, 238, 199)"}return i}return __extends(t,n),t}(r);t.FileViewerWholeLineLineAdornment=f});
define("VersionControl/Scenarios/Shared/FileViewers/EditableFileViewer",["require","exports","react","VSS/Controls","VersionControl/Scripts/Controls/FileViewer","VersionControl/Scripts/FileViewerLineAdornment","VersionControl/Scripts/TFS.VersionControl.EditorExtensions","VersionControl/Scripts/TFS.VersionControl.WikiLinkTransformer","VersionControl/Scripts/Utils/Number","VSS/LoaderPlugins/Css!VersionControl/Shared/FileViewers/EditableFileViewer"],function(n,t,i,r,u,f,e,o,s){function a(n,t){return!h(n,t,["isVisible","displayItem","isPreviewMode","isEditing","scrollToAnchor","isNewFile","initialContent","hideBranchCreationOption",])}function h(n,t,i){for(var f,r=0,u=i;r<u.length;r++)if(f=u[r],n[f]!==t[f])return!1;return!0}function v(n,t){if(n.fileViewerOfflineSettings&&t.fileViewerOfflineSettings){var r=n.fileViewerOfflineSettings.hitAdornments,i=t.fileViewerOfflineSettings.hitAdornments;if(r&&!i||i&&!r)return!0;if(r&&i)return r.length!=i.length?!0:r.some(function(n,t){return n.startLine!==i[t].startLine||n.endLine!==i[t].endLine||n.startColumn!=i[t].startColumn||n.endColumn!==i[t].endColumn||n.className!==i[t].className||n.scrollToAdornment!==i[t].scrollToAdornment})}return!1}function y(n,t){if(n.fileViewerOfflineSettings&&t.fileViewerOfflineSettings){if(n.fileViewerOfflineSettings.offlineFileContent&&!t.fileViewerOfflineSettings.offlineFileContent||t.fileViewerOfflineSettings.offlineFileContent&&!n.fileViewerOfflineSettings.offlineFileContent)return!0;if(n.fileViewerOfflineSettings.offlineFileContent&&t.fileViewerOfflineSettings.offlineFileContent)return n.fileViewerOfflineSettings.offlineFileContent.content!==t.fileViewerOfflineSettings.offlineFileContent.content}return!1}Object.defineProperty(t,"__esModule",{value:!0});var c=["isDiffMode","isDiffInline","line"],l=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.onContentChanged=function(n){if(t.props.onContentEdited)t.props.onContentEdited(n)},t.onSelectionChanged=function(n){if(t.props.onSelectionChanged)t.props.onSelectionChanged(n)},t.onScrollChanged=function(n){if(t.props.onScrollChanged)t.props.onScrollChanged(n);t.lastKnownScrollTop=n.scrollTop},t.onEditorEscapeEdit=function(){t.props.onEditorEscapeEdit&&t.props.onEditorEscapeEdit()},t}return __extends(t,n),t.prototype.componentDidMount=function(){this.innerControl=this.createControl();this.configControl(this.props);this.viewItem(this.props);this.updateScrollTop(this.props.scrollTop)},t.prototype.componentWillUnmount=function(){this.innerControl&&(this.innerControl.dispose(),this.innerControl=null)},t.prototype.componentWillReceiveProps=function(n){(!h(this.props,n,c)||v(this.props,n))&&this.configControl(n)},t.prototype.componentWillUpdate=function(n){(a(n,this.props)||y(this.props,n))&&this.viewItem(n);this.updateScrollTop(n.scrollTop)},t.prototype.render=function(){var n=["file-viewer-holder",this.props.className,];return this.props.isVisible||n.push("hidden"),i.createElement("div",{className:n.join(" "),ref:"holder"})},t.prototype.raiseScrollChanged=function(){this.innerControl.beginGetScrollPosition(this.onScrollChanged)},t.prototype.createControl=function(){var n=r.BaseControl.createIn(u.FileViewer,this.refs.holder,{tfsContext:this.props.repositoryContext.getTfsContext(),monitorScroll:this.props.onScrollChanged,monitorSelection:this.props.onSelectionChanged,hideActionsToolbar:!0,allowEditing:!0});return e.ContextMenuItemExtension.addContextMenuItems(n,this.props.repositoryContext.getTfsContext()),e.ContextMenuItemExtension.bindContextMenuItems(n),n.setContentChangedCallback(this.onContentChanged),n.addSelectionListener(this.onSelectionChanged),n.addScrollPositionListener(this.onScrollChanged),n.setEditorEscapeEditCallback(this.onEditorEscapeEdit),n.showElement(),n.setActiveState(!0,!0),this.props.addExtension&&this.props.addExtension(n),n},t.prototype.configControl=function(n){n.fileViewerOfflineSettings?this.innerControl.extendEditorConfig({showDiff:n.isDiffMode,inline:n.isDiffInline,adornmentsEnabled:!0,adornments:n.fileViewerOfflineSettings.hitAdornments}):this.innerControl.extendEditorConfig({showDiff:n.isDiffMode,inline:n.isDiffInline,adornmentsEnabled:Boolean(n.line),adornments:n.line?f.FileViewerLineAdornment.create(n.line):[]})},t.prototype.viewItem=function(n){var r=this,i=n.displayItem,t=this.innerControl;if(t){if(!i||!i.contentMetadata||i.isFolder){t.clearContent();return}n.isVisible&&(t.setLineLinkingWidgetUrl(window.location.href),t.viewItem(n.repositoryContext,i,this.getEditSettings(n),this.getViewSettings(n),n.fileViewerOfflineSettings).then(function(){if(r.innerControl&&!r.innerControl.isDisposed()){n.isPreviewMode!==undefined&&t.setPreviewContentMode(n.isPreviewMode);var u=n.onFileContentLoaded;u&&i===n.displayItem&&t.beginGetEditorContent(function(n){u(n,t.isContentTooBigToEdit())})}}))}},t.prototype.getEditSettings=function(n){var t={allowBranchCreation:!n.hideBranchCreationOption,editMode:n.isEditing,allowEditing:!0,newFile:n.isNewFile};return n.isNewFile&&n.initialContent&&(t.initialContent=n.initialContent),t},t.prototype.getViewSettings=function(n){return{contentRendererOptions:{linkTransformer:new o.CodeExplorerWikiLinkTransformer(n.repositoryContext,n.displayItem,n.useFragmentsForMarkdownLinks)},scrollContentTo:n.scrollToAnchor}},t.prototype.updateScrollTop=function(n){this.innerControl&&n!==undefined&&!s.areSimilar(n,this.lastKnownScrollTop)&&this.innerControl.scroll(n)},t.defaultProps={isVisible:!0},t}(i.Component);t.EditableFileViewer=l});
define("VersionControl/Scripts/Controls/AnnotateAnnotationEngine",["require","exports","VersionControl/Scripts/Generated/TFS.VersionControl.Legacy.Contracts"],function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function n(t,i,r){this._repositoryContext=t;this._path=i;this._version=r;this._progressEventListeners=[];this._diffBatchSize=n.DEFAULT_DIFF_BATCH_SIZE}return n.prototype.addProgressListener=function(n){this._progressEventListeners.push(n)},n.prototype.isComplete=function(){return this._completed},n.prototype.isCancelled=function(){return this._stopped},n.prototype.getVersionMap=function(){return this._versionMap},n.prototype.getRepositoryContext=function(){return this._repositoryContext},n.prototype.getItemPath=function(){return this._path},n.prototype.getItemVersion=function(){return this._version},n.prototype.getHistoryEntries=function(){return this._historyEntries},n.prototype.hasMoreHistoryAvailable=function(){return this._moreHistoryAvailable},n.prototype.hasUnprocessedHistory=function(){return!1},n.prototype.getAnnotationBlocks=function(){for(var r=[],n=null,i,t=1;t<=this._totalLines;t++)i=this._versionsByLine[t],i?n&&n.version===i?n.lineCount++:(n={startLine:t,lineCount:1,version:i},r.push(n)):n=null;return r},n.prototype.getVersionForLineNumber=function(n){return this._versionsByLine[n]},n.prototype.start=function(){var t=this;this._stopped=!1;this._completed=!1;this._moreHistoryAvailable=!1;this._versionMap={};this._historyEntries=[];this._currentHistoryEntryIndex=0;this._versionsByLine=[];this._totalLines=0;this._processedLinesCount=0;this._beginFetchHistory(n.MAX_HISTORY_DEPTH,0,function(){t._historyEntries.length>0?t._annotateNextBatch():t._fireProgressEvent()})},n.prototype.cancel=function(){this._stopped=!0},n.prototype._beginFetchHistory=function(n,t,i){var r=this;this._repositoryContext.getClient().beginGetHistory(this._repositoryContext,this._getHistorySearchCriteria(n,t),function(n){r._stopped||(r._processHistoryResults(n),i.call(r))})},n.prototype._annotateNextBatch=function(){var n=this,t;t=Math.min(this._currentHistoryEntryIndex+this._diffBatchSize,this._historyEntries.length-1);this._annotateBatch(this._currentHistoryEntryIndex,t,function(){n._currentHistoryEntryIndex=t+1;n._fireProgressEvent();!n._completed&&n._historyEntries.length>n._currentHistoryEntryIndex&&n._annotateNextBatch()})},n.prototype._annotateBatch=function(){throw new Error("_annotateBatch is abstract.");},n.prototype._fireProgressEvent=function(){var n=this;$.each(this._progressEventListeners,function(t,i){i.call(n,n.getAnnotationBlocks(),n._versionMap,n._completed)})},n.prototype._processHistoryResults=function(n){var t=this;$.each(n.results,function(n,i){t._versionMap[i.changeList.version]=i});this._historyEntries=this._historyEntries.concat(n.results);this._moreHistoryAvailable=n.moreResultsAvailable},n.prototype._updateVersionsByLine=function(n,t,r){var u=this;$.each(n,function(n,f){var e,o;if(f.changeType===i.FileDiffBlockChangeType.Add||f.changeType===i.FileDiffBlockChangeType.Edit)for(o=f.mLine+f.mLinesCount-1,e=f.mLine;e<=o;e++)u._updateVersionByLine(e,t,r)});this._completed=this._processedLinesCount===this._totalLines},n.prototype._updateVersionByLine=function(n,t,i){var r;r=i?i[n]:n;r&&!this._versionsByLine[r]&&(this._versionsByLine[r]=t,this._processedLinesCount++)},n.prototype._updateLineMap=function(n,t){var u=this,r=[];return $.each(n,function(n,f){var e,o;if(f.changeType===i.FileDiffBlockChangeType.None)for(e=0;e<f.mLinesCount;e++)t?(o=t[f.mLine+e],o&&!u._versionsByLine[o]&&(r[f.oLine+e]=o)):r[f.oLine+e]=f.mLine+e}),r},n.prototype._calculateTotalLinesCount=function(n){var t;for(this._totalLines=0,t=n.length-1;t>=0;t--)if(n[t].mLinesCount>0){this._totalLines=n[t].mLine+n[t].mLinesCount-1;break}},n.prototype._setVersionForAllPendingLines=function(n){for(var t=1;t<=this._totalLines;t++)this._versionsByLine[t]||(this._versionsByLine[t]=n,this._processedLinesCount++);this._completed=!0},n.prototype._getHistorySearchCriteria=function(n,t){return{itemPath:this._path,itemVersion:this._version,top:n,skip:t,followRenames:!0,excludeDeletes:!0}},n.MAX_HISTORY_DEPTH=1e3,n.DEFAULT_DIFF_BATCH_SIZE=25,n}();t.AnnotationEngine=r});
define("VersionControl/Scripts/Controls/AnnotateGitAnnotationEngine",["require","exports","VersionControl/Scripts/Generated/TFS.VersionControl.Legacy.Contracts","VersionControl/Scripts/Controls/AnnotateAnnotationEngine"],function(n,t,i,r){Object.defineProperty(t,"__esModule",{value:!0});var u=function(n){function t(t,i,r){return n.call(this,t,i,r)||this}return __extends(t,n),t.prototype.start=function(){this._hasUnprocessedHistory=!1;this._lineMaps={};this._unprocessedBatchResults={};n.prototype.start.call(this)},t.prototype.hasUnprocessedHistory=function(){return this._hasUnprocessedHistory},t.prototype.getGitRepositoryContext=function(){return this.getRepositoryContext()},t.prototype._processHistoryResults=function(t){var i=t;this._hasUnprocessedHistory=i.unprocessedCount>0||i.unpopulatedCount>0;n.prototype._processHistoryResults.call(this,t)},t.prototype._annotateBatch=function(n,t,i){for(var r=this,e=[],f=this.getHistoryEntries(),u=n;u<=t;u++)e.push(f[u].changeList.version);this.getGitRepositoryContext().getGitClient().beginGetAnnotateGitDiffs(this.getGitRepositoryContext().getRepository(),this.getItemPath(),e,function(t){r.isCancelled()||($.each(t,function(t,i){var u=n+t;return r._processBatchResults(u,i,f)||(r._unprocessedBatchResults[u]=i),r.isComplete()?!1:void 0}),$.each(r._unprocessedBatchResults,function(n,t){r._processBatchResults(n,t,f)&&delete r._unprocessedBatchResults[n]}),i.call(r))})},t.prototype._processBatchResults=function(n,t,i){var u=this,f=i[n].changeList.version,r=this._lineMaps[t.mObjectId];if(n===0)this._calculateTotalLinesCount(t.diffs[0].diff.blocks);else if(!r)return!1;return t.diffs.length===1?this._updateVersionsByLine(t.diffs[0].diff.blocks,f,r):this._updateMergeCommitLines(t.diffs,f,r),$.each(t.diffs,function(n,t){u._lineMaps[t.oObjectId]=u._updateLineMap(t.diff.blocks,r)}),r&&delete this._lineMaps[t.mObjectId],!0},t.prototype._updateMergeCommitLines=function(n,t,r){var f=this,u=[];$.each(n,function(n,t){$.each(t.diff.blocks,function(n,t){var r,f;if(t.changeType===i.FileDiffBlockChangeType.Add||t.changeType===i.FileDiffBlockChangeType.Edit)for(f=t.mLine+t.mLinesCount-1,r=t.mLine;r<=f;r++)u[r]=(u[r]||0)+1})});$.each(u,function(i,u){u===n.length&&f._updateVersionByLine(i,t,r)})},t}(r.AnnotationEngine);t.GitAnnotationEngine=u});
define("VersionControl/Scripts/Controls/AnnotateTfsAnnotationEngine",["require","exports","VersionControl/Scripts/Controls/AnnotateAnnotationEngine"],function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(n){function t(t,i,r){return n.call(this,t,i,r)||this}return __extends(t,n),t.prototype.start=function(){this._lineMap=null;n.prototype.start.call(this)},t.prototype._getHistorySearchCriteria=function(t,i){return $.extend(n.prototype._getHistorySearchCriteria.call(this,t,i),{toVersion:this.getItemVersion()})},t.prototype._annotateBatch=function(n,t,i){var r=this,f,h=[],e,u=this.getHistoryEntries(),o,s;for(u.length>1&&t===u.length-1&&!this.hasMoreHistoryAvailable()&&t--,f=n;f<=t;f++)s=u[f],e={mFileId:s.fileId,mEncoding:s.encoding,mServerItem:s.serverItem},o=u[f+1],o&&(e.oFileId=o.fileId,e.oEncoding=o.encoding,e.oServerItem=o.serverItem),h.push(e);this.getRepositoryContext().getClient().beginGetAnnotateTfsDiffs(h,function(f){r.isCancelled()||($.each(f,function(t,i){var f=n+t;return f===0&&r._calculateTotalLinesCount(i.blocks),r._updateVersionsByLine(i.blocks,u[f].changeList.version,r._lineMap),r._lineMap=r._updateLineMap(i.blocks,r._lineMap),r.isComplete()?!1:void 0}),!r.isComplete()&&t>=u.length-2&&!r.hasMoreHistoryAvailable()&&r._setVersionForAllPendingLines(u[u.length-1].changeList.version),i.call(r))})},t}(i.AnnotationEngine);t.TfsAnnotationEngine=r});
define("VersionControl/Scenarios/Shared/FileViewers/AnnotatedFileViewer",["require","exports","OfficeFabric/MessageBar","OfficeFabric/Utilities","react","VSS/Utils/String","Presentation/Scripts/TFS/Components/Splitter","VersionControl/Scenarios/Shared/FileViewers/BlameList","VersionControl/Scenarios/Shared/FileViewers/EditableFileViewer","VersionControl/Scripts/Controls/AnnotateGitAnnotationEngine","VersionControl/Scripts/Controls/AnnotateTfsAnnotationEngine","VersionControl/Scripts/RepositoryContext","VersionControl/Scripts/Resources/TFS.Resources.VersionControl","VersionControl/Scripts/Utils/Number","VSS/LoaderPlugins/Css!VersionControl/Shared/FileViewers/AnnotatedFileViewer"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){function d(n,t){for(var i=0;i<n.length-1;i++)if(n[i].changeList.version===t)return n[i+1]}function g(n){n&&n.raiseScrollChanged()}function p(n,t){for(var r,e,u=[],i=1,f=0,o=n;f<o.length;f++)r=o[f],e=r.startLine-i,e>0&&u.push({startLine:i,lineCount:e,version:"unknown"}),u.push(r),i=r.startLine+r.lineCount;return i<t&&u.push(w(i,t)),u}function w(n,t){return{startLine:n,lineCount:t-n+1,version:"unknown-cut"}}function y(n,t,i,r,u){u===void 0&&(u=Date.now());var f=t==="blameScrollTop"?"fileScrollTop":"blameScrollTop";return function(e){var h=e[t],o,s;return h===undefined||nt(e,u)?(o={},o[f]=n,o[t]=undefined,o.requestedScrollTime=u,o.lineHeight=i||e.lineHeight,o.firstLineTop=r!==undefined?r:e.firstLineTop,o):v.areSimilar(n,h)?(s={},s[t]=undefined,s.requestedScrollTime=undefined,s):void 0}}function nt(n,t){return n.blocks?t-n.requestedScrollTime>b:!1}function tt(n){if(n&&n.length>0)return n[n.length-1]}Object.defineProperty(t,"__esModule",{value:!0});var b=600,k=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.state={},t.getVersionForLineNumber=function(n){return n&&t.annotationEngine&&t.annotationEngine.getVersionForLineNumber(n)},t.refreshBlocks=function(n,i,r){if(n.length||r){var u=t.annotationEngine.hasUnprocessedHistory()?a.AnnotateUnprocessedHistoryWarningFormat:t.annotationEngine.hasMoreHistoryAvailable()?f.format(a.AnnotateMaxHistoryWarningFormat,t.annotationEngine.getHistoryEntries().length):undefined;t.setState({blocks:p(n,t.props.linesCount),warningMessage:u})}},t.onFileViewerSelectionChanged=function(n){t.setState({lineNumber:n.startLineNumber})},t.onFileViewerScrollChanged=function(n){t.setState(y(n.scrollTop,"fileScrollTop",n.lineHeight,n.firstLineTop))},t.onBlameScrollChanged=function(n){t.setState(y(n,"blameScrollTop"))},t.viewBlamePrior=function(n){if(t.props.onChangeVersion&&t.annotationEngine){var i=d(t.annotationEngine.getHistoryEntries(),n.version);if(i)t.props.onChangeVersion(i.changeList.version)}},t}return __extends(t,n),t.prototype.componentWillMount=function(){this.createAnnotationEngine(this.props)},t.prototype.componentWillUnmount=function(){this.destroyEngine()},t.prototype.componentWillReceiveProps=function(n){if(n.displayItem!==this.props.displayItem)this.destroyEngine(),this.setState({blocks:undefined,fileScrollTop:undefined,blameScrollTop:undefined,lineNumber:undefined});else if(n.linesCount!==this.props.linesCount&&this.hasBlocks()){var t=this.state.blocks[this.state.blocks.length-1],i=t.startLine+t.lineCount;i<n.linesCount&&this.setState({blocks:this.state.blocks.concat([w(i,n.linesCount)])})}this.createAnnotationEngine(n)},t.prototype.render=function(){var n=Boolean(this.props.isAnnotate&&this.state.lineHeight);return u.createElement("div",{className:r.css("vc-new-annotated-file-viewer",{hidden:!this.props.isVisible})},this.state.warningMessage&&u.createElement(i.MessageBar,{messageBarType:i.MessageBarType.warning},this.state.warningMessage),u.createElement(e.Splitter,{statefulSettingsPath:"Git.Explorer.BlameSplitter",left:n&&u.createElement(o.BlameList,{repositoryContext:this.props.repositoryContext,path:this.props.displayItem&&this.props.displayItem.serverItem,blocks:this.state.blocks,firstVersion:this.getFirstVersion(),versionsMap:this.annotationEngine?this.annotationEngine.getVersionMap():{},getVersion:this.getVersionForLineNumber,currentLineNumber:this.state.lineNumber,onCommitClick:this.props.onCommitClick,onScroll:this.onBlameScrollChanged,onViewBlamePrior:this.viewBlamePrior,scrollTop:this.state.blameScrollTop,lineHeight:this.state.lineHeight,firstLineTop:this.state.firstLineTop}),isLeftPaneVisible:n,right:u.createElement(s.EditableFileViewer,__assign({},this.props,{ref:g,scrollTop:this.state.fileScrollTop,onSelectionChanged:this.onFileViewerSelectionChanged,onScrollChanged:this.onFileViewerScrollChanged})),enableToggleButton:!1}))},t.prototype.hasBlocks=function(){return this.state.blocks&&this.state.blocks.length>0},t.prototype.getFirstVersion=function(){var n=tt(this.annotationEngine&&this.annotationEngine.getHistoryEntries());return n&&n.changeList.version},t.prototype.createAnnotationEngine=function(n){var t=n.displayItem;n.isAnnotate&&n.isVisible&&t&&!this.annotationEngine&&(this.annotationEngine=this.props.repositoryContext.getRepositoryType()===l.RepositoryType.Git?new h.GitAnnotationEngine(this.props.repositoryContext,t.serverItem,t.version):new c.TfsAnnotationEngine(this.props.repositoryContext,t.serverItem,t.version),this.annotationEngine.addProgressListener(this.refreshBlocks),this.annotationEngine.start())},t.prototype.destroyEngine=function(){this.annotationEngine&&(this.annotationEngine.cancel(),this.annotationEngine=undefined)},t.defaultProps={isVisible:!0},t}(u.PureComponent);t.AnnotatedFileViewer=k;t.fillGaps=p;t.updateScrollTop=y});
define("VersionControl/Scenarios/Explorer/Components/FileContent",["require","exports","react","VersionControl/Scenarios/Explorer/Components/Container","VersionControl/Scenarios/Shared/FileViewers/AnnotatedFileViewer","VersionControl/Scripts/Controls/ControlsCommon"],function(n,t,i,r,u,f){function e(n){return!n}Object.defineProperty(t,"__esModule",{value:!0});t.FileContentContainer=r.create(["pivotTabs","itemContent","fileContent","context"],function(n,t){var s=n.pivotTabsState,h=n.itemContentState,r=n.fileContentState,c=n.repositoryContext,o=t.actionCreator,l=t.isVisible;return i.createElement(u.AnnotatedFileViewer,{className:"navigation-view-tab",isVisible:l,isAnnotate:s.isAnnotate,isPreviewMode:s.isPreviewMode,isDiffMode:s.currentTab===f.VersionControlActionIds.HighlightChanges,isDiffInline:r.isDiffInline,displayItem:e(r.isLoadingInitialContent)&&h.displayItem,initialContent:r.originalContent,isEditing:r.isEditing,isNewFile:r.isNewFile,scrollToAnchor:r.scrollToAnchor,useFragmentsForMarkdownLinks:!0,line:r.line,linesCount:r.originalLinesCount,repositoryContext:c,onFileContentLoaded:r.originalContent===undefined&&o.changeOriginalContent,onContentEdited:o.editFileContent,onCommitClick:o.goToBlameCommit,onChangeVersion:o.changeVersionToBlame,onEditorEscapeEdit:o.focusManager.setFocusToCommandBar})})});
if (window.performance && window.performance.mark) { window.performance.mark('endLoadBundleInner-async'); }