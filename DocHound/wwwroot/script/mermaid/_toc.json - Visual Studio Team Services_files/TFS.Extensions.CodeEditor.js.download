//dependencies=BuiltInExtensions/Scripts/TFS.Extension#0,BuiltInExtensions/Scripts/Resources/TFS.Resources.CodeEditor#0,VSS/Controls/PopupContent#?,VSS/Utils/Array#?,VSS/Utils/Core#?,VSS/Utils/String#?,VSS/Utils/UI#?,VSS/Utils/Url#?,VSS/Utils/Clipboard#?,VSS/VSS#?,Presentation/Scripts/TFS/TFS.Discussion.Common,jQueryUI/core#?,Presentation/Scripts/TFS/TFS.Discussion.Common.UI,Presentation/Scripts/TFS/Resources/TFS.Resources.Discussion#0,Presentation/Scripts/URI#?,Presentation/Scripts/TFS/TFS.Adornment.Common#0,BuiltInExtensions/Scripts/TFS.Extensions.CodeEditor.Adornments,VSS/Diag#?,VSS/Locations#?,q#?,VSS/FeatureAvailability/Services#?,Presentation/Scripts/TFS/Generated/TFS.Server.WebAccess.Constants#0,Mention/Scripts/TFS.Mention,VSS/Utils/Accessibility#?,VSS/Context#?,VSS/Common/Contracts/Platform#?,VSS/Contributions/LocalPageData#?,Presentation/Scripts/TFS/TFS.Host.TfsContext,jQueryUI/autocomplete#?,Mention/Scripts/TFS.Mention.Helpers,Mention/Scripts/Resources/TFS.Resources.Mention#0,Mention/Scripts/TFS.Mention.Autocomplete.JQueryAutocomplete,VSS/Service#?,VSS/Telemetry/Services#?,Mention/Scripts/TFS.Social.Telemetry,Presentation/Scripts/TFS/Generated/TFS.WorkItemTracking.Constants#0,TFS/WorkItemTracking/RestClient#?,VSS/Contributions/Services#?,VSS/Error#?,Presentation/Scripts/TFS/FeatureRef/WorkItemTypeColorAndIconsProvider,react#?,react-dom#?,OfficeFabric/Utilities#?,OfficeFabric/Tooltip#?,VSS/LoaderPlugins/Css!Presentation/Components/WorkItemTypeIcon#?,Presentation/Scripts/TFS/Components/WorkItemTypeIcon,Mention/Scripts/TFS.Mention.WorkItems
// Copyright (C) Microsoft Corporation. All rights reserved.
var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__assign=this&&this.__assign||Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n};define(["require","exports","BuiltInExtensions/Scripts/TFS.Extension","BuiltInExtensions/Scripts/Resources/TFS.Resources.CodeEditor","VSS/Controls/PopupContent","VSS/Utils/Array","VSS/Utils/Core","VSS/Utils/String","VSS/Utils/UI","VSS/Utils/Url","VSS/Utils/Clipboard","Presentation/Scripts/TFS/TFS.Discussion.Common","Presentation/Scripts/TFS/TFS.Discussion.Common.UI","Presentation/Scripts/TFS/Resources/TFS.Resources.Discussion","Presentation/Scripts/URI","BuiltInExtensions/Scripts/TFS.Extensions.CodeEditor.Adornments","VSS/Diag","VSS/VSS","VSS/Locations","Mention/Scripts/TFS.Mention.WorkItems"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){function ht(t){g?t.call(this,g):n(["vs/editor/contrib/zoneWidget/browser/zoneWidget"],function(n){g=function(){var t=function(t){n.ZoneWidget.call(this,t,{showFrame:!1,showArrow:!1})},i=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype;n.prototype=new i};return i(t,n.ZoneWidget),t.prototype._onWidth=function(n){this.discussionThread.onWidth(n)},t.prototype._doLayout=function(n,t){this.discussionThread.doLayout(n,t)},t.prototype._fillContainer=function(n){this.discussionThread.fillContainer(n)},t}();t.call(this,g)})}function ot(n){return n.positionLineNumber<n.selectionStartLineNumber||n.positionLineNumber===n.selectionStartLineNumber&&n.positionColumn<n.selectionStartColumn}function ut(n){return!n||n.endLineNumber===n.startLineNumber&&n.endColumn===n.startColumn}function st(n){return n.getEditorType()===monaco.editor.EditorType.IDiffEditor}function ft(n){n&&n.length&&n.forEach(function(n){n.dispose()})}function nt(n){return n===undefined||n===null}var it,tt,rt,et,g;Object.defineProperty(t,"__esModule",{value:!0});window.MonacoEnvironment={getWorkerUrl:function(){return k.urlHelper.getMvcUrl({action:"WorkerLoaderProxy",controller:"CodeEditor",area:"BuiltInExtensions",team:null,project:null,queryParams:{version:"0.10.1"}})}};it=function(){function t(){this._versionControlExtension=null;this._hostIdClass="";this._isEditorInitialized=!1;this._monacoContentTypesByExtension=null;this._contentLoadInProgress=!1;this._contentLoadedDeferred=$.Deferred().resolve();this._currentConfig={};this._diffEditorLeftItemInfo={};this._diffEditorRightItemInfo={};this._diffPerformedInitialScroll=!1;this._throttledContentChangedTimeMs=300;this._throttledContentChangedTimeout=null;this._maxFileContentLength=5242880;this._editorOptions=null;this._editorTopOffset=0;this._editorFirstLineTop=0;this._previousError=null;this._currentDiffSelection=null;this._discussionThreadControlManagersByEditorId={};this._adornmentControlManagersByEditorId={};this._originalContent=null;this._originalContentType=null;this._originalContentPath=null;this._isDirty=!1;this._diffEditorForEdit=null;this._$diffEditorHost=null;this._$editorHost=null;this._diffEditMode=!1;this._resizeRequested=!1;this._contentChangedListener=null;this._escapeEditListener=null;this._lineLinkingWidgetsByEditorId={};this._editorDisposables=[];this._diffEditorDisposables=[];this._customLanguages={};this._userPreferences={};this.NUM_CHARS_FOR_ICON_PADDING=3;this.DEFAULT_MIN_LINE_CHARS_WIDTH=5;this.DEFAULT_FONT_SIZE=12}return t.prototype.isContentLoadInProgress=function(){return this._contentLoadInProgress},t.prototype.isDiffEditorInitialized=function(){return this._diffPerformedInitialScroll},t.prototype.isEditorInitialized=function(){return this._isEditorInitialized},t.prototype.setErrorMessage=function(n,t){var u,r,f;t!==this._previousError&&(this._previousError=t,u=$(".code-editor-host"+this._hostIdClass),r=$(".errors-host"+this._hostIdClass),t?(r.empty(),$("<div />").addClass("error-message").text(t).attr("title",t).appendTo(r),r.show(),u.addClass("with-error"),f=u.children().eq(0),f.length&&(this._editorTopOffset=f.offset().top)):(r.hide(),u.removeClass("with-error"),this._editorTopOffset=0),n&&this.getEditorOptions().monitorScroll&&this._versionControlExtension.sendMessage(i.VersionControl.ActionIds.SCROLL_POSITION_CHANGED,this.getEditorScrollPosition(n)))},t.prototype.checkSupportedVersion=function(){var n;return s.BrowserCheckUtils.isMsie()&&(n=parseFloat(s.BrowserCheckUtils.getVersion()),n<8)?(this.setErrorMessage(null,r.IEVersionError),this._versionControlExtension.sendLoadError(r.IEVersionError),!1):!0},t.prototype.getEditorOptions=function(){if(!this._editorOptions){var n={fontSize:this.DEFAULT_FONT_SIZE,lineNumbersMinChars:this.DEFAULT_MIN_LINE_CHARS_WIDTH};this._editorOptions=$.parseJSON($(".code-editor-options"+this._hostIdClass).html()||"{}");this._editorOptions.configuration=$.extend(n,this._editorOptions.configuration)}return this._editorOptions},t.prototype.getEditorTheme=function(n){var r=this.getEditorOptions(),t=r.editorThemeInfo;if(!t){var i=r.editorTheme||"vs",u=n||r.editorCss||"default",f="tfs-extension-"+u;i==="hc-black"&&this.isEdgeWithWindowsHighContrastTheme()&&(i="vs");t={themeName:f,themeData:{base:i,inherit:!0,rules:i==="vs"?pt:i==="hc-black"?wt:[],colors:{}}};r.editorThemeInfo=t;monaco.editor.defineTheme(t.themeName,t.themeData)}return t},t.prototype.isEdgeWithWindowsHighContrastTheme=function(){return s.BrowserCheckUtils.isEdge()&&window.matchMedia&&window.matchMedia("(-ms-high-contrast:active)").matches?!0:!1},t.prototype.getContentType=function(n){var t=n.metadata?n.metadata.contentType||"":"",i,r,u;return t=t.toLowerCase(),t&&t!=="application/octet-stream"||(t="text/plain"),t==="text/plain"&&(i=n.content,i&&i.length>5&&(i.substring(0,5).toLowerCase()==="<?xml"?t="text/xml":n.metadata&&n.metadata.extension==="h"&&(r=i.indexOf("@interface"),u=r>-1?i.lastIndexOf("@end"):0,u>0&&u>r&&(t="text/x-objective-c")))),t},t.prototype.getMonacoContentTypeOverride=function(n){return this._monacoContentTypesByExtension===null&&(this._monacoContentTypesByExtension={},this._monacoContentTypesByExtension.bat="text/x-bat",this._monacoContentTypesByExtension.c="text/x-cpp",this._monacoContentTypesByExtension.cc="text/x-cpp",this._monacoContentTypesByExtension.cmd="text/x-bat",this._monacoContentTypesByExtension.coffee="text/x-coffeescript",this._monacoContentTypesByExtension.config="text/xml",this._monacoContentTypesByExtension.cpp="text/x-cpp",this._monacoContentTypesByExtension.cs="text/x-csharp",this._monacoContentTypesByExtension.cshtml="text/x-cshtml",this._monacoContentTypesByExtension.csproj="text/xml",this._monacoContentTypesByExtension.css="text/css",this._monacoContentTypesByExtension.cxx="text/x-cpp",this._monacoContentTypesByExtension.fs="text/x-fsharp",this._monacoContentTypesByExtension.fsx="text/x-fsharp",this._monacoContentTypesByExtension.go="text/x-go",this._monacoContentTypesByExtension.h="text/x-cpp",this._monacoContentTypesByExtension.handlebars="text/x-handlebars-template",this._monacoContentTypesByExtension.hpp="text/x-cpp",this._monacoContentTypesByExtension.htm="text/html",this._monacoContentTypesByExtension.html="text/html",this._monacoContentTypesByExtension.ini="text/ini",this._monacoContentTypesByExtension.jade="text/x-jade",this._monacoContentTypesByExtension.java="text/x-java-source",this._monacoContentTypesByExtension.js="text/javascript",this._monacoContentTypesByExtension.json="application/json",this._monacoContentTypesByExtension.less="text/x-less",this._monacoContentTypesByExtension.lua="text/x-lua",this._monacoContentTypesByExtension.m="text/x-objective-c",this._monacoContentTypesByExtension.markdown="text/x-markdown",this._monacoContentTypesByExtension.md="text/x-markdown",this._monacoContentTypesByExtension.mdown="text/x-markdown",this._monacoContentTypesByExtension.php="application/x-php",this._monacoContentTypesByExtension.ps1="text/x-powershell",this._monacoContentTypesByExtension.psm1="text/x-powershell",this._monacoContentTypesByExtension.py="text/x-python",this._monacoContentTypesByExtension.r="text/x-r",this._monacoContentTypesByExtension.rb="text/x-ruby",this._monacoContentTypesByExtension.rc="text/x-cpp",this._monacoContentTypesByExtension.rhistory="text/x-r",this._monacoContentTypesByExtension.rt="text/x-r",this._monacoContentTypesByExtension.sass="text/x-scss",this._monacoContentTypesByExtension.scss="text/x-scss",this._monacoContentTypesByExtension.sql="text/x-sql",this._monacoContentTypesByExtension.strada="text/strada",this._monacoContentTypesByExtension.swift="text/swift",this._monacoContentTypesByExtension.ts="text/typescript",this._monacoContentTypesByExtension.tsx="text/typescript",this._monacoContentTypesByExtension.vb="text/x-vb",this._monacoContentTypesByExtension.xaml="application/xaml+xml",this._monacoContentTypesByExtension.xml="text/xml"),this._monacoContentTypesByExtension[(""+n).toLowerCase()]},t.prototype.beginGetMonacoMode=function(n,t,i){var r,u,f;if(!!n&&typeof n!="string"){if(r=n,r.name){r.name=r.name.toLowerCase().replace(/[^a-z]/g,"");this._customLanguages[r.name]||(r.tokenPostfix=r.tokenPostfix||"",monaco.languages.register({id:r.name}),monaco.languages.setMonarchTokensProvider(r.name,r),this._customLanguages[r.name]=r);i(r.name);return}i("text/plain");return}if(n!=="text/x-objective-c"&&t&&(u=t.filePath,f=(""+u).lastIndexOf("."),f>=0&&(n=this.getMonacoContentTypeOverride(u.substr(f+1))||n)),!n||n==="text/plain"){i("text/plain");return}i(n)},t.prototype.sendEditorContentChangedEvent=function(n){var t=this;this._throttledContentChangedTimeout&&window.clearTimeout(this._throttledContentChangedTimeout);this._throttledContentChangedTimeout=window.setTimeout(function(){var r=n.getValue(),i;t._versionControlExtension.sendEditorContentChangedEvent(t._contentLoadInProgress,r);t._contentLoadInProgress||(i=r!==t._originalContent,i!==t._isDirty&&(t._isDirty=i,t._versionControlExtension.sendEditorDirtyStateChangedEvent(i)))},this._isDirty?this._throttledContentChangedTimeMs:0)},t.prototype.getEditorScrollPosition=function(n){return{scrollTop:n.getScrollTop(),scrollLeft:n.getScrollLeft(),lineHeight:n.getConfiguration().lineHeight,topOffset:this._editorTopOffset,firstLineTop:this._editorFirstLineTop}},t.prototype.setEditorScrollPosition=function(n,t){n.setScrollPosition(t)},t.prototype.getEditorSelection=function(n){return n.getSelection()},t.prototype.updateEditorTheme=function(n,t,i){var e=this.getEditorTheme(t.editorCss).themeName,u,f,r;e!==this._themeName&&(u=i.getConfiguration().lineHeight,this._themeName=e,monaco.editor.setTheme(this._themeName),f=i.getConfiguration().lineHeight,f!==u&&(r=n.getScrollTop(),r!==0&&(r=r*f/u,n.setScrollTop(r))))},t.prototype.updateEditorReadOnly=function(n,t){var u=this,r=n.getConfiguration(),i=t.editable!==!0;r.readOnly!==i&&n.updateOptions({readOnly:i});i?(this._contentChangedListener&&(this._contentChangedListener.dispose(),this._contentChangedListener=null),this._escapeEditListener&&(this._escapeEditListener.dispose(),this._escapeEditListener=null)):(this._escapeEditListener=n.onKeyDown(function(n){n.keyCode!==monaco.KeyCode.Escape||n.altKey||n.ctrlKey||n.metaKey||n.shiftKey||u.sendEscapeEditEvent()}),this.addContentChangedListener(n,r,t),t.noFocus||n.focus())},t.prototype.updateUserPreferences=function(n,t){var i=t.userPreferences;i&&Object.keys(i).length>0&&(this._userPreferences.foldingEnabled!==i.foldingEnabled||this._userPreferences.minimapEnabled!==i.minimapEnabled||this._userPreferences.whiteSpaceEnabled!==i.whiteSpaceEnabled||this._userPreferences.wordWrapEnabled!==i.wordWrapEnabled)&&(this._userPreferences=i,this.toggleFolding(this._userPreferences.foldingEnabled),this.toggleMinimap(this._userPreferences.minimapEnabled),this.toggleWhiteSpace(this._userPreferences.whiteSpaceEnabled),this.toggleWordWrap(this._userPreferences.wordWrapEnabled),this.updateEditorOptions(n))},t.prototype.addContentChangedListener=function(n,t,i){var u=this,r;i=i||{};r=i.contentChangedDelay||t.contentChangedDelay;typeof r=="number"&&(this._throttledContentChangedTimeMs=r);this._contentChangedListener||(this._contentChangedListener=n.onDidChangeModelContent(function(){u.sendEditorContentChangedEvent(n)}))},t.prototype.setContentLoadInProgress=function(n){this._contentLoadInProgress=n;n?this._contentLoadedDeferred.state()!=="pending"&&(this._contentLoadedDeferred=$.Deferred()):this._contentLoadedDeferred.resolve()},t.prototype.setEditorModel=function(n,t){var i=n.getModel();n.setModel(t);this.disposeModel(i)},t.prototype.setDiffEditorModels=function(n,t,i){var r=n.getOriginalEditor().getModel(),u=n.getModifiedEditor().getModel();n.setModel({original:t,modified:i});this.disposeModel(r);this.disposeModel(u)},t.prototype.disposeModel=function(n){n&&!n.isDisposed()&&n.dispose()},t.prototype.setEditorContent=function(n,t,i,r,u,f){var e=this,o;this._originalContent=t;u&&(o={filePath:u.path});this._isDirty=!1;this.beginGetMonacoMode(r,o,function(r){var o=u?e.getResourceURL(u):null;e.setEditorModel(n,monaco.editor.createModel(t||"",r,o));n.layout();i&&e.setContentLoadInProgress(!1);e._currentConfig.editable&&(e._currentConfig.noFocus||n.focus());f&&f.call(e)})},t.prototype.getResourceURL=function(n){var i=y.encode(n.version||""),t=n.path||"";return t=t.indexOf("/")===0?t.substring(1):t,t=y.encode(t.toLowerCase()),monaco.Uri.parse(o.format("inMemory://model/{0}/{1}/{2}",n.repo||"",i,t))},t.prototype.beginCreateBuiltInEditor=function(n,t){tt.setModuleCodeEditor(this);this.beginCreateEditor(n,t)},t.prototype.beginCreateEditor=function(t,r){var u=this;this.checkSupportedVersion()&&(r=r||i.getVersionControlExtension(),this._versionControlExtension=r,this.setHostIdClass(),n(["vs/editor/editor.main"],function(){var f=$(".code-editor-host"+u._hostIdClass),r,n,o,e;if(f[0]){u._$editorHost=f;r=u.getEditorOptions();n=monaco.editor.create(f[0],$.extend(r.configuration||{},{value:"",mode:"text/plain",readOnly:r.editable!==!0,scrollBeyondLastLine:r.editable===!0,theme:u.getEditorTheme().themeName,wrappingColumn:-1,longLineBoundary:1e6,scrollbar:{horizontalScrollbarSize:14,verticalScrollbarSize:16}}));d.editor.minimap.enabled=d.editor.minimap.enabled||r.minimapEnabled===!0;d.editor.folding=d.editor.folding||r.foldingEnabled===!0;u.updateEditorOptions(n);f.data("editor",n);f.bind("remove",function(){u._isEditorInitialized=!1;u.setEditorModel(n,null);n.dispose()});n.onDidDispose(function(){ft(u._editorDisposables);u._editorDisposables=[]});if(r.editable===!0&&u.addContentChangedListener(n,r),r.monitorScroll&&u._editorDisposables.push(n.onDidScrollChange(function(t){t.scrollTopChanged&&(u._editorFirstLineTop=n.getTopForLineNumber(1));u._versionControlExtension.sendMessage(i.VersionControl.ActionIds.SCROLL_POSITION_CHANGED,u.getEditorScrollPosition(n))})),r.monitorSelection&&u._editorDisposables.push(n.onDidChangeCursorPosition(function(){u._versionControlExtension.sendMessage(i.VersionControl.ActionIds.SELECTION_CHANGED,u.getEditorSelection(n))})),r.bindKeys)for(o=n,e=0;e<r.bindKeys.length;e++)typeof o.addCommand=="function"&&o.addCommand(r.bindKeys[e],function(n){return function(){this.sendKeyDownEvent(r.bindKeys[n])}}(e));u.addBuiltInContextMenuItems(n);r.contextMenuItems&&u.addContextMenuItems(r.contextMenuItems,n);u._versionControlExtension.addMessageListener(i.VersionControl.ActionIds.EDITOR_ADD_CONTEXT_MENU_ITEM,function(t){t.actionData.contextMenuItems&&u.addContextMenuItems(t.actionData.contextMenuItems,n)});$(window).resize(function(){u._diffEditMode?u._resizeRequested=!0:u.layoutFileEditor(n)});u._versionControlExtension.addMessageListener(i.VersionControl.ActionIds.GET_EDITOR_CONTENT,function(t){u._contentLoadedDeferred.done(function(){u._versionControlExtension.sendEditorContent(n.getValue((t.actionData||{}).codeEditorOptions),t.requestId)})});u._versionControlExtension.addMessageListener(i.VersionControl.ActionIds.GET_SCROLL_POSITION,function(t){u._versionControlExtension.sendResponse(t.requestId,i.VersionControl.ActionIds.GET_SCROLL_POSITION,u.getEditorScrollPosition(n))});u._versionControlExtension.addMessageListener(i.VersionControl.ActionIds.SET_SCROLL_POSITION,function(t){u.setEditorScrollPosition(n,t.actionData)});u._versionControlExtension.addMessageListener(i.VersionControl.ActionIds.GET_SELECTION,function(t){u._versionControlExtension.sendResponse(t.requestId,i.VersionControl.ActionIds.GET_SELECTION,u.getEditorSelection(n))});u._versionControlExtension.addMessageListener(i.VersionControl.ActionIds.REFRESH_LAYOUT,function(){n.layout()});u._versionControlExtension.onResetEditorDiffContent(function(){u._originalContent=n.getValue();u.showEditDiff(!1)});u._versionControlExtension.sendMessage(i.VersionControl.ActionIds.EDITOR_CREATED);t&&t.call(u,n)}}))},t.prototype.setHostIdClass=function(){var n=this._versionControlExtension.getHostId();this._hostIdClass=n?".code-editor-hostId-"+n:""},t.prototype.addContextMenuItems=function(n,t){var r=this,u,i;t!==null&&(u=t.getActions(),i=f.toDictionary(u,function(n){return n.label},function(){return!0}),n.forEach(function(n){i[n.label]||(i[n.label]=!0,t.addAction({id:n.id,label:n.label,contextMenuGroupId:n.contextMenuGroupId,enablement:n.enablement,keybindings:n.keybindings,keybindingContext:undefined,run:function(t){var i=r.getDataForContextMenuItemAction(t),u={contextMenuItemId:n.id,dataForAction:i};return r.sendContextMenuItemClickEvent(u),null}}))}))},t.prototype.addBuiltInContextMenuItems=function(n){var t=this;if(n){var i=st(n)?n:null,u=i?i.getModifiedEditor():n,f=void 0;i||(f={id:"tfs-toggle-folding",label:r.ContextMenuToggleCodeFolding,keybindings:[monaco.KeyMod.chord(monaco.KeyMod.CtrlCmd|monaco.KeyCode.KEY_K,monaco.KeyMod.CtrlCmd|monaco.KeyCode.KEY_K)],run:function(){t._userPreferences.foldingEnabled=t.toggleFolding(u);t.updateEditorOptions(i||u);t.sendEditorPreferenceChangedEvent({foldingEnabled:t._userPreferences.foldingEnabled})}},u.addAction(f),i&&i.getOriginalEditor().addAction(f));f={id:"tfs-toggle-minimap",label:r.ContextMenuToggleMinimap,run:function(){t._userPreferences.minimapEnabled=t.toggleMinimap(u);t.updateEditorOptions(i||u);t.sendEditorPreferenceChangedEvent({minimapEnabled:t._userPreferences.minimapEnabled})}};u.addAction(f);i&&i.getOriginalEditor().addAction(f);f={id:"tfs-toggle-wordwrap",label:r.ContextMenuToggleWordWrap,run:function(){t._userPreferences.wordWrapEnabled=t.toggleWordWrap(u);t.updateEditorOptions(i||u);t.sendEditorPreferenceChangedEvent({wordWrapEnabled:t._userPreferences.wordWrapEnabled})}};u.addAction(f);i&&i.getOriginalEditor().addAction(f);f={id:"tfs-toggle-whitespace",label:r.ContextMenuToggleWhiteSpace,run:function(){t._userPreferences.whiteSpaceEnabled=t.toggleWhiteSpace(u);t.updateEditorOptions(i||u);t.sendEditorPreferenceChangedEvent({whiteSpaceEnabled:t._userPreferences.whiteSpaceEnabled})}};u.addAction(f);i&&i.getOriginalEditor().addAction(f)}},t.prototype.toggleFolding=function(n){if(nt(n))return!1;var t=typeof n=="boolean"?n:!n.getConfiguration().contribInfo.folding;return d.editor.folding=t,t},t.prototype.toggleMinimap=function(n){if(nt(n))return!1;var t=typeof n=="boolean"?n:!n.getConfiguration().viewInfo.minimap.enabled;return d.editor.minimap.enabled=t,t},t.prototype.toggleWhiteSpace=function(n){if(nt(n))return!1;var t=typeof n=="boolean"?n:n.getConfiguration().viewInfo.renderWhitespace==="none";return d.editor.renderWhitespace=t?"all":"none",d.editor.ignoreTrimWhitespace=!t,t},t.prototype.toggleWordWrap=function(n){if(nt(n))return!1;var t=typeof n=="boolean"?n:!n.getConfiguration().wrappingInfo.isViewportWrapping;return d.editor.wordWrap=t?"on":"off",t},t.prototype.updateEditorOptions=function(n){if(d.ignoreConfigurationChangedEvent=!0,st(n)){var i=n,t=this.getAdjustedDiffEditorOptions();i.updateOptions(t);(t.minimap.enabled||t.wordWrap==="on")&&(i.getModifiedEditor().updateOptions(t),t.minimap.enabled=!1,t.wordWrap==="on"&&(t.lineNumbers="off",t.wordWrap="off",i.getOriginalEditor().updateOptions(t)))}else n.updateOptions(d.editor);d.ignoreConfigurationChangedEvent=!1},t.prototype.getAdjustedDiffEditorOptions=function(){return __assign({},d.editor,{minimap:__assign({},d.editor.minimap),wordWrap:d.editor.renderSideBySide?"off":d.editor.wordWrap,folding:!1})},t.prototype.sendKeyDownEvent=function(n){this._versionControlExtension.sendMessage(i.VersionControl.ActionIds.EDITOR_KEY_PRESSED,n)},t.prototype.sendEscapeEditEvent=function(){this._versionControlExtension.sendMessage(i.VersionControl.ActionIds.EDITOR_ESCAPE_EDIT)},t.prototype.sendContextMenuItemClickEvent=function(n){this._versionControlExtension.sendMessage(i.VersionControl.ActionIds.EDITOR_CONTEXT_MENU_ITEM_CLICKED,n)},t.prototype.sendEditorPreferenceChangedEvent=function(n){this._versionControlExtension.sendEditorPreferencesChangedEvent(n)},t.prototype.getDataForContextMenuItemAction=function(n){var u={},t=n.getSelection(),i="",f=n.getModel(),s=Math.max(t.startLineNumber,t.endLineNumber),e=Math.min(t.startLineNumber,t.endLineNumber),o=Math.min(t.startColumn,t.endColumn),h=Math.max(t.startColumn,t.endColumn),r;return s>e||h>o?i=f.getValueInRange(t):(r=f.getWordAtPosition({lineNumber:e,column:o}),r&&(i=r.word)),u.textUnderCursorOrSelection=i,u},t.prototype.layoutFileEditor=function(n){this._resizeRequested=!1;!this._versionControlExtension.getConfiguration().skipLayoutOnResize&&this._isEditorVisible(n)&&n.layout()},t.prototype._isEditorVisible=function(n){return n.domElement||w.logWarning("TFS.ExtensionsCodeEditor: editor.domElement is not available. Perhaps an upgrade has changed this editor private attribute."),$(n.domElement).is(":visible")},t.prototype.setEditorConfig=function(n,t){var i=this,u,f,e;if(this.updateEditorTheme(n,t,n),this.updateEditorReadOnly(n,t),this.updateUserPreferences(n,t),this.updateCommonEditorConfig(n,!1,t),t.activeState===!1){this._currentConfig=t;return}if(t.showDiff){this._diffEditMode=!0;this._$diffEditorHost?this._diffEditorForEdit&&this.renderEditDiff(n):(u=$(".code-editor-host").parent(),this._$diffEditorHost=$("<div><\/div>").addClass("code-editor-host").appendTo(u),this.beginCreateDiffEditor(function(r){if(i._diffEditorForEdit=r,i.updateDiffSideBySide(i._diffEditorForEdit,t),t.editable){var u=r.getModifiedEditor();u.updateOptions({readOnly:!1});u.onDidChangeModelContent(function(){n.setValue(u.getValue())})}i.renderEditDiff(n)},this._versionControlExtension));this.updateDiffSideBySide(this._diffEditorForEdit,t);this._currentConfig=t;return}if(t.path&&t.path===this._currentConfig.path&&t.version===this._currentConfig.version&&typeof t.content!="string"&&!t.forceRefresh&&(!t.repositoryId||t.repositoryId===this._currentConfig.repositoryId)){this._diffEditMode=!1;this.showEditDiff(!1);this._contentLoadInProgress||(this.setDiscussionThreads(n,t.discussionThreads,t.selectedDiscussionId),this.setAdornments(n,t.adornments));this.layoutFileEditor(n);this._currentConfig=t;return}this._diffEditMode=!1;this.showEditDiff(!1);this._currentConfig=t;this.setContentLoadInProgress(!0);this.setDiscussionThreads(n,[]);this.setAdornments(n,[]);this.setErrorMessage(n,null);typeof t.content=="string"?(f=t.contentType||(t.fileInfo||{}).contentType||"text/plain",e=t.skipResource?null:{repo:t.repositoryId,version:t.version,path:t.path},this.setEditorContent(n,t.content,!0,f,e,function(){i.updateLineNumbersWidth(n,!1,t);i.setDiscussionThreads(n,t.discussionThreads,t.selectedDiscussionId);i.setAdornments(n,t.adornments)})):t.path?(this.setEditorContent(n,r.Loading,!1,"text/plain"),this._versionControlExtension.getItemContents(t.path,t.version,{maxContentLength:this._maxFileContentLength},function(u){var e=i._versionControlExtension.getConfiguration(),f;e.path===t.path&&e.version===t.version&&(u.exceededMaxContentLength&&i.setErrorMessage(n,r.TruncatedEditorContent),f=i.getContentType(u),i.setEditorContent(n,u.content,!0,f,{repo:t.repositoryId,version:t.version,path:t.path},function(){var t=i._versionControlExtension.getConfiguration();i.updateLineNumbersWidth(n,!1,t);i.setDiscussionThreads(n,t.discussionThreads,t.selectedDiscussionId);i.setAdornments(n,t.adornments)}),i._originalContentType=f,i._originalContentPath=u.path)},function(u){var f=i._versionControlExtension.getConfiguration();f.path===t.path&&f.version===t.version&&(i.setErrorMessage(n,r.FailedToGetContent+": "+u),i.setEditorContent(n,"",!0,"text/plain"))})):this.setEditorContent(n,"",!0,"text/plain");this._isEditorInitialized=!0},t.prototype.updateDiffSideBySide=function(n,t){if(n&&t&&!nt(t.inline)){var i=!t.inline;d.editor.renderSideBySide!==i&&(d.editor.renderSideBySide=i,this.updateEditorOptions(n))}},t.prototype.showEditDiff=function(n){n?(this._$editorHost.hide(),this._$diffEditorHost&&this._$diffEditorHost.show()):(this._$editorHost.show(),this._$diffEditorHost&&this._$diffEditorHost.hide())},t.prototype.renderEditDiff=function(n){var t=this;this.showEditDiff(!0);this._diffEditorLeftItemInfo.path=this._originalContentPath||null;this._diffEditorLeftItemInfo.version=null;this._diffEditorLeftItemInfo.content=this._originalContent;this._diffEditorLeftItemInfo.contentType=this._originalContentType||"text/plain";this._diffEditorRightItemInfo.path=this._originalContentPath||null;this._diffEditorRightItemInfo.version=null;this._diffEditorRightItemInfo.content=n.getValue();this._diffEditorRightItemInfo.contentType=this._originalContentType||"text/plain";this.beginGetMonacoMode(this._diffEditorLeftItemInfo.contentType,{filePath:this._diffEditorLeftItemInfo.path},function(n){t._diffPerformedInitialScroll=!1;var i=monaco.editor.createModel(t._diffEditorLeftItemInfo.content,n),r=monaco.editor.createModel(t._diffEditorRightItemInfo.content,n);t.setDiffEditorModels(t._diffEditorForEdit,i,r);t._diffEditorForEdit.setPosition({lineNumber:1,column:1});t.updateLineNumbersWidth(t._diffEditorForEdit,!0,t._versionControlExtension.getConfiguration());t._diffEditorForEdit.layout();t._contentLoadInProgress=!1})},t.prototype.sendCurrentDiffInfo=function(n,t){var u=!1,f=!1,r,i;t.ranges&&t.ranges.length>0&&(r=n.getPosition(),i=t.ranges[0].range,i&&r.lineNumber>i.startLineNumber&&(u=!0),i=t.ranges[t.ranges.length-1].range,i&&r.lineNumber<i.startLineNumber&&(f=!0));this._versionControlExtension.sendCurrentDiffStatus(u,f)},t.prototype.sendDiffLines=function(n){this._versionControlExtension.sendDiffLines(n.ranges.map(function(n){return n.range.startLineNumber}))},t.prototype.fetchDiffItemContent=function(n,t,i,u,f){var s=this,e=i+"path",o=i+"version",h=i+"content",c=i+"contentType";typeof u[h]=="string"?(t.path=u[e]||null,t.version=u[o]||null,t.content=u[h],t.contentType=u[c]||"text/plain",f()):t.path===u[e]&&t.version===u[o]?f():u[e]?this._versionControlExtension.getItemContents(u[e],u[o],{maxContentLength:this._maxFileContentLength},function(i){var h=s._versionControlExtension.getConfiguration();h[e]===u[e]&&h[o]===u[o]&&(t.path=u[e],t.version=u[o],t.content=i.content,t.contentType=s.getContentType(i),i.exceededMaxContentLength&&s.setErrorMessage(n.modifiedEditor,r.TruncatedDiffMessage),f())},function(i){var h=s._versionControlExtension.getConfiguration();h[e]===u[e]&&h[o]===u[o]&&(t.path=u[e],t.version=u[o],t.content=r.FailedToGetContent+": "+i,t.contentType="text/plain",s.setErrorMessage(n.modifiedEditor,r.FailedToGetContent+": "+i),f())}):(t.path=null,t.version=null,t.content="",t.contentType="text/plain",f())},t.prototype.setDiffEditorConfig=function(n,t){var i=this,u=!1,f,e;if(this.updateUserPreferences(n,t),this.updateCommonEditorConfig(n,!0,t),t.activeState!==!1){if(t.ocontent&&t.mcontent?u=this._diffEditorLeftItemInfo.content===t.ocontent&&this._diffEditorRightItemInfo.content===t.mcontent?!0:!1:t.opath&&t.mpath&&(u=this._diffEditorLeftItemInfo.path===t.opath&&this._diffEditorLeftItemInfo.version===t.oversion&&this._diffEditorRightItemInfo.path===t.mpath&&this._diffEditorRightItemInfo.version===t.mversion?!0:!1),this.updateDiffSideBySide(n,t),this.setDiffEditorMode(n,t.inline===!0),u){this._contentLoadInProgress||(this.setDiscussionThreads(n,t.discussionThreads,t.selectedDiscussionId),this.setAdornments(n,t.adornments));return}this.setContentLoadInProgress(!0);this.setErrorMessage(n.modifiedEditor,null);this.setDiscussionThreads(n,[]);this.setAdornments(n,[]);this.updateEditorTheme(n,t,n.modifiedEditor);f=monaco.editor.createModel(r.Loading,"text/plain");e=monaco.editor.createModel(r.Loading,"text/plain");this.setDiffEditorModels(n,f,e);this.fetchDiffItemContent(n,this._diffEditorLeftItemInfo,"o",t,function(){i.fetchDiffItemContent(n,i._diffEditorRightItemInfo,"m",i._versionControlExtension.getConfiguration(),function(){i.beginGetMonacoMode(i._diffEditorRightItemInfo.contentType,{filePath:i._diffEditorRightItemInfo.path},function(t){i._diffPerformedInitialScroll=!1;var r=monaco.editor.createModel(i._diffEditorLeftItemInfo.content,t),u=monaco.editor.createModel(i._diffEditorRightItemInfo.content,t);i.setDiffEditorModels(n,r,u);n.setPosition({lineNumber:1,column:1});i.updateLineNumbersWidth(n,!0,i._versionControlExtension.getConfiguration());n.layout();i.setContentLoadInProgress(!1)})})});this._isEditorInitialized=!0}},t.prototype.beginCreateBuiltInDiffEditor=function(n,t){tt.setModuleCodeEditor(this);this.beginCreateDiffEditor(n,t)},t.prototype.beginCreateDiffEditor=function(t,r){var u=this;this.checkSupportedVersion()&&(r=r||i.getVersionControlExtension(),this._versionControlExtension=r,this.setHostIdClass(),n(["vs/editor/editor.main"],function(){var e=u._$diffEditorHost||$(".code-editor-host"+u._hostIdClass),r,n,f;if(e[0]){r=u.getEditorOptions();n=monaco.editor.createDiffEditor(e[0],$.extend(r.configuration||{},{readOnly:r.editable!==!0,renderSideBySide:r.inline!==!0,scrollBeyondLastLine:r.editable===!0,theme:u.getEditorTheme().themeName,scrollbar:{horizontalScrollbarSize:14}}));d.editor.minimap.enabled=d.editor.minimap.enabled||r.minimapEnabled===!0;u.updateEditorOptions(n);u.addBuiltInContextMenuItems(n);r.contextMenuItems&&(u.addContextMenuItems(r.contextMenuItems,n.getOriginalEditor()),u.addContextMenuItems(r.contextMenuItems,n.getModifiedEditor()));u._versionControlExtension.addMessageListener(i.VersionControl.ActionIds.EDITOR_ADD_CONTEXT_MENU_ITEM,function(t){t.actionData.contextMenuItems&&(u.addContextMenuItems(t.actionData.contextMenuItems,n.getOriginalEditor()),u.addContextMenuItems(t.actionData.contextMenuItems,n.getModifiedEditor()))});e.data("editor",n);e.bind("remove",function(){u._isEditorInitialized=!1;u.setDiffEditorModels(n,null,null);n.dispose()});n.onDidDispose(function(){ft(u._diffEditorDisposables);u._diffEditorDisposables=[]});f=monaco.editor.createDiffNavigator(n,{alwaysRevealFirst:!r.selectedDiscussionId});u._diffEditorDisposables.push(n.onDidUpdateDiff(function(){var t=u.handleDiffComputed(n);u._diffPerformedInitialScroll||(u._diffPerformedInitialScroll=!0,n.layout(),t&&(f.revealFirst=!1),u.sendDiffLines(f),u.sendCurrentDiffInfo(n,f))}));u._diffEditorDisposables.push(n.getModifiedEditor().onDidChangeCursorPosition(function(){u.sendCurrentDiffInfo(n,f)}));u._diffEditorDisposables.push(n.getOriginalEditor().onDidChangeCursorSelection(function(n){u._currentDiffSelection={originalSide:!0,startLineNumber:n.selection.startLineNumber,endLineNumber:n.selection.endLineNumber,startColumn:n.selection.startColumn,endColumn:n.selection.endColumn,positionLineNumber:n.selection.positionLineNumber,positionColumn:n.selection.positionColumn}}));u._diffEditorDisposables.push(n.getModifiedEditor().onDidChangeCursorSelection(function(n){u._currentDiffSelection={originalSide:!1,startLineNumber:n.selection.startLineNumber,endLineNumber:n.selection.endLineNumber,startColumn:n.selection.startColumn,endColumn:n.selection.endColumn,positionLineNumber:n.selection.positionLineNumber,positionColumn:n.selection.positionColumn}}));u._versionControlExtension.onShowNextDifference(function(){f.next()});u._versionControlExtension.onShowPreviousDifference(function(){f.previous()});u._versionControlExtension.onNavigateToPosition(function(t){n.setPosition(t.actionData);n.revealPositionInCenter(t.actionData)});r.editable===!0&&u.addContentChangedListener(n.getModifiedEditor(),r);$(window).resize(function(){u._versionControlExtension.getConfiguration().skipLayoutOnResize||n.layout()});u._versionControlExtension.addMessageListener(i.VersionControl.ActionIds.REFRESH_LAYOUT,function(){n.layout()});u._diffEditMode||(u._versionControlExtension.addMessageListener(i.VersionControl.ActionIds.GET_EDITOR_CONTENT,function(t){u._contentLoadedDeferred.done(function(){u._versionControlExtension.sendEditorContent(n.getValue(),t.requestId)})}),u._versionControlExtension.addMessageListener(i.VersionControl.ActionIds.GET_SELECTION,function(n){u._versionControlExtension.sendResponse(n.requestId,i.VersionControl.ActionIds.GET_SELECTION,u._currentDiffSelection)}));n.getModifiedEditor().onDidChangeConfiguration(function(){d.ignoreConfigurationChangedEvent||(d.ignoreConfigurationChangedEvent=!0,n.getModifiedEditor().updateOptions(u.getAdjustedDiffEditorOptions()),d.ignoreConfigurationChangedEvent=!1)});u._versionControlExtension.sendMessage(i.VersionControl.ActionIds.EDITOR_CREATED);$.isFunction(t)&&t.call(u,n)}}))},t.prototype.updateCommonEditorConfig=function(n,t,i){var r=n.getId(),u;i.commentsEnabled?this._discussionThreadControlManagersByEditorId[r]||(this._discussionThreadControlManagersByEditorId[r]=this.createDiscussionThreadControlManager(n,t)):this._discussionThreadControlManagersByEditorId[r]&&(this._discussionThreadControlManagersByEditorId[r].dispose(),delete this._discussionThreadControlManagersByEditorId[r]);u=this._lineLinkingWidgetsByEditorId[r];u&&(u.dispose(),delete this._lineLinkingWidgetsByEditorId[r]);i.lineLinkingWidgetUrl&&n.getEditorType()===monaco.editor.EditorType.ICodeEditor&&(this._lineLinkingWidgetsByEditorId[r]=new ct(n,i.lineLinkingWidgetUrl));i.adornmentsEnabled?this._adornmentControlManagersByEditorId[r]||(this._adornmentControlManagersByEditorId[r]=this.createAdornmentControlManager(n,t)):this._adornmentControlManagersByEditorId[r]&&(this._adornmentControlManagersByEditorId[r].dispose(),delete this._adornmentControlManagersByEditorId[r])},t.prototype.getNumberOfDigits=function(n){for(var t=0;n>0;)n=Math.floor(n/10),t++;return t},t.prototype.getNumberOfLinesInEditor=function(n){return n.getModel()._lines.length},t.prototype.updateLineNumbersWidth=function(n,t,i){var r;r=t?Math.max(this.getNumberOfDigits(this.getNumberOfLinesInEditor(n.originalEditor)),this.getNumberOfDigits(this.getNumberOfLinesInEditor(n.modifiedEditor))):this.getNumberOfDigits(this.getNumberOfLinesInEditor(n));i.commentsEnabled&&(r+=this.NUM_CHARS_FOR_ICON_PADDING);r=Math.max(r,this.DEFAULT_MIN_LINE_CHARS_WIDTH);r!==(t?n.modifiedEditor:n).getConfiguration().lineNumbersMinChars&&n.updateOptions({lineNumbersMinChars:r})},t.prototype.handleDiffComputed=function(n){var t;return this._contentLoadInProgress?!1:(t=this._versionControlExtension.getConfiguration(),this.setAdornments(n,t.adornments),this.setDiscussionThreads(n,t.discussionThreads,t.selectedDiscussionId))},t.prototype.setDiscussionThreads=function(n,t){var i=this._discussionThreadControlManagersByEditorId[n.getId()];return i&&i.setDiscussionThreads(t),!1},t.prototype.setDiffEditorMode=function(n,t){var i=this._discussionThreadControlManagersByEditorId[n.getId()];i&&i.setDiffMode(t)},t.prototype.createDiscussionThreadControlManager=function(n,t){var i=this.getEditorOptions();return new vt(i.host.uri,n,t,i.supportsDiscussionWorkItemCreation,i.supportCommentStatus,this._versionControlExtension)},t.prototype.setAdornments=function(n,t){var i=this._adornmentControlManagersByEditorId[n.getId()],r;i&&i.setAdornments(t);r=t&&t.some(function(n){return n.usingGlyphMargin});n.updateOptions({glyphMargin:r})},t.prototype.createAdornmentControlManager=function(n,t){return new p.MonacoAdornmentControlManager(n,t)},t}();t.CodeEditor=it,function(n){function i(n){t=n}function r(){return t.isContentLoadInProgress()}function u(){return t.isDiffEditorInitialized()}function f(){return t.isEditorInitialized()}function e(){return t.getEditorOptions()}function o(n,i,r,u,f,e){t.setEditorContent(n,i,r,u,f,e)}function s(n){t.beginCreateEditor(n)}function h(n,i){t.setEditorConfig(n,i)}function c(n,i){t.setDiffEditorConfig(n,i)}function l(n){t.beginCreateDiffEditor(n)}var t;n.setModuleCodeEditor=i;n.isContentLoadInProgress=r;n.isDiffEditorInitialized=u;n.isEditorInitialized=f;n.getEditorOptions=e;n.setEditorContent=o;n.beginCreateEditor=s;n.setEditorConfig=h;n.setDiffEditorConfig=c;n.beginCreateDiffEditor=l;t=new it}(tt=t.TFSAdvancedCodeEditorPlugin||(t.TFSAdvancedCodeEditorPlugin={}));rt=function(){function n(n,t,i,r,u){this.domNode=n;this.afterLineNumber=t;this.heightInLines=i;this._onDomNodeTop=r;this._onComputedHeight=u;this.id=-1}return n.prototype.onDomNodeTop=function(n){this._onDomNodeTop(n)},n.prototype.onComputedHeight=function(n){this._onComputedHeight(n)},n}();t.ViewZoneDelegate=rt;et=function(){function n(n,t,i){this.editor=n;this.zoneWidget=t;this.zoneWidget.discussionThread=this;this.isDiffEditor=n.getEditorType()===monaco.editor.EditorType.IDiffEditor;this.created=!1;this.hasDiscussionContent=!1;this.discussionThreadControls=[];this.lineNumber=i?i.line:1;this.showAbove=!i}return n.prototype._normalizeLineNumber=function(n){return n-(this.showAbove?1:0)},n.prototype.showWidget=function(){this.created?this.resizeZone(this.lineNumber,this.discussionThreadHeightLines):(this.created=!0,this.zoneWidget.create(),this.zoneWidget.rulerDecorations=this.editor.deltaDecorations([],[{range:{startLineNumber:this.lineNumber,endLineNumber:this.lineNumber,startColumn:1,endColumn:1},options:{isWholeLine:!0,showInOverviewRuler:n.OVERVIEW_RULER_DISCUSSION_COLOR}}]),this.zoneWidget.show(new monaco.Position(this._normalizeLineNumber(this.lineNumber),0),this.discussionThreadHeightLines))},n.prototype.resizeZone=function(n,t){var i=this,r=t*this.editor.getConfiguration().lineHeight;this.zoneWidget.domNode.style.width=this.zoneWidget._getWidth()+"px";this.position={lineNumber:n,column:0};this.editor.changeViewZones(function(r){r.removeZone(i.zoneWidget._viewZone.id);i.zoneWidget._viewZone=new rt(document.createElement("div"),i._normalizeLineNumber(n),t,function(n){return i.zoneWidget._onViewZoneTop(n)},function(n){return i.zoneWidget._onViewZoneHeight(n)});i.zoneWidget._viewZone.id=r.addZone(i.zoneWidget._viewZone)});this.zoneWidget.domNode.style.height=r+"px";this.zoneWidget.container.style.height=r+"px";this.zoneWidget._doLayout(r)},n.prototype.onWidth=function(){this.isDisposed||($.each(this.discussionThreadControls,function(n,t){t.updateCommentSizes()}),this.handleResize())},n.prototype.doLayout=function(n){this.getPopulatedContents().css("height",n+"px")},n.prototype.fillContainer=function(n){this.zoneWidget.container=n;var t=this.getPopulatedContents();this.discussionThreadHeightLines=this.calculateLineHeight(this.measureContainerHeight(t));t.appendTo(n)},n.prototype.handleResize=function(n){var u=this.editor.getCenteredRangeInViewport(),r,f;if(u){var e=u.startLineNumber,o=this.lineNumber<e,s=this.editor.getScrollHeight(),t=this.getPopulatedContents(),h=t.outerHeight(),i;t.css("height","auto");i=this.calculateLineHeight(t.height());i===this.discussionThreadHeightLines?t.css("height",h+"px"):(this.discussionThreadHeightLines=i,this.showWidget(),this.isNewControl&&n&&o&&(r=this.editor.getScrollHeight()-s,r!==0&&(f=this.editor.getScrollTop()+r,this.editor.setScrollTop(f))))}},n.prototype.dispose=function(){this.isDisposed=!0;this.zoneWidget.associatedFillerWidget&&this.zoneWidget.associatedFillerWidget.dispose();this.zoneWidget.listenersToRemove&&this.zoneWidget.listenersToRemove.length&&(this.zoneWidget.listenersToRemove.forEach(function(n){n()}),this.zoneWidget.listenersToRemove=[]);this.zoneWidget.rulerDecorations&&(this.editor.deltaDecorations(this.zoneWidget.rulerDecorations,[]),this.zoneWidget.rulerDecorations=null);this.zoneWidget.dispose()},n.prototype.appendDiscussionContent=function(n){this.getPopulatedContents();n.appendTo(this.$threadControlContent);this.discussionThreadControls.push(n);this.hasDiscussionContent?this.handleResize():(this.hasDiscussionContent=!0,this.showWidget())},n.prototype.handleDiscussionContentRemoved=function(n){var i=this,t=-1;$.each(this.discussionThreadControls,function(r,u){if(u===n)return t=r,i.discussionThreadControls.splice(r,1),!1});t===this.discussionThreadControls.length&&t--;this.$threadControlContent&&t>=0&&this.handleResize()},n.prototype.getPopulatedContents=function(){var t=this;return this.$contents||(this.$contents=$("<div />").addClass("monaco-discussion-container").css("margin-left",this.editor.getLayoutInfo().lineNumbersWidth+n.DiscussionLeftAdditionalMargin+"px"),this.$contents.css("margin-right",n.DiscussionRightMarginPx+"px").addClass("content"),this.$threadControlContent=$("<div class='discussion-threads-container' />"),this.$threadControlContent.appendTo(this.$contents),this.$threadControlContent.bind("discussion-thread-resized discussion-comment-resized",function(){t.handleResize()})),this.$contents},n.prototype.calculateLineHeight=function(t){var i=this.editor.getConfiguration().lineHeight,r=t>i&&t+n.DiscussionHeightPaddingPx||0;return Math.ceil(r/i)},n.prototype.measureContainerHeight=function(t){var i;return n._$measurementElement||(n._$measurementElement=$("<div />").addClass("discussion-measurement-probe").css("position","absolute").css("top","-99999px").css("left","-99999px").appendTo(document.body)),i=this.editor.getLayoutInfo().width,i-=this.isDiffEditor?n.DiffEditorZoneWidgetRightMargin:n.EditorZoneWidgetRightMargin,n._$measurementElement.css("width",i+"px"),t.appendTo(n._$measurementElement),$.each(this.discussionThreadControls,function(n,t){t.updateCommentSizes()}),t.height()},n.prototype.scrollIntoView=function(){this.editor.revealPositionInCenter({lineNumber:this.lineNumber,column:1})},n.extendedZoneWidget=!1,n.DiscussionHeightPaddingPx=5,n.DiscussionRightMarginPx=12,n.DiscussionLeftAdditionalMargin=10,n.EditorZoneWidgetRightMargin=18,n.DiffEditorZoneWidgetRightMargin=30,n.OVERVIEW_RULER_DISCUSSION_COLOR="rgba(128, 192, 240, 0.5)",n}();g=null;var ct=function(){function n(n,t){var i=this;this._disposables=[];this._delayedUpdate=null;this._editor=n;this._originalUrl=t;this._editor.addContentWidget(this);this._disposables.push(this._editor.onDidChangeCursorSelection(function(n){i.setSelection(null);ut(n.selection)||i.setSelection(n.selection)}))}return n.prototype.getId=function(){return this._editor.getId()+":LineLinkingWidget"},n.prototype.getDomNode=function(){var t=this,n;return this._$domNode||(this._$domNode=$('<div class="get-line-link" />'),n=u.RichContentTooltip.add(r.CopyLineLinkTitle,this._$domNode,{openDelay:300}),this._$domNode.click(function(){return t.copyLineLink(),n.setTextContent(r.CopiedLineLinkTitle),setTimeout(function(){return n.show()},0),!1}).mouseout(function(){n.setTextContent(r.CopyLineLinkTitle)}),$('<div class="bowtie-icon bowtie-link" />').appendTo(this._$domNode)),this._$domNode[0]},n.prototype.getPosition=function(){if(this._selection){var n;return n=ot(this._selection)?[monaco.editor.ContentWidgetPositionPreference.ABOVE,monaco.editor.ContentWidgetPositionPreference.BELOW]:[monaco.editor.ContentWidgetPositionPreference.BELOW,monaco.editor.ContentWidgetPositionPreference.ABOVE],{position:{column:this._selection.positionColumn,lineNumber:this._selection.positionLineNumber},preference:n}}return null},n.prototype.setSelection=function(n){var t=this;this._selection=n;this._delayedUpdate&&this._delayedUpdate.cancel();$(this.getDomNode()).hide();n&&(this._delayedUpdate=e.delay(this,250,function(){$(t.getDomNode()).show();t._editor.layoutContentWidget(t);t._delayedUpdate=null}))},n.prototype.copyLineLink=function(){var n=h.Uri.parse(this._originalUrl);this._selection&&(n.addQueryParam("line",this._selection.startLineNumber+"",!0),n.addQueryParam("lineStyle","plain",!0),n.addQueryParam("lineEnd",this._selection.endLineNumber+"",!0),n.addQueryParam("lineStartColumn",this._selection.startColumn+"",!0),n.addQueryParam("lineEndColumn",this._selection.endColumn+"",!0));c.copyToClipboard(n.absoluteUri)},n.prototype.dispose=function(){var n,t,i;if(this._editor.removeContentWidget(this),this._disposables){for(n=0,t=this._disposables;n<t.length;n++)i=t[n],i.dispose();this._disposables=[]}},n}(),lt=function(){function n(n,t){this._$domNode=null;this._lineNumber=0;this._discussionManager=n;this._isOriginalEditor=t}return n.prototype.getId=function(){return"add-comment-gutter"},n.prototype.getDomNode=function(){var n=this;return this._$domNode||(this._$domNode=$("<div />").attr("title",v.AddCommentTooltip).addClass("add-comment-gutter add-comment-background-icon").click(function(){return n._discussionManager.createNewThread(n._discussionManager.getDiscussionPosition(n._lineNumber,n._isOriginalEditor)),!1})),this._$domNode[0]},n.prototype.getPosition=function(){return null},n.prototype.setPosition=function(n,t){this._lineNumber=n;this.getDomNode().style.top=t+"px"},n.prototype.hide=function(){this.setPosition(0,-1e3)},n}(),at=function(){function n(n,t,i){this._delayedUpdate=null;this._$domNode=null;this.allowEditorOverflow=!0;this._editor=n;this._discussionManager=t;this._isOriginalEditor=i}return n.prototype.getId=function(){return"add-comment-selection"},n.prototype.getDomNode=function(){var n=this;return this._$domNode||(this._$domNode=$('<div class="add-comment-selection" />').attr("title",v.SelectionCommentTooltip).click(function(){return n._discussionManager.createNewThread(n._discussionManager.getDiscussionPositionFromSelection(n._selection,n._isOriginalEditor)),n.hide(),!1}),$('<div class="add-comment-background-icon" />').appendTo(this._$domNode)),this._$domNode[0]},n.prototype.getPosition=function(){if(this._selection){var n;return n=ot(this._selection)?[monaco.editor.ContentWidgetPositionPreference.ABOVE,monaco.editor.ContentWidgetPositionPreference.BELOW]:[monaco.editor.ContentWidgetPositionPreference.BELOW,monaco.editor.ContentWidgetPositionPreference.ABOVE],{position:{lineNumber:this._selection.positionLineNumber,column:this._selection.positionColumn},preference:n}}return null},n.prototype.setSelection=function(n){var t=this;this._selection=n;this._delayedUpdate&&this._delayedUpdate.cancel();$(this.getDomNode()).hide();n&&(this._delayedUpdate=e.delay(this,500,function(){$(t.getDomNode()).show();t._editor.layoutContentWidget(t);t._delayedUpdate=null}))},n.prototype.hide=function(){this.setSelection(null)},n}(),vt=function(n){function t(t,r,u,f,e,o){var s=n.call(this)||this;return s._hostUrl=t,s._editor=r,s._isDiffEditor=u,s._supportsCreateWorkItem=f,s._supportCommentStatus=e,s._versionControlExtension=o,s._diffInline=!1,s._zoneWidgetsByKey={},s._zoneWidgetRefCounts={},s._disposables=[],u?(s.addDiscussionWidgetsAndCommands(r.getOriginalEditor(),!0),s.addDiscussionWidgetsAndCommands(r.getModifiedEditor(),!1)):s.addDiscussionWidgetsAndCommands(r,!1),s._extensionMessageListener=function(n){s.handleExtensionThreadUpdateEvent(n.actionData||{})},s._versionControlExtension.addMessageListener(i.VersionControl.ActionIds.DISCUSSION_THREAD_UPDATED,s._extensionMessageListener),s}return __extends(t,n),t.prototype.dispose=function(){this.clearDiscussionThreads();this._discussionThreadControlsByUniqueId={};this._extensionMessageListener&&this._versionControlExtension.removeMessageListener(this._extensionMessageListener);ft(this._disposables);this._disposables=[];this._lastMouseOverDecorations&&(this.getEditor(this._lastMouseOverIsOriginalEditor).deltaDecorations(this._lastMouseOverDecorations,[]),this._lastMouseOverDecorations=null);this._originalEditorGutterWidget?(this.getEditor(!0).removeOverlayWidget(this._originalEditorGutterWidget),this._originalEditorGutterWidget=null):this._modifiedEditorGutterWidget&&(this.getEditor(!1).removeOverlayWidget(this._modifiedEditorGutterWidget),this._modifiedEditorGutterWidget=null);this._originalEditorSelectionWidget&&(this.getEditor(!0).removeContentWidget(this._originalEditorSelectionWidget),this._originalEditorSelectionWidget=null);this._modifiedEditorSelectionWidget&&(this.getEditor(!1).removeContentWidget(this._modifiedEditorSelectionWidget),this._modifiedEditorSelectionWidget=null)},t.prototype.setDiffMode=function(n){this._diffInline=n},t.prototype.showCreateWorkItemDropdown=function(){return this._supportsCreateWorkItem},t.prototype.beginGetWorkItemTypeNames=function(n){var t=this;this._versionControlExtension.sendMessage(i.Discussion.ActionIds.GET_WORK_ITEM_TYPES,{},function(i){n.call(t,i.actionData.workItemTypeNames)})},t.prototype.getVersionControlExtension=function(){return this._versionControlExtension},t.prototype.handleExtensionThreadUpdateEvent=function(n){var u=this,t=this._versionControlExtension.getConfiguration(),i,r;this.isContentLoadInProgress()?(n.currentThreads?t.discussionThreads=n.currentThreads:n.newThreads&&(i=t.discussionThreads||[],r=this.filterThreads(n.newThreads,i),t.discussionThreads=i.concat(r)),n.threadSelected&&(t.selectedDiscussionId=n.threadSelected.id)):n.currentThreads?this.setDiscussionThreads(n.currentThreads):n.newThreads&&(i=t.discussionThreads||[],r=this.filterThreads(n.newThreads,i),$.each(r,function(t,i){u.createFileThread(i,t===0,n.createdByUser)}))},t.prototype.filterThreads=function(n,t){return n.filter(function(n){return!f.arrayContains(n,t,function(n,t){var i=n.id===t.id;return i&&w.getDebugMode()&&window.console&&window.console.log&&console.log("Duplicate thread id: "+n.id),i})})},t.prototype.addDiscussionWidgetsAndCommands=function(n,t){this.addGutterWidget(n,t);this.addSelectionWidget(n,t);this.addCommentCommand(n,t)},t.prototype.addCommentCommand=function(n,t){var i=this;n.addAction({id:"add-comment",label:v.AddCommentEditorCommand,keybindings:[monaco.KeyCode.F4],keybindingContext:null,contextMenuGroupId:"1_modification",contextMenuOrder:10,run:function(n){return i.createNewThread(i.getDiscussionPosition(n.getPosition().lineNumber,t)),null}})},t.prototype.addGutterWidget=function(n,t){var i=this,r=new lt(this,t);n.addOverlayWidget(r);t?this._originalEditorGutterWidget=r:this._modifiedEditorGutterWidget=r;this._disposables.push(n.onMouseMove(function(u){var f=u.target.position?u.target.position.lineNumber:0,e;(f!==i._lastMouseOverLine||t!==i._lastMouseOverIsOriginalEditor)&&u.target.detail!=="add-comment-gutter"&&(i._isDiffEditor&&(t?i._modifiedEditorGutterWidget.hide():i._originalEditorGutterWidget.hide()),!u.target.position||i.isContentLoadInProgress()?(r.hide(),e=[]):(r.setPosition(f,n.getTopForLineNumber(f)-n.getScrollTop()),e=[{range:{startLineNumber:f,endLineNumber:f},options:{isWholeLine:!0,className:"highlighted-line"}}]),i._isDiffEditor&&t!==i._lastMouseOverIsOriginalEditor&&i._lastMouseOverDecorations?(i.getEditor(!t).deltaDecorations(i._lastMouseOverDecorations,[]),i._lastMouseOverDecorations=n.deltaDecorations([],e)):i._lastMouseOverDecorations=n.deltaDecorations(i._lastMouseOverDecorations||[],e),i._lastMouseOverIsOriginalEditor=t,i._lastMouseOverLine=f)}))},t.prototype.isContentLoadInProgress=function(){var n=this._versionControlExtension.isContentLoadInProgress();return n!==null?n:tt.isContentLoadInProgress()},t.prototype.addSelectionWidget=function(n,t){var r=this,i=new at(n,this,t);n.addContentWidget(i);t?this._originalEditorSelectionWidget=i:this._modifiedEditorSelectionWidget=i;this._disposables.push(n.onDidChangeCursorSelection(function(n){r._isDiffEditor&&(t?r._modifiedEditorSelectionWidget.hide():r._originalEditorSelectionWidget.hide());ut(n.selection)?i.hide():i.setSelection(n.selection)}))},t.prototype.getEditor=function(n){if(this._isDiffEditor){var t=this._editor;return n?t.getOriginalEditor():t.getModifiedEditor()}return this._editor},t.prototype.getDiscussionPosition=function(n,t){var r=this.getEditor(t),i=r.getSelection();return!ut(i)&&n>=i.startLineNumber&&n<=i.endLineNumber?this.getDiscussionPositionFromSelection(i,t):{positionContext:this.getDiscussionPositionContext(t),startLine:n,endLine:n,startColumn:1,endColumn:(r.getModel().getLineContent(n)||"").length+1}},t.prototype.getDiscussionPositionFromSelection=function(n,t){return{positionContext:this.getDiscussionPositionContext(t),startLine:n.startLineNumber,endLine:n.endLineNumber,startColumn:n.startColumn,endColumn:n.endColumn}},t.prototype.getDiscussionPositionContext=function(n){return this._isDiffEditor?n?l.PositionContext.LeftBuffer:l.PositionContext.RightBuffer:this._versionControlExtension.getConfiguration().commentsDefaultPositionContext||l.PositionContext.RightBuffer},t.prototype.processDiscussionThreads=function(n){var t=this;return $.each(n||[],function(n,i){$.each(i.comments||[],function(n,i){t.processDiscussionComment(i)})}),n||[]},t.prototype.processDiscussionComment=function(n){return!n.publishedDate||n.publishedDate instanceof Date||(n.publishedDate=new Date(n.publishedDate)),!n.lastUpdatedDate||n.lastUpdatedDate instanceof Date||(n.lastUpdatedDate=new Date(n.lastUpdatedDate)),n},t.prototype.setDiscussionThreads=function(n){this.redraw(this.processDiscussionThreads(n))},t.prototype.redraw=function(n){var t=this;this.clearDiscussionThreads();this._discussionThreadControlsByUniqueId={};$.each(n,function(n,i){t.createFileThread(i)})},t.prototype.getIdentityImageUrl=function(n){return this._hostUrl+"/_api/_common/IdentityImage?"+$.param({id:n})},t.prototype.createNewThread=function(n,t){this._versionControlExtension.sendMessage(i.Discussion.ActionIds.CREATE_THREAD,{position:n},function(n){$.isFunction(t)&&t.call(this,n.actionData)})},t.prototype.createFileThread=function(n,t,i){var p=this,s,f=0,e=!1,b,h,r,c,v,y,u,a;n.position&&n.position.positionContext!==l.PositionContext.InLineBuffer&&(this._isDiffEditor&&n.position.positionContext&&(e=n.position.positionContext===l.PositionContext.LeftBuffer),f=n.position.endColumn===1&&n.position.endLine>n.position.startLine?n.position.endLine-1:n.position.endLine,h=this.getEditor(e).getModel(),f>0&&f<=h.getLineCount()&&(b=h.getLineContent(f)));r=this.getEditor(e);r&&(c=r.getCenteredRangeInViewport(),c&&(y=r.getScrollHeight(),v=!n.position||n.position.endLine<c.startLineNumber));s=new yt(n,this,e);this.registerThreadControl(s);this._discussionThreadControlsByUniqueId=this._discussionThreadControlsByUniqueId||{};this._discussionThreadControlsByUniqueId[n.uniqueId]&&(u=this._discussionThreadControlsByUniqueId[n.uniqueId].getThread(),w.logError(o.format("thread control was already registered. ID: {0}={1}, UniqueID: {2}={3}, OriginalId: {4}={5}",n.id,u&&u.id,n.uniqueId,u&&u.uniqueId,n.originalId,u&&u.originalId)));this._discussionThreadControlsByUniqueId[n.uniqueId]=s;this.beginGetZoneWidget(f,e,function(n){p._zoneWidgetRefCounts[n.referenceKey]++;var t=r&&r.saveViewState();s.setZoneWidget(n);!i&&t&&r.restoreViewState(t)});v&&!i&&r&&(a=r.getScrollHeight()-y,a&&r.setScrollTop(r.getScrollTop()+a))},t.prototype.beginGetZoneWidget=function(n,t,i){var u=this,f=(t?"o":"m")+n,r=this._zoneWidgetsByKey[f];r?$.isFunction(i)&&i.call(this,r):b.queueRequest(this,this,"_widgetTypeInfo",function(e){r=u._zoneWidgetsByKey[f];r||(r=u._createDiscussionThreadWidget(e.widgetType,n,t),r.referenceKey=f,u._zoneWidgetsByKey[f]=r,u._zoneWidgetRefCounts[f]=0);$.isFunction(i)&&i.call(u,r)},null,function(n){ht(function(t){n({widgetType:t})})})},t.prototype._releaseWidgetReference=function(n){--this._zoneWidgetRefCounts[n.referenceKey]<1&&(delete this._zoneWidgetRefCounts[n.referenceKey],delete this._zoneWidgetsByKey[n.referenceKey],n.dispose())},t.prototype._createDiscussionThreadWidget=function(n,t,i){var f=this._editor,r=null,u,e;return t>0&&(r={line:t}),this._isDiffEditor&&(u=this._editor,this._diffInline?(i&&r&&(r.line=u.getDiffLineInformationForOriginal(r.line).equivalentLineNumber),f=u.getModifiedEditor()):f=i?u.getOriginalEditor():u.getModifiedEditor()),e=new n(f),new et(f,e,r)},t}(a.DiscussionThreadControlManagerBase),yt=function(){function n(n,t,i){this._monacoDiscussionThreadManager=t;this._isOriginalSide=i;this._position=n.position;this._thread=n}return n.prototype.appendTo=function(t){var r=this,i;setTimeout(function(){t.closest(".zone-widget-container").addClass(n.CSS_CLASS_MENTION_OVERFLOW_VISIBLE);t.closest(".zone-widget").attr("aria-hidden","false")},0);i=$("<div><\/div>").prependTo(t);this._$container=i;b.using(["VersionControl/Scripts/Components/PullRequestReview/DiscussionThreadHost"],function(n){n.DiscussionThreadHost.createDiscussionThread(i,r._thread,r)})},n.prototype.sizeChanged=function(n){this._widget&&this._widget.handleResize(n)},n.prototype.hostShouldUnmount=function(){this.dispose()},n.prototype.dispose=function(){var n=this;this.sizeChanged(!1);b.using(["VersionControl/Scripts/Components/PullRequestReview/DiscussionThreadHost"],function(t){t.DiscussionThreadHost.removeDiscussionThread(n._$container);n._thread&&n._thread.id<0&&n._thread.comments&&n._thread.comments.length===0&&n._monacoDiscussionThreadManager.getEditor(n._isOriginalSide).focus()});this._widget&&(this._widget.handleDiscussionContentRemoved(this),this._monacoDiscussionThreadManager._releaseWidgetReference(this._widget),this._widget=null);this._lineDecorationId&&(this._monacoDiscussionThreadManager.getEditor(this._isOriginalSide).deltaDecorations([this._lineDecorationId],[]),this._lineDecorationId=null)},n.prototype.setZoneWidget=function(n){this._widget=n;n.isNewControl=!0;n.appendDiscussionContent(this);this._position&&this._position.positionContext!==l.PositionContext.InLineBuffer&&(this._lineDecorationId=this._monacoDiscussionThreadManager.getEditor(this._isOriginalSide).deltaDecorations([],[{range:{startLineNumber:this._position.startLine,startColumn:this._position.startColumn,endLineNumber:this._position.endLine,endColumn:this._position.endColumn},options:{inlineClassName:"commented-text"}}])[0])},n.prototype.setSelectedState=function(){},n.prototype.scrollIntoView=function(){this._widget&&this._widget.scrollIntoView()},n.prototype.updateCommentSizes=function(){},n.prototype.focus=function(){this.scrollIntoView()},n.prototype.getThread=function(){return this._thread},n.prototype.removeComment=function(){return this._widget&&this._widget.handleResize(),!1},n.prototype.getCommentControl=function(){return null},n.prototype.updateCommentId=function(){},n.prototype.handleUpdatedThreadId=function(){},n.CSS_CLASS_MENTION_OVERFLOW_VISIBLE="mention-overflow-visible",n}();var pt=[{token:"comment",foreground:"007200"},{token:"number",foreground:"007200"},{token:"debug-token",foreground:"800080"},{token:"error-token",foreground:"CD3131",fontStyle:"bold"},{token:"info-token",foreground:"316BCD"},{token:"warn-token",foreground:"EE7600",fontStyle:"bold"},],wt=[{token:"debug-token",foreground:"B267E6"},{token:"error-token",foreground:"FF0000",fontStyle:"bold"},{token:"info-token",foreground:"6796E6"},{token:"warn-token",foreground:"EE7600",fontStyle:"bold"},],d={ignoreConfigurationChangedEvent:!1,editor:{lineNumbers:"on",minimap:{},wrappingIndent:"same"}}});
//direct-dependencies=BuiltInExtensions/Scripts/TFS.Extension,BuiltInExtensions/Scripts/Resources/TFS.Resources.CodeEditor,VSS/Controls/PopupContent,VSS/Utils/Array,VSS/Utils/Core,VSS/Utils/String,VSS/Utils/UI,VSS/Utils/Url,VSS/Utils/Clipboard,Presentation/Scripts/TFS/TFS.Discussion.Common,Presentation/Scripts/TFS/TFS.Discussion.Common.UI,Presentation/Scripts/TFS/Resources/TFS.Resources.Discussion,Presentation/Scripts/URI,BuiltInExtensions/Scripts/TFS.Extensions.CodeEditor.Adornments,VSS/Diag,VSS/VSS,VSS/Locations,Mention/Scripts/TFS.Mention.WorkItems
